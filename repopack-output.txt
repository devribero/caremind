This file is a merged representation of the entire codebase, combining all repository files into a single document.
Generated by Repopack on: 2025-11-14T16:56:10.136Z

================================================================
File Summary
================================================================

Purpose:
--------
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.

File Format:
------------
The content is organized as follows:
1. This summary section
2. Repository information
3. Repository structure
4. Multiple file entries, each consisting of:
  a. A separator line (================)
  b. The file path (File: path/to/file)
  c. Another separator line
  d. The full contents of the file
  e. A blank line

Usage Guidelines:
-----------------
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.

Notes:
------
- Some files may have been excluded based on .gitignore rules and Repopack's
  configuration.
- Binary files are not included in this packed representation. Please refer to
  the Repository Structure section for a complete list of file paths, including
  binary files.

Additional Info:
----------------

For more information about Repopack, visit: https://github.com/yamadashy/repopack

================================================================
Repository Structure
================================================================
.eslintignore
.gitignore
eslint.config.mjs
next.config.ts
package.json
public/fallback-ce627215c0e4a9af.js
public/icons/back.svg
public/icons/file.svg
public/icons/globe.svg
public/icons/next.svg
public/icons/vercel.svg
public/icons/window.svg
public/images/hero-elderly.svg
public/manifest.json
public/sw.js
public/swe-worker-5c72df51bb1f6ee0.js
public/workbox-c2c0676f.js
src/app/(dashboard)/compromissos/page.tsx
src/app/(dashboard)/configuracoes/page.tsx
src/app/(dashboard)/dashboard/page.module.css
src/app/(dashboard)/dashboard/page.tsx
src/app/(dashboard)/familia/page.tsx
src/app/(dashboard)/familiar-dashboard/page.tsx
src/app/(dashboard)/integracoes/page.module.css
src/app/(dashboard)/integracoes/page.tsx
src/app/(dashboard)/layout.tsx
src/app/(dashboard)/perfil/modal.module.css
src/app/(dashboard)/perfil/page.module.css
src/app/(dashboard)/perfil/page.tsx
src/app/(dashboard)/relatorios/page.module.css
src/app/(dashboard)/relatorios/page.tsx
src/app/(dashboard)/remedios/page.module.css
src/app/(dashboard)/remedios/page.tsx
src/app/(dashboard)/rotinas/page.module.css
src/app/(dashboard)/rotinas/page.tsx
src/app/ajuda/page.tsx
src/app/api/agenda/route.ts
src/app/api/change-password/route.ts
src/app/api/compromissos/[id]/route.ts
src/app/api/compromissos/route.ts
src/app/api/criar-idoso/route.ts
src/app/api/historico_eventos/[id]/route.ts
src/app/api/medicamentos/[id]/route.ts
src/app/api/medicamentos/route.ts
src/app/api/perfil/[id]/route.ts
src/app/api/perfil/route.ts
src/app/api/relatorios/historico/route.ts
src/app/api/rotinas/[id]/route.ts
src/app/api/rotinas/route.ts
src/app/api/vinculos/[id]/route.ts
src/app/api/vinculos/idosos/route.ts
src/app/auth/AuthClient.tsx
src/app/auth/page.module.css
src/app/auth/page.tsx
src/app/blog/page.tsx
src/app/contato/page.tsx
src/app/cookies/page.tsx
src/app/forgot-password/page.module.css
src/app/forgot-password/page.tsx
src/app/funcionalidades/page.tsx
src/app/globals.css
src/app/layout.tsx
src/app/offline/offline.module.css
src/app/offline/page.tsx
src/app/onboarding/page.tsx
src/app/page.module.css
src/app/page.tsx
src/app/politica-privacidade/page.module.css
src/app/politica-privacidade/page.tsx
src/app/privacidade/page.module.css
src/app/privacidade/page.tsx
src/app/reset-password/page.tsx
src/app/seguranca/page.tsx
src/app/sobre/page.tsx
src/app/status/page.tsx
src/app/termos/page.module.css
src/app/termos/page.tsx
src/components/ClientAreaHeader.module.css
src/components/ClientAreaHeader.tsx
src/components/ConfirmDialog.module.css
src/components/ConfirmDialog.tsx
src/components/dashboard/DashboardOverview.module.css
src/components/dashboard/DashboardOverview.tsx
src/components/DashboardClient.module.css
src/components/DashboardClient.tsx
src/components/DevUnhandledRejectionLogger.tsx
src/components/EditProfileModal.module.css
src/components/EditProfileModal.tsx
src/components/ErrorBoundary.tsx
src/components/Footer.module.css
src/components/Footer.tsx
src/components/forms/AddForm.module.css
src/components/forms/AddMedicamentoForm.tsx
src/components/forms/AddRotinaForm.tsx
src/components/FullScreenLoader.module.css
src/components/FullScreenLoader.tsx
src/components/Header/Header.module.css
src/components/Header/Header.tsx
src/components/headers/Header.module.css
src/components/headers/HeaderDashboard.module.css
src/components/headers/HeaderDashboard.tsx
src/components/headers/HeaderHome.module.css
src/components/headers/HeaderHome.tsx
src/components/headers/HeaderLogin.module.css
src/components/headers/HeaderLogin.tsx
src/components/InstallPWA.module.css
src/components/InstallPWA.tsx
src/components/layout/AppLayout.module.css
src/components/layout/AppLayout.tsx
src/components/layout/HeaderDashboard.module.css
src/components/layout/HeaderDashboard.tsx
src/components/layout/SidebarDashboard.module.css
src/components/layout/SidebarDashboard.tsx
src/components/MedicamentoCard.module.css
src/components/MedicamentoCard.tsx
src/components/Modal.module.css
src/components/Modal.tsx
src/components/modals/AddEditCompromissoModal.module.css
src/components/modals/AddEditCompromissoModal.tsx
src/components/modals/AddIdosoModal.module.css
src/components/modals/AddIdosoModal.tsx
src/components/perfil/GerenciarIdososVinculados.tsx
src/components/ProtectedRoute.tsx
src/components/RotinasCard.module.css
src/components/RotinasCard.tsx
src/components/Toast.tsx
src/components/ui/button.tsx
src/components/Waves.tsx
src/contexts/AuthContext.tsx
src/contexts/IdosoContext.tsx
src/contexts/LoadingContext.tsx
src/contexts/ProfileContext.tsx
src/hooks/index.ts
src/hooks/use-pwa.ts
src/hooks/useApiRequest.ts
src/hooks/useAuthRequest.ts
src/hooks/useCrudOperations.ts
src/hooks/useModalState.ts
src/hooks/useOptimisticUpdates.ts
src/hooks/useOptimizedNavigation.ts
src/hooks/usePersistentState.ts
src/lib/medicamentoUtils.ts
src/lib/services/passwordService.ts
src/lib/services/ProfileService.ts
src/lib/supabase/client.ts
src/lib/supabase/server.ts
src/lib/utils.ts
src/middleware.ts
src/utils/errorHandler.ts
src/utils/errors.ts
tsconfig.json

================================================================
Repository Files
================================================================

================
File: .eslintignore
================
node_modules
.next
out
public
*.config.js
*.config.ts

================
File: .gitignore
================
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
/node_modules
/.pnp
.pnp.*
.yarn/*
!.yarn/patches
!.yarn/plugins
!.yarn/releases
!.yarn/versions

# testing
/coverage

# next.js
/.next/
/out/

# production
/build

# misc
.DS_Store
*.pem

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.pnpm-debug.log*

# env files (can opt-in for committing if needed)
.env*

# vercel
.vercel

# typescript
*.tsbuildinfo
next-env.d.ts

================
File: eslint.config.mjs
================
import { dirname } from "path";
import { fileURLToPath } from "url";
import { FlatCompat } from "@eslint/eslintrc";

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

const compat = new FlatCompat({
  baseDirectory: __dirname,
  recommendedConfig: {
    env: {
      es2022: true,
      node: true,
      browser: true,
    },
    parserOptions: {
      ecmaVersion: "latest",
      sourceType: "module",
      ecmaFeatures: {
        jsx: true,
      },
    },
    settings: {
      react: {
        version: "detect",
      },
      next: {
        rootDir: ["app/*/", "pages/*/", "components/*/"],
      },
    },
  },
});

const eslintConfig = [
  ...compat.extends(
    "next/core-web-vitals",
    "next/typescript",
    "plugin:@typescript-eslint/recommended",
    "plugin:react-hooks/recommended"
  ),
  {
    rules: {
      // Desativa regras problemáticas
      "@typescript-eslint/no-explicit-any": "off",
      "@typescript-eslint/no-unused-vars": "warn",
      "react-hooks/exhaustive-deps": "warn",
      "react/no-unescaped-entities": "off",
      "react/jsx-no-undef": "error",
      "react/react-in-jsx-scope": "off",
      "react/prop-types": "off",
      "react/display-name": "off",
      "@next/next/no-page-custom-font": "off",
      "@typescript-eslint/no-empty-object-type": "off",
      // Adiciona regras personalizadas
      "no-console": ["warn", { allow: ["warn", "error"] }],
      "prefer-const": "warn",
      "no-unused-vars": "off", // Desativa a regra padrão em favor da do TypeScript
      "@typescript-eslint/no-unused-vars": [
        "warn",
        {
          argsIgnorePattern: "^_",
          varsIgnorePattern: "^_",
          caughtErrorsIgnorePattern: "^_",
        },
      ],
      "react-hooks/rules-of-hooks": "error",
      "react-hooks/exhaustive-deps": [
        "warn",
        {
          additionalHooks: "(useAsyncEffect|useAsyncCallback)",
        },
      ],
    },
  },
  {
    files: ["**/*.ts", "**/*.tsx"],
    languageOptions: {
      parserOptions: {
        project: "./tsconfig.json",
      },
    },
  },
];

export default eslintConfig;

================
File: next.config.ts
================
import type { NextConfig } from "next";
import withPWAInit from "@ducanh2912/next-pwa";
const path = require('path');

// Lógica para extrair o hostname da URL do Supabase
const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;
const dynamicRemotePatterns = [];

try {
  if (supabaseUrl) {
    const host = new URL(supabaseUrl).host;
    dynamicRemotePatterns.push({ 
      protocol: 'https', 
      hostname: host,
      pathname: '/storage/v1/object/public/**',
    });
  }
} catch (e) {
  // ignora erro se a URL do ENV for inválida
}

const nextConfig: NextConfig = {
  env: {
    NEXT_PUBLIC_API_URL: process.env.NEXT_PUBLIC_API_URL,
  },
  experimental: {
    optimizePackageImports: ['@radix-ui/react-icons'],
  },
  images: {
    remotePatterns: [
      ...dynamicRemotePatterns,
    ],
  },
  outputFileTracingRoot: path.resolve(__dirname),
  serverExternalPackages: [
    '@supabase/realtime-js',
    '@supabase/supabase-js',
  ],
  eslint: { ignoreDuringBuilds: true },
  typescript: { ignoreBuildErrors: true },
  async headers() {
    const imgSrcHosts = [];
    if (Array.isArray(dynamicRemotePatterns)) {
      for (const p of dynamicRemotePatterns) {
        if (p && p.hostname) imgSrcHosts.push(`https://${p.hostname}`);
      }
    }

  const cspParts = [
      "default-src 'self'",
      "base-uri 'self'",
  `img-src 'self' data: blob: ${imgSrcHosts.join(' ')}`.trim(),
  "script-src 'self' https://cdn.jsdelivr.net",
  "script-src-attr 'none'",
  "object-src 'none'",
  "style-src 'self' https://fonts.googleapis.com",
  "style-src-elem 'self' https://fonts.googleapis.com",
  "style-src-attr 'unsafe-inline'",
  "font-src 'self' data: https://fonts.gstatic.com",
  // permitir fetchs para CDN de ícones e assets (bootstrap icons via jsdelivr)
  "connect-src 'self' https://cdn.jsdelivr.net",
      "media-src 'self'",
      (() => {
        const hosts = [];
        if (Array.isArray(dynamicRemotePatterns)) {
          for (const p of dynamicRemotePatterns) {
            if (p && p.hostname) {
              hosts.push(`https://${p.hostname}`);
              hosts.push(`wss://${p.hostname}`);
            }
          }
        }
        return ["connect-src 'self' https://cdn.jsdelivr.net", ...hosts].join(' ');
      })(),
      "worker-src 'self' blob:",
      "frame-ancestors 'self'",
      "upgrade-insecure-requests",
    ];

    const csp = cspParts.filter(Boolean).join('; ');

    return [
      {
        source: '/(.*)',
        headers: [
          { key: 'Content-Security-Policy', value: csp },
          { key: 'Referrer-Policy', value: 'strict-origin-when-cross-origin' },
          { key: 'X-Content-Type-Options', value: 'nosniff' },
          { key: 'X-Frame-Options', value: 'SAMEORIGIN' },
          { key: 'X-XSS-Protection', value: '0' },
          { key: 'Permissions-Policy', value: 'camera=(), microphone=(), geolocation=()' },
          { key: 'Cross-Origin-Opener-Policy', value: 'same-origin' },
          { key: 'Cross-Origin-Embedder-Policy', value: 'require-corp' },
          { key: 'Strict-Transport-Security', value: 'max-age=15552000; includeSubDomains' },
        ],
      },
    ];
  },
};

const withPWA = withPWAInit({
  dest: "public",
  cacheOnFrontEndNav: true,
  aggressiveFrontEndNavCaching: true,
  reloadOnOnline: true,
  disable: process.env.NODE_ENV === "development",
  workboxOptions: {
    disableDevLogs: true,
  },
  fallbacks: {
    document: "/offline",
  },
});

export default withPWA(nextConfig);

================
File: package.json
================
{
  "name": "caremind",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint",
    "lint:fix": "eslint . --ext .ts,.tsx --fix"
  },
  "dependencies": {
    "@ducanh2912/next-pwa": "^10.2.9",
    "@radix-ui/react-slot": "^1.2.3",
    "@supabase/auth-helpers-nextjs": "^0.10.0",
    "@supabase/ssr": "^0.7.0",
    "@supabase/supabase-js": "^2.57.2",
    "@vercel/analytics": "^1.5.0",
    "@vercel/speed-insights": "^1.2.0",
    "chart.js": "^4.5.0",
    "class-variance-authority": "^0.7.1",
    "framer-motion": "^12.23.24",
    "geist": "^1.4.2",
    "lucide-react": "^0.542.0",
    "next": "^15.5.4",
    "next-pwa": "^5.6.0",
    "next-themes": "^0.4.6",
    "qrcode.react": "^4.2.0",
    "react": "^18.3.1",
    "react-chartjs-2": "^5.3.0",
    "react-dom": "^18.3.1",
    "react-icons": "^5.5.0",
    "tailwind-merge": "^3.3.1"
  },
  "devDependencies": {
    "@eslint/eslintrc": "^3",
    "@types/node": "20.19.23",
    "@types/react": "18.3.26",
    "@types/react-dom": "^18.3.0",
    "@typescript-eslint/eslint-plugin": "^8.46.4",
    "@typescript-eslint/parser": "^8.46.4",
    "eslint": "^9",
    "eslint-config-next": "^15.4.6",
    "eslint-plugin-react-hooks": "^7.0.1",
    "typescript": "5.9.3"
  }
}

================
File: public/fallback-ce627215c0e4a9af.js
================
(()=>{var e={907:e=>{var t,r,n,o=e.exports={};function i(){throw Error("setTimeout has not been defined")}function c(){throw Error("clearTimeout has not been defined")}try{t="function"==typeof setTimeout?setTimeout:i}catch(e){t=i}try{r="function"==typeof clearTimeout?clearTimeout:c}catch(e){r=c}function u(e){if(t===setTimeout)return setTimeout(e,0);if((t===i||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}var a=[],s=!1,l=-1;function f(){s&&n&&(s=!1,n.length?a=n.concat(a):l=-1,a.length&&_())}function _(){if(!s){var e=u(f);s=!0;for(var t=a.length;t;){for(n=a,a=[];++l<t;)n&&n[l].run();l=-1,t=a.length}n=null,s=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===c||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function A(){}o.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];a.push(new h(e,t)),1!==a.length||s||u(_)},h.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=A,o.addListener=A,o.once=A,o.off=A,o.removeListener=A,o.removeAllListeners=A,o.emit=A,o.prependListener=A,o.prependOnceListener=A,o.listeners=function(e){return[]},o.binding=function(e){throw Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw Error("process.chdir is not supported")},o.umask=function(){return 0}}},t={};(()=>{"use strict";var r=function r(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={exports:{}},c=!0;try{e[n](i,i.exports,r),c=!1}finally{c&&delete t[n]}return i.exports}(907);self.fallback=async e=>{let{destination:t,url:n}=e,o={document:"/offline",image:r.env.__PWA_FALLBACK_IMAGE__,audio:r.env.__PWA_FALLBACK_AUDIO__,video:r.env.__PWA_FALLBACK_VIDEO__,font:r.env.__PWA_FALLBACK_FONT__}[t];return o?caches.match(o,{ignoreSearch:!0}):""===t&&r.env.__PWA_FALLBACK_DATA__&&n.match(/\/_next\/data\/.+\/.+\.json$/i)?caches.match(r.env.__PWA_FALLBACK_DATA__,{ignoreSearch:!0}):Response.error()}})()})();

================
File: public/icons/back.svg
================
<?xml version="1.0" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20010904//EN"
        "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd">
<svg version="1.0" xmlns="http://www.w3.org/2000/svg"
     width="512.000000pt" height="512.000000pt" viewBox="0 0 512.000000 512.000000"
     preserveAspectRatio="xMidYMid meet">

    <g transform="translate(0.000000,512.000000) scale(0.100000,-0.100000)"
       fill="#0400BA" stroke="none">
        <path d="M1850 4257 c-27 -8 -212 -187 -813 -786 -466 -464 -787 -792 -800
-816 -28 -54 -28 -136 0 -190 32 -59 1547 -1570 1595 -1590 177 -73 359 110
279 280 -13 27 -205 225 -590 610 -314 313 -571 573 -571 577 0 4 859 9 1909
10 l1909 3 44 30 c138 97 118 306 -34 370 -33 13 -245 15 -1933 15 -1042 0
-1895 3 -1895 7 0 4 263 271 584 593 573 574 584 586 594 635 35 169 -112 302
-278 252z"/>
    </g>
</svg>

================
File: public/icons/file.svg
================
<svg fill="none" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M14.5 13.5V5.41a1 1 0 0 0-.3-.7L9.8.29A1 1 0 0 0 9.08 0H1.5v13.5A2.5 2.5 0 0 0 4 16h8a2.5 2.5 0 0 0 2.5-2.5m-1.5 0v-7H8v-5H3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1M9.5 5V2.12L12.38 5zM5.13 5h-.62v1.25h2.12V5zm-.62 3h7.12v1.25H4.5zm.62 3h-.62v1.25h7.12V11z" clip-rule="evenodd" fill="#666" fill-rule="evenodd"/></svg>

================
File: public/icons/globe.svg
================
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><g clip-path="url(#a)"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.27 14.1a6.5 6.5 0 0 0 3.67-3.45q-1.24.21-2.7.34-.31 1.83-.97 3.1M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16m.48-1.52a7 7 0 0 1-.96 0H7.5a4 4 0 0 1-.84-1.32q-.38-.89-.63-2.08a40 40 0 0 0 3.92 0q-.25 1.2-.63 2.08a4 4 0 0 1-.84 1.31zm2.94-4.76q1.66-.15 2.95-.43a7 7 0 0 0 0-2.58q-1.3-.27-2.95-.43a18 18 0 0 1 0 3.44m-1.27-3.54a17 17 0 0 1 0 3.64 39 39 0 0 1-4.3 0 17 17 0 0 1 0-3.64 39 39 0 0 1 4.3 0m1.1-1.17q1.45.13 2.69.34a6.5 6.5 0 0 0-3.67-3.44q.65 1.26.98 3.1M8.48 1.5l.01.02q.41.37.84 1.31.38.89.63 2.08a40 40 0 0 0-3.92 0q.25-1.2.63-2.08a4 4 0 0 1 .85-1.32 7 7 0 0 1 .96 0m-2.75.4a6.5 6.5 0 0 0-3.67 3.44 29 29 0 0 1 2.7-.34q.31-1.83.97-3.1M4.58 6.28q-1.66.16-2.95.43a7 7 0 0 0 0 2.58q1.3.27 2.95.43a18 18 0 0 1 0-3.44m.17 4.71q-1.45-.12-2.69-.34a6.5 6.5 0 0 0 3.67 3.44q-.65-1.27-.98-3.1" fill="#666"/></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h16v16H0z"/></clipPath></defs></svg>

================
File: public/icons/next.svg
================
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 394 80"><path fill="#000" d="M262 0h68.5v12.7h-27.2v66.6h-13.6V12.7H262V0ZM149 0v12.7H94v20.4h44.3v12.6H94v21h55v12.6H80.5V0h68.7zm34.3 0h-17.8l63.8 79.4h17.9l-32-39.7 32-39.6h-17.9l-23 28.6-23-28.6zm18.3 56.7-9-11-27.1 33.7h17.8l18.3-22.7z"/><path fill="#000" d="M81 79.3 17 0H0v79.3h13.6V17l50.2 62.3H81Zm252.6-.4c-1 0-1.8-.4-2.5-1s-1.1-1.6-1.1-2.6.3-1.8 1-2.5 1.6-1 2.6-1 1.8.3 2.5 1a3.4 3.4 0 0 1 .6 4.3 3.7 3.7 0 0 1-3 1.8zm23.2-33.5h6v23.3c0 2.1-.4 4-1.3 5.5a9.1 9.1 0 0 1-3.8 3.5c-1.6.8-3.5 1.3-5.7 1.3-2 0-3.7-.4-5.3-1s-2.8-1.8-3.7-3.2c-.9-1.3-1.4-3-1.4-5h6c.1.8.3 1.6.7 2.2s1 1.2 1.6 1.5c.7.4 1.5.5 2.4.5 1 0 1.8-.2 2.4-.6a4 4 0 0 0 1.6-1.8c.3-.8.5-1.8.5-3V45.5zm30.9 9.1a4.4 4.4 0 0 0-2-3.3 7.5 7.5 0 0 0-4.3-1.1c-1.3 0-2.4.2-3.3.5-.9.4-1.6 1-2 1.6a3.5 3.5 0 0 0-.3 4c.3.5.7.9 1.3 1.2l1.8 1 2 .5 3.2.8c1.3.3 2.5.7 3.7 1.2a13 13 0 0 1 3.2 1.8 8.1 8.1 0 0 1 3 6.5c0 2-.5 3.7-1.5 5.1a10 10 0 0 1-4.4 3.5c-1.8.8-4.1 1.2-6.8 1.2-2.6 0-4.9-.4-6.8-1.2-2-.8-3.4-2-4.5-3.5a10 10 0 0 1-1.7-5.6h6a5 5 0 0 0 3.5 4.6c1 .4 2.2.6 3.4.6 1.3 0 2.5-.2 3.5-.6 1-.4 1.8-1 2.4-1.7a4 4 0 0 0 .8-2.4c0-.9-.2-1.6-.7-2.2a11 11 0 0 0-2.1-1.4l-3.2-1-3.8-1c-2.8-.7-5-1.7-6.6-3.2a7.2 7.2 0 0 1-2.4-5.7 8 8 0 0 1 1.7-5 10 10 0 0 1 4.3-3.5c2-.8 4-1.2 6.4-1.2 2.3 0 4.4.4 6.2 1.2 1.8.8 3.2 2 4.3 3.4 1 1.4 1.5 3 1.5 5h-5.8z"/></svg>

================
File: public/icons/vercel.svg
================
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1155 1000"><path d="m577.3 0 577.4 1000H0z" fill="#fff"/></svg>

================
File: public/icons/window.svg
================
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.5 2.5h13v10a1 1 0 0 1-1 1h-11a1 1 0 0 1-1-1zM0 1h16v11.5a2.5 2.5 0 0 1-2.5 2.5h-11A2.5 2.5 0 0 1 0 12.5zm3.75 4.5a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5M7 4.75a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0m1.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5" fill="#666"/></svg>

================
File: public/images/hero-elderly.svg
================
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 500 500"><g id="freepik--Shadow--inject-93"><ellipse id="freepik--path--inject-93" cx="250" cy="416.24" rx="193.89" ry="11.32" style="fill:#f5f5f5"></ellipse></g><g id="freepik--Puzzle--inject-93"><path d="M322.89,367.37c-4.68-16.69,10-45.28,10-45.28s26.52,9.87,37.46,5.49c5-2,7.26-19.51,8.33-23.73.55-2.15,6.55-5.48,7.32-7.23,1.3-3-3-7.49-3-7.49s5.91-3.91,6.66-5.49c1.71-3.6-2.66-3-.83-14.15,0,0,14-3.33,14-9,0,0-17.73-14.5-15.31-29,.49-3,1-6.39,1.42-10.1h-7.3l.69-.82a3.34,3.34,0,1,0-5.1,0l.68.82H366.36v10.25a3.91,3.91,0,0,1,2.44-.87,3.87,3.87,0,0,1,0,7.74,3.92,3.92,0,0,1-2.44-.86v22.17l-.82-.68a3.34,3.34,0,1,0,0,5.11l.82-.68V275.4H355.7a3.87,3.87,0,1,1-6.87,2.44,3.92,3.92,0,0,1,.86-2.44H327.53l.68-.82a3.34,3.34,0,1,0-5.12,0l.68.82H312.39v10.36a4,4,0,0,1,2.44-.85,3.87,3.87,0,0,1,0,7.73,3.92,3.92,0,0,1-2.44-.86v10.61h-11.9l.67-.82a3.37,3.37,0,0,0,.77-2.15,3.33,3.33,0,1,0-5.88,2.15l.68.82H274.56a3.87,3.87,0,1,1-6,0H257.72c0,18.76-3.26,42-15.79,62.45-20,11.75-28.1,36.45-29,53H371.42c-.61-2.87-5.57-18.95-41.37-38.62C326.49,374.79,323.8,370.64,322.89,367.37Z" style="fill:#407BFF"></path><path d="M332.78,106.34a3.84,3.84,0,0,0,6.91-.82l5.47,8.83-9.2,5.71a.23.23,0,0,0-.1.24.22.22,0,0,0,.18.19,3.37,3.37,0,1,1-3.8,2.36.24.24,0,0,0-.08-.25.24.24,0,0,0-.27,0l-9.26,5.74-5.47-8.83a3.94,3.94,0,0,0,2.57-.54,3.84,3.84,0,0,0-4.05-6.53,3.91,3.91,0,0,0-1.63,2.06l-5.39-8.69,9.26-5.74a.24.24,0,0,0,.11-.24.25.25,0,0,0-.19-.19,3.41,3.41,0,0,1-2.3-1.55,3.37,3.37,0,1,1,5.73-3.55,3.34,3.34,0,0,1,.37,2.74.23.23,0,0,0,.09.25.23.23,0,0,0,.26,0l9.21-5.71,5.38,8.69a3.81,3.81,0,0,0-2.56.54A3.85,3.85,0,0,0,332.78,106.34Z" style="fill:#407BFF"></path><path d="M365.86,193.94H355.63a3.83,3.83,0,0,0-2.93-6.3,3.83,3.83,0,0,0-2.94,6.3H339.34V183a.23.23,0,0,0-.41-.15,3.34,3.34,0,0,1-2.52,1.13,3.37,3.37,0,0,1,0-6.74,3.34,3.34,0,0,1,2.52,1.13.24.24,0,0,0,.41-.16V167.43h10.42a3.83,3.83,0,1,0,6.77,2.47,3.76,3.76,0,0,0-.9-2.47h10.23V178.2a.24.24,0,0,0,.41.16,3.41,3.41,0,0,1,2.53-1.13,3.37,3.37,0,0,1,0,6.74,3.41,3.41,0,0,1-2.53-1.13.23.23,0,0,0-.26-.07.25.25,0,0,0-.15.22Z" style="fill:#407BFF"></path><path d="M241.51,179.41a.26.26,0,0,0-.27,0,3.37,3.37,0,1,1,1.62-4.15.24.24,0,0,0,.22.15.21.21,0,0,0,.22-.14l4-10.21,9.64,3.77a3.83,3.83,0,1,0,5.47,2.13l9.59,3.75-4,10.21a.21.21,0,0,0,.06.25.23.23,0,0,0,.26,0,3.33,3.33,0,0,1,2.76-.15,3.37,3.37,0,1,1-2.45,6.28,3.34,3.34,0,0,1-1.93-2,.23.23,0,0,0-.44,0l-3.93,10.07-9.59-3.75a3.84,3.84,0,1,0-5.47-2.14l-9.64-3.76,3.93-10.07A.25.25,0,0,0,241.51,179.41Z" style="fill:#407BFF"></path><path d="M312,236.85a.23.23,0,0,0-.15.22v10.85H301.54a3.9,3.9,0,0,0,.89-2.47,3.84,3.84,0,1,0-7.67,0,3.93,3.93,0,0,0,.9,2.47H285.37V237.07a.24.24,0,0,0-.41-.16,3.37,3.37,0,1,1-2.53-5.6,3.41,3.41,0,0,1,2.53,1.15.24.24,0,0,0,.41-.16V221.4h10.29a3.93,3.93,0,0,0-.9,2.47,3.84,3.84,0,1,0,7.67,0,3.9,3.9,0,0,0-.89-2.47h10.35v10.9a.24.24,0,0,0,.41.16,3.41,3.41,0,0,1,2.53-1.15,3.38,3.38,0,1,1-2.53,5.6A.23.23,0,0,0,312,236.85Z" style="fill:#407BFF"></path><path d="M264.77,129.6a.22.22,0,0,0-.22.16L260.89,140l-9.74-3.49a3.84,3.84,0,1,0-5.54-2L235.92,131l3.66-10.21a.23.23,0,0,0-.07-.26.25.25,0,0,0-.26,0,3.37,3.37,0,1,1-.49-6.12,3.44,3.44,0,0,1,2,1.93.25.25,0,0,0,.22.15.27.27,0,0,0,.22-.16l3.68-10.26,9.69,3.47a3.87,3.87,0,0,0-1.68,2,3.84,3.84,0,1,0,7.22,2.59,3.89,3.89,0,0,0,0-2.63l9.75,3.49-3.68,10.27a.23.23,0,0,0,.06.26.26.26,0,0,0,.27,0,3.41,3.41,0,0,1,2.77-.23,3.37,3.37,0,1,1-4.27,4.42A.25.25,0,0,0,264.77,129.6Z" style="fill:#407BFF"></path><path d="M194.12,100.11a.25.25,0,0,0,.1.25l8.89,6.22-5.93,8.48a3.88,3.88,0,0,0-1.51-2.15,3.84,3.84,0,0,0-4.4,6.29,3.94,3.94,0,0,0,2.54.68l-5.89,8.44L179,122.1a.23.23,0,0,0-.36.24,3.37,3.37,0,1,1-6-1.13,3.44,3.44,0,0,1,2.39-1.42.23.23,0,0,0,.1-.42l-8.93-6.25,5.9-8.44a3.88,3.88,0,0,0,1.5,2.15,3.83,3.83,0,1,0,4.4-6.28,3.89,3.89,0,0,0-2.54-.69l5.93-8.48,8.94,6.25a.26.26,0,0,0,.27,0,.22.22,0,0,0,.09-.25,3.46,3.46,0,0,1,.51-2.73,3.37,3.37,0,1,1,3.14,5.28A.25.25,0,0,0,194.12,100.11Z" style="fill:#407BFF"></path><path d="M279.06,288.77a3.37,3.37,0,0,1,3.37-3.36,3.44,3.44,0,0,1,2.53,1.12.22.22,0,0,0,.26.06.23.23,0,0,0,.15-.21v-11h10.29a3.93,3.93,0,0,0-.9,2.47,3.84,3.84,0,1,0,7.67,0,3.9,3.9,0,0,0-.89-2.47h10.35v11a.23.23,0,0,0,.15.21.22.22,0,0,0,.26-.06,3.44,3.44,0,0,1,2.53-1.12,3.37,3.37,0,0,1,0,6.73A3.41,3.41,0,0,1,312.3,291a.24.24,0,0,0-.41.16v10.72H301.54a3.9,3.9,0,0,0,.89-2.47,3.84,3.84,0,1,0-7.67,0,3.93,3.93,0,0,0,.9,2.47H285.37V291.17A.24.24,0,0,0,285,291a3.41,3.41,0,0,1-2.53,1.13A3.37,3.37,0,0,1,279.06,288.77Z" style="fill:#407BFF"></path><path d="M312.36,264.12a.23.23,0,0,0-.15-.21.22.22,0,0,0-.26.06,3.37,3.37,0,1,1,0-4.47.23.23,0,0,0,.26.06.23.23,0,0,0,.15-.21v-11H322.7a3.84,3.84,0,1,0,5.9,0h10.27v11a.23.23,0,0,0,.15.21.23.23,0,0,0,.26-.06,3.41,3.41,0,0,1,2.53-1.13,3.37,3.37,0,1,1,0,6.73,3.41,3.41,0,0,1-2.53-1.13.22.22,0,0,0-.26-.06.23.23,0,0,0-.15.21V274.9H328.6a3.84,3.84,0,1,0-6.79-2.47,3.8,3.8,0,0,0,.89,2.47H312.36Z" style="fill:#407BFF"></path><path d="M308.71,181.47l10.83,1.17-1.11,10.24a3.84,3.84,0,1,0-.63,5.83L316.69,209l-10.83-1.17a.23.23,0,0,0-.23.12.24.24,0,0,0,0,.27,3.42,3.42,0,0,1,.84,2.63,3.36,3.36,0,1,1-6.69-.72,3.42,3.42,0,0,1,1.4-2.39.24.24,0,0,0-.11-.43l-10.78-1.16,1.11-10.29a3.84,3.84,0,1,0,.63-5.84l1.11-10.24L304,181a.25.25,0,0,0,.23-.12.24.24,0,0,0,0-.26,3.41,3.41,0,0,1-.86-2.64,3.36,3.36,0,0,1,6.69.72,3.41,3.41,0,0,1-1.38,2.4.22.22,0,0,0-.09.25A.22.22,0,0,0,308.71,181.47Z" style="fill:#407BFF"></path><path d="M296.21,274.9H285.37V264.67a3.84,3.84,0,1,0,0-5.87V248.39h10.84a.24.24,0,0,0,.22-.15.25.25,0,0,0-.06-.26,3.45,3.45,0,0,1-1.14-2.53,3.37,3.37,0,1,1,6.73,0,3.44,3.44,0,0,1-1.12,2.53.25.25,0,0,0-.06.26.24.24,0,0,0,.22.15h10.89V258.8a3.84,3.84,0,1,0,0,5.87V274.9H301a.24.24,0,0,0-.22.15.25.25,0,0,0,.06.26,3.44,3.44,0,0,1,1.12,2.53,3.37,3.37,0,1,1-6.73,0,3.45,3.45,0,0,1,1.14-2.53.25.25,0,0,0,.06-.26A.24.24,0,0,0,296.21,274.9Z" style="fill:#407BFF"></path><path d="M357.3,151.19a.23.23,0,0,0-.19.39,3.36,3.36,0,1,1-4.45-.38.25.25,0,0,0,.09-.25.23.23,0,0,0-.21-.17l-10.93-.95.91-10.42a3.85,3.85,0,0,0,6.54-2.39,3.85,3.85,0,0,0-6-3.47l.23-2.59a82.44,82.44,0,0,1,19.89,8.9,3.84,3.84,0,0,0,3.26,2.51,2.81,2.81,0,0,0,.41,0c.66.5,1.31,1,1.94,1.5l-.71,8.26Z" style="fill:#407BFF"></path><path d="M264.69,288.77a3.85,3.85,0,0,0-6.31-2.94V275.37h10.8a.24.24,0,0,0,.22-.15.23.23,0,0,0-.07-.26,3.37,3.37,0,1,1,4.46,0,.23.23,0,0,0-.07.26.25.25,0,0,0,.22.15h11v10.46a3.9,3.9,0,0,0-2.47-.89,3.84,3.84,0,1,0,2.47,6.78v10.17h-11a.25.25,0,0,0-.22.15.23.23,0,0,0,.07.26,3.37,3.37,0,1,1-4.46,0,.23.23,0,0,0,.07-.26.24.24,0,0,0-.22-.15h-10.8V291.72a3.85,3.85,0,0,0,6.31-3Z" style="fill:#407BFF"></path><path d="M257.91,286.38a.23.23,0,0,0,.15.21.2.2,0,0,0,.25-.06,3.48,3.48,0,0,1,2.54-1.12,3.37,3.37,0,1,1-2.53,5.6.23.23,0,0,0-.26-.06.23.23,0,0,0-.15.22v10.72h-.19a168.45,168.45,0,0,0-2.24-26.52h2.43Z" style="fill:#407BFF"></path><path d="M331.59,144.09a.23.23,0,0,0,.26-.06,3.41,3.41,0,0,1,2.53-1.13,3.37,3.37,0,1,1,0,6.73,3.44,3.44,0,0,1-2.53-1.12.23.23,0,0,0-.26-.07.25.25,0,0,0-.15.22v11H321.17a3.84,3.84,0,1,0-6.79-2.47,3.83,3.83,0,0,0,.9,2.47H304.93v-11a.25.25,0,0,0-.15-.22.22.22,0,0,0-.25.07,3.46,3.46,0,0,1-2.54,1.12,3.37,3.37,0,1,1,0-6.73,3.42,3.42,0,0,1,2.54,1.13.21.21,0,0,0,.25.06.23.23,0,0,0,.15-.22v-6.05c3.71.07,7.23.25,10.6.53a3.8,3.8,0,0,0,4.78.48q5.93.69,11.13,1.8v3.24A.23.23,0,0,0,331.59,144.09Z" style="fill:#407BFF"></path><path d="M366.33,159a52.21,52.21,0,0,1,9.19,8h-9.19Z" style="fill:#407BFF"></path><path d="M323.79,145.71l3.12.31a3.26,3.26,0,0,1-3.12-.31Z" style="fill:#407BFF"></path><path d="M154.15,223.32a3.84,3.84,0,0,0,7.38-2.14,3.91,3.91,0,0,0-1.55-2.12l10-2.91,3,10.47a.25.25,0,0,0,.2.17.24.24,0,0,0,.24-.13,3.41,3.41,0,0,1,2.11-1.81,3.37,3.37,0,1,1-.87,6.09.22.22,0,0,0-.27,0,.21.21,0,0,0-.08.25l3,10.42-10,2.91a3.83,3.83,0,1,0-7.33-1.81c-.83-1.12-1.61-2.27-2.31-3.44a112.34,112.34,0,0,1-8.48-17.11l5.09-1.48A3.9,3.9,0,0,0,154.15,223.32Z" style="fill:#407BFF"></path><path d="M169.57,156.74a.23.23,0,0,0,0-.26,3.37,3.37,0,1,1,4.41.73.23.23,0,0,0-.11.25.23.23,0,0,0,.19.18l10.86,1.81-1.69,10.15a3.79,3.79,0,0,0-2.27-1.29,3.84,3.84,0,0,0-1.27,7.58,3.8,3.8,0,0,0,2.58-.49l-1.7,10.21-10.86-1.81a.24.24,0,0,0-.24.12.23.23,0,0,0,0,.26,3.38,3.38,0,1,1-5.95,1.58,3.38,3.38,0,0,1,1.54-2.31.23.23,0,0,0,.11-.25A.25.25,0,0,0,165,183l-5.81-1a96.71,96.71,0,0,1,1.31-10,3.81,3.81,0,0,0,1.38-6.09,78.35,78.35,0,0,1,3.3-9.84l4.17.7A.24.24,0,0,0,169.57,156.74Z" style="fill:#407BFF"></path><path d="M381.9,194.09a.23.23,0,0,0,.06.26,3.38,3.38,0,1,1-4.45,0,.23.23,0,0,0,.06-.26.23.23,0,0,0-.22-.15h-11v-10.4a3.84,3.84,0,1,0,2.47-6.78,3.9,3.9,0,0,0-2.47.89V167.43H376c7,7.93,10.7,17.21,12.41,26.51h-6.24A.23.23,0,0,0,381.9,194.09Z" style="fill:#407BFF"></path><path d="M365.86,247.92H355.63a3.84,3.84,0,1,0-5.87,0H339.34V237.07a.24.24,0,0,0-.41-.16,3.33,3.33,0,0,1-2.52,1.15,3.38,3.38,0,1,1,2.52-5.6.24.24,0,0,0,.41-.16V221.4h10.42a3.84,3.84,0,0,0,2.94,6.31,3.84,3.84,0,0,0,2.93-6.31h10.23v10.9a.24.24,0,0,0,.41.16,3.38,3.38,0,1,1,0,4.45.23.23,0,0,0-.26-.06.23.23,0,0,0-.15.22Z" style="fill:#407BFF"></path><path d="M198.09,259.08a3.38,3.38,0,0,1,4.63,4.29.23.23,0,0,0,.06.26.25.25,0,0,0,.26,0l9.86-4.89,4.62,9.31a3.88,3.88,0,0,0-2.59.3,3.83,3.83,0,1,0,3.4,6.87,3.91,3.91,0,0,0,1.81-1.89l4.54,9.16-2.25,1.11c-3.2-4.41-5.35-6.87-5.35-6.87s-11.83-5.53-20.71-13.7A3.37,3.37,0,0,1,198.09,259.08Z" style="fill:#407BFF"></path><path d="M345.65,261.73a3.84,3.84,0,0,0-6.31-2.93V248.39h11a.24.24,0,0,0,.22-.15.25.25,0,0,0-.06-.26,3.37,3.37,0,0,1,2.23-5.9,3.36,3.36,0,0,1,3.36,3.37,3.44,3.44,0,0,1-1.13,2.53.23.23,0,0,0-.06.26.23.23,0,0,0,.22.15h10.77V258.8a3.84,3.84,0,1,0,0,5.87V274.9H355.09a.23.23,0,0,0-.22.15.23.23,0,0,0,.06.26,3.44,3.44,0,0,1,1.13,2.53,3.37,3.37,0,1,1-6.73,0,3.41,3.41,0,0,1,1.14-2.53.25.25,0,0,0,.06-.26.24.24,0,0,0-.22-.15h-11V264.67a3.84,3.84,0,0,0,6.31-2.94Z" style="fill:#407BFF"></path><path d="M383.58,218.46a3.84,3.84,0,1,0-6.78,2.47H366.33V210a.23.23,0,0,0-.15-.21.23.23,0,0,0-.26.06,3.37,3.37,0,1,1,0-4.46.23.23,0,0,0,.41-.15V194.41H376.8a3.85,3.85,0,1,0,5.87,0h5.78a95.47,95.47,0,0,1,.5,26.52h-6.28A3.84,3.84,0,0,0,383.58,218.46Z" style="fill:#407BFF"></path><path d="M322.89,367.37c-4.68-16.69,10-45.28,10-45.28s26.52,9.87,37.46,5.49c5-2,7.26-19.51,8.33-23.73.55-2.15,6.55-5.48,7.32-7.23,1.3-3-3-7.49-3-7.49s5.91-3.91,6.66-5.49c1.71-3.6-2.66-3-.83-14.15,0,0,14-3.33,14-9,0,0-17.73-14.5-15.31-29,.49-3,1-6.39,1.42-10.1h-7.3l.69-.82a3.34,3.34,0,1,0-5.1,0l.68.82H366.36v10.25a3.91,3.91,0,0,1,2.44-.87,3.87,3.87,0,0,1,0,7.74,3.92,3.92,0,0,1-2.44-.86v22.17l-.82-.68a3.34,3.34,0,1,0,0,5.11l.82-.68V275.4H355.7a3.87,3.87,0,1,1-6.87,2.44,3.92,3.92,0,0,1,.86-2.44H327.53l.68-.82a3.34,3.34,0,1,0-5.12,0l.68.82H312.39v10.36a4,4,0,0,1,2.44-.85,3.87,3.87,0,0,1,0,7.73,3.92,3.92,0,0,1-2.44-.86v10.61h-11.9l.67-.82a3.37,3.37,0,0,0,.77-2.15,3.33,3.33,0,1,0-5.88,2.15l.68.82H274.56a3.87,3.87,0,1,1-6,0H257.72c0,18.76-3.26,42-15.79,62.45-20,11.75-28.1,36.45-29,53H371.42c-.61-2.87-5.57-18.95-41.37-38.62C326.49,374.79,323.8,370.64,322.89,367.37Z" style="fill:#fff;isolation:isolate;opacity:0.7000000000000001"></path><path d="M332.78,106.34a3.84,3.84,0,0,0,6.91-.82l5.47,8.83-9.2,5.71a.23.23,0,0,0-.1.24.22.22,0,0,0,.18.19,3.37,3.37,0,1,1-3.8,2.36.24.24,0,0,0-.08-.25.24.24,0,0,0-.27,0l-9.26,5.74-5.47-8.83a3.94,3.94,0,0,0,2.57-.54,3.84,3.84,0,0,0-4.05-6.53,3.91,3.91,0,0,0-1.63,2.06l-5.39-8.69,9.26-5.74a.24.24,0,0,0,.11-.24.25.25,0,0,0-.19-.19,3.41,3.41,0,0,1-2.3-1.55,3.37,3.37,0,1,1,5.73-3.55,3.34,3.34,0,0,1,.37,2.74.23.23,0,0,0,.09.25.23.23,0,0,0,.26,0l9.21-5.71,5.38,8.69a3.81,3.81,0,0,0-2.56.54A3.85,3.85,0,0,0,332.78,106.34Z" style="fill:#fff;isolation:isolate;opacity:0.7000000000000001"></path><path d="M365.86,193.94H355.63a3.83,3.83,0,0,0-2.93-6.3,3.83,3.83,0,0,0-2.94,6.3H339.34V183a.23.23,0,0,0-.41-.15,3.34,3.34,0,0,1-2.52,1.13,3.37,3.37,0,0,1,0-6.74,3.34,3.34,0,0,1,2.52,1.13.24.24,0,0,0,.41-.16V167.43h10.42a3.83,3.83,0,1,0,6.77,2.47,3.76,3.76,0,0,0-.9-2.47h10.23V178.2a.24.24,0,0,0,.41.16,3.41,3.41,0,0,1,2.53-1.13,3.37,3.37,0,0,1,0,6.74,3.41,3.41,0,0,1-2.53-1.13.23.23,0,0,0-.26-.07.25.25,0,0,0-.15.22Z" style="fill:#fff;isolation:isolate;opacity:0.7000000000000001"></path><path d="M241.51,179.41a.26.26,0,0,0-.27,0,3.37,3.37,0,1,1,1.62-4.15.24.24,0,0,0,.22.15.21.21,0,0,0,.22-.14l4-10.21,9.64,3.77a3.83,3.83,0,1,0,5.47,2.13l9.59,3.75-4,10.21a.21.21,0,0,0,.06.25.23.23,0,0,0,.26,0,3.33,3.33,0,0,1,2.76-.15,3.37,3.37,0,1,1-2.45,6.28,3.34,3.34,0,0,1-1.93-2,.23.23,0,0,0-.44,0l-3.93,10.07-9.59-3.75a3.84,3.84,0,1,0-5.47-2.14l-9.64-3.76,3.93-10.07A.25.25,0,0,0,241.51,179.41Z" style="fill:#fff;isolation:isolate;opacity:0.7000000000000001"></path><path d="M312,236.85a.23.23,0,0,0-.15.22v10.85H301.54a3.9,3.9,0,0,0,.89-2.47,3.84,3.84,0,1,0-7.67,0,3.93,3.93,0,0,0,.9,2.47H285.37V237.07a.24.24,0,0,0-.41-.16,3.37,3.37,0,1,1-2.53-5.6,3.41,3.41,0,0,1,2.53,1.15.24.24,0,0,0,.41-.16V221.4h10.29a3.93,3.93,0,0,0-.9,2.47,3.84,3.84,0,1,0,7.67,0,3.9,3.9,0,0,0-.89-2.47h10.35v10.9a.24.24,0,0,0,.41.16,3.41,3.41,0,0,1,2.53-1.15,3.38,3.38,0,1,1-2.53,5.6A.23.23,0,0,0,312,236.85Z" style="fill:#fff;isolation:isolate;opacity:0.8"></path><path d="M264.77,129.6a.22.22,0,0,0-.22.16L260.89,140l-9.74-3.49a3.84,3.84,0,1,0-5.54-2L235.92,131l3.66-10.21a.23.23,0,0,0-.07-.26.25.25,0,0,0-.26,0,3.37,3.37,0,1,1-.49-6.12,3.44,3.44,0,0,1,2,1.93.25.25,0,0,0,.22.15.27.27,0,0,0,.22-.16l3.68-10.26,9.69,3.47a3.87,3.87,0,0,0-1.68,2,3.84,3.84,0,1,0,7.22,2.59,3.89,3.89,0,0,0,0-2.63l9.75,3.49-3.68,10.27a.23.23,0,0,0,.06.26.26.26,0,0,0,.27,0,3.41,3.41,0,0,1,2.77-.23,3.37,3.37,0,1,1-4.27,4.42A.25.25,0,0,0,264.77,129.6Z" style="fill:#fff;isolation:isolate;opacity:0.8"></path><path d="M279.06,288.77a3.37,3.37,0,0,1,3.37-3.36,3.44,3.44,0,0,1,2.53,1.12.22.22,0,0,0,.26.06.23.23,0,0,0,.15-.21v-11h10.29a3.93,3.93,0,0,0-.9,2.47,3.84,3.84,0,1,0,7.67,0,3.9,3.9,0,0,0-.89-2.47h10.35v11a.23.23,0,0,0,.15.21.22.22,0,0,0,.26-.06,3.44,3.44,0,0,1,2.53-1.12,3.37,3.37,0,0,1,0,6.73A3.41,3.41,0,0,1,312.3,291a.24.24,0,0,0-.41.16v10.72H301.54a3.9,3.9,0,0,0,.89-2.47,3.84,3.84,0,1,0-7.67,0,3.93,3.93,0,0,0,.9,2.47H285.37V291.17A.24.24,0,0,0,285,291a3.41,3.41,0,0,1-2.53,1.13A3.37,3.37,0,0,1,279.06,288.77Z" style="fill:#fff;isolation:isolate;opacity:0.8"></path><path d="M312.36,264.12a.23.23,0,0,0-.15-.21.22.22,0,0,0-.26.06,3.37,3.37,0,1,1,0-4.47.23.23,0,0,0,.26.06.23.23,0,0,0,.15-.21v-11H322.7a3.84,3.84,0,1,0,5.9,0h10.27v11a.23.23,0,0,0,.15.21.23.23,0,0,0,.26-.06,3.41,3.41,0,0,1,2.53-1.13,3.37,3.37,0,1,1,0,6.73,3.41,3.41,0,0,1-2.53-1.13.22.22,0,0,0-.26-.06.23.23,0,0,0-.15.21V274.9H328.6a3.84,3.84,0,1,0-6.79-2.47,3.8,3.8,0,0,0,.89,2.47H312.36Z" style="fill:#fff;isolation:isolate;opacity:0.8"></path><path d="M308.71,181.47l10.83,1.17-1.11,10.24a3.84,3.84,0,1,0-.63,5.83L316.69,209l-10.83-1.17a.23.23,0,0,0-.23.12.24.24,0,0,0,0,.27,3.42,3.42,0,0,1,.84,2.63,3.36,3.36,0,1,1-6.69-.72,3.42,3.42,0,0,1,1.4-2.39.24.24,0,0,0-.11-.43l-10.78-1.16,1.11-10.29a3.84,3.84,0,1,0,.63-5.84l1.11-10.24L304,181a.25.25,0,0,0,.23-.12.24.24,0,0,0,0-.26,3.41,3.41,0,0,1-.86-2.64,3.36,3.36,0,0,1,6.69.72,3.41,3.41,0,0,1-1.38,2.4.22.22,0,0,0-.09.25A.22.22,0,0,0,308.71,181.47Z" style="fill:#fff;isolation:isolate;opacity:0.8"></path><path d="M225.75,205.14l10.83,1.17-1.1,10.24a3.89,3.89,0,0,0-2.36-1.17,3.84,3.84,0,1,0,1.73,7l-1.12,10.3-10.83-1.17a.25.25,0,0,0-.23.12.26.26,0,0,0,0,.27,3.43,3.43,0,0,1,.85,2.63,3.36,3.36,0,1,1-6.69-.72,3.46,3.46,0,0,1,1.39-2.4.22.22,0,0,0,.09-.25.22.22,0,0,0-.2-.17l-10.78-1.16,1.12-10.3a3.84,3.84,0,1,0,3.18-6.47,3.88,3.88,0,0,0-2.55.64l1.1-10.24L221,204.62a.24.24,0,0,0,.2-.39,3.37,3.37,0,1,1,5.84-1.91,3.42,3.42,0,0,1-1.39,2.4.22.22,0,0,0-.09.24A.25.25,0,0,0,225.75,205.14Z" style="fill:#407BFF"></path><path d="M225.75,205.14l10.83,1.17-1.1,10.24a3.89,3.89,0,0,0-2.36-1.17,3.84,3.84,0,1,0,1.73,7l-1.12,10.3-10.83-1.17a.25.25,0,0,0-.23.12.26.26,0,0,0,0,.27,3.43,3.43,0,0,1,.85,2.63,3.36,3.36,0,1,1-6.69-.72,3.46,3.46,0,0,1,1.39-2.4.22.22,0,0,0,.09-.25.22.22,0,0,0-.2-.17l-10.78-1.16,1.12-10.3a3.84,3.84,0,1,0,3.18-6.47,3.88,3.88,0,0,0-2.55.64l1.1-10.24L221,204.62a.24.24,0,0,0,.2-.39,3.37,3.37,0,1,1,5.84-1.91,3.42,3.42,0,0,1-1.39,2.4.22.22,0,0,0-.09.24A.25.25,0,0,0,225.75,205.14Z" style="fill:#fff;isolation:isolate;opacity:0.8"></path><path d="M296.21,274.9H285.37V264.67a3.84,3.84,0,1,0,0-5.87V248.39h10.84a.24.24,0,0,0,.22-.15.25.25,0,0,0-.06-.26,3.45,3.45,0,0,1-1.14-2.53,3.37,3.37,0,1,1,6.73,0,3.44,3.44,0,0,1-1.12,2.53.25.25,0,0,0-.06.26.24.24,0,0,0,.22.15h10.89V258.8a3.84,3.84,0,1,0,0,5.87V274.9H301a.24.24,0,0,0-.22.15.25.25,0,0,0,.06.26,3.44,3.44,0,0,1,1.12,2.53,3.37,3.37,0,1,1-6.73,0,3.45,3.45,0,0,1,1.14-2.53.25.25,0,0,0,.06-.26A.24.24,0,0,0,296.21,274.9Z" style="fill:#fff;isolation:isolate;opacity:0.7000000000000001"></path><path d="M357.3,151.19a.23.23,0,0,0-.19.39,3.36,3.36,0,1,1-4.45-.38.25.25,0,0,0,.09-.25.23.23,0,0,0-.21-.17l-10.93-.95.91-10.42a3.85,3.85,0,0,0,6.54-2.39,3.85,3.85,0,0,0-6-3.47l.23-2.59a82.44,82.44,0,0,1,19.89,8.9,3.84,3.84,0,0,0,3.26,2.51,2.81,2.81,0,0,0,.41,0c.66.5,1.31,1,1.94,1.5l-.71,8.26Z" style="fill:#fff;isolation:isolate;opacity:0.8"></path><path d="M264.69,288.77a3.85,3.85,0,0,0-6.31-2.94V275.37h10.8a.24.24,0,0,0,.22-.15.23.23,0,0,0-.07-.26,3.37,3.37,0,1,1,4.46,0,.23.23,0,0,0-.07.26.25.25,0,0,0,.22.15h11v10.46a3.9,3.9,0,0,0-2.47-.89,3.84,3.84,0,1,0,2.47,6.78v10.17h-11a.25.25,0,0,0-.22.15.23.23,0,0,0,.07.26,3.37,3.37,0,1,1-4.46,0,.23.23,0,0,0,.07-.26.24.24,0,0,0-.22-.15h-10.8V291.72a3.85,3.85,0,0,0,6.31-3Z" style="fill:#fff;isolation:isolate;opacity:0.7000000000000001"></path><path d="M257.91,286.38a.23.23,0,0,0,.15.21.2.2,0,0,0,.25-.06,3.48,3.48,0,0,1,2.54-1.12,3.37,3.37,0,1,1-2.53,5.6.23.23,0,0,0-.26-.06.23.23,0,0,0-.15.22v10.72h-.19a168.45,168.45,0,0,0-2.24-26.52h2.43Z" style="fill:#fff;isolation:isolate;opacity:0.7000000000000001"></path><path d="M331.59,144.09a.23.23,0,0,0,.26-.06,3.41,3.41,0,0,1,2.53-1.13,3.37,3.37,0,1,1,0,6.73,3.44,3.44,0,0,1-2.53-1.12.23.23,0,0,0-.26-.07.25.25,0,0,0-.15.22v11H321.17a3.84,3.84,0,1,0-6.79-2.47,3.83,3.83,0,0,0,.9,2.47H304.93v-11a.25.25,0,0,0-.15-.22.22.22,0,0,0-.25.07,3.46,3.46,0,0,1-2.54,1.12,3.37,3.37,0,1,1,0-6.73,3.42,3.42,0,0,1,2.54,1.13.21.21,0,0,0,.25.06.23.23,0,0,0,.15-.22v-6.05c3.71.07,7.23.25,10.6.53a3.8,3.8,0,0,0,4.78.48q5.93.69,11.13,1.8v3.24A.23.23,0,0,0,331.59,144.09Z" style="fill:#fff;isolation:isolate;opacity:0.7000000000000001"></path><path d="M366.33,159a52.21,52.21,0,0,1,9.19,8h-9.19Z" style="fill:#fff;isolation:isolate;opacity:0.8"></path><path d="M154.15,223.32a3.84,3.84,0,0,0,7.38-2.14,3.91,3.91,0,0,0-1.55-2.12l10-2.91,3,10.47a.25.25,0,0,0,.2.17.24.24,0,0,0,.24-.13,3.41,3.41,0,0,1,2.11-1.81,3.37,3.37,0,1,1-.87,6.09.22.22,0,0,0-.27,0,.21.21,0,0,0-.08.25l3,10.42-10,2.91a3.83,3.83,0,1,0-7.33-1.81c-.83-1.12-1.61-2.27-2.31-3.44a112.34,112.34,0,0,1-8.48-17.11l5.09-1.48A3.9,3.9,0,0,0,154.15,223.32Z" style="fill:#fff;isolation:isolate;opacity:0.7000000000000001"></path><path d="M169.57,156.74a.23.23,0,0,0,0-.26,3.37,3.37,0,1,1,4.41.73.23.23,0,0,0-.11.25.23.23,0,0,0,.19.18l10.86,1.81-1.69,10.15a3.79,3.79,0,0,0-2.27-1.29,3.84,3.84,0,0,0-1.27,7.58,3.8,3.8,0,0,0,2.58-.49l-1.7,10.21-10.86-1.81a.24.24,0,0,0-.24.12.23.23,0,0,0,0,.26,3.38,3.38,0,1,1-5.95,1.58,3.38,3.38,0,0,1,1.54-2.31.23.23,0,0,0,.11-.25A.25.25,0,0,0,165,183l-5.81-1a96.71,96.71,0,0,1,1.31-10,3.81,3.81,0,0,0,1.38-6.09,78.35,78.35,0,0,1,3.3-9.84l4.17.7A.24.24,0,0,0,169.57,156.74Z" style="fill:#fff;isolation:isolate;opacity:0.8"></path><path d="M381.9,194.09a.23.23,0,0,0,.06.26,3.38,3.38,0,1,1-4.45,0,.23.23,0,0,0,.06-.26.23.23,0,0,0-.22-.15h-11v-10.4a3.84,3.84,0,1,0,2.47-6.78,3.9,3.9,0,0,0-2.47.89V167.43H376c7,7.93,10.7,17.21,12.41,26.51h-6.24A.23.23,0,0,0,381.9,194.09Z" style="fill:#fff;isolation:isolate;opacity:0.7000000000000001"></path><path d="M365.86,247.92H355.63a3.84,3.84,0,1,0-5.87,0H339.34V237.07a.24.24,0,0,0-.41-.16,3.33,3.33,0,0,1-2.52,1.15,3.38,3.38,0,1,1,2.52-5.6.24.24,0,0,0,.41-.16V221.4h10.42a3.84,3.84,0,0,0,2.94,6.31,3.84,3.84,0,0,0,2.93-6.31h10.23v10.9a.24.24,0,0,0,.41.16,3.38,3.38,0,1,1,0,4.45.23.23,0,0,0-.26-.06.23.23,0,0,0-.15.22Z" style="fill:#fff;isolation:isolate;opacity:0.7000000000000001"></path><path d="M198.09,259.08a3.38,3.38,0,0,1,4.63,4.29.23.23,0,0,0,.06.26.25.25,0,0,0,.26,0l9.86-4.89,4.62,9.31a3.88,3.88,0,0,0-2.59.3,3.83,3.83,0,1,0,3.4,6.87,3.91,3.91,0,0,0,1.81-1.89l4.54,9.16-2.25,1.11c-3.2-4.41-5.35-6.87-5.35-6.87s-11.83-5.53-20.71-13.7A3.37,3.37,0,0,1,198.09,259.08Z" style="fill:#fff;isolation:isolate;opacity:0.7000000000000001"></path><path d="M345.65,261.73a3.84,3.84,0,0,0-6.31-2.93V248.39h11a.24.24,0,0,0,.22-.15.25.25,0,0,0-.06-.26,3.37,3.37,0,0,1,2.23-5.9,3.36,3.36,0,0,1,3.36,3.37,3.44,3.44,0,0,1-1.13,2.53.23.23,0,0,0-.06.26.23.23,0,0,0,.22.15h10.77V258.8a3.84,3.84,0,1,0,0,5.87V274.9H355.09a.23.23,0,0,0-.22.15.23.23,0,0,0,.06.26,3.44,3.44,0,0,1,1.13,2.53,3.37,3.37,0,1,1-6.73,0,3.41,3.41,0,0,1,1.14-2.53.25.25,0,0,0,.06-.26.24.24,0,0,0-.22-.15h-11V264.67a3.84,3.84,0,0,0,6.31-2.94Z" style="fill:#fff;isolation:isolate;opacity:0.7000000000000001"></path><path d="M383.58,218.46a3.84,3.84,0,1,0-6.78,2.47H366.33V210a.23.23,0,0,0-.15-.21.23.23,0,0,0-.26.06,3.37,3.37,0,1,1,0-4.46.23.23,0,0,0,.41-.15V194.41H376.8a3.85,3.85,0,1,0,5.87,0h5.78a95.47,95.47,0,0,1,.5,26.52h-6.28A3.84,3.84,0,0,0,383.58,218.46Z" style="fill:#fff;isolation:isolate;opacity:0.8"></path><path d="M194.12,100.11a.25.25,0,0,0,.1.25l8.89,6.22-5.93,8.48a3.88,3.88,0,0,0-1.51-2.15,3.84,3.84,0,0,0-4.4,6.29,3.94,3.94,0,0,0,2.54.68l-5.89,8.44L179,122.1a.23.23,0,0,0-.36.24,3.37,3.37,0,1,1-6-1.13,3.44,3.44,0,0,1,2.39-1.42.23.23,0,0,0,.1-.42l-8.93-6.25,5.9-8.44a3.88,3.88,0,0,0,1.5,2.15,3.83,3.83,0,1,0,4.4-6.28,3.89,3.89,0,0,0-2.54-.69l5.93-8.48,8.94,6.25a.26.26,0,0,0,.27,0,.22.22,0,0,0,.09-.25,3.46,3.46,0,0,1,.51-2.73,3.37,3.37,0,1,1,3.14,5.28A.25.25,0,0,0,194.12,100.11Z" style="fill:#fff;isolation:isolate;opacity:0.7000000000000001"></path></g><g id="freepik--Plant--inject-93"><path d="M386.46,343.54c.21,1.47-3.78,2.44-7,3,.26,2.67,2,5.37,4.49,7.89,3.09-1.74,7.49-4,8.3-3.48s-3.62,3.53-6.44,5.25a58,58,0,0,0,6.39,4.84c1.38-1.29,3-2.43,4-1.81s.73,2.63.23,4.42c3.36,1.95,5.87,3.14,5.87,3.14a67.5,67.5,0,0,0,2.24-9.53c-.17-.33-.33-.67-.49-1-.54-1.25,0-1.78.88-1.95a33.63,33.63,0,0,0,.06-6.87c-3.8-.8-8.42-2.27-6.69-4.55,1-1.37,2.95-1.53,4.94-1.19a8.52,8.52,0,0,0-.94-1.27c-6.91-7.62-11.74,0-11.74,0-4-3.35-9.66-2.45-10.88,2.79C381.88,342.59,386.2,341.73,386.46,343.54Z" style="fill:#407BFF"></path><path d="M386.46,343.54c.21,1.47-3.78,2.44-7,3,.26,2.67,2,5.37,4.49,7.89,3.09-1.74,7.49-4,8.3-3.48s-3.62,3.53-6.44,5.25a58,58,0,0,0,6.39,4.84c1.38-1.29,3-2.43,4-1.81s.73,2.63.23,4.42c3.36,1.95,5.87,3.14,5.87,3.14a67.5,67.5,0,0,0,2.24-9.53c-.17-.33-.33-.67-.49-1-.54-1.25,0-1.78.88-1.95a33.63,33.63,0,0,0,.06-6.87c-3.8-.8-8.42-2.27-6.69-4.55,1-1.37,2.95-1.53,4.94-1.19a8.52,8.52,0,0,0-.94-1.27c-6.91-7.62-11.74,0-11.74,0-4-3.35-9.66-2.45-10.88,2.79C381.88,342.59,386.2,341.73,386.46,343.54Z" style="isolation:isolate;opacity:0.30000000000000004"></path><path d="M395.08,399.53l-1-.08c0-.52,4.09-51.53-7.36-56.34a3.91,3.91,0,0,0-3.47.09c-4.13,2.15-6.12,11.08-6.14,11.17l-1-.21c.08-.38,2.1-9.48,6.65-11.85a4.89,4.89,0,0,1,4.32-.12C399.23,347.28,395.26,397.4,395.08,399.53Z" style="fill:#407BFF"></path><path d="M396.53,398.42c-.21-2.29-4.88-56.26,3.86-62,2.09-1.38,4-1.67,5.55-.87,4.13,2.09,4.67,10.91,4.69,11.29l-1,.06c0-.09-.53-8.63-4.14-10.45-1.25-.63-2.78-.36-4.55.8-8.25,5.41-3.47,60.52-3.42,61.08Z" style="fill:#407BFF"></path><path d="M397.84,402.79c-.07-1.76-1.5-43.07,6.45-46.69a5.59,5.59,0,0,1,4.73,0c5.46,2.4,8.84,12.58,9,13l-.95.31c0-.1-3.38-10.18-8.43-12.4a4.54,4.54,0,0,0-3.91,0c-6.11,2.77-6.31,34-5.87,45.74Z" style="fill:#407BFF"></path><path d="M395.81,400.9l-1-.12c1.4-12.29,4.08-45.06-.3-49a1.71,1.71,0,0,0-1.79-.56c-2.93,1.13-4.72,11.78-5.16,15.8l-1-.11c.17-1.54,1.77-15.08,5.8-16.62a2.62,2.62,0,0,1,2.81.74C400.85,356.12,396,399.07,395.81,400.9Z" style="fill:#407BFF"></path><polygon points="379.13 377.59 415.06 377.59 412.06 417.83 382.13 417.83 379.13 377.59" style="fill:#263238"></polygon><polygon points="390.04 377.59 391.04 417.83 412.06 417.83 415.06 377.59 390.04 377.59" style="fill:#fff;isolation:isolate;opacity:0.2"></polygon><path d="M384,362.82c-.37,1-3.16.21-5.35-.57-.76,1.74-.59,4,.06,6.4,2.5,0,6,.08,6.31.71s-3.44.93-5.77,1a42.13,42.13,0,0,0,2.28,5.18c1.3-.33,2.69-.47,3.07.24s-.45,1.87-1.37,2.8c1.4,2.36,2.54,4,2.54,4a46.9,46.9,0,0,0,4.65-5.11c0-.26,0-.53.05-.8.1-1,.6-1.11,1.22-.91a23.31,23.31,0,0,0,2.38-4.22c-2.07-1.79-4.41-4.28-2.56-5.1,1.11-.48,2.34.07,3.45,1a5.11,5.11,0,0,0-.14-1.11c-1.65-7.07-7.24-4-7.24-4-1.33-3.44-5.12-4.81-7.66-2C381.53,360.66,384.48,361.61,384,362.82Z" style="fill:#407BFF"></path><path d="M384,362.82c-.37,1-3.16.21-5.35-.57-.76,1.74-.59,4,.06,6.4,2.5,0,6,.08,6.31.71s-3.44.93-5.77,1a42.13,42.13,0,0,0,2.28,5.18c1.3-.33,2.69-.47,3.07.24s-.45,1.87-1.37,2.8c1.4,2.36,2.54,4,2.54,4a46.9,46.9,0,0,0,4.65-5.11c0-.26,0-.53.05-.8.1-1,.6-1.11,1.22-.91a23.31,23.31,0,0,0,2.38-4.22c-2.07-1.79-4.41-4.28-2.56-5.1,1.11-.48,2.34.07,3.45,1a5.11,5.11,0,0,0-.14-1.11c-1.65-7.07-7.24-4-7.24-4-1.33-3.44-5.12-4.81-7.66-2C381.53,360.66,384.48,361.61,384,362.82Z" style="isolation:isolate;opacity:0.30000000000000004"></path><path d="M410.7,367.6a13.57,13.57,0,0,0-3.29.69,7.93,7.93,0,0,1-.48-2.38c-.23-7.24,5-4.19,7.7-6.32a6,6,0,0,1,4.59-1.44,9,9,0,0,0-.62,1.24,1.13,1.13,0,0,0,.87,1.55,3.26,3.26,0,0,0,2-.24,3,3,0,0,0,.52-.36,10.44,10.44,0,0,1,1,2.42,13.58,13.58,0,0,1,.46,3.1,9.19,9.19,0,0,0-1.21.35,1.13,1.13,0,0,0-.45,1.72,5.3,5.3,0,0,0,1.49,1.05,16.9,16.9,0,0,1-.91,3.39l-.37.06c-.26.05-.52.12-.78.19l-.43.16a1.16,1.16,0,0,0-.68.88,1.13,1.13,0,0,0,.43,1,3.24,3.24,0,0,0,.54.33,8,8,0,0,1-2.87,2.89,28.1,28.1,0,0,1-3.06-1.61c.22-.29.44-.58.64-.88a1.7,1.7,0,0,0,.3-1.14,1.54,1.54,0,0,0-.58-1,1.53,1.53,0,0,0-2.16.28c-.24.36-.51.7-.77,1a18.88,18.88,0,0,1-3.68-3.58l.11,0a11.74,11.74,0,0,1,2-.34,1.54,1.54,0,0,0-.39-3Z" style="fill:#407BFF"></path><path d="M412.77,342.62a9,9,0,0,1,2-1.08,5.17,5.17,0,0,0-.79-1.46c-3.06-3.91-4.44,0-6.82.06a4.08,4.08,0,0,0-3,1.25,8.47,8.47,0,0,1,.87.38.77.77,0,0,1,.22,1.2,2.3,2.3,0,0,1-1.17.77,3.27,3.27,0,0,1-.44,0,6.64,6.64,0,0,0,.54,1.71,9.55,9.55,0,0,0,1.12,1.83,6.86,6.86,0,0,1,.78-.35.77.77,0,0,1,1,.7,3.5,3.5,0,0,1-.33,1.21,11.75,11.75,0,0,0,2,1.39l.22-.14.5-.24.29-.11a.82.82,0,0,1,.75.17.78.78,0,0,1,.23.74,2.21,2.21,0,0,1-.14.41,5.5,5.5,0,0,0,2.78.26,20.83,20.83,0,0,0,.9-2.19l-.72-.18a1.13,1.13,0,0,1-.66-.47,1,1,0,0,1,1.11-1.59l.86.21a13.11,13.11,0,0,0,.37-3.49l-.07,0a8.35,8.35,0,0,0-1.23.71,1.05,1.05,0,0,1-1.45-.32A1.06,1.06,0,0,1,412.77,342.62Z" style="fill:#407BFF"></path><path d="M412.77,342.62a9,9,0,0,1,2-1.08,5.17,5.17,0,0,0-.79-1.46c-3.06-3.91-4.44,0-6.82.06a4.08,4.08,0,0,0-3,1.25,8.47,8.47,0,0,1,.87.38.77.77,0,0,1,.22,1.2,2.3,2.3,0,0,1-1.17.77,3.27,3.27,0,0,1-.44,0,6.64,6.64,0,0,0,.54,1.71,9.55,9.55,0,0,0,1.12,1.83,6.86,6.86,0,0,1,.78-.35.77.77,0,0,1,1,.7,3.5,3.5,0,0,1-.33,1.21,11.75,11.75,0,0,0,2,1.39l.22-.14.5-.24.29-.11a.82.82,0,0,1,.75.17.78.78,0,0,1,.23.74,2.21,2.21,0,0,1-.14.41,5.5,5.5,0,0,0,2.78.26,20.83,20.83,0,0,0,.9-2.19l-.72-.18a1.13,1.13,0,0,1-.66-.47,1,1,0,0,1,1.11-1.59l.86.21a13.11,13.11,0,0,0,.37-3.49l-.07,0a8.35,8.35,0,0,0-1.23.71,1.05,1.05,0,0,1-1.45-.32A1.06,1.06,0,0,1,412.77,342.62Z" style="isolation:isolate;opacity:0.30000000000000004"></path><path d="M383.5,349.87c-.21,1.47,3.77,2.44,7,3-.27,2.67-2,5.37-4.5,7.88-3.08-1.73-7.49-4-8.3-3.47s3.63,3.53,6.45,5.24a57.69,57.69,0,0,1-6.39,4.84c-1.39-1.29-3-2.42-4-1.81s-.73,2.64-.24,4.42c-3.35,2-5.87,3.15-5.87,3.15a67.5,67.5,0,0,1-2.24-9.53c.17-.34.34-.67.49-1,.54-1.25,0-1.78-.88-2a33.61,33.61,0,0,1-.05-6.87c3.8-.79,8.42-2.27,6.69-4.55-1.05-1.37-3-1.53-4.94-1.18a7.9,7.9,0,0,1,.93-1.28c6.92-7.62,11.74,0,11.74,0,4-3.35,9.66-2.44,10.88,2.79C388.08,348.91,383.76,348.05,383.5,349.87Z" style="fill:#407BFF"></path></g><g id="freepik--Character--inject-93"><rect x="251.53" y="329.49" width="55.43" height="82.71" rx="7.04" style="fill:#263238"></rect><rect x="251.53" y="329.49" width="55.43" height="82.71" rx="7.04" style="fill:#fff;isolation:isolate;opacity:0.5"></rect><path d="M295.58,412.2h-37a7,7,0,0,1-7-7V336.53a7,7,0,0,1,7-7h37a7,7,0,0,0-7,7v68.63A7,7,0,0,0,295.58,412.2Z" style="isolation:isolate;opacity:0.1"></path><rect x="180" y="410.05" width="118.44" height="7.78" transform="translate(478.45 827.88) rotate(180)" style="fill:#263238"></rect><rect x="180" y="410.05" width="118.44" height="7.78" transform="translate(478.45 827.88) rotate(180)" style="fill:#fff;isolation:isolate;opacity:0.2"></rect><rect x="231.29" y="410.05" width="67.15" height="7.78" transform="translate(529.74 827.88) rotate(180)" style="fill:#fff;isolation:isolate;opacity:0.2"></rect><path d="M262.42,365.79H175L161.7,297a12.18,12.18,0,0,1,12-14.5h62.58a12.19,12.19,0,0,1,12,9.87Z" style="fill:#263238"></path><path d="M262.42,365.79H175L161.7,297a12.18,12.18,0,0,1,12-14.5h62.58a12.19,12.19,0,0,1,12,9.87Z" style="fill:#fff;isolation:isolate;opacity:0.6000000000000001"></path><path d="M199.84,365.79H175L161.7,297a12.18,12.18,0,0,1,12-14.5h0a12.18,12.18,0,0,1,12,9.87Z" style="isolation:isolate;opacity:0.1"></path><rect x="171.7" y="364.95" width="136.1" height="47.25" rx="6.14" style="fill:#263238"></rect><rect x="171.7" y="364.95" width="136.1" height="47.25" rx="6.14" style="fill:#fff;isolation:isolate;opacity:0.6000000000000001"></rect><rect x="171.7" y="364.95" width="65.27" height="47.25" rx="6.14" style="isolation:isolate;opacity:0.1"></rect><path d="M275.2,282.74a11.27,11.27,0,0,1-2.13,6.41A10.64,10.64,0,0,1,270,292a12.34,12.34,0,0,1-3.25,1.38,5.75,5.75,0,0,1-1.22.2l-.73,0a31.42,31.42,0,0,1-4.75-.13c-1.16-.1-2.25-.26-3.33-.44s-2.34-.43-3.48-.68-2.22-.55-3.31-.84c-2.18-.58-4.28-1.29-6.36-2l-.18-.07c-1-.35-1.94-.72-2.9-1.12s-2-.84-3.1-1.37a9.28,9.28,0,0,1,7.21-17.09l.21.09,2.62,1,2.7,1c1.79.71,3.59,1.37,5.35,2l1.66.59c-.08-.2-.16-.38-.23-.58-1-2.35-2.07-4.76-3.21-7.18l-3.47-7.29-.06-.12a4.67,4.67,0,0,1,7.37-5.45,83.63,83.63,0,0,1,6.09,6.28,85.49,85.49,0,0,1,5.48,7c.86,1.25,1.68,2.55,2.49,3.93a31.42,31.42,0,0,1,2.26,4.61,22.73,22.73,0,0,1,.93,2.91A15.6,15.6,0,0,1,275.2,282.74Z" style="fill:#407BFF"></path><path d="M260,293.51c-1.16-.1-2.25-.26-3.33-.44s-2.34-.43-3.48-.68-2.22-.55-3.31-.84c-2.18-.58-4.28-1.29-6.36-2l-.18-.07a11.8,11.8,0,0,1,4.86-5.08S254.56,286.3,260,293.51Z" style="opacity:0.2"></path><polygon points="300.04 397.41 312.73 398.34 312.34 413.35 301.74 412.59 300.04 397.41" style="fill:#e4897b"></polygon><polygon points="300.04 397.42 312.74 398.35 312.51 406.75 300.99 405.92 300.04 397.42" style="opacity:0.2"></polygon><path d="M300.23,417.83H303l.75-1.12,1.45,1.13,16.69,0a7.49,7.49,0,0,0-.72-3.82s-5-.45-6.91-2.93a.62.62,0,0,0-.62-.24c-1.66.35-8.26,1.61-11.9.31a.59.59,0,0,0-.81.54A40.4,40.4,0,0,1,300.23,417.83Z" style="fill:#263238"></path><path d="M230.51,332.54s-18.9,35.22,3.51,35.22c28.2,0,55-7.09,55-7.09s-1.53,15,9.36,43.56l15.23-.13s5.94-61.28-5.43-71.56c-9.15-8.28-41.64-5.63-41.64-5.63Z" style="fill:#263238"></path><path d="M292.42,381c-.19.74-.38,1.47-.58,2.18-3.55-14.85-2.77-22.55-2.77-22.55s-26.85,7.1-55,7.1c-13.63,0-12-13-8.59-23.24,9.61-6.1,19.75-11.63,27-15.4l14.18-2.21s5.84-.48,13.27-.4C290.85,331.43,301.41,345,292.42,381Z" style="opacity:0.2"></path><path d="M265.75,327.41c-16.39,9.06-58.09,2.49-65.55,1.22-.93-12.34-2.18-28-6.11-42.6A11.93,11.93,0,0,1,203,271.19a160.49,160.49,0,0,1,35.23-2.94c4.14.15,8.59,2.16,9.92,6.09C254.29,292.44,264,307.15,265.75,327.41Z" style="fill:#407BFF"></path><path d="M228,277.7c-6.88.35-12.85-5.51-16.07-7.54,3.48-2.43,5.14-6.79,5.83-9.21.3-1.07.42-1.76.42-1.76l11.68,5.2a7,7,0,0,0-.35,4.68,6.27,6.27,0,0,1,3.23,3.32.42.42,0,0,0,0,.1C233.66,274.86,234.8,277.35,228,277.7Z" style="fill:#e4897b"></path><path d="M232.8,272.49c-7,2.88-13.78-5.53-15-11.54.3-1.07.42-1.76.42-1.76l11.68,5.2a7,7,0,0,0-.35,4.68,6.27,6.27,0,0,1,3.23,3.32A.42.42,0,0,0,232.8,272.49Z" style="opacity:0.2"></path><path d="M228.43,277.67l-2.59-2.3-4,2S224,279.6,228.43,277.67Z" style="fill:#407BFF"></path><path d="M228.43,277.67l-2.59-2.3-4,2S224,279.6,228.43,277.67Z" style="fill:#fff;opacity:0.5"></path><path d="M213.61,268.44s4.93,6.74,12.23,6.93a11.42,11.42,0,0,0-5.69,6.95,14.14,14.14,0,0,1-9.6-12.34A4,4,0,0,1,213.61,268.44Z" style="fill:#407BFF"></path><path d="M228.43,277.67l3.5-3,4,1.13S232.45,279.42,228.43,277.67Z" style="fill:#407BFF"></path><path d="M228.43,277.67l3.5-3,4,1.13S232.45,279.42,228.43,277.67Z" style="fill:#fff;opacity:0.5"></path><path d="M229.52,269.07s2.52,3.25,2.41,5.64c3.34.9,4.47,5.91,4.47,5.91s1.36-7.23-3.63-11A5.44,5.44,0,0,0,229.52,269.07Z" style="fill:#407BFF"></path><path d="M213.61,268.44s4.93,6.74,12.23,6.93a11.42,11.42,0,0,0-5.69,6.95,14.14,14.14,0,0,1-9.6-12.34A4,4,0,0,1,213.61,268.44Z" style="fill:#fff;opacity:0.8"></path><path d="M229.52,269.07s2.52,3.25,2.41,5.64c3.34.9,4.47,5.91,4.47,5.91s1.36-7.23-3.63-11A5.44,5.44,0,0,0,229.52,269.07Z" style="fill:#fff;opacity:0.8"></path><path d="M216.9,242.92c7.71-7.51,20.1-2.43,23.52,1.61s1.23,12.34-3.31,15.61S216.9,242.92,216.9,242.92Z" style="fill:#263238"></path><path d="M216.9,242.92c7.71-7.51,20.1-2.43,23.52,1.61s1.23,12.34-3.31,15.61S216.9,242.92,216.9,242.92Z" style="fill:#fff;opacity:0.4"></path><path d="M217.76,249.41c-.28,7.77-.29,13.06,4.14,17,8.8,7.81,14.92,4.42,17.67-3,2.47-6.68,2.52-18.27-5.23-22.41S218,241.63,217.76,249.41Z" style="fill:#e4897b"></path><path d="M225.84,244.12c1.54,2.8-1.74,15.73-5,14.52a51.42,51.42,0,0,1-6.5-3s-1.95-6.81,2.39-12.44S225.84,244.12,225.84,244.12Z" style="fill:#263238"></path><path d="M232,252.87c-.08.67.21,1.26.65,1.31s.87-.45,1-1.13-.21-1.26-.65-1.31S232.07,252.2,232,252.87Z" style="fill:#263238"></path><path d="M238.93,253.9c-.08.67.21,1.26.65,1.31s.87-.45.95-1.13-.21-1.26-.65-1.31S239,253.23,238.93,253.9Z" style="fill:#263238"></path><path d="M236.55,254.15l-.74,5.66a6.06,6.06,0,0,0,2,.33.74.74,0,0,0,.56-1.19A13.35,13.35,0,0,1,236.55,254.15Z" style="fill:#de5753"></path><path d="M229.79,249.91a.39.39,0,0,1-.17-.11.41.41,0,0,1,0-.56,4,4,0,0,1,3.54-1,.4.4,0,0,1,.27.49.41.41,0,0,1-.5.28h0a3.17,3.17,0,0,0-2.79.78A.4.4,0,0,1,229.79,249.91Z" style="fill:#263238"></path><path d="M238.46,249.51a.36.36,0,0,1,.31.21,3.1,3.1,0,0,0,2.32,1.7.41.41,0,0,1,.35.44.39.39,0,0,1-.43.36,3.92,3.92,0,0,1-2.94-2.13.39.39,0,0,1,.17-.54A.43.43,0,0,1,238.46,249.51Z" style="fill:#263238"></path><path d="M235.81,264.07a.38.38,0,0,1-.37-.29c-.77-3.39-5.28-2.84-5.47-2.81a.38.38,0,0,1-.43-.32.37.37,0,0,1,.33-.42s5.38-.68,6.3,3.38a.37.37,0,0,1-.28.45Z" style="fill:#263238"></path><path d="M225.84,244.12c1.54,2.8-1.74,15.73-5,14.52a51.42,51.42,0,0,1-6.5-3s-1.95-6.81,2.39-12.44S225.84,244.12,225.84,244.12Z" style="fill:#fff;opacity:0.4"></path><path d="M213.64,257.31a7.85,7.85,0,0,0,4.49,4.05c2.63.91,4.13-1.41,3.56-4-.51-2.32-2.51-5.57-5.22-5.37A3.59,3.59,0,0,0,213.64,257.31Z" style="fill:#e4897b"></path><path d="M224.07,244.81a.26.26,0,0,1-.22-.13.24.24,0,0,1,.08-.32,16.93,16.93,0,0,1,9.49-2.74,16.14,16.14,0,0,0-10.61,1.73.27.27,0,0,1-.31-.07.26.26,0,0,1,0-.32,11.47,11.47,0,0,1,8.05-3.27h0a11.29,11.29,0,0,0-8.27,1.71.25.25,0,0,1-.35-.07A.24.24,0,0,1,222,241c5.71-3.85,11.85-.87,11.91-.84a.27.27,0,0,1,.12.32.26.26,0,0,1-.3.15,11.23,11.23,0,0,0-9.48,1.52c7.92-3.18,13.24.51,13.29.55a.25.25,0,0,1,.08.33.27.27,0,0,1-.33.1c-3.74-1.8-7.66-.88-10.23.16a24.64,24.64,0,0,1,12.21.8.25.25,0,0,1,.15.32.26.26,0,0,1-.33.15c-.08,0-8.16-2.9-14.94.24Z" style="fill:#263238"></path><g style="opacity:0.4"><path d="M224.07,244.81a.26.26,0,0,1-.22-.13.24.24,0,0,1,.08-.32,16.93,16.93,0,0,1,9.49-2.74,16.14,16.14,0,0,0-10.61,1.73.27.27,0,0,1-.31-.07.26.26,0,0,1,0-.32,11.47,11.47,0,0,1,8.05-3.27h0a11.29,11.29,0,0,0-8.27,1.71.25.25,0,0,1-.35-.07A.24.24,0,0,1,222,241c5.71-3.85,11.85-.87,11.91-.84a.27.27,0,0,1,.12.32.26.26,0,0,1-.3.15,11.23,11.23,0,0,0-9.48,1.52c7.92-3.18,13.24.51,13.29.55a.25.25,0,0,1,.08.33.27.27,0,0,1-.33.1c-3.74-1.8-7.66-.88-10.23.16a24.64,24.64,0,0,1,12.21.8.25.25,0,0,1,.15.32.26.26,0,0,1-.33.15c-.08,0-8.16-2.9-14.94.24Z" style="fill:#fff"></path></g><path d="M240,262.12a17.39,17.39,0,0,0-5.63-2.78l-.25.61.54.19c2.35.93,3.37,3.53,2.18,4.79-.91,1-3.78-.14-3.38-2l-1.48-.57c-.47,1.56-2.62,1.56-3.54.57-1.36-1.46-.37-4.88,5.13-3.15l.15-.58a11.22,11.22,0,0,0-6.35.3,4.8,4.8,0,0,1-4.15-3.63l-1.46,1.84s-1.47,6.44.95,10.48S240.55,274.82,240,262.12Z" style="fill:#263238"></path><path d="M240,262.12a17.39,17.39,0,0,0-5.63-2.78l-.25.61.54.19c2.35.93,3.37,3.53,2.18,4.79-.91,1-3.78-.14-3.38-2l-1.48-.57c-.47,1.56-2.62,1.56-3.54.57-1.36-1.46-.37-4.88,5.13-3.15l.15-.58a11.22,11.22,0,0,0-6.35.3,4.8,4.8,0,0,1-4.15-3.63l-1.46,1.84s-1.47,6.44.95,10.48S240.55,274.82,240,262.12Z" style="fill:#fff;opacity:0.4"></path><polygon points="275.73 398.61 288.38 397.3 290.62 412.15 280.05 413.26 275.73 398.61" style="fill:#e4897b"></polygon><polygon points="275.73 398.62 288.39 397.31 289.64 405.62 278.15 406.82 275.73 398.62" style="opacity:0.2"></polygon><path d="M278.21,417.83H281l.75-1.12,1.45,1.13,16.69,0a7.49,7.49,0,0,0-.72-3.82s-5-.45-6.92-2.93a.62.62,0,0,0-.62-.24c-1.66.35-8.25,1.61-11.89.31a.6.6,0,0,0-.82.54A39,39,0,0,1,278.21,417.83Z" style="fill:#263238"></path><path d="M200.49,332.54s-7.9,26,13.33,33.21S256,360.27,256,360.27s0,5.48,18.91,45.78l15.68-2.95s-5.53-60.32-12.41-70.56-41.64-5.63-41.64-5.63Z" style="fill:#263238"></path><path d="M256.64,254.48l-3.49,4.06c-4.94,2.7-7.31-4.25-7.31-4.25l-3.67-4.11a2.84,2.84,0,0,1,.2-3.67l2.42-2.86a3,3,0,0,1,4.07-.66l3.74,3.36a5.87,5.87,0,0,1,1.69,2.31Z" style="fill:#e4897b"></path><path d="M222.71,331.44c-10.54-.86-19.44-2.29-22.51-2.81-.8-10.68-1.85-23.86-4.67-36.67,4-2.4,7.14-4,7.14-4s5.84,14.12-2.43,22.56c0,0,5.11,8.39,19.21,16C222,327.91,223,329.62,222.71,331.44Z" style="opacity:0.2"></path><path d="M209.57,287.76a131.12,131.12,0,0,0-8.69,15.2c-1.95,4.2-4,9.62-3.83,13.75l-1.41-3.32c-.33-.28-.14.08.23.47,3.19,2.94,7.65,5,11.61,7.14,1.89,1,3.89,2,5.73,3a4.71,4.71,0,0,1-2.29,8.83,62.31,62.31,0,0,1-13.67-1.64c-5.71-1.43-15.24-4.46-16.67-11.43-1.41-7.14-.25-12.65,1.54-18.86a85.5,85.5,0,0,1,11.54-22.84c2.91-4.93,9.05-6.67,13.82-3.25a9.31,9.31,0,0,1,2.09,12.93Z" style="fill:#407BFF"></path><path d="M214.56,325l-4.4,3.06c-3.18,4.64,3.5,7.7,3.5,7.7l2.62,2.76a2.84,2.84,0,0,0,3.67.17l3.09-2.12a3,3,0,0,0,1.06-4l-1.86-2.75a5.75,5.75,0,0,0-2.13-1.91Z" style="fill:#e4897b"></path><path d="M213.78,324.14l2.57,1.73a35.39,35.39,0,0,0-6.23,8.15h-3.85S207.75,326.24,213.78,324.14Z" style="fill:#407BFF"></path><path d="M213.78,324.14l2.57,1.73a35.39,35.39,0,0,0-6.23,8.15h-3.85S207.75,326.24,213.78,324.14Z" style="fill:#fff;opacity:0.5"></path><path d="M250.77,261.1l-2.06-2.32a35.53,35.53,0,0,0,8.08-6.31l3.73,1S257.13,260.59,250.77,261.1Z" style="fill:#407BFF"></path><path d="M250.77,261.1l-2.06-2.32a35.53,35.53,0,0,0,8.08-6.31l3.73,1S257.13,260.59,250.77,261.1Z" style="fill:#fff;opacity:0.5"></path><path d="M257.09,274.62s1.65,5.3,2.91,6.48S253,280.8,257.09,274.62Z" style="opacity:0.2"></path><rect x="161.47" y="329.49" width="55.43" height="82.71" rx="7.04" style="fill:#263238"></rect><rect x="161.47" y="329.49" width="55.43" height="82.71" rx="7.04" style="fill:#fff;isolation:isolate;opacity:0.6000000000000001"></rect><path d="M205.53,412.2h-37a7,7,0,0,1-7-7V336.53a7,7,0,0,1,7-7h37a7,7,0,0,0-7,7v68.63A7,7,0,0,0,205.53,412.2Z" style="isolation:isolate;opacity:0.2"></path></g><g id="freepik--speech-bubble--inject-93"><path d="M261.37,185.57H235.65a8.84,8.84,0,0,0-8.85,8.84v25a8.85,8.85,0,0,0,8.85,8.85H242l-3,6.89,7-6.89h15.39a8.85,8.85,0,0,0,8.85-8.85v-25A8.84,8.84,0,0,0,261.37,185.57Z" style="fill:#407BFF"></path><g style="opacity:0.30000000000000004"><path d="M261.37,185.57H235.65a8.84,8.84,0,0,0-8.85,8.84v25a8.85,8.85,0,0,0,8.85,8.85H242l-3,6.89,7-6.89h15.39a8.85,8.85,0,0,0,8.85-8.85v-25A8.84,8.84,0,0,0,261.37,185.57Z" style="fill:#fff"></path></g><path d="M251.55,201.45c0-1.93-1.48-3.24-3.86-3.24a5.61,5.61,0,0,0-5,2.66l-3-2.18a9.43,9.43,0,0,1,8.35-4.2c4.53,0,7.56,2.31,7.56,6.27,0,5.63-5.28,6.15-5.28,10.22H246.4C246.4,205.87,251.55,204.9,251.55,201.45Zm-5.64,15.08a2.46,2.46,0,1,1,4.9,0,2.46,2.46,0,1,1-4.9,0Z" style="fill:#fff"></path></g><g id="freepik--Table--inject-93"><rect x="104.56" y="408.41" width="73.75" height="9.42" style="fill:#263238"></rect><rect x="132.89" y="408.41" width="45.42" height="9.42" style="fill:#fff;isolation:isolate;opacity:0.2"></rect><polygon points="133.58 341.75 122.24 341.75 120.75 325.87 135.07 325.87 133.58 341.75" style="fill:#263238"></polygon><polygon points="133.58 341.75 122.24 341.75 120.75 325.87 135.07 325.87 133.58 341.75" style="fill:#fff;isolation:isolate;opacity:0.7000000000000001"></polygon><polygon points="133.21 341.27 122.61 341.27 121.82 332.23 134 332.23 133.21 341.27" style="fill:#fff;isolation:isolate;opacity:0.5"></polygon><rect x="163.06" y="327.52" width="6.56" height="14.19" style="fill:#263238"></rect><rect x="167.17" y="330.89" width="2.45" height="7.87" style="fill:#fff;isolation:isolate;opacity:0.5"></rect><rect x="162.56" y="325.96" width="7.55" height="1.55" transform="translate(332.68 653.48) rotate(180)" style="fill:#407BFF"></rect><path d="M150.32,342l-1.78-.06a.48.48,0,0,1,0-1l1.77.06a.48.48,0,0,1,0,1Z" style="fill:#407BFF"></path><path d="M149.52,341.92l-1,0a.48.48,0,0,1,0-1l1,0Z" style="fill:#fff;isolation:isolate;opacity:0.7000000000000001"></path><path d="M149.57,341l-1.57.82a.48.48,0,0,1-.45-.85l1.58-.82a.48.48,0,1,1,.44.85Z" style="fill:#407BFF"></path><path d="M148.87,341.33l-.87.45a.48.48,0,0,1-.45-.85l.87-.45Z" style="fill:#fff;isolation:isolate;opacity:0.7000000000000001"></path><rect x="149.05" y="336.22" width="14.62" height="5.49" style="fill:#263238"></rect><rect x="149.05" y="336.22" width="14.62" height="5.49" style="fill:#fff;isolation:isolate;opacity:0.5"></rect><rect x="153.1" y="336.22" width="6.99" height="3.74" style="fill:#fff;isolation:isolate;opacity:0.5"></rect><rect x="129.99" y="340.27" width="5.8" height="1.43" style="fill:#407BFF"></rect><path d="M146.93,342l-1.77-.06a.48.48,0,0,1,0-1L147,341a.48.48,0,1,1,0,1Z" style="fill:#407BFF"></path><path d="M146.14,342l-1,0a.48.48,0,0,1,0-1l1,0Z" style="fill:#fff;isolation:isolate;opacity:0.7000000000000001"></path><path d="M152.54,342l-1.77-.06a.48.48,0,0,1,0-1l1.77.06a.48.48,0,1,1,0,1Z" style="fill:#407BFF"></path><path d="M151.75,342l-1,0a.48.48,0,0,1,0-1l1,0Z" style="fill:#fff;isolation:isolate;opacity:0.7000000000000001"></path><path d="M140.76,342,139,341.9a.47.47,0,0,1-.46-.49.49.49,0,0,1,.49-.47l1.77.07a.48.48,0,1,1,0,.95Z" style="fill:#407BFF"></path><path d="M140,341.94l-1,0a.47.47,0,0,1-.46-.49.49.49,0,0,1,.49-.47l1,0Z" style="fill:#fff;isolation:isolate;opacity:0.7000000000000001"></path><path d="M145.12,341.26l-1.66.63a.47.47,0,0,1-.61-.28.49.49,0,0,1,.28-.62l1.66-.62a.48.48,0,0,1,.62.28A.48.48,0,0,1,145.12,341.26Z" style="fill:#407BFF"></path><path d="M144.38,341.55l-.92.34a.47.47,0,0,1-.61-.28.49.49,0,0,1,.28-.62l.91-.34Z" style="fill:#fff;isolation:isolate;opacity:0.7000000000000001"></path><rect x="102.91" y="344.28" width="76.59" height="69.55" style="fill:#407BFF"></rect><rect x="102.91" y="344.28" width="76.59" height="69.55" style="fill:#fff;isolation:isolate;opacity:0.4"></rect><rect x="102.91" y="344.28" width="28.18" height="69.55" style="isolation:isolate;opacity:0.2"></rect><path d="M181.77,344.28a2.53,2.53,0,0,1-2.53,2.54H103.18a2.54,2.54,0,0,1,0-5.07h76.06A2.53,2.53,0,0,1,181.77,344.28Z" style="fill:#407BFF"></path><path d="M181.77,344.28a2.53,2.53,0,0,1-2.53,2.54H131.19a2.54,2.54,0,0,1,0-5.07h48.05A2.53,2.53,0,0,1,181.77,344.28Z" style="fill:#fff;isolation:isolate;opacity:0.2"></path><rect x="135.11" y="350.44" width="40.88" height="13.93" style="fill:#fff;isolation:isolate;opacity:0.30000000000000004"></rect><rect x="135.11" y="367.13" width="40.88" height="42.38" style="fill:#fff;isolation:isolate;opacity:0.30000000000000004"></rect><circle cx="155.55" cy="353.55" r="1.32" style="isolation:isolate;opacity:0.2"></circle><circle cx="155.55" cy="371.54" r="1.32" style="isolation:isolate;opacity:0.2"></circle></g><g id="freepik--Lamp--inject-93"><rect x="87.27" y="227.35" width="4.75" height="187.66" style="fill:#263238"></rect><rect x="87.27" y="227.35" width="4.75" height="187.66" style="fill:#fff;isolation:isolate;opacity:0.2"></rect><path d="M87.71,402.79h3.88a4.79,4.79,0,0,1,4.79,4.79v8.66a0,0,0,0,1,0,0H82.92a0,0,0,0,1,0,0v-8.66A4.79,4.79,0,0,1,87.71,402.79Z" style="fill:#263238"></path><path d="M107.57,208.83H71.71c-.79,30.24-12,46.34-12,46.34h59.87S108.36,239.07,107.57,208.83Z" style="fill:#407BFF"></path><path d="M87.71,402.79h3.88a4.79,4.79,0,0,1,4.79,4.79v8.66a0,0,0,0,1,0,0H82.92a0,0,0,0,1,0,0v-8.66A4.79,4.79,0,0,1,87.71,402.79Z" style="fill:#fff;isolation:isolate;opacity:0.30000000000000004"></path><path d="M75.76,412.2h27.77a5.63,5.63,0,0,1,5.63,5.63v0a0,0,0,0,1,0,0h-39a0,0,0,0,1,0,0v0A5.63,5.63,0,0,1,75.76,412.2Z" style="fill:#263238"></path><path d="M75.76,412.2h27.77a5.63,5.63,0,0,1,5.63,5.63v0a0,0,0,0,1,0,0h-39a0,0,0,0,1,0,0v0A5.63,5.63,0,0,1,75.76,412.2Z" style="fill:#fff;isolation:isolate;opacity:0.4"></path><path d="M119.58,255.17H59.71s3.63-5.21,6.91-15.28a109.53,109.53,0,0,0,5.1-31.06h35.86a109.85,109.85,0,0,0,5.09,31C116,250,119.58,255.17,119.58,255.17Z" style="fill:#fff;isolation:isolate;opacity:0.5"></path><path d="M112.67,239.88a28.56,28.56,0,0,1-46,0,109.53,109.53,0,0,0,5.1-31.06h35.86A109.85,109.85,0,0,0,112.67,239.88Z" style="fill:#fff;isolation:isolate;opacity:0.2"></path></g></svg>

================
File: public/manifest.json
================
{
  "name": "CareMind",
  "short_name": "CareMind",
  "start_url": "/",
  "display": "standalone",
  "background_color": "#ffffff",
  "theme_color": "#0400BA",
  "description": "Um app PWA feito com Next.js 😎",
  "icons": [
    { "src": "/icons/logo_coracao.png", "sizes": "192x192", "type": "image/png", "purpose": "any" },
    { "src": "/icons/logo_coracao.png", "sizes": "512x512", "type": "image/png", "purpose": "any" }
  ]
}

================
File: public/sw.js
================
if(!self.define){let e,n={};const s=(s,a)=>(s=new URL(s+".js",a).href,n[s]||new Promise(n=>{if("document"in self){const e=document.createElement("script");e.src=s,e.onload=n,document.head.appendChild(e)}else e=s,importScripts(s),n()}).then(()=>{const e=n[s];if(!e)throw new Error(`Module ${s} didn’t register its module`);return e}));self.define=(a,t)=>{const r=e||("document"in self?document.currentScript.src:"")||location.href;if(n[r])return;const i={};const c=e=>s(e,r),o={module:{uri:r},exports:i,require:c};n[r]=Promise.all(a.map(e=>o[e]||c(e))).then(e=>(t(...e),i))}}define(["./workbox-c2c0676f"],function(e){"use strict";importScripts("/fallback-ce627215c0e4a9af.js"),self.skipWaiting(),e.clientsClaim(),e.precacheAndRoute([{url:"/_next/static/H39wVANZ0N4ox3Ebn3nqQ/_buildManifest.js",revision:"1ece6dc69bd5c10856c0636edd0efbbe"},{url:"/_next/static/H39wVANZ0N4ox3Ebn3nqQ/_ssgManifest.js",revision:"b6652df95db52feb4daf4eca35380933"},{url:"/_next/static/chunks/1125-e640849e3e2814ab.js",revision:"e640849e3e2814ab"},{url:"/_next/static/chunks/1143-3d9011047fa056f4.js",revision:"3d9011047fa056f4"},{url:"/_next/static/chunks/1496-bcf59de326f18b66.js",revision:"bcf59de326f18b66"},{url:"/_next/static/chunks/1646.9123ee47220ed70b.js",revision:"9123ee47220ed70b"},{url:"/_next/static/chunks/183-dec3e7037d6bb392.js",revision:"dec3e7037d6bb392"},{url:"/_next/static/chunks/2619-38012e79151e370a.js",revision:"38012e79151e370a"},{url:"/_next/static/chunks/39-2bb570c7b8cdc82d.js",revision:"2bb570c7b8cdc82d"},{url:"/_next/static/chunks/4bd1b696-6ba40a8e5adf1b2c.js",revision:"6ba40a8e5adf1b2c"},{url:"/_next/static/chunks/5139.c5e46d26064a85db.js",revision:"c5e46d26064a85db"},{url:"/_next/static/chunks/5239-99f71af5a170d036.js",revision:"99f71af5a170d036"},{url:"/_next/static/chunks/538-dd844710d70cfd45.js",revision:"dd844710d70cfd45"},{url:"/_next/static/chunks/5626-93806005b078571d.js",revision:"93806005b078571d"},{url:"/_next/static/chunks/6495-e32e8bd35188e689.js",revision:"e32e8bd35188e689"},{url:"/_next/static/chunks/7559-fbd6a636baf4331a.js",revision:"fbd6a636baf4331a"},{url:"/_next/static/chunks/7734-cdd6d4ace9002378.js",revision:"cdd6d4ace9002378"},{url:"/_next/static/chunks/820-dca503df82a4718c.js",revision:"dca503df82a4718c"},{url:"/_next/static/chunks/9c4e2130-2dbbf4d1082d731a.js",revision:"2dbbf4d1082d731a"},{url:"/_next/static/chunks/app/(dashboard)/compromissos/page-d1e545621d5a5280.js",revision:"d1e545621d5a5280"},{url:"/_next/static/chunks/app/(dashboard)/configuracoes/page-5b1589bef71d528a.js",revision:"5b1589bef71d528a"},{url:"/_next/static/chunks/app/(dashboard)/dashboard/page-9466505250126fbf.js",revision:"9466505250126fbf"},{url:"/_next/static/chunks/app/(dashboard)/familia/page-b31306465fe6911a.js",revision:"b31306465fe6911a"},{url:"/_next/static/chunks/app/(dashboard)/familiar-dashboard/page-aeadfdf409cf332e.js",revision:"aeadfdf409cf332e"},{url:"/_next/static/chunks/app/(dashboard)/integracoes/page-96c77bb7661d7803.js",revision:"96c77bb7661d7803"},{url:"/_next/static/chunks/app/(dashboard)/layout-9d958c878eef923b.js",revision:"9d958c878eef923b"},{url:"/_next/static/chunks/app/(dashboard)/perfil/page-61a8b29985194882.js",revision:"61a8b29985194882"},{url:"/_next/static/chunks/app/(dashboard)/relatorios/page-e5a83095e188743a.js",revision:"e5a83095e188743a"},{url:"/_next/static/chunks/app/(dashboard)/remedios/page-08a340735ef4ac2e.js",revision:"08a340735ef4ac2e"},{url:"/_next/static/chunks/app/(dashboard)/rotinas/page-96b0dfcdab877065.js",revision:"96b0dfcdab877065"},{url:"/_next/static/chunks/app/_not-found/page-c8a4ed5d6a1a6e6c.js",revision:"c8a4ed5d6a1a6e6c"},{url:"/_next/static/chunks/app/ajuda/page-fd0dc13dd8d759e8.js",revision:"fd0dc13dd8d759e8"},{url:"/_next/static/chunks/app/api/agenda/route-487bab5fbe06fa90.js",revision:"487bab5fbe06fa90"},{url:"/_next/static/chunks/app/api/change-password/route-487bab5fbe06fa90.js",revision:"487bab5fbe06fa90"},{url:"/_next/static/chunks/app/api/compromissos/%5Bid%5D/route-487bab5fbe06fa90.js",revision:"487bab5fbe06fa90"},{url:"/_next/static/chunks/app/api/compromissos/route-487bab5fbe06fa90.js",revision:"487bab5fbe06fa90"},{url:"/_next/static/chunks/app/api/criar-idoso/route-487bab5fbe06fa90.js",revision:"487bab5fbe06fa90"},{url:"/_next/static/chunks/app/api/historico_eventos/%5Bid%5D/route-487bab5fbe06fa90.js",revision:"487bab5fbe06fa90"},{url:"/_next/static/chunks/app/api/medicamentos/%5Bid%5D/route-487bab5fbe06fa90.js",revision:"487bab5fbe06fa90"},{url:"/_next/static/chunks/app/api/medicamentos/route-487bab5fbe06fa90.js",revision:"487bab5fbe06fa90"},{url:"/_next/static/chunks/app/api/perfil/%5Bid%5D/route-487bab5fbe06fa90.js",revision:"487bab5fbe06fa90"},{url:"/_next/static/chunks/app/api/perfil/route-487bab5fbe06fa90.js",revision:"487bab5fbe06fa90"},{url:"/_next/static/chunks/app/api/relatorios/historico/route-487bab5fbe06fa90.js",revision:"487bab5fbe06fa90"},{url:"/_next/static/chunks/app/api/rotinas/%5Bid%5D/route-487bab5fbe06fa90.js",revision:"487bab5fbe06fa90"},{url:"/_next/static/chunks/app/api/rotinas/route-487bab5fbe06fa90.js",revision:"487bab5fbe06fa90"},{url:"/_next/static/chunks/app/api/vinculos/%5Bid%5D/route-487bab5fbe06fa90.js",revision:"487bab5fbe06fa90"},{url:"/_next/static/chunks/app/api/vinculos/idosos/route-487bab5fbe06fa90.js",revision:"487bab5fbe06fa90"},{url:"/_next/static/chunks/app/auth/page-9f1f692d80d75959.js",revision:"9f1f692d80d75959"},{url:"/_next/static/chunks/app/blog/page-881b9e60d9134132.js",revision:"881b9e60d9134132"},{url:"/_next/static/chunks/app/contato/page-2d5a3a5a88df7922.js",revision:"2d5a3a5a88df7922"},{url:"/_next/static/chunks/app/cookies/page-719f4492cd568161.js",revision:"719f4492cd568161"},{url:"/_next/static/chunks/app/forgot-password/page-6020a07a44766897.js",revision:"6020a07a44766897"},{url:"/_next/static/chunks/app/funcionalidades/page-a3a616b17eaf9b58.js",revision:"a3a616b17eaf9b58"},{url:"/_next/static/chunks/app/layout-9e7cb934b32dd34b.js",revision:"9e7cb934b32dd34b"},{url:"/_next/static/chunks/app/offline/page-fa27da15a60851ae.js",revision:"fa27da15a60851ae"},{url:"/_next/static/chunks/app/onboarding/page-403d957b3a60b3f0.js",revision:"403d957b3a60b3f0"},{url:"/_next/static/chunks/app/page-13d7378633fce2b1.js",revision:"13d7378633fce2b1"},{url:"/_next/static/chunks/app/politica-privacidade/page-5bd5f10bd0a38a32.js",revision:"5bd5f10bd0a38a32"},{url:"/_next/static/chunks/app/privacidade/page-63201240259ec4f1.js",revision:"63201240259ec4f1"},{url:"/_next/static/chunks/app/reset-password/page-9509a389bd6e4318.js",revision:"9509a389bd6e4318"},{url:"/_next/static/chunks/app/seguranca/page-7f9de2650ffe97d1.js",revision:"7f9de2650ffe97d1"},{url:"/_next/static/chunks/app/sobre/page-c8590e2c5addf421.js",revision:"c8590e2c5addf421"},{url:"/_next/static/chunks/app/status/page-f05d9d2ff596fbda.js",revision:"f05d9d2ff596fbda"},{url:"/_next/static/chunks/app/termos/page-b1780fd464457943.js",revision:"b1780fd464457943"},{url:"/_next/static/chunks/ca377847-ff5497c9e602f93b.js",revision:"ff5497c9e602f93b"},{url:"/_next/static/chunks/ee560e2c-d72490a792d6b610.js",revision:"d72490a792d6b610"},{url:"/_next/static/chunks/framework-f31701c9d93f12a4.js",revision:"f31701c9d93f12a4"},{url:"/_next/static/chunks/main-app-1d75eec1c5bfc7ab.js",revision:"1d75eec1c5bfc7ab"},{url:"/_next/static/chunks/main-c51bc9a458cc9784.js",revision:"c51bc9a458cc9784"},{url:"/_next/static/chunks/pages/_app-131c90850aef965b.js",revision:"131c90850aef965b"},{url:"/_next/static/chunks/pages/_error-e4ba546eb376bdf4.js",revision:"e4ba546eb376bdf4"},{url:"/_next/static/chunks/polyfills-42372ed130431b0a.js",revision:"846118c33b2c0e922d7b3a7676f81f6f"},{url:"/_next/static/chunks/webpack-46df30cd988d8660.js",revision:"46df30cd988d8660"},{url:"/_next/static/css/03eb779c8828d853.css",revision:"03eb779c8828d853"},{url:"/_next/static/css/0a12bf27a27f6e0f.css",revision:"0a12bf27a27f6e0f"},{url:"/_next/static/css/0e42426c2bd61d68.css",revision:"0e42426c2bd61d68"},{url:"/_next/static/css/24c488585864d28e.css",revision:"24c488585864d28e"},{url:"/_next/static/css/6469028f1cf8a433.css",revision:"6469028f1cf8a433"},{url:"/_next/static/css/8f1f0e7d3f7a7b84.css",revision:"8f1f0e7d3f7a7b84"},{url:"/_next/static/css/90fe75f9aa4a019b.css",revision:"90fe75f9aa4a019b"},{url:"/_next/static/css/bf47663a512818d3.css",revision:"bf47663a512818d3"},{url:"/_next/static/css/cc70e69dd04d93e2.css",revision:"cc70e69dd04d93e2"},{url:"/_next/static/css/cd9e28dea955576b.css",revision:"cd9e28dea955576b"},{url:"/fallback-ce627215c0e4a9af.js",revision:"38b3bfd9c1d6240f51534e2d01365949"},{url:"/favicon.ico",revision:"699c5f2b4f0a52a3c294674fb2ed3508"},{url:"/icons/back.svg",revision:"a28f5b00a47f56c142da63ef4854c692"},{url:"/icons/cuidador.webp",revision:"24d74c27da7532749945ae7990ff6b2c"},{url:"/icons/file.svg",revision:"d09f95206c3fa0bb9bd9fefabfd0ea71"},{url:"/icons/foto_padrao.png",revision:"95abc9593590f552032461ae530d4a2f"},{url:"/icons/globe.svg",revision:"2aaafa6a49b6563925fe440891e32717"},{url:"/icons/idoso.webp",revision:"d0968b89d244dd58ed9018c2b3de525d"},{url:"/icons/logo_coracao.png",revision:"a4bcc61fec20e53a060752618c2a4315"},{url:"/icons/logo_coracao.png",revision:"5f581b5e99a43341e30cbdb851bdf7a3"},{url:"/icons/next.svg",revision:"8e061864f388b47f33a1c3780831193e"},{url:"/icons/teamwork.webp",revision:"0224f832132d8f6cb6db3ec4bf7d42bd"},{url:"/icons/user.webp",revision:"3bfc921a0b07314c643275ec28498ceb"},{url:"/icons/vercel.svg",revision:"c0af2f507b369b085b35ef4bbe3bcf1e"},{url:"/icons/window.svg",revision:"a2760511c65806022ad20adf74370ff3"},{url:"/images/alexa-logo.png",revision:"0d658a1082f9886105752d645b5805e0"},{url:"/images/google_home-logo.png",revision:"62ca6aed445a27b668428e834c1a5e3a"},{url:"/images/hero-elderly.svg",revision:"4aec5f41daabc776682f538ee4a1ace5"},{url:"/manifest.json",revision:"3b8fc047518750891e947b4e4a17db52"},{url:"/offline",revision:"H39wVANZ0N4ox3Ebn3nqQ"},{url:"/swe-worker-5c72df51bb1f6ee0.js",revision:"76fdd3369f623a3edcf74ce2200bfdd0"}],{ignoreURLParametersMatching:[/^utm_/,/^fbclid$/]}),e.cleanupOutdatedCaches(),e.registerRoute("/",new e.NetworkFirst({cacheName:"start-url",plugins:[{cacheWillUpdate:function(e){var n=e.response;return _async_to_generator(function(){return _ts_generator(this,function(e){return[2,n&&"opaqueredirect"===n.type?new Response(n.body,{status:200,statusText:"OK",headers:n.headers}):n]})})()}},{handlerDidError:function(e){var n=e.request;return _async_to_generator(function(){return _ts_generator(this,function(e){return[2,"undefined"!=typeof self?self.fallback(n):Response.error()]})})()}}]}),"GET"),e.registerRoute(/^https:\/\/fonts\.(?:gstatic)\.com\/.*/i,new e.CacheFirst({cacheName:"google-fonts-webfonts",plugins:[new e.ExpirationPlugin({maxEntries:4,maxAgeSeconds:31536e3}),{handlerDidError:function(e){var n=e.request;return _async_to_generator(function(){return _ts_generator(this,function(e){return[2,"undefined"!=typeof self?self.fallback(n):Response.error()]})})()}}]}),"GET"),e.registerRoute(/^https:\/\/fonts\.(?:googleapis)\.com\/.*/i,new e.StaleWhileRevalidate({cacheName:"google-fonts-stylesheets",plugins:[new e.ExpirationPlugin({maxEntries:4,maxAgeSeconds:604800}),{handlerDidError:function(e){var n=e.request;return _async_to_generator(function(){return _ts_generator(this,function(e){return[2,"undefined"!=typeof self?self.fallback(n):Response.error()]})})()}}]}),"GET"),e.registerRoute(/\.(?:eot|otf|ttc|ttf|woff|woff2|font.css)$/i,new e.StaleWhileRevalidate({cacheName:"static-font-assets",plugins:[new e.ExpirationPlugin({maxEntries:4,maxAgeSeconds:604800}),{handlerDidError:function(e){var n=e.request;return _async_to_generator(function(){return _ts_generator(this,function(e){return[2,"undefined"!=typeof self?self.fallback(n):Response.error()]})})()}}]}),"GET"),e.registerRoute(/\.(?:jpg|jpeg|gif|png|svg|ico|webp)$/i,new e.StaleWhileRevalidate({cacheName:"static-image-assets",plugins:[new e.ExpirationPlugin({maxEntries:64,maxAgeSeconds:2592e3}),{handlerDidError:function(e){var n=e.request;return _async_to_generator(function(){return _ts_generator(this,function(e){return[2,"undefined"!=typeof self?self.fallback(n):Response.error()]})})()}}]}),"GET"),e.registerRoute(/\/_next\/static.+\.js$/i,new e.CacheFirst({cacheName:"next-static-js-assets",plugins:[new e.ExpirationPlugin({maxEntries:64,maxAgeSeconds:86400}),{handlerDidError:function(e){var n=e.request;return _async_to_generator(function(){return _ts_generator(this,function(e){return[2,"undefined"!=typeof self?self.fallback(n):Response.error()]})})()}}]}),"GET"),e.registerRoute(/\/_next\/image\?url=.+$/i,new e.StaleWhileRevalidate({cacheName:"next-image",plugins:[new e.ExpirationPlugin({maxEntries:64,maxAgeSeconds:86400}),{handlerDidError:function(e){var n=e.request;return _async_to_generator(function(){return _ts_generator(this,function(e){return[2,"undefined"!=typeof self?self.fallback(n):Response.error()]})})()}}]}),"GET"),e.registerRoute(/\.(?:mp3|wav|ogg)$/i,new e.CacheFirst({cacheName:"static-audio-assets",plugins:[new e.RangeRequestsPlugin,new e.ExpirationPlugin({maxEntries:32,maxAgeSeconds:86400}),{handlerDidError:function(e){var n=e.request;return _async_to_generator(function(){return _ts_generator(this,function(e){return[2,"undefined"!=typeof self?self.fallback(n):Response.error()]})})()}}]}),"GET"),e.registerRoute(/\.(?:mp4|webm)$/i,new e.CacheFirst({cacheName:"static-video-assets",plugins:[new e.RangeRequestsPlugin,new e.ExpirationPlugin({maxEntries:32,maxAgeSeconds:86400}),{handlerDidError:function(e){var n=e.request;return _async_to_generator(function(){return _ts_generator(this,function(e){return[2,"undefined"!=typeof self?self.fallback(n):Response.error()]})})()}}]}),"GET"),e.registerRoute(/\.(?:js)$/i,new e.StaleWhileRevalidate({cacheName:"static-js-assets",plugins:[new e.ExpirationPlugin({maxEntries:48,maxAgeSeconds:86400}),{handlerDidError:function(e){var n=e.request;return _async_to_generator(function(){return _ts_generator(this,function(e){return[2,"undefined"!=typeof self?self.fallback(n):Response.error()]})})()}}]}),"GET"),e.registerRoute(/\.(?:css|less)$/i,new e.StaleWhileRevalidate({cacheName:"static-style-assets",plugins:[new e.ExpirationPlugin({maxEntries:32,maxAgeSeconds:86400}),{handlerDidError:function(e){var n=e.request;return _async_to_generator(function(){return _ts_generator(this,function(e){return[2,"undefined"!=typeof self?self.fallback(n):Response.error()]})})()}}]}),"GET"),e.registerRoute(/\/_next\/data\/.+\/.+\.json$/i,new e.StaleWhileRevalidate({cacheName:"next-data",plugins:[new e.ExpirationPlugin({maxEntries:32,maxAgeSeconds:86400}),{handlerDidError:function(e){var n=e.request;return _async_to_generator(function(){return _ts_generator(this,function(e){return[2,"undefined"!=typeof self?self.fallback(n):Response.error()]})})()}}]}),"GET"),e.registerRoute(/\.(?:json|xml|csv)$/i,new e.NetworkFirst({cacheName:"static-data-assets",plugins:[new e.ExpirationPlugin({maxEntries:32,maxAgeSeconds:86400}),{handlerDidError:function(e){var n=e.request;return _async_to_generator(function(){return _ts_generator(this,function(e){return[2,"undefined"!=typeof self?self.fallback(n):Response.error()]})})()}}]}),"GET"),e.registerRoute(function(e){var n=e.sameOrigin,s=e.url.pathname;return!(!n||s.startsWith("/api/auth/callback")||!s.startsWith("/api/"))},new e.NetworkFirst({cacheName:"apis",networkTimeoutSeconds:10,plugins:[new e.ExpirationPlugin({maxEntries:16,maxAgeSeconds:86400}),{handlerDidError:function(e){var n=e.request;return _async_to_generator(function(){return _ts_generator(this,function(e){return[2,"undefined"!=typeof self?self.fallback(n):Response.error()]})})()}}]}),"GET"),e.registerRoute(function(e){var n=e.request,s=e.url.pathname,a=e.sameOrigin;return"1"===n.headers.get("RSC")&&"1"===n.headers.get("Next-Router-Prefetch")&&a&&!s.startsWith("/api/")},new e.NetworkFirst({cacheName:"pages-rsc-prefetch",plugins:[new e.ExpirationPlugin({maxEntries:32,maxAgeSeconds:86400}),{handlerDidError:function(e){var n=e.request;return _async_to_generator(function(){return _ts_generator(this,function(e){return[2,"undefined"!=typeof self?self.fallback(n):Response.error()]})})()}}]}),"GET"),e.registerRoute(function(e){var n=e.request,s=e.url.pathname,a=e.sameOrigin;return"1"===n.headers.get("RSC")&&a&&!s.startsWith("/api/")},new e.NetworkFirst({cacheName:"pages-rsc",plugins:[new e.ExpirationPlugin({maxEntries:32,maxAgeSeconds:86400}),{handlerDidError:function(e){var n=e.request;return _async_to_generator(function(){return _ts_generator(this,function(e){return[2,"undefined"!=typeof self?self.fallback(n):Response.error()]})})()}}]}),"GET"),e.registerRoute(function(e){var n=e.url.pathname;return e.sameOrigin&&!n.startsWith("/api/")},new e.NetworkFirst({cacheName:"pages",plugins:[new e.ExpirationPlugin({maxEntries:32,maxAgeSeconds:86400}),{handlerDidError:function(e){var n=e.request;return _async_to_generator(function(){return _ts_generator(this,function(e){return[2,"undefined"!=typeof self?self.fallback(n):Response.error()]})})()}}]}),"GET"),e.registerRoute(function(e){return!e.sameOrigin},new e.NetworkFirst({cacheName:"cross-origin",networkTimeoutSeconds:10,plugins:[new e.ExpirationPlugin({maxEntries:32,maxAgeSeconds:3600}),{handlerDidError:function(e){var n=e.request;return _async_to_generator(function(){return _ts_generator(this,function(e){return[2,"undefined"!=typeof self?self.fallback(n):Response.error()]})})()}}]}),"GET"),self.__WB_DISABLE_DEV_LOGS=!0});

================
File: public/swe-worker-5c72df51bb1f6ee0.js
================
(()=>{"use strict";self.onmessage=async e=>{switch(e.data.type){case"__START_URL_CACHE__":{const t=e.data.url,a=await fetch(t);if(!a.redirected)return(await caches.open("start-url")).put(t,a);return Promise.resolve()}case"__FRONTEND_NAV_CACHE__":{const t=e.data.url,a=await caches.open("pages");if(await a.match(t,{ignoreSearch:!0}))return;const s=await fetch(t);if(!s.ok)return;if(a.put(t,s.clone()),e.data.shouldCacheAggressively&&s.headers.get("Content-Type")?.includes("text/html"))try{const e=await s.text(),t=[],a=await caches.open("static-style-assets"),r=await caches.open("next-static-js-assets"),c=await caches.open("static-js-assets");for(const[s,r]of e.matchAll(/<link.*?href=['"](.*?)['"].*?>/g))/rel=['"]stylesheet['"]/.test(s)&&t.push(a.match(r).then(e=>e?Promise.resolve():a.add(r)));for(const[,a]of e.matchAll(/<script.*?src=['"](.*?)['"].*?>/g)){const e=/\/_next\/static.+\.js$/i.test(a)?r:c;t.push(e.match(a).then(t=>t?Promise.resolve():e.add(a)))}return await Promise.all(t)}catch{}return Promise.resolve()}default:return Promise.resolve()}}})();

================
File: public/workbox-c2c0676f.js
================
define(["exports"],function(t){"use strict";try{self["workbox:core:7.0.0"]&&_()}catch(t){}const e=(t,...e)=>{let s=t;return e.length>0&&(s+=` :: ${JSON.stringify(e)}`),s};class s extends Error{constructor(t,s){super(e(t,s)),this.name=t,this.details=s}}try{self["workbox:routing:7.0.0"]&&_()}catch(t){}const n=t=>t&&"object"==typeof t?t:{handle:t};class r{constructor(t,e,s="GET"){this.handler=n(e),this.match=t,this.method=s}setCatchHandler(t){this.catchHandler=n(t)}}class i extends r{constructor(t,e,s){super(({url:e})=>{const s=t.exec(e.href);if(s&&(e.origin===location.origin||0===s.index))return s.slice(1)},e,s)}}class a{constructor(){this.t=new Map,this.i=new Map}get routes(){return this.t}addFetchListener(){self.addEventListener("fetch",t=>{const{request:e}=t,s=this.handleRequest({request:e,event:t});s&&t.respondWith(s)})}addCacheListener(){self.addEventListener("message",t=>{if(t.data&&"CACHE_URLS"===t.data.type){const{payload:e}=t.data,s=Promise.all(e.urlsToCache.map(e=>{"string"==typeof e&&(e=[e]);const s=new Request(...e);return this.handleRequest({request:s,event:t})}));t.waitUntil(s),t.ports&&t.ports[0]&&s.then(()=>t.ports[0].postMessage(!0))}})}handleRequest({request:t,event:e}){const s=new URL(t.url,location.href);if(!s.protocol.startsWith("http"))return;const n=s.origin===location.origin,{params:r,route:i}=this.findMatchingRoute({event:e,request:t,sameOrigin:n,url:s});let a=i&&i.handler;const o=t.method;if(!a&&this.i.has(o)&&(a=this.i.get(o)),!a)return;let c;try{c=a.handle({url:s,request:t,event:e,params:r})}catch(t){c=Promise.reject(t)}const h=i&&i.catchHandler;return c instanceof Promise&&(this.o||h)&&(c=c.catch(async n=>{if(h)try{return await h.handle({url:s,request:t,event:e,params:r})}catch(t){t instanceof Error&&(n=t)}if(this.o)return this.o.handle({url:s,request:t,event:e});throw n})),c}findMatchingRoute({url:t,sameOrigin:e,request:s,event:n}){const r=this.t.get(s.method)||[];for(const i of r){let r;const a=i.match({url:t,sameOrigin:e,request:s,event:n});if(a)return r=a,(Array.isArray(r)&&0===r.length||a.constructor===Object&&0===Object.keys(a).length||"boolean"==typeof a)&&(r=void 0),{route:i,params:r}}return{}}setDefaultHandler(t,e="GET"){this.i.set(e,n(t))}setCatchHandler(t){this.o=n(t)}registerRoute(t){this.t.has(t.method)||this.t.set(t.method,[]),this.t.get(t.method).push(t)}unregisterRoute(t){if(!this.t.has(t.method))throw new s("unregister-route-but-not-found-with-method",{method:t.method});const e=this.t.get(t.method).indexOf(t);if(!(e>-1))throw new s("unregister-route-route-not-registered");this.t.get(t.method).splice(e,1)}}let o;const c=()=>(o||(o=new a,o.addFetchListener(),o.addCacheListener()),o);function h(t,e,n){let a;if("string"==typeof t){const s=new URL(t,location.href);a=new r(({url:t})=>t.href===s.href,e,n)}else if(t instanceof RegExp)a=new i(t,e,n);else if("function"==typeof t)a=new r(t,e,n);else{if(!(t instanceof r))throw new s("unsupported-route-type",{moduleName:"workbox-routing",funcName:"registerRoute",paramName:"capture"});a=t}return c().registerRoute(a),a}try{self["workbox:strategies:7.0.0"]&&_()}catch(t){}const u={cacheWillUpdate:async({response:t})=>200===t.status||0===t.status?t:null},l={googleAnalytics:"googleAnalytics",precache:"precache-v2",prefix:"workbox",runtime:"runtime",suffix:"undefined"!=typeof registration?registration.scope:""},f=t=>[l.prefix,t,l.suffix].filter(t=>t&&t.length>0).join("-"),w=t=>t||f(l.precache),d=t=>t||f(l.runtime);function p(t,e){const s=new URL(t);for(const t of e)s.searchParams.delete(t);return s.href}class y{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}}const g=new Set;function m(t){return"string"==typeof t?new Request(t):t}class v{constructor(t,e){this.h={},Object.assign(this,e),this.event=e.event,this.u=t,this.l=new y,this.p=[],this.m=[...t.plugins],this.v=new Map;for(const t of this.m)this.v.set(t,{});this.event.waitUntil(this.l.promise)}async fetch(t){const{event:e}=this;let n=m(t);if("navigate"===n.mode&&e instanceof FetchEvent&&e.preloadResponse){const t=await e.preloadResponse;if(t)return t}const r=this.hasCallback("fetchDidFail")?n.clone():null;try{for(const t of this.iterateCallbacks("requestWillFetch"))n=await t({request:n.clone(),event:e})}catch(t){if(t instanceof Error)throw new s("plugin-error-request-will-fetch",{thrownErrorMessage:t.message})}const i=n.clone();try{let t;t=await fetch(n,"navigate"===n.mode?void 0:this.u.fetchOptions);for(const s of this.iterateCallbacks("fetchDidSucceed"))t=await s({event:e,request:i,response:t});return t}catch(t){throw r&&await this.runCallbacks("fetchDidFail",{error:t,event:e,originalRequest:r.clone(),request:i.clone()}),t}}async fetchAndCachePut(t){const e=await this.fetch(t),s=e.clone();return this.waitUntil(this.cachePut(t,s)),e}async cacheMatch(t){const e=m(t);let s;const{cacheName:n,matchOptions:r}=this.u,i=await this.getCacheKey(e,"read"),a=Object.assign(Object.assign({},r),{cacheName:n});s=await caches.match(i,a);for(const t of this.iterateCallbacks("cachedResponseWillBeUsed"))s=await t({cacheName:n,matchOptions:r,cachedResponse:s,request:i,event:this.event})||void 0;return s}async cachePut(t,e){const n=m(t);var r;await(r=0,new Promise(t=>setTimeout(t,r)));const i=await this.getCacheKey(n,"write");if(!e)throw new s("cache-put-with-no-response",{url:(a=i.url,new URL(String(a),location.href).href.replace(new RegExp(`^${location.origin}`),""))});var a;const o=await this.R(e);if(!o)return!1;const{cacheName:c,matchOptions:h}=this.u,u=await self.caches.open(c),l=this.hasCallback("cacheDidUpdate"),f=l?await async function(t,e,s,n){const r=p(e.url,s);if(e.url===r)return t.match(e,n);const i=Object.assign(Object.assign({},n),{ignoreSearch:!0}),a=await t.keys(e,i);for(const e of a)if(r===p(e.url,s))return t.match(e,n)}(u,i.clone(),["__WB_REVISION__"],h):null;try{await u.put(i,l?o.clone():o)}catch(t){if(t instanceof Error)throw"QuotaExceededError"===t.name&&await async function(){for(const t of g)await t()}(),t}for(const t of this.iterateCallbacks("cacheDidUpdate"))await t({cacheName:c,oldResponse:f,newResponse:o.clone(),request:i,event:this.event});return!0}async getCacheKey(t,e){const s=`${t.url} | ${e}`;if(!this.h[s]){let n=t;for(const t of this.iterateCallbacks("cacheKeyWillBeUsed"))n=m(await t({mode:e,request:n,event:this.event,params:this.params}));this.h[s]=n}return this.h[s]}hasCallback(t){for(const e of this.u.plugins)if(t in e)return!0;return!1}async runCallbacks(t,e){for(const s of this.iterateCallbacks(t))await s(e)}*iterateCallbacks(t){for(const e of this.u.plugins)if("function"==typeof e[t]){const s=this.v.get(e),n=n=>{const r=Object.assign(Object.assign({},n),{state:s});return e[t](r)};yield n}}waitUntil(t){return this.p.push(t),t}async doneWaiting(){let t;for(;t=this.p.shift();)await t}destroy(){this.l.resolve(null)}async R(t){let e=t,s=!1;for(const t of this.iterateCallbacks("cacheWillUpdate"))if(e=await t({request:this.request,response:e,event:this.event})||void 0,s=!0,!e)break;return s||e&&200!==e.status&&(e=void 0),e}}class R{constructor(t={}){this.cacheName=d(t.cacheName),this.plugins=t.plugins||[],this.fetchOptions=t.fetchOptions,this.matchOptions=t.matchOptions}handle(t){const[e]=this.handleAll(t);return e}handleAll(t){t instanceof FetchEvent&&(t={event:t,request:t.request});const e=t.event,s="string"==typeof t.request?new Request(t.request):t.request,n="params"in t?t.params:void 0,r=new v(this,{event:e,request:s,params:n}),i=this.q(r,s,e);return[i,this.D(i,r,s,e)]}async q(t,e,n){let r;await t.runCallbacks("handlerWillStart",{event:n,request:e});try{if(r=await this.U(e,t),!r||"error"===r.type)throw new s("no-response",{url:e.url})}catch(s){if(s instanceof Error)for(const i of t.iterateCallbacks("handlerDidError"))if(r=await i({error:s,event:n,request:e}),r)break;if(!r)throw s}for(const s of t.iterateCallbacks("handlerWillRespond"))r=await s({event:n,request:e,response:r});return r}async D(t,e,s,n){let r,i;try{r=await t}catch(i){}try{await e.runCallbacks("handlerDidRespond",{event:n,request:s,response:r}),await e.doneWaiting()}catch(t){t instanceof Error&&(i=t)}if(await e.runCallbacks("handlerDidComplete",{event:n,request:s,response:r,error:i}),e.destroy(),i)throw i}}function b(t){t.then(()=>{})}function q(){return q=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var s=arguments[e];for(var n in s)({}).hasOwnProperty.call(s,n)&&(t[n]=s[n])}return t},q.apply(null,arguments)}let D,U;const x=new WeakMap,L=new WeakMap,I=new WeakMap,C=new WeakMap,E=new WeakMap;let N={get(t,e,s){if(t instanceof IDBTransaction){if("done"===e)return L.get(t);if("objectStoreNames"===e)return t.objectStoreNames||I.get(t);if("store"===e)return s.objectStoreNames[1]?void 0:s.objectStore(s.objectStoreNames[0])}return k(t[e])},set:(t,e,s)=>(t[e]=s,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function O(t){return t!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(U||(U=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(B(this),e),k(x.get(this))}:function(...e){return k(t.apply(B(this),e))}:function(e,...s){const n=t.call(B(this),e,...s);return I.set(n,e.sort?e.sort():[e]),k(n)}}function T(t){return"function"==typeof t?O(t):(t instanceof IDBTransaction&&function(t){if(L.has(t))return;const e=new Promise((e,s)=>{const n=()=>{t.removeEventListener("complete",r),t.removeEventListener("error",i),t.removeEventListener("abort",i)},r=()=>{e(),n()},i=()=>{s(t.error||new DOMException("AbortError","AbortError")),n()};t.addEventListener("complete",r),t.addEventListener("error",i),t.addEventListener("abort",i)});L.set(t,e)}(t),e=t,(D||(D=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(t=>e instanceof t)?new Proxy(t,N):t);var e}function k(t){if(t instanceof IDBRequest)return function(t){const e=new Promise((e,s)=>{const n=()=>{t.removeEventListener("success",r),t.removeEventListener("error",i)},r=()=>{e(k(t.result)),n()},i=()=>{s(t.error),n()};t.addEventListener("success",r),t.addEventListener("error",i)});return e.then(e=>{e instanceof IDBCursor&&x.set(e,t)}).catch(()=>{}),E.set(e,t),e}(t);if(C.has(t))return C.get(t);const e=T(t);return e!==t&&(C.set(t,e),E.set(e,t)),e}const B=t=>E.get(t);const P=["get","getKey","getAll","getAllKeys","count"],M=["put","add","delete","clear"],W=new Map;function j(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(W.get(e))return W.get(e);const s=e.replace(/FromIndex$/,""),n=e!==s,r=M.includes(s);if(!(s in(n?IDBIndex:IDBObjectStore).prototype)||!r&&!P.includes(s))return;const i=async function(t,...e){const i=this.transaction(t,r?"readwrite":"readonly");let a=i.store;return n&&(a=a.index(e.shift())),(await Promise.all([a[s](...e),r&&i.done]))[0]};return W.set(e,i),i}N=(t=>q({},t,{get:(e,s,n)=>j(e,s)||t.get(e,s,n),has:(e,s)=>!!j(e,s)||t.has(e,s)}))(N);try{self["workbox:expiration:7.0.0"]&&_()}catch(t){}const S="cache-entries",K=t=>{const e=new URL(t,location.href);return e.hash="",e.href};class A{constructor(t){this._=null,this.L=t}I(t){const e=t.createObjectStore(S,{keyPath:"id"});e.createIndex("cacheName","cacheName",{unique:!1}),e.createIndex("timestamp","timestamp",{unique:!1})}C(t){this.I(t),this.L&&function(t,{blocked:e}={}){const s=indexedDB.deleteDatabase(t);e&&s.addEventListener("blocked",t=>e(t.oldVersion,t)),k(s).then(()=>{})}(this.L)}async setTimestamp(t,e){const s={url:t=K(t),timestamp:e,cacheName:this.L,id:this.N(t)},n=(await this.getDb()).transaction(S,"readwrite",{durability:"relaxed"});await n.store.put(s),await n.done}async getTimestamp(t){const e=await this.getDb(),s=await e.get(S,this.N(t));return null==s?void 0:s.timestamp}async expireEntries(t,e){const s=await this.getDb();let n=await s.transaction(S).store.index("timestamp").openCursor(null,"prev");const r=[];let i=0;for(;n;){const s=n.value;s.cacheName===this.L&&(t&&s.timestamp<t||e&&i>=e?r.push(n.value):i++),n=await n.continue()}const a=[];for(const t of r)await s.delete(S,t.id),a.push(t.url);return a}N(t){return this.L+"|"+K(t)}async getDb(){return this._||(this._=await function(t,e,{blocked:s,upgrade:n,blocking:r,terminated:i}={}){const a=indexedDB.open(t,e),o=k(a);return n&&a.addEventListener("upgradeneeded",t=>{n(k(a.result),t.oldVersion,t.newVersion,k(a.transaction),t)}),s&&a.addEventListener("blocked",t=>s(t.oldVersion,t.newVersion,t)),o.then(t=>{i&&t.addEventListener("close",()=>i()),r&&t.addEventListener("versionchange",t=>r(t.oldVersion,t.newVersion,t))}).catch(()=>{}),o}("workbox-expiration",1,{upgrade:this.C.bind(this)})),this._}}class F{constructor(t,e={}){this.O=!1,this.T=!1,this.k=e.maxEntries,this.B=e.maxAgeSeconds,this.P=e.matchOptions,this.L=t,this.M=new A(t)}async expireEntries(){if(this.O)return void(this.T=!0);this.O=!0;const t=this.B?Date.now()-1e3*this.B:0,e=await this.M.expireEntries(t,this.k),s=await self.caches.open(this.L);for(const t of e)await s.delete(t,this.P);this.O=!1,this.T&&(this.T=!1,b(this.expireEntries()))}async updateTimestamp(t){await this.M.setTimestamp(t,Date.now())}async isURLExpired(t){if(this.B){const e=await this.M.getTimestamp(t),s=Date.now()-1e3*this.B;return void 0===e||e<s}return!1}async delete(){this.T=!1,await this.M.expireEntries(1/0)}}try{self["workbox:range-requests:7.0.0"]&&_()}catch(t){}async function H(t,e){try{if(206===e.status)return e;const n=t.headers.get("range");if(!n)throw new s("no-range-header");const r=function(t){const e=t.trim().toLowerCase();if(!e.startsWith("bytes="))throw new s("unit-must-be-bytes",{normalizedRangeHeader:e});if(e.includes(","))throw new s("single-range-only",{normalizedRangeHeader:e});const n=/(\d*)-(\d*)/.exec(e);if(!n||!n[1]&&!n[2])throw new s("invalid-range-values",{normalizedRangeHeader:e});return{start:""===n[1]?void 0:Number(n[1]),end:""===n[2]?void 0:Number(n[2])}}(n),i=await e.blob(),a=function(t,e,n){const r=t.size;if(n&&n>r||e&&e<0)throw new s("range-not-satisfiable",{size:r,end:n,start:e});let i,a;return void 0!==e&&void 0!==n?(i=e,a=n+1):void 0!==e&&void 0===n?(i=e,a=r):void 0!==n&&void 0===e&&(i=r-n,a=r),{start:i,end:a}}(i,r.start,r.end),o=i.slice(a.start,a.end),c=o.size,h=new Response(o,{status:206,statusText:"Partial Content",headers:e.headers});return h.headers.set("Content-Length",String(c)),h.headers.set("Content-Range",`bytes ${a.start}-${a.end-1}/${i.size}`),h}catch(t){return new Response("",{status:416,statusText:"Range Not Satisfiable"})}}function $(t,e){const s=e();return t.waitUntil(s),s}try{self["workbox:precaching:7.0.0"]&&_()}catch(t){}function z(t){if(!t)throw new s("add-to-cache-list-unexpected-type",{entry:t});if("string"==typeof t){const e=new URL(t,location.href);return{cacheKey:e.href,url:e.href}}const{revision:e,url:n}=t;if(!n)throw new s("add-to-cache-list-unexpected-type",{entry:t});if(!e){const t=new URL(n,location.href);return{cacheKey:t.href,url:t.href}}const r=new URL(n,location.href),i=new URL(n,location.href);return r.searchParams.set("__WB_REVISION__",e),{cacheKey:r.href,url:i.href}}class G{constructor(){this.updatedURLs=[],this.notUpdatedURLs=[],this.handlerWillStart=async({request:t,state:e})=>{e&&(e.originalRequest=t)},this.cachedResponseWillBeUsed=async({event:t,state:e,cachedResponse:s})=>{if("install"===t.type&&e&&e.originalRequest&&e.originalRequest instanceof Request){const t=e.originalRequest.url;s?this.notUpdatedURLs.push(t):this.updatedURLs.push(t)}return s}}}class V{constructor({precacheController:t}){this.cacheKeyWillBeUsed=async({request:t,params:e})=>{const s=(null==e?void 0:e.cacheKey)||this.W.getCacheKeyForURL(t.url);return s?new Request(s,{headers:t.headers}):t},this.W=t}}let J,Q;async function X(t,e){let n=null;if(t.url){n=new URL(t.url).origin}if(n!==self.location.origin)throw new s("cross-origin-copy-response",{origin:n});const r=t.clone(),i={headers:new Headers(r.headers),status:r.status,statusText:r.statusText},a=e?e(i):i,o=function(){if(void 0===J){const t=new Response("");if("body"in t)try{new Response(t.body),J=!0}catch(t){J=!1}J=!1}return J}()?r.body:await r.blob();return new Response(o,a)}class Y extends R{constructor(t={}){t.cacheName=w(t.cacheName),super(t),this.j=!1!==t.fallbackToNetwork,this.plugins.push(Y.copyRedirectedCacheableResponsesPlugin)}async U(t,e){const s=await e.cacheMatch(t);return s||(e.event&&"install"===e.event.type?await this.S(t,e):await this.K(t,e))}async K(t,e){let n;const r=e.params||{};if(!this.j)throw new s("missing-precache-entry",{cacheName:this.cacheName,url:t.url});{const s=r.integrity,i=t.integrity,a=!i||i===s;n=await e.fetch(new Request(t,{integrity:"no-cors"!==t.mode?i||s:void 0})),s&&a&&"no-cors"!==t.mode&&(this.A(),await e.cachePut(t,n.clone()))}return n}async S(t,e){this.A();const n=await e.fetch(t);if(!await e.cachePut(t,n.clone()))throw new s("bad-precaching-response",{url:t.url,status:n.status});return n}A(){let t=null,e=0;for(const[s,n]of this.plugins.entries())n!==Y.copyRedirectedCacheableResponsesPlugin&&(n===Y.defaultPrecacheCacheabilityPlugin&&(t=s),n.cacheWillUpdate&&e++);0===e?this.plugins.push(Y.defaultPrecacheCacheabilityPlugin):e>1&&null!==t&&this.plugins.splice(t,1)}}Y.defaultPrecacheCacheabilityPlugin={cacheWillUpdate:async({response:t})=>!t||t.status>=400?null:t},Y.copyRedirectedCacheableResponsesPlugin={cacheWillUpdate:async({response:t})=>t.redirected?await X(t):t};class Z{constructor({cacheName:t,plugins:e=[],fallbackToNetwork:s=!0}={}){this.F=new Map,this.H=new Map,this.$=new Map,this.u=new Y({cacheName:w(t),plugins:[...e,new V({precacheController:this})],fallbackToNetwork:s}),this.install=this.install.bind(this),this.activate=this.activate.bind(this)}get strategy(){return this.u}precache(t){this.addToCacheList(t),this.G||(self.addEventListener("install",this.install),self.addEventListener("activate",this.activate),this.G=!0)}addToCacheList(t){const e=[];for(const n of t){"string"==typeof n?e.push(n):n&&void 0===n.revision&&e.push(n.url);const{cacheKey:t,url:r}=z(n),i="string"!=typeof n&&n.revision?"reload":"default";if(this.F.has(r)&&this.F.get(r)!==t)throw new s("add-to-cache-list-conflicting-entries",{firstEntry:this.F.get(r),secondEntry:t});if("string"!=typeof n&&n.integrity){if(this.$.has(t)&&this.$.get(t)!==n.integrity)throw new s("add-to-cache-list-conflicting-integrities",{url:r});this.$.set(t,n.integrity)}if(this.F.set(r,t),this.H.set(r,i),e.length>0){const t=`Workbox is precaching URLs without revision info: ${e.join(", ")}\nThis is generally NOT safe. Learn more at https://bit.ly/wb-precache`;console.warn(t)}}}install(t){return $(t,async()=>{const e=new G;this.strategy.plugins.push(e);for(const[e,s]of this.F){const n=this.$.get(s),r=this.H.get(e),i=new Request(e,{integrity:n,cache:r,credentials:"same-origin"});await Promise.all(this.strategy.handleAll({params:{cacheKey:s},request:i,event:t}))}const{updatedURLs:s,notUpdatedURLs:n}=e;return{updatedURLs:s,notUpdatedURLs:n}})}activate(t){return $(t,async()=>{const t=await self.caches.open(this.strategy.cacheName),e=await t.keys(),s=new Set(this.F.values()),n=[];for(const r of e)s.has(r.url)||(await t.delete(r),n.push(r.url));return{deletedURLs:n}})}getURLsToCacheKeys(){return this.F}getCachedURLs(){return[...this.F.keys()]}getCacheKeyForURL(t){const e=new URL(t,location.href);return this.F.get(e.href)}getIntegrityForCacheKey(t){return this.$.get(t)}async matchPrecache(t){const e=t instanceof Request?t.url:t,s=this.getCacheKeyForURL(e);if(s){return(await self.caches.open(this.strategy.cacheName)).match(s)}}createHandlerBoundToURL(t){const e=this.getCacheKeyForURL(t);if(!e)throw new s("non-precached-url",{url:t});return s=>(s.request=new Request(t),s.params=Object.assign({cacheKey:e},s.params),this.strategy.handle(s))}}const tt=()=>(Q||(Q=new Z),Q);class et extends r{constructor(t,e){super(({request:s})=>{const n=t.getURLsToCacheKeys();for(const r of function*(t,{ignoreURLParametersMatching:e=[/^utm_/,/^fbclid$/],directoryIndex:s="index.html",cleanURLs:n=!0,urlManipulation:r}={}){const i=new URL(t,location.href);i.hash="",yield i.href;const a=function(t,e=[]){for(const s of[...t.searchParams.keys()])e.some(t=>t.test(s))&&t.searchParams.delete(s);return t}(i,e);if(yield a.href,s&&a.pathname.endsWith("/")){const t=new URL(a.href);t.pathname+=s,yield t.href}if(n){const t=new URL(a.href);t.pathname+=".html",yield t.href}if(r){const t=r({url:i});for(const e of t)yield e.href}}(s.url,e)){const e=n.get(r);if(e){return{cacheKey:e,integrity:t.getIntegrityForCacheKey(e)}}}},t.strategy)}}t.CacheFirst=class extends R{async U(t,e){let n,r=await e.cacheMatch(t);if(!r)try{r=await e.fetchAndCachePut(t)}catch(t){t instanceof Error&&(n=t)}if(!r)throw new s("no-response",{url:t.url,error:n});return r}},t.ExpirationPlugin=class{constructor(t={}){this.cachedResponseWillBeUsed=async({event:t,request:e,cacheName:s,cachedResponse:n})=>{if(!n)return null;const r=this.V(n),i=this.J(s);b(i.expireEntries());const a=i.updateTimestamp(e.url);if(t)try{t.waitUntil(a)}catch(t){}return r?n:null},this.cacheDidUpdate=async({cacheName:t,request:e})=>{const s=this.J(t);await s.updateTimestamp(e.url),await s.expireEntries()},this.X=t,this.B=t.maxAgeSeconds,this.Y=new Map,t.purgeOnQuotaError&&function(t){g.add(t)}(()=>this.deleteCacheAndMetadata())}J(t){if(t===d())throw new s("expire-custom-caches-only");let e=this.Y.get(t);return e||(e=new F(t,this.X),this.Y.set(t,e)),e}V(t){if(!this.B)return!0;const e=this.Z(t);if(null===e)return!0;return e>=Date.now()-1e3*this.B}Z(t){if(!t.headers.has("date"))return null;const e=t.headers.get("date"),s=new Date(e).getTime();return isNaN(s)?null:s}async deleteCacheAndMetadata(){for(const[t,e]of this.Y)await self.caches.delete(t),await e.delete();this.Y=new Map}},t.NetworkFirst=class extends R{constructor(t={}){super(t),this.plugins.some(t=>"cacheWillUpdate"in t)||this.plugins.unshift(u),this.tt=t.networkTimeoutSeconds||0}async U(t,e){const n=[],r=[];let i;if(this.tt){const{id:s,promise:a}=this.et({request:t,logs:n,handler:e});i=s,r.push(a)}const a=this.st({timeoutId:i,request:t,logs:n,handler:e});r.push(a);const o=await e.waitUntil((async()=>await e.waitUntil(Promise.race(r))||await a)());if(!o)throw new s("no-response",{url:t.url});return o}et({request:t,logs:e,handler:s}){let n;return{promise:new Promise(e=>{n=setTimeout(async()=>{e(await s.cacheMatch(t))},1e3*this.tt)}),id:n}}async st({timeoutId:t,request:e,logs:s,handler:n}){let r,i;try{i=await n.fetchAndCachePut(e)}catch(t){t instanceof Error&&(r=t)}return t&&clearTimeout(t),!r&&i||(i=await n.cacheMatch(e)),i}},t.RangeRequestsPlugin=class{constructor(){this.cachedResponseWillBeUsed=async({request:t,cachedResponse:e})=>e&&t.headers.has("range")?await H(t,e):e}},t.StaleWhileRevalidate=class extends R{constructor(t={}){super(t),this.plugins.some(t=>"cacheWillUpdate"in t)||this.plugins.unshift(u)}async U(t,e){const n=e.fetchAndCachePut(t).catch(()=>{});e.waitUntil(n);let r,i=await e.cacheMatch(t);if(i);else try{i=await n}catch(t){t instanceof Error&&(r=t)}if(!i)throw new s("no-response",{url:t.url,error:r});return i}},t.cleanupOutdatedCaches=function(){self.addEventListener("activate",t=>{const e=w();t.waitUntil((async(t,e="-precache-")=>{const s=(await self.caches.keys()).filter(s=>s.includes(e)&&s.includes(self.registration.scope)&&s!==t);return await Promise.all(s.map(t=>self.caches.delete(t))),s})(e).then(t=>{}))})},t.clientsClaim=function(){self.addEventListener("activate",()=>self.clients.claim())},t.precacheAndRoute=function(t,e){!function(t){tt().precache(t)}(t),function(t){const e=tt();h(new et(e,t))}(e)},t.registerRoute=h});

================
File: src/app/(dashboard)/compromissos/page.tsx
================
'use client';

import React, { useMemo } from 'react';
import { useAuth } from '@/contexts/AuthContext';
import { useIdoso } from '@/contexts/IdosoContext';
import { useCrudOperations } from '@/hooks/useCrudOperations';
import { Modal } from '@/components/Modal';
import { AddEditCompromissoForm, type Compromisso } from '@/components/modals/AddEditCompromissoModal';
import { toast } from '@/components/Toast';
import styles from '../rotinas/page.module.css';

export default function CompromissosPage() {
  const { user } = useAuth();
  const { idosoSelecionadoId, listaIdososVinculados } = useIdoso();
  const isFamiliar = user?.user_metadata?.account_type === 'familiar';
  const targetUserId = isFamiliar ? idosoSelecionadoId : user?.id;

  const selectedElderName = useMemo(() => (
    listaIdososVinculados.find((i) => i.id === idosoSelecionadoId)?.nome || null
  ), [listaIdososVinculados, idosoSelecionadoId]);

  type CompItem = Required<Compromisso> & { id: string };

  const endpoint = targetUserId ? `/api/compromissos?user_id=${encodeURIComponent(targetUserId)}` : '/api/compromissos';

  const onSuccess = React.useMemo(() => ({
    create: () => toast.success('Compromisso criado com sucesso'),
    update: () => toast.success('Compromisso atualizado com sucesso'),
    delete: () => toast.success('Compromisso excluído com sucesso'),
  }), []);

  const onError = React.useMemo(() => ({
    read: (m: string) => toast.error(m),
    create: (m: string) => toast.error(m),
    update: (m: string) => toast.error(m),
    delete: (m: string) => toast.error(m),
  }), []);

  const crudConfig = React.useMemo(() => ({
    endpoint,
    onSuccess,
    onError,
  }), [endpoint, onSuccess, onError]);

  const {
    items,
    loading,
    error,
    addModal,
    editModal,
    createItem,
    updateItem,
    deleteItem,
    editItem,
    fetchItems,
    setItems,
  } = useCrudOperations<CompItem>(crudConfig);

  React.useEffect(() => {
    // Evita chamadas desnecessárias em loop: apenas limpa a lista se familiar sem idoso selecionado.
    if (isFamiliar && !targetUserId) {
      setItems([] as any);
    }
    // Quando targetUserId existir, o hook interno chamará fetch ao mudar o endpoint.
  }, [isFamiliar, targetUserId, setItems]);

  const handleCreate = async (data: Compromisso) => {
    if (isFamiliar && !targetUserId) {
      toast.info('Selecione um idoso no menu superior antes de adicionar compromissos.');
      return;
    }
    const payload: any = {
      ...data,
      ...(targetUserId ? { user_id: targetUserId } : {}),
      // normalizar datetime-local para ISO se vier em formato local
    };
    if (payload.data_hora && !/Z$/.test(payload.data_hora)) {
      const asDate = new Date(payload.data_hora);
      if (!isNaN(asDate.getTime())) payload.data_hora = asDate.toISOString();
    }
    await createItem(payload as any);
  };

  const handleUpdate = async (data: Compromisso) => {
    if (!editModal.item) return;
    const payload: any = { ...data };
    if (payload.data_hora && !/Z$/.test(payload.data_hora)) {
      const asDate = new Date(payload.data_hora);
      if (!isNaN(asDate.getTime())) payload.data_hora = asDate.toISOString();
    }
    await updateItem(editModal.item.id, payload);
  };

  const renderList = () => {
    if (isFamiliar && !targetUserId) {
      return (
        <div className={styles.emptyState}>
          <p>Selecione um idoso no menu superior para visualizar os compromissos.</p>
        </div>
      );
    }
    if (loading) return <p className={styles.loadingText}>Carregando...</p>;
    if (error) return <p className={styles.errorText}>Erro: {error}</p>;
    if (!items?.length) {
      return (
        <div className={styles.emptyState}>
          <p>Nenhum compromisso encontrado.</p>
          <p>Clique em "Adicionar Compromisso" acima para começar.</p>
        </div>
      );
    }

    return (
      <div className={styles.gridContainer}>
        {items
          .slice()
          .sort((a, b) => (a.data_hora ? new Date(a.data_hora).getTime() : 0) - (b.data_hora ? new Date(b.data_hora).getTime() : 0))
          .map((c) => (
            <div key={c.id} style={{ border: '1px solid #e5e7eb', borderRadius: 12, padding: 14, background: 'white' }}>
              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                <h3 style={{ margin: 0, fontSize: 18, color: 'black', }}>{c.titulo}</h3>
                <div style={{ display: 'flex', gap: 8 }}>
                  <button onClick={() => editItem(c)} style={{ padding: '6px 10px', borderRadius: 8, border: '1px solid #e5e7eb', background: '#f3f4f6', color: 'black' }}>Editar</button>
                  <button onClick={() => deleteItem(c.id)} style={{ padding: '6px 10px', borderRadius: 8, border: '1px solid #fecaca', background: '#fef2f2', color: '#b91c1c' }}>Excluir</button>
                </div>
              </div>
              <div style={{ marginTop: 8, color: '#6b7280', fontSize: 14 }}>
                <div><strong>Tipo:</strong> {c.tipo || 'outros'}</div>
                {c.data_hora && <div><strong>Data/Hora:</strong> {new Date(c.data_hora).toLocaleString()}</div>}
                {c.local && <div><strong>Local:</strong> {c.local}</div>}
                {c.descricao && <div style={{ marginTop: 6 }}>{c.descricao}</div>}
              </div>
            </div>
          ))}
      </div>
    );
  };

  return (
    <main className={styles.main}>
      <div className={styles.content}>
        <div className={styles.pageHeader}>
          <h1 className={styles.content_title}>{selectedElderName ? `Compromissos de ${selectedElderName}` : 'Compromissos'}</h1>
        </div>

        {!loading && !error && !(isFamiliar && !targetUserId) && (
          <div className={styles.actionsContainer}>
            <button className={styles.addButton} onClick={() => addModal.open()}>
              <span className={styles.addIcon}>+</span>
              Adicionar Compromisso
            </button>
          </div>
        )}

        <section className={styles.content_info}>{renderList()}</section>
      </div>

      <Modal isOpen={addModal.isOpen} onClose={addModal.close} title="Adicionar compromisso">
        <AddEditCompromissoForm onSave={handleCreate} onCancel={addModal.close} />
      </Modal>

      <Modal isOpen={editModal.isOpen} onClose={editModal.close} title="Editar compromisso">
        {editModal.item && (
          <AddEditCompromissoForm
            onSave={handleUpdate}
            onCancel={editModal.close}
            compromisso={{
              id: editModal.item.id,
              titulo: editModal.item.titulo,
              descricao: editModal.item.descricao ?? '',
              data_hora: editModal.item.data_hora ?? '',
              local: editModal.item.local ?? '',
              tipo: (editModal.item.tipo as any) || 'consulta',
              lembrete_minutos: editModal.item.lembrete_minutos ?? 60,
            }}
          />
        )}
      </Modal>
    </main>
  );
}

================
File: src/app/(dashboard)/configuracoes/page.tsx
================
'use client';

export default function Configuracoes() {
  return (
    <div style={{ padding: 20 }}>
      <h1 style={{ fontWeight: 800, fontSize: 18, marginBottom: 12 }}>Configurações</h1>
      <div style={{
        background: '#ffffff',
        border: '1px solid rgba(0,0,0,0.06)',
        borderRadius: 12,
        padding: 16
      }}>
        <p style={{ margin: 0, color: '#475569' }}>
          Em breve você poderá personalizar preferências da sua conta aqui.
        </p>
      </div>
    </div>
  );
}

================
File: src/app/(dashboard)/dashboard/page.module.css
================
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');

.dashboardContainer {
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  background-color: transparent;
  font-family: "Poppins", sans-serif;
  position: relative;
  overflow-x: hidden;
}

/* ondas globais são renderizadas via layout; nenhuma sobreposição adicional aqui */

.loadingContainer {
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  background-color: transparent;
}

.content {
  flex: 1;
  max-width: 1200px;
  width: 100%;
  margin: 0 auto;
  padding: 0 20px;
  position: relative;
  z-index: 10;
}

.content_title {
  font-family: "Poppins", sans-serif;
  font-size: 48px;
  font-weight: 700;
  color: #0400BA;
  text-align: left;
  margin-top: 40px;
  margin-bottom: 40px;
  position: relative;
}

.content_title::after {
  content: "";
  position: absolute;
  bottom: -8px;
  left: 0;
  width: 100px;
  height: 4px;
  background-color: #0400BA;
  border-radius: 2px;
}

.headerContainer {
  position: sticky;
  top: 0;
  z-index: 950;
  width: 100%;
  transition: margin-left 0.3s ease-in-out, width 0.3s ease-in-out;
}

.headerPushed {
  margin-left: 280px;
  width: calc(100% - 280px);
}

.mainContent {
  transition: margin-left 0.3s ease-in-out;
  padding: 24px;
  width: 100%;
  position: relative;
  z-index: 10;
}

.contentPushed {
  margin-left: 280px; 
}

/* Responsive design */
@media (max-width: 768px) {
  .headerContainer {
    padding: 15px;
    border-radius: 0 0 20px 20px;
  }
  
  .content_title {
    font-size: 2rem;
  }
  
  .content {
    padding: 0 15px;
  }
}

@media (max-width: 480px) {
  .content_title {
    font-size: 1.75rem;
  }
  
  .content {
    padding: 0 15px;
  }
}

================
File: src/app/(dashboard)/dashboard/page.tsx
================
'use client';

import { useEffect } from 'react';
import { useAuth } from '@/contexts/AuthContext';
import { useRouter } from 'next/navigation';
import { FullScreenLoader } from '@/components/FullScreenLoader';
import DashboardClient from '@/components/DashboardClient';

export default function Dashboard() {
  const { user, loading } = useAuth(); 
  const router = useRouter();

  useEffect(() => {
    if (!loading && !user) {
      router.push('/auth');
    }
  }, [user, loading, router]); 

  if (loading) {
    return <FullScreenLoader />;
  }

  if (user) {
    return <DashboardClient />;
  }

  return null;
}

================
File: src/app/(dashboard)/familia/page.tsx
================
'use client'

import pageStyles from '@/app/(dashboard)/perfil/page.module.css';
import modalStyles from '@/app/(dashboard)/perfil/modal.module.css';
import { useAuth } from '@/contexts/AuthContext';
import { useRouter } from 'next/navigation';
import { useState, useRef } from 'react';
import GerenciarIdososVinculados, { GerenciarIdososVinculadosRef } from '@/components/perfil/GerenciarIdososVinculados';
import AddIdosoModal from '@/components/modals/AddIdosoModal';
import { ToastContainer } from '@/components/Toast';

export default function FamiliaPage() {
  const { user } = useAuth();
  const router = useRouter();
  const [showAddIdosoModal, setShowAddIdosoModal] = useState(false);
  const idososRef = useRef<GerenciarIdososVinculadosRef>(null);

  if (!user) {
    return (
      <main className={pageStyles.main}>
        <div className={pageStyles.mainContent}>
          <div className={pageStyles.content}>
            <p>Você precisa estar autenticado.</p>
          </div>
        </div>
      </main>
    );
  }

  const isFamiliar = user?.user_metadata?.account_type === 'familiar';
  if (!isFamiliar) {
    return (
      <main className={pageStyles.main}>
        <div className={pageStyles.mainContent}>
          <div className={pageStyles.content}>
            <p>Esta página é exclusiva para usuários do tipo Familiar.</p>
          </div>
        </div>
      </main>
    );
  }

  return (
    <main className={pageStyles.main}>
      <div className={pageStyles.mainContent}>
        <div className={pageStyles.content}>
          <ToastContainer />
          <div className={pageStyles.pageHeader}>
            <h1 className={pageStyles.content_title}>Família</h1>
          </div>

          <div style={{ display: 'flex', gap: 12, marginBottom: 16 }}>
            <button 
              className={pageStyles.actionButton}
              onClick={() => setShowAddIdosoModal(true)}
            >
              Adicionar Idoso
            </button>
            <button 
              className={pageStyles.actionButton}
              onClick={() => idososRef.current?.refresh()}
            >
              Atualizar Lista
            </button>
            <button 
              className={pageStyles.actionButton}
              onClick={() => router.push('/perfil')}
            >
              Voltar para Perfil
            </button>
          </div>

          <section className={pageStyles.content_info}>
            <div className={pageStyles.profileSection}>
              <GerenciarIdososVinculados ref={idososRef} />

              <AddIdosoModal
                isOpen={showAddIdosoModal}
                onClose={() => setShowAddIdosoModal(false)}
                onSuccess={() => {
                  idososRef.current?.refresh();
                }}
              />
            </div>
          </section>
        </div>
      </div>
    </main>
  );
}

================
File: src/app/(dashboard)/familiar-dashboard/page.tsx
================
'use client';

import { useEffect } from 'react';
import { useRouter } from 'next/navigation';
import { useAuth } from '@/contexts/AuthContext';
import { useProfile } from '@/contexts/ProfileContext';
import { useIdoso } from '@/contexts/IdosoContext';
import { FullScreenLoader } from '@/components/FullScreenLoader';
import DashboardClient from '@/components/DashboardClient';

export default function FamiliarDashboardPage() {
  const { user, loading } = useAuth();
  const { profile } = useProfile();
  const { idosoSelecionadoId, listaIdososVinculados, loading: idososLoading } = useIdoso();
  const router = useRouter();

  useEffect(() => {
    if (!loading && !user) {
      router.push('/auth');
    }
  }, [loading, user, router]);

  if (loading || idososLoading) {
    return <FullScreenLoader />;
  }

  if (!user) return null;

  const tipo = (profile?.tipo || user.user_metadata?.account_type) as string | undefined;
  const isFamiliar = (tipo || '').toLowerCase() === 'familiar';

  if (!isFamiliar) {
    return (
      <main style={{ padding: 24 }}>
        <h2>Esta página é exclusiva para usuários do tipo Familiar.</h2>
      </main>
    );
  }

  if (!listaIdososVinculados.length) {
    return (
      <main style={{ padding: 24 }}>
        <h2>Nenhum idoso vinculado.</h2>
        <p>Adicione um idoso na página de Perfil &gt; Família.</p>
      </main>
    );
  }

  if (!idosoSelecionadoId) {
    return (
      <main style={{ padding: 24 }}>
        <h2>Nenhum idoso selecionado.</h2>
        <p>Selecione um idoso no seletor no topo para visualizar o dashboard.</p>
      </main>
    );
  }

  return (
    <DashboardClient readOnly idosoId={idosoSelecionadoId} />
  );
}

================
File: src/app/(dashboard)/integracoes/page.module.css
================
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');

.main {
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  background-color: transparent;
  font-family: "Poppins", sans-serif;
}

.content {
  flex: 1;
  max-width: 1200px;
  width: 100%;
  margin: 0 auto;
  padding: 0 20px;
}

.content_title {
  font-size: 40px;
  font-weight: 700;
  color: #0400BA;
  text-align: left;
  margin-top: 40px;
  margin-bottom: 16px;
  position: relative;
}

.content_title::after {
  content: "";
  position: absolute;
  bottom: -8px;
  left: 0;
  width: 100px;
  height: 4px;
  background-color: #0400BA;
  border-radius: 2px;
}

.subtitle {
  color: #1f2937; /* gray-800 */
  font-size: 1.125rem; /* text-lg */
  margin-top: 24px;
}

.content_info {
  border-radius: 20px;
  margin-top: 2rem;
  padding: 1.5rem;
}

.grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 1.5rem;
}

@media (min-width: 768px) {
  .grid { grid-template-columns: repeat(2, 1fr); }
}

@media (min-width: 1024px) {
  .grid { grid-template-columns: repeat(3, 1fr); }
}

.card {
  border: 1px solid #e5e7eb; /* gray-200 */
  background: rgba(255, 255, 255, 0.95); /* semi-transparent to show waves behind */
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 1px 2px rgba(0,0,0,0.04);
}

.cardHeader {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 1.25rem 1.5rem;
  background: #f8fafc;
  color: #1e293b;
  position: relative;
  z-index: 1;
  border-top-left-radius: 12px;
  border-top-right-radius: 12px;
  border-bottom: 1px solid #e2e8f0;
}

.headerRight {
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.cardTitle {
  font-size: 1.1rem;
  line-height: 1.4;
  font-weight: 600;
  color: #1e293b;
  letter-spacing: 0.01em;
  margin: 0;
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.alexaLogo {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 40px;
  height: 40px;
  border-radius: 8px;
  background: white;
  padding: 6px;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.alexaLogo img {
  filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.1));
  object-fit: contain;
}

.alexaLogo:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.alexaLogo:active {
  transform: translateY(0);
}

.cardContent {
  padding: 1.5rem;
  display: flex;
  flex-direction: column;
  gap: 1.25rem;
  flex: 1;
  background: linear-gradient(180deg, #ffffff 0%, #f8fafc 100%);
}

.cardDescription {
  color: #4b5563;
  font-size: 0.95rem;
  line-height: 1.6;
  margin: 0.5rem 0;
}

.cardDisabled {
  background: #f9fafb;
  opacity: 0.6;
}

/* Button primary consistent with Caremind brand */
.primaryButton {
  background-color: #0400BA !important;
  color: #ffffff !important;
  border-radius: 9999px !important; /* pill */
  height: 44px;
  padding: 0 18px;
  font-weight: 600;
  box-shadow: 0 6px 20px rgba(4, 0, 186, 0.25);
  border: none;
  cursor: pointer;
}
.primaryButton:hover {
  background-color: rgba(4, 0, 186, 0.9) !important;
  box-shadow: 0 8px 24px rgba(4, 0, 186, 0.28);
}
.primaryButton:active {
  transform: translateY(0.5px);
  box-shadow: 0 4px 16px rgba(4, 0, 186, 0.22);
}
.primaryButton:focus-visible {
  outline: none;
  box-shadow: 0 0 0 3px rgba(4, 0, 186, 0.3), 0 8px 24px rgba(4, 0, 186, 0.28);
}

/* Card visual polish */
.card {
  border: 1px solid #e5e7eb;
  background: white;
  border-radius: 16px;
  overflow: hidden;
  box-shadow: 0 4px 20px rgba(0,0,0,0.03);
  transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
  height: 100%;
  display: flex;
  flex-direction: column;
  position: relative;
  overflow: hidden;
}

.card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(90deg, #0400BA, #5A54F2);
  opacity: 0;
  transition: opacity 0.3s ease;
}

.card:hover {
  border-color: #e0e7ff;
  box-shadow: 0 8px 30px rgba(4, 0, 186, 0.1);
  transform: translateY(-2px);
}

.card:hover::before {
  opacity: 1;
}

/* Loading state */
.loadingState {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 2rem 1rem;
  text-align: center;
}

.loadingSpinner {
  width: 2.5rem;
  height: 2.5rem;
  border: 3px solid rgba(4, 0, 186, 0.1);
  border-radius: 50%;
  border-top-color: #0400BA;
  animation: spin 1s ease-in-out infinite;
  margin-bottom: 1rem;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.loadingText {
  color: #4b5563;
  font-size: 0.95rem;
  margin-top: 0.5rem;
}

/* Connected state */
.connectedState {
  display: flex;
  flex-direction: column;
  flex: 1;
}

.connectedBadge {
  display: inline-flex;
  align-items: center;
  background: linear-gradient(90deg, #f0fdf4 0%, #ecfdf5 100%);
  color: #047857;
  padding: 0.35rem 1rem;
  border-radius: 20px;
  font-size: 0.8rem;
  font-weight: 500;
  margin-bottom: 1rem;
  align-self: flex-start;
  border: 1px solid #d1fae5;
  box-shadow: 0 1px 2px rgba(0,0,0,0.02);
  backdrop-filter: blur(4px);
  -webkit-backdrop-filter: blur(4px);
}

.connectedBadge svg {
  margin-right: 0.5rem;
  width: 1rem;
  height: 1rem;
}

/* Disconnect button */
.disconnectButton {
  background-color: white !important;
  color: #ef4444 !important;
  border: 1px solid #fecaca !important;
  margin-top: auto;
  border-radius: 10px !important;
  font-weight: 500 !important;
  letter-spacing: 0.3px;
  transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1) !important;
  box-shadow: 0 1px 3px rgba(0,0,0,0.05);
  position: relative;
  overflow: hidden;
  padding: 0.7rem 1.25rem !important;
}

.disconnectButton::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(239, 68, 68, 0.05) 100%);
  opacity: 0;
  transition: opacity 0.3s ease;
}

.disconnectButton:hover {
  background-color: #fef2f2 !important;
  color: #dc2626 !important;
  border-color: #fca5a5 !important;
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(239, 68, 68, 0.1) !important;
}

.disconnectButton:hover::before {
  opacity: 1;
}

.disconnectButton:active {
  transform: translateY(0) !important;
  box-shadow: 0 2px 4px rgba(0,0,0,0.05) !important;
  background-color: #fee2e2 !important;
}

.disconnectButton:focus {
  box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.2) !important;
  outline: none;
}

/* Status icon in header */
.statusIcon {
  width: 1.75rem;
  height: 1.75rem;
  flex-shrink: 0;
  background: white;
  border-radius: 50%;
  padding: 4px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

/* Responsive adjustments */
@media (max-width: 640px) {
  .content_title {
    font-size: 2rem;
    margin-top: 2rem;
  }
  
  .card {
    margin-bottom: 1rem;
  }
}

/* Animation for status changes */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(5px); }
  to { opacity: 1; transform: translateY(0); }
}

.cardContent > * {
  animation: fadeIn 0.3s ease-out forwards;
}

================
File: src/app/(dashboard)/integracoes/page.tsx
================
"use client";

import { Button } from "@/components/ui/button";
import { Home, Loader2, Check } from "lucide-react";
import Image from "next/image";
import styles from "./page.module.css";
import { createBrowserClient } from '@supabase/ssr';
import { useState, useEffect } from 'react';
import { useSearchParams } from 'next/navigation';
import { toast } from '@/components/Toast';

export default function IntegracoesPage() {
  const supabase = createBrowserClient(process.env.NEXT_PUBLIC_SUPABASE_URL!, process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!);
  const [isCheckingStatus, setIsCheckingStatus] = useState(true);
  const [alexaIntegration, setAlexaIntegration] = useState<any>(null);
  const [isLoadingAlexa, setIsLoadingAlexa] = useState(false);
  const [status, setStatus] = useState<string | null>(null);
  const [message, setMessage] = useState<string | null>(null);
  const [isLoadingGoogle, setIsLoadingGoogle] = useState(false);
  
  // (Opcional) Você pode adicionar um estado para o Google se quiser mostrar "Conectado"
  // const [googleIntegration, setGoogleIntegration] = useState<any>(null);

  const searchParams = useSearchParams();

  const fetchIntegrationStatus = async () => {
    try {
      const { data, error } = await supabase
        .from('user_integrations')
        .select('*')
        .eq('provider', 'amazon_alexa')
        .single();

      if (error && error.code !== 'PGRST116') { // PGRST116 = no rows returned
        throw error;
      }

      if (data) {
        setAlexaIntegration(data);
      }
      // (Opcional) Aqui você também pode buscar o status do Google
      // const { data: googleData } = await supabase.from('user_integrations')...
    } catch (error) {
      console.error('Erro ao verificar status da integração:', error);
      toast.error('Não foi possível verificar o status da integração com a Alexa');
    } finally {
      setIsCheckingStatus(false);
    }
  };

  useEffect(() => {
    fetchIntegrationStatus();
  }, []);

  useEffect(() => {
    if (!searchParams) return;
    
    const urlStatus = searchParams.get('status');
    const urlMessage = searchParams.get('message');

    setStatus(urlStatus);
    setMessage(urlMessage);

    if (urlStatus === 'success') {
      toast.success('Integração com Alexa realizada com sucesso!');
      fetchIntegrationStatus();
    } else if (urlStatus === 'error') {
      toast.error(`Erro na integração com Alexa: ${urlMessage || 'Erro desconhecido'}`);
    }

    // Limpa os parâmetros da URL após processá-los
    window.history.replaceState(null, '', '/integracoes');
  }, [searchParams]);

  // NOVO useEffect para salvar o Token do Google
  useEffect(() => {
    // "Ouve" eventos de autenticação
    const { data: authListener } = supabase.auth.onAuthStateChange(
      async (event, session) => {
        
        // Checa se o usuário acabou de fazer login (SIGNED_IN)
        // E se foi um login com provedor que tem um refresh token
        if (event === 'SIGNED_IN' && session?.provider_refresh_token && session.user) {
          
          // Verifica se o provedor é Google
          const userProvider = session.user.app_metadata.provider;
  
          if (userProvider === 'google') {
            console.log('Detectado login com Google. Salvando tokens...');
            
            // Prepara os dados para salvar na sua tabela
            const integrationData = {
              user_id: session.user.id,
              provider: 'google', // Salva como 'google'
              access_token: session.access_token,
              refresh_token: session.provider_refresh_token,
              expires_at: new Date(Date.now() + (session.expires_in! * 1000)).toISOString(),
              status: 'connected', // Você pode usar o campo 'status'
            };
  
            // Salva ou atualiza (upsert) na sua tabela 'user_integrations'
            // Garanta que você tenha uma política RLS para 'insert' e 'update'
            // ou use uma 'edge function' para fazer isso com 'service_role'
            const { error } = await supabase
              .from('user_integrations')
              .upsert(integrationData, {
                onConflict: 'user_id, provider', // Evita duplicatas
              });
  
            if (error) {
              console.error('Erro ao salvar token do Google:', error);
              toast.error('Erro ao salvar integração com Google.');
            } else {
              console.log('Integração com Google salva com sucesso!');
              toast.success('Conectado com o Google Home!');
              // (Opcional) Chame o fetchIntegrationStatus() para atualizar a UI
              // fetchIntegrationStatus(); 
            }
          }
        }
      }
    );
  
    // Limpa o listener
    return () => {
	  authListener?.subscription.unsubscribe();
    };
  }, [supabase]); // Adiciona 'supabase' como dependência


  const handleConnectAlexa = async () => {
    setIsLoadingAlexa(true);
    try {
      const { data, error } = await supabase.functions.invoke('get-amazon-auth-url');

      if (error) throw new Error(typeof error === 'string' ? error : JSON.stringify(error));

      window.location.href = data.url;
    
    } catch (err) {
      console.error('Erro ao conectar com a Alexa:', err);
      toast.error(`Não foi possível iniciar a conexão com a Amazon. ${err instanceof Error ? err.message : String(err)}`);
      setIsLoadingAlexa(false);
    }
  };

  const handleDisconnectAlexa = async () => {
    if (!alexaIntegration?.id) return;
    
    setIsLoadingAlexa(true);
    try {
      const { error } = await supabase
        .from('user_integrations')
        .delete()
        .eq('id', alexaIntegration.id);

      if (error) throw error;

      toast.success('Integração removida com sucesso!');
      setAlexaIntegration(null);
    } catch (error) {
      console.error('Erro ao desconectar a Alexa:', error);
      toast.error('Não foi possível remover a integração com a Alexa');
    } finally {
      setIsLoadingAlexa(false);
    }
  };

  // FUNÇÃO ATUALIZADA
  const handleConnectGoogleHome = async () => {
    setIsLoadingGoogle(true);
    try {
      const { error } = await supabase.auth.signInWithOAuth({
        provider: 'google',
        options: {
          scopes: 'https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/calendar.events',
          queryParams: {
            access_type: 'offline', // para obter refresh_token
            prompt: 'consent',      // força o consentimento e emite refresh_token
          },
        },
      });

      if (error) throw error;
      // Redirecionamento será feito automaticamente pelo Supabase
    } catch (err) {
      console.error('Erro ao conectar Google:', err);
      toast.error('Não foi possível iniciar a conexão com o Google');
      setIsLoadingGoogle(false);
    }
  };

  return (
    <main className={styles.main}>
      <div className={styles.content}>
        <h1 className={styles.content_title}>Integrações</h1>
        <p className={styles.subtitle}>
          Conecte o Caremind a outros aplicativos e dispositivos para automatizar sua rotina de cuidado.
        </p>

        <section className={styles.content_info}>
          <div className={styles.grid}>
            {/* Card da Alexa (sem alterações) */}
            <div className={styles.card}>
              <div className={styles.cardHeader}>
                <h2 className={styles.cardTitle}>Amazon Alexa</h2>
                <div className={styles.headerRight}>
                  {isCheckingStatus ? (
                    <Loader2 className={`${styles.statusIcon} text-blue-500 animate-spin`} />
                  ) : alexaIntegration ? (
                    <div className={styles.alexaLogo}>
                      <Image 
                        src="/images/alexa-logo.png" 
                        alt="Alexa" 
                        width={32} 
                        height={32}
                        className="object-contain"
                      />
                    </div>
                  ) : (
                    <div className={styles.alexaLogo}>
                      <Image 
                        src="/images/alexa-logo.png" 
                        alt="Alexa" 
                        width={32} 
                        height={32}
                        className="object-contain"
                      />
                    </div>
                  )}
                </div>
              </div>
              <div className={styles.cardContent}>
                {isCheckingStatus ? (
                  <div className={styles.loadingState}>
                    <div className={styles.loadingSpinner} />
                    <p className={styles.loadingText}>Verificando status da integração...</p>
                  </div>
                ) : alexaIntegration ? (
                  <div className={styles.connectedState}>
                    <div className={styles.connectedBadge}>
                      <Check className="w-4 h-4 text-green-600" />
                      <span>Conectado</span>
                    </div>
                    <p className={styles.cardDescription}>
                      Sua conta está conectada. Receba lembretes de voz e confirmações no seu dispositivo Echo.
                    </p>
                    <Button 
                      size="lg" 
                      onClick={handleDisconnectAlexa} 
                      disabled={isLoadingAlexa} 
                      className={`${styles.disconnectButton} w-full mt-auto`}
                      variant="outline"
                    >
                      {isLoadingAlexa ? (
                        <>
                          <Loader2 className="mr-2 h-4 w-4 animate-spin" />
                          Desconectando...
                        </>
                      ) : 'Desconectar'}
                    </Button>
                  </div>
                ) : (
                  <>
                    <p className={styles.cardDescription}>
                      Conecte sua conta para receber lembretes de voz e confirmações de cuidados no seu dispositivo Echo.
                    </p>
                    <Button 
                      size="lg" 
                      onClick={handleConnectAlexa} 
                      disabled={isLoadingAlexa} 
                      className={`${styles.primaryButton} w-full mt-4`}
                    >
                      {isLoadingAlexa ? (
                        <>
                          <Loader2 className="mr-2 h-4 w-4 animate-spin" />
                          Conectando...
                        </>
                      ) : 'Conectar com Alexa'}
                    </Button>
                  </>
                )}
              </div>
            </div>

            {/* Card do Google Home (sem alterações visuais) */}
            <div className={styles.card}>
              <div className={styles.cardHeader}>
                <h2 className={styles.cardTitle}>Google Home</h2>
                <div className={styles.alexaLogo}>
                      <Image 
                        src="/images/google_home-logo.png" 
                        alt="Google" 
                        width={32} 
                        height={32}
                        className="object-contain"
                      />
                    </div>
              </div>
              <div className={styles.cardContent}>
                <p className={styles.cardDescription}>
                  Use comandos de voz com o Google Assistente para acompanhar medicamentos, rotinas e compromissos.
                </p>
                {/* (Opcional) Você pode adicionar uma lógica aqui para mostrar 
                  "Conectado" ou "Desconectar" se 'googleIntegration' estiver definido 
                */}
                <Button size="lg" onClick={handleConnectGoogleHome} disabled={isLoadingGoogle} className={`${styles.primaryButton} w-full`}>
                  {isLoadingGoogle ? (
                    <>
                      <Loader2 className="mr-2 h-4 w-4 animate-spin" />
                      Conectando...
                    </>
                  ) : 'Conectar'}
                </Button>
              </div>
            </div>
          </div>
        </section>
      </div>
    </main>
  );
}

================
File: src/app/(dashboard)/layout.tsx
================
"use client";
import { useEffect } from "react";
import { useRouter } from "next/navigation";
import AppLayout from "@/components/layout/AppLayout";
import { useAuth } from "@/contexts/AuthContext";
import { FullScreenLoader } from "@/components/FullScreenLoader";
import { IdosoProvider } from "@/contexts/IdosoContext";
import { useProfile } from "@/contexts/ProfileContext";
import { Waves } from "@/components/Waves";

export default function DashboardGroupLayout({ children }: { children: React.ReactNode }) {
  const { user, loading } = useAuth();
  const router = useRouter();
  const { profile } = useProfile();

  useEffect(() => {
    if (!loading && !user) {
      router.push("/auth");
    }
  }, [loading, user, router]);

  if (loading) {
    return <FullScreenLoader />;
  }

  if (!user) return null;

  const accountType = (profile?.tipo || user.user_metadata?.account_type)?.toLowerCase();
  // Sempre envolve com IdosoProvider para garantir que componentes que usam useIdoso tenham contexto,
  // mesmo quando a conta não for familiar (o provider já trata esse caso internamente).
  return (
    <IdosoProvider>
      <Waves />
      <AppLayout>{children}</AppLayout>
    </IdosoProvider>
  );
}

================
File: src/app/(dashboard)/perfil/modal.module.css
================
/* Fundo escuro atrás do modal */
.modalOverlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
}

/* Container do modal */
.modalContent {
  background-color: #fff;
  padding: 30px;
  border-radius: 12px;
  width: 90%;
  max-width: 480px;
  position: relative;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.25);
  animation: fadeIn 0.3s ease;
}

/* Título */
.modalTitle {
  font-size: 22px;
  font-weight: 600;
  margin-bottom: 20px;
  color: #222;
}

/* Botão fechar (X) */
.modalClose {
  position: absolute;
  top: 15px;
  right: 20px;
  font-size: 28px;
  font-weight: bold;
  cursor: pointer;
  color: #444;
  transition: color 0.2s;
}

.modalClose:hover {
  color: #000;
}

/* Mensagem de erro */
.errorMessage {
  background-color: #fee;
  color: #c33;
  padding: 10px 12px;
  border-radius: 6px;
  margin-bottom: 15px;
  border: 1px solid #fcc;
  font-size: 14px;
}

/* Inputs e labels */
.formGroup {
  margin-bottom: 18px;
}

.modalLabel {
  font-size: 14px;
  font-weight: 500;
  margin-bottom: 6px;
  display: block;
  color: #333;
}

.modalInput {
  width: 100%;
  padding: 12px 14px;
  border: 1px solid #ccc;
  border-radius: 8px;
  font-size: 15px;
  color: #222;
  background-color: #fafafa;
  transition: all 0.2s ease;
}

.modalInput:focus {
  border-color: #4a54c9;
  background-color: #fff;
  outline: none;
  box-shadow: 0 0 0 3px rgba(91, 101, 243, 0.2);
}

.modalInput:disabled {
  background-color: #eee;
  cursor: not-allowed;
}

/* Botões */
.modalActions {
  display: flex;
  justify-content: flex-end;
  gap: 12px;
  margin-top: 20px;
}

.cancelButton {
  background-color: transparent;
  border: 1px solid #ccc;
  color: #333;
  padding: 10px 20px;
  border-radius: 8px;
  font-size: 15px;
  cursor: pointer;
  transition: background-color 0.2s;
}

.cancelButton:hover {
  background-color: #f3f3f3;
}

.saveButton {
  background-color: #4a54c9;
  border: none;
  color: #fff;
  padding: 10px 22px;
  border-radius: 8px;
  font-size: 15px;
  font-weight: 600;
  cursor: pointer;
  transition: background-color 0.2s;
}

.saveButton:hover {
  background-color: #3a44b0;
}

.saveButton:disabled {
  background-color: #999;
  cursor: not-allowed;
}

/* Responsividade */
@media (max-width: 480px) {
  .modalContent {
    width: 95%;
    padding: 20px;
  }

  .modalTitle {
    font-size: 18px;
  }

  .modalInput {
    font-size: 14px;
    padding: 10px 12px;
  }

  .modalActions {
    flex-direction: column;
    gap: 10px;
  }

  .cancelButton,
  .saveButton {
    width: 100%;
  }
}

/* Animação de entrada */
@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

================
File: src/app/(dashboard)/perfil/page.module.css
================
.main {
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  font-family: "League Spartan", sans-serif;
}

.content {
  flex: 1;
  max-width: 1200px;
  width: 100%;
  margin: 0 auto;
  padding: 0 20px;
}

.content_title {
  font-size: 40px;
  font-weight: 700;
  color: #0400BA;
  text-align: left;
  margin-top: 40px;
  margin-bottom: 40px;
  position: relative;
}

.content_title::after {
  content: "";
  position: absolute;
  bottom: -8px;
  left: 0;
  width: 100px;
  height: 4px;
  background-color: #0400BA;
  border-radius: 2px;
}

.content_info {
  background-color: white;
  border-radius: 20px;
  margin-top: 2rem;
  padding: 1.5rem;
}

.mainContent {
  transition: margin-left 0.3s ease-in-out;
  padding: 24px;
  width: 100%;
}

.contentPushed {
  margin-left: 280px;
}

.pageHeader {
  margin-bottom: 1.5rem;
}

/* Responsive design to match other pages */
@media (max-width: 768px) {
  .content { padding: 0 15px; }
}

@media (max-width: 480px) {
  .content_title { font-size: 1.75rem; }
}

.pageContainer {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 30px;
}

.profileSection {
  width: 100%;
  max-width: 1000px;
}

.profileHeader {
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-radius: 16px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
  padding: 20px 30px;
  margin-bottom: 25px;
  flex-wrap: wrap;
  gap: 20px;
}

.profileInfo {
  display: flex;
  align-items: center;
  gap: 20px;
}

.profilePhotoContainer {
  position: relative;
  width: 80px;
  height: 80px;
}

.profilePhoto {
  width: 100%;
  height: 100%;
  border-radius: 50%;
  object-fit: cover;
  border: 3px solid;
}

.uploadPhotoButton {
  position: absolute;
  bottom: 0;
  right: 0;
  border: #0400BA;
  background-color: #0400BA;
  border-radius: 50%;
  width: 30px;
  height: 30px;
  display: flex;
  justify-content: center;
  align-items: center;
  cursor: pointer;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
}

.uploadPhotoButton svg {
  width: 18px;
  height: 18px;
  fill: #fff;
}

.profileText {
  display: flex;
  flex-direction: column;
}

.profileName {
  font-size: 24px;
  font-weight: bold;
  color: rgb(36, 36, 36);
  margin: 0;
}

.profileEmail {
  font-size: 14px;
  color: black;
}

.profileActions {
  display: flex;
  gap: 15px;
  flex-wrap: wrap;
  justify-content: center;
}

.actionButton, .logoutButton {
  padding: 10px 20px;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  transition: background-color 0.3s, color 0.3s;
  border: none;
}

.actionButton {
  background-color: var(--primary-color);
  color: #fff;
}

.actionButton:hover {
  background-color: #4a54c9;
}

.logoutButton {
  background-color: #f44336;
  color: #fff;
}

.logoutButton:hover {
  background-color: #d32f2f;
}

.infoCard {
  background-color: var(--card-background);
  border-radius: 16px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
  padding: 30px;
}

.cardTitle {
  font-size: 20px;
  font-weight: bold;
  color: black;
  margin-bottom: 25px;
}

.infoGrid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 20px;
}

@media (min-width: 768px) {
  .infoGrid {
    grid-template-columns: repeat(2, 1fr);
  }
}

.infoField {
  display: flex;
  flex-direction: column;
}

.fieldLabel {
  font-size: 14px;
  color: black;
  margin-bottom: 8px;
  font-weight: 500;
}

.fieldInput {
  background-color: var(--secondary-color);
  border: 1px solid var(--border-color);
  border-radius: 8px;
  padding: 12px 15px;
  font-size: 16px;
  color: black;
  transition: border-color 0.3s, background-color 0.3s;
}

.fieldInput:focus {
  outline: none;
  border-color: var(--primary-color);
  box-shadow: 0 0 0 3px rgba(91, 101, 243, 0.2);
}

.fieldInput:disabled {
  background-color: #e9ecef;
  cursor: not-allowed;
}

.editButtonContainer {
  display: flex;
  justify-content: flex-end;
  margin-top: 30px;
}

.editProfileButton {
  background-color: var(--primary-color);
  color: #fff;
  border: none;
  padding: 12px 30px;
  border-radius: 8px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: background-color 0.3s, transform 0.2s;
}

.editProfileButton:hover {
  background-color: #4a54c9;
}

/* Modal Styling */
.modalOverlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgb(255, 255, 255);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
}

.modalContent {
  background-color: var(--card-background);
  padding: 30px;
  border-radius: 12px;
  width: 90%;
  max-width: 500px;
  position: relative;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
}

.modalTitle {
  font-size: 24px;
  font-weight: bold;
  color: black;
  margin: 0 0 20px;
}

.modalClose {
  position: absolute;
  top: 15px;
  right: 25px;
  font-size: 28px;
  font-weight: bold;
  cursor: pointer;
  color: black;
}

.formGroup {
  margin-bottom: 20px;
}

.modalLabel {
  font-size: 14px;
  color: black;
  margin-bottom: 8px;
  font-weight: 500;
  display: block;
}

.modalInput {
  width: 100%;
  padding: 12px 15px;
  border: 1px solid var(--border-color);
  border-radius: 8px;
  background-color: var(--secondary-color);
  color: black;
  font-size: 16px;
}

.modalInput:focus {
  outline: none;
  border-color: var(--primary-color);
  box-shadow: 0 0 0 3px rgba(91, 101, 243, 0.2);
}

.modalActions {
  display: flex;
  justify-content: flex-end;
  gap: 15px;
  margin-top: 20px;
}

.cancelButton {
  background-color: transparent;
  color: black;
  border: 1px solid var(--border-color);
  padding: 12px 25px;
  border-radius: 8px;
  font-size: 16px;
  cursor: pointer;
  transition: background-color 0.3s;
}

.cancelButton:hover {
  background-color: #f0f0f0;
}

.saveButton {
  background-color: var(--primary-color);
  color: #fff;
  border: none;
  padding: 12px 25px;
  border-radius: 8px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: background-color 0.3s;
}

.saveButton:hover {
  background-color: #4a54c9;
}

/* Responsividade para tablets */
@media (max-width: 1024px) {
  .pageContainer {
    padding: 25px;
  }
  
  .profileHeader {
    padding: 18px 25px;
    flex-direction: column;
    align-items: center;
    text-align: center;
    gap: 15px;
  }
  
  .profileInfo {
    flex-direction: column;
    align-items: center;
    gap: 15px;
  }
  
  .profileActions {
    width: 100%;
    justify-content: center;
  }
}

/* Responsividade para dispositivos móveis */
@media (max-width: 768px) {
  .pageContainer {
    padding: 20px 15px;
  }
  
  .profileHeader {
    padding: 15px 20px;
    margin-bottom: 20px;
  }
  
  .profilePhotoContainer {
    width: 70px;
    height: 70px;
  }
  
  .uploadPhotoButton {
    width: 25px;
    height: 25px;
  }
  
  .uploadPhotoButton svg {
    width: 15px;
    height: 15px;
  }
  
  .profileName {
    font-size: 20px;
  }
  
  .profileEmail {
    font-size: 13px;
  }
  
  .actionButton, .logoutButton {
    padding: 8px 16px;
    font-size: 14px;
  }
  
  .infoCard {
    padding: 25px 20px;
  }
  
  .cardTitle {
    font-size: 18px;
    margin-bottom: 20px;
  }
  
  .modalContent {
    width: 95%;
    padding: 25px 20px;
  }
  
  .modalTitle {
    font-size: 20px;
  }
}

/* Responsividade para telas pequenas */
@media (max-width: 480px) {
  .pageContainer {
    padding: 15px 10px;
  }
  
  .profileHeader {
    padding: 12px 15px;
    margin-bottom: 15px;
  }
  
  .profilePhotoContainer {
    width: 60px;
    height: 60px;
  }
  
  .uploadPhotoButton {
    width: 22px;
    height: 22px;
  }
  
  .uploadPhotoButton svg {
    width: 12px;
    height: 12px;
  }
  
  .profileName {
    font-size: 18px;
  }
  
  .profileEmail {
    font-size: 12px;
  }
  
  .profileActions {
    flex-direction: column;
    width: 100%;
    gap: 10px;
  }
  
  .actionButton, .logoutButton {
    width: 100%;
    padding: 10px 16px;
    font-size: 14px;
  }
  
  .infoCard {
    padding: 20px 15px;
  }
  
  .cardTitle {
    font-size: 16px;
    margin-bottom: 18px;
  }
  
  .infoGrid {
    gap: 15px;
  }
  
  .fieldInput {
    padding: 10px 12px;
    font-size: 14px;
  }
  
  .editProfileButton {
    width: 100%;
    padding: 12px 20px;
    font-size: 14px;
  }
  
  .modalContent {
    width: 98%;
    padding: 20px 15px;
    margin: 10px;
  }
  
  .modalTitle {
    font-size: 18px;
  }
  
  .modalInput {
    padding: 10px 12px;
    font-size: 14px;
  }
  
  .modalActions {
    flex-direction: column;
    gap: 10px;
  }
  
  .cancelButton, .saveButton {
    width: 100%;
    padding: 12px 20px;
    font-size: 14px;
  }
}

/* Responsividade para telas muito pequenas */
@media (max-width: 360px) {
  .pageContainer {
    padding: 12px 8px;
  }
  
  .profileHeader {
    padding: 10px 12px;
  }
  
  .profilePhotoContainer {
    width: 55px;
    height: 55px;
  }
  
  .profileName {
    font-size: 16px;
  }
  
  .infoCard {
    padding: 15px 12px;
  }
  
  .cardTitle {
    font-size: 15px;
  }
  
  .modalContent {
    padding: 15px 12px;
    margin: 5px;
  }
}


.errorMessage {
    background-color: #fee;
    color: #c33;
    padding: 10px;
    border-radius: 4px;
    margin-bottom: 15px;
    border: 1px solid #fcc;
    font-size: 14px;
}

================
File: src/app/(dashboard)/perfil/page.tsx
================
'use client'

import pageStyles from '@/app/(dashboard)/perfil/page.module.css';
import modalStyles from '@/app/(dashboard)/perfil/modal.module.css';
import { createClient } from '@/lib/supabase/client';
import { useState, useEffect, useRef, useCallback, ChangeEvent } from 'react';
import { useRouter } from 'next/navigation';
import Image from 'next/image';
import { useAuth } from '@/contexts/AuthContext';
import { useAuthRequest } from '@/hooks/useAuthRequest';
import { EditProfileModal } from '@/components/EditProfileModal';
import { toast } from '@/components/Toast';
// Elders management moved to /familia

// --- DEFINIÇÃO DE TIPOS ---
interface PasswordData {
    currentPassword: string;
    newPassword: string;
    confirmNewPassword: string;
}

interface ProfileDataType {
    fullName: string;
    email: string;
    phone: string;
    dob: string;
    photoUrl: string;
}

interface ChangePasswordModalProps {
    show: boolean;
    onClose: () => void;
    onSave: (data: PasswordData) => void;
    loading: boolean; // Corrigido: Agora é obrigatório
}

// --- COMPONENTE MODAL DE ALTERAR SENHA ---

const ChangePasswordModal = ({ show, onClose, onSave, loading }: ChangePasswordModalProps) => {
    const [passwordData, setPasswordData] = useState<PasswordData>({
        currentPassword: '',
        newPassword: '',
        confirmNewPassword: ''
    });
    const [error, setError] = useState<string>('');

    if (!show) {
        return null;
    }

    const handlePasswordChange = (e: ChangeEvent<HTMLInputElement>) => {
        const { name, value } = e.target;
        setPasswordData(prev => ({ ...prev, [name]: value }));
        if (error) setError('');
    };

    const handleSaveClick = () => {
        if (!passwordData.currentPassword) {
            setError("Por favor, informe a senha atual");
            return;
        }
        if (!passwordData.newPassword) {
            setError("Por favor, informe a nova senha");
            return;
        }
        if (passwordData.newPassword.length < 6) {
            setError("A nova senha deve ter pelo menos 6 caracteres");
            return;
        }
        if (passwordData.newPassword !== passwordData.confirmNewPassword) {
            setError("As novas senhas não coincidem!");
            return;
        }
        setError('');
        onSave(passwordData);
    };

    const handleClose = () => {
        setPasswordData({
            currentPassword: '',
            newPassword: '',
            confirmNewPassword: ''
        });
        setError('');
        onClose();
    };

    return (
        <div className={modalStyles.modalOverlay}>
            <div className={modalStyles.modalContent}>
                <h2 className={modalStyles.modalTitle}>Alterar Senha</h2>
                <span className={modalStyles.modalClose} onClick={handleClose}>&times;</span>
                
                {error && (
                    <div className={modalStyles.errorMessage}>
                        {error}
                    </div>
                )}

                <div className={modalStyles.formGroup}>
                    <label htmlFor="currentPassword" className={modalStyles.modalLabel}>Senha Atual</label>
                    <input 
                        type="password" 
                        id="currentPassword" 
                        name="currentPassword" 
                        className={modalStyles.modalInput} 
                        value={passwordData.currentPassword}
                        onChange={handlePasswordChange}
                        disabled={loading}
                    />
                </div>
                <div className={modalStyles.formGroup}>
                    <label htmlFor="newPassword" className={modalStyles.modalLabel}>Nova Senha</label>
                    <input 
                        type="password" 
                        id="newPassword" 
                        name="newPassword" 
                        className={modalStyles.modalInput} 
                        value={passwordData.newPassword}
                        onChange={handlePasswordChange}
                        disabled={loading}
                    />
                </div>
                <div className={modalStyles.formGroup}>
                    <label htmlFor="confirmNewPassword" className={modalStyles.modalLabel}>Repetir Nova Senha</label>
                    <input 
                        type="password" 
                        id="confirmNewPassword" 
                        name="confirmNewPassword" 
                        className={modalStyles.modalInput} 
                        value={passwordData.confirmNewPassword}
                        onChange={handlePasswordChange}
                        disabled={loading}
                    />
                </div>
                <div className={modalStyles.modalActions}>
                    <button 
                        className={modalStyles.cancelButton} 
                        onClick={handleClose}
                        disabled={loading}
                    >
                        Cancelar
                    </button>
                    <button 
                        className={modalStyles.saveButton} 
                        onClick={handleSaveClick}
                        disabled={loading}
                    >
                        {loading ? 'Salvando...' : 'Salvar'}
                    </button>
                </div>
            </div>
        </div>
    );
};


// --- COMPONENTE PRINCIPAL DA PÁGINA DE PERFIL ---
export default function Perfil() {
    const { user, signOut } = useAuth();
    const router = useRouter();
    const supabase = createClient();
    const { makeRequest } = useAuthRequest();
    
    
    const [uploadingPhoto, setUploadingPhoto] = useState(false); 
    const [successMessage, setSuccessMessage] = useState<string>('');
    const [passwordLoading, setPasswordLoading] = useState(false); 
    const [profileData, setProfileData] = useState<ProfileDataType>({
        fullName: '',
        email: '',
        phone: '',
        dob: '',
        photoUrl: '/foto_padrao.png'
    });
    const [showPasswordModal, setShowPasswordModal] = useState(false);
    const [isMenuOpen, setIsMenuOpen] = useState<boolean>(false);
    const [showPhotoViewer, setShowPhotoViewer] = useState(false);
    const [showEditModal, setShowEditModal] = useState(false);

    const fileInputRef = useRef<HTMLInputElement>(null); // ADICIONADO
    const BUCKET_NAME = process.env.NEXT_PUBLIC_SUPABASE_BUCKET || 'avatars'; // ADICIONADO

    useEffect(() => {
        const fetchProfileData = async () => {
            if (!user) return;
            try {
                const profile = await makeRequest<any>('/api/perfil');
                if (profile) {
                    setProfileData({
                        fullName: profile.nome || user.user_metadata?.full_name || '',
                        email: user.email || '',
                        phone: profile.telefone || '',
                        dob: profile.data_nascimento || '',
                        photoUrl: profile.foto_usuario || '/foto_padrao.png',
                    });
                }
            } catch (error) {
                console.error('Erro ao buscar perfil pela API:', error);
                setProfileData(prev => ({
                    ...prev,
                    fullName: user.user_metadata?.full_name || 'Nome não encontrado',
                    email: user.email || '',
                    photoUrl: '/foto_padrao.png',
                }));
            }
        };
        fetchProfileData();
    }, [user, makeRequest]);

    const handleLogout = async () => {
        await signOut();
        router.push('/auth');
    };

    const handleSaveProfile = useCallback(async (data: { fullName: string; phone: string; dob: string }) => {
        if (!user) {
            alert("Erro: Usuário não encontrado.");
            return;
        }

        try {
            await makeRequest(`/api/perfil/${user.id}`, {
                method: 'PUT',
                body: JSON.stringify({
                    fullName: data.fullName,
                    phone: data.phone,
                    dob: data.dob,
                }),
            });
            
            // Atualiza o estado local
            setProfileData(prev => ({
                ...prev,
                fullName: data.fullName,
                phone: data.phone,
                dob: data.dob,
            }));
            
            // Dispara evento para atualizar outros componentes
            window.dispatchEvent(new CustomEvent('profileUpdated', { 
                detail: { 
                    fullName: data.fullName,
                    phone: data.phone,
                    dob: data.dob,
                } 
            }));
            
            return true;
        } catch (error) {
            console.error('Erro ao salvar perfil:', error);
            const { normalizeError } = await import('@/utils/errors');
            throw normalizeError(error, 'Erro ao salvar perfil');
        }
    }, [user, makeRequest]);

    // Função refatorada para centralizar o upload de foto
    const handleUploadButtonClick = () => {
        fileInputRef.current?.click();
    };

    const handleFileChange = async (event: ChangeEvent<HTMLInputElement>) => {
        const files = event.target.files;
        if (!files || files.length === 0) return;
        if (!user) {
            alert('Você precisa estar autenticado para enviar uma foto.');
            return;
        }

        const file = files[0];
        try {
            setUploadingPhoto(true);
            if (!BUCKET_NAME) {
                alert('Bucket do Storage não configurado. Defina NEXT_PUBLIC_SUPABASE_BUCKET no seu .env.local (ex.: avatars) e crie esse bucket no Supabase.');
                return;
            }
            // Gera um caminho único por usuário/timestamp
            const fileExt = file.name.split('.').pop();
            const filePath = `profiles/${user.id}/${Date.now()}.${fileExt}`;

            // Faz upload para o bucket
            const { error: uploadError } = await supabase.storage
                .from(BUCKET_NAME) 
                .upload(filePath, file, {
                    cacheControl: '3600',
                    upsert: true,
                });

            if (uploadError) throw uploadError;

            // Obtém URL pública
            const { data: publicData } = supabase.storage
                .from(BUCKET_NAME)
                .getPublicUrl(filePath);

            const publicUrl = publicData.publicUrl;

            // Atualiza via API de perfil
            await makeRequest(`/api/perfil/${user.id}`, {
                method: 'PUT',
                body: JSON.stringify({ foto_usuario: publicUrl }),
            });

            // Atualiza UI
            setProfileData(prev => ({ ...prev, photoUrl: publicUrl }));
            
            // Sinaliza que o perfil foi atualizado para o header
            localStorage.setItem('profileUpdated', 'true');
            
            // Dispara evento customizado para notificar outros componentes
            window.dispatchEvent(new CustomEvent('profilePhotoUpdated', { 
                detail: { photoUrl: publicUrl } 
            }));
            
            toast.success('Foto de perfil atualizada com sucesso!');    
        } catch (err: any) {
            console.error('Erro ao enviar/atualizar foto:', err);
            if (err?.message?.toLowerCase?.().includes('bucket not found')) {
                alert(`Bucket não encontrado no Supabase. Verifique se o bucket "${BUCKET_NAME ?? ''}" existe e está público nas configurações de Storage.`);
            } else {
                alert('Não foi possível atualizar a foto de perfil.');
            }
        } finally {
            setUploadingPhoto(false);
            if (fileInputRef.current) fileInputRef.current.value = '';
        }
    };

    const handleEditClick = () => {
        setShowEditModal(true);
    };

    // Salvar nova senha via API
    const handleSavePassword = async (data: PasswordData) => {
        setPasswordLoading(true);
        try {
            await makeRequest('/api/change-password', {
                method: 'POST',
                body: JSON.stringify({
                    currentPassword: data.currentPassword,
                    newPassword: data.newPassword,
                }),
            });

            alert("Senha alterada com sucesso! Por segurança, você será desconectado para reautenticar.");
            
            // Desconecta o usuário após a mudança de senha, forçando um novo login com a nova senha
            await signOut();
            router.push('/auth');

        } catch (error) {
            console.error("Erro ao salvar senha:", error);
            if (error instanceof Error) {
                // Trata o erro de reautenticação (ex: senha atual incorreta)
                alert(`Erro ao alterar senha: ${error.message}`);
            } else {
                alert("Erro inesperado ao tentar alterar a senha.");
            }
        } finally {
            setPasswordLoading(false);
            // O modal só fecha se for para a tela de login ou se houver erro não-crítico
            // Se a senha foi salva, a navegação resolve o fechamento.
            if (!passwordLoading) setShowPasswordModal(false); 
        }
    };

    const toggleMenu = () => setIsMenuOpen(!isMenuOpen);
    const closeMenu = () => setIsMenuOpen(false);

    return (
        <main className={pageStyles.main}>
            <div className={pageStyles.mainContent}>
                <div className={pageStyles.content}>
                    
                    <div className={pageStyles.pageHeader}>
                        <h1 className={pageStyles.content_title}>Perfil</h1>
                    </div>
                    <section className={pageStyles.content_info}>
                        <div className={pageStyles.profileSection}>
                            <div className={pageStyles.profileHeader}>
                                <div className={pageStyles.profileInfo}>
                                        <div className={pageStyles.profilePhotoContainer}>
                                            <Image
                                                src={profileData.photoUrl}
                                                alt="Foto de Perfil"
                                                className={pageStyles.profilePhoto}
                                                width={80}
                                                height={80}
                                                key={profileData.photoUrl}
                                                onError={() => {
                                                    setProfileData(prev => ({ ...prev, photoUrl: '/foto_padrao.png' }));
                                                }}
                                                onClick={() => setShowPhotoViewer(true)}
                                                style={{ cursor: 'pointer' }}
                                            />
                                            <button 
                                                className={pageStyles.uploadPhotoButton} 
                                                onClick={handleUploadButtonClick}
                                                disabled={uploadingPhoto}
                                            >
                                                {uploadingPhoto ? (
                                                    <svg className={pageStyles.spinner} viewBox="0 0 50 50">
                                                        <circle className={pageStyles.path} cx="25" cy="25" r="20" fill="none" strokeWidth="5"></circle>
                                                    </svg>
                                                ) : (
                                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                                                        <path d="M12 9V3H9V9H3V12H9V18H12V12H18V9H12Z" />
                                                    </svg>
                                                )}
                                            </button>
                                            <input
                                                type="file"
                                                ref={fileInputRef}
                                                onChange={handleFileChange}
                                                style={{ display: 'none' }}
                                                accept="image/png, image/jpeg"
                                                disabled={uploadingPhoto}
                                            />
                                        </div>
                                        <div className={pageStyles.profileText}>
                                            <h1 className={pageStyles.profileName}>{profileData.fullName}</h1>
                                            <span className={pageStyles.profileEmail}>{profileData.email}</span>
                                        </div>
                                    </div>
                                    <div className={pageStyles.profileActions}>
                                        <button 
                                            className={pageStyles.actionButton} 
                                            onClick={() => setShowPasswordModal(true)}
                                            disabled={passwordLoading || uploadingPhoto}
                                        >
                                            Alterar Senha
                                        </button>
                                        <button className={pageStyles.logoutButton} onClick={handleLogout}>Logout</button>
                                    </div>
                                </div>
                                <div className={pageStyles.infoCard}>
                                    <h2 className={pageStyles.cardTitle}>Informações do Perfil</h2>
                                    <div className={pageStyles.infoGrid}>
                                        <div className={pageStyles.infoField}>
                                            <label htmlFor="fullName" className={pageStyles.fieldLabel}>Nome Completo</label>
                                            <input
                                                type="text"
                                                id="fullName"
                                                name="fullName"
                                                value={profileData.fullName}
                                                className={pageStyles.fieldInput}
                                                disabled
                                            />
                                        </div>
                                        <div className={pageStyles.infoField}>
                                            <label htmlFor="email" className={pageStyles.fieldLabel}>Email</label>
                                            <input
                                                type="email"
                                                id="email"
                                                name="email"
                                                value={profileData.email}
                                                className={pageStyles.fieldInput}
                                                disabled
                                            />
                                        </div>
                                        <div className={pageStyles.infoField}>
                                            <label htmlFor="phone" className={pageStyles.fieldLabel}>Telefone</label>
                                            <input
                                                type="text"
                                                id="phone"
                                                name="phone"
                                                value={profileData.phone}
                                                className={pageStyles.fieldInput}
                                                disabled
                                            />
                                        </div>
                                        <div className={pageStyles.infoField}>
                                            <label htmlFor="dob" className={pageStyles.fieldLabel}>Data de Nascimento</label>
                                            <input
                                                type="date"
                                                id="dob"
                                                name="dob"
                                                value={profileData.dob}
                                                className={pageStyles.fieldInput}
                                                disabled
                                            />
                                        </div>
                                    </div>
                                    <div className={pageStyles.editButtonContainer}>
                                        <button
                                            className={pageStyles.editProfileButton}
                                            onClick={handleEditClick}
                                            disabled={uploadingPhoto || passwordLoading}
                                            type="button"
                                        >
                                            Editar Perfil
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <ChangePasswordModal 
                                show={showPasswordModal} 
                                onClose={() => setShowPasswordModal(false)} 
                                onSave={handleSavePassword}
                                loading={passwordLoading}
                            />
                            
                            <EditProfileModal
                                isOpen={showEditModal}
                                onClose={() => setShowEditModal(false)}
                                onSave={handleSaveProfile}
                                initialData={{
                                    fullName: profileData.fullName,
                                    phone: profileData.phone,
                                    dob: profileData.dob,
                                }}
                                loading={uploadingPhoto || passwordLoading}
                            />



                            {showPhotoViewer && (
                                <div className={modalStyles.modalOverlay} onClick={() => setShowPhotoViewer(false)}>
                                    <div
                                        className={modalStyles.modalContent}
                                        onClick={(e) => e.stopPropagation()}
                                        style={{ background: 'transparent', boxShadow: 'none', padding: 0, maxWidth: '90vw' }}
                                    >
                                        <span className={modalStyles.modalClose} onClick={() => setShowPhotoViewer(false)}>&times;</span>
                                        <div style={{ display: 'flex', justifyContent: 'center', alignItems: 'center', maxHeight: '80vh' }}>
                                            <Image
                                                src={profileData.photoUrl}
                                                alt="Visualização da Foto de Perfil"
                                                width={1000}
                                                height={1000}
                                                style={{ width: 'auto', height: '80vh', objectFit: 'contain', borderRadius: 8 }}
                                            />
                                        </div>
                                    </div>
                                </div>
                            )}
                        </section>
                    </div>
                </div>
            </main>
        );
    }

================
File: src/app/(dashboard)/relatorios/page.module.css
================
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');

.main {
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  background-color: transparent;
  font-family: "Poppins", sans-serif; /* alterado para Poppins */
}

.content {
  flex: 1;
  max-width: 1200px;
  width: 100%;
  margin: 0 auto;
  padding: 0 20px;
}

.content_title {
  font-family: "Poppins", sans-serif;
  font-size: 40px;
  font-weight: 700;
  color: #0400BA;
  text-align: left;
  margin-top: 40px;
  margin-bottom: 40px;
  position: relative;
}

.content_title::after {
  content: "";
  position: absolute;
  bottom: -8px;
  left: 0;
  width: 100px;
  height: 4px;
  background-color: #0400BA;
  border-radius: 2px;
}

.headerContainer {
  position: sticky;
  top: 0;
  z-index: 950;
  width: 100%;
  transition: margin-left 0.3s ease-in-out, width 0.3s ease-in-out;
}

.headerPushed {
  margin-left: 280px;
  width: calc(100% - 280px);
}

.mainContent {
  transition: margin-left 0.3s ease-in-out;
  padding: 24px;
  width: 100%;
}

.contentPushed {
  margin-left: 280px; 
}

/* Report Cards Grid */
.reportGrid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 24px;
  margin-bottom: 30px;
}

.reportCard {
  background: white;
  padding: 24px;
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.cardTitle {
  font-size: 20px;
  font-weight: 600;
  color: #333;
  margin-bottom: 20px;
}

.progressWrapper {
  margin-bottom: 16px;
}

.progressLabel {
  display: flex;
  justify-content: space-between;
  margin-bottom: 8px;
  font-size: 14px;
  color: #666;
}

.progressBar {
  width: 100%;
}

.progressBar progress {
  width: 100%;
  height: 12px;
  border-radius: 6px;
  overflow: hidden;
}

.progressBar progress::-webkit-progress-bar {
  background-color: #e0e0e0;
  border-radius: 6px;
}

.progressBar progress::-webkit-progress-value {
  background-color: #0400BA;
  border-radius: 6px;
  transition: width 0.3s ease;
}

.progressBar progress::-moz-progress-bar {
  background-color: #0400BA;
  border-radius: 6px;
}

.progressBarRed progress::-webkit-progress-value {
  background-color: #dc3545;
}

.progressBarRed progress::-moz-progress-bar {
  background-color: #dc3545;
}

/* Chart Container */
.chartContainer {
  background: white;
  padding: 24px;
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  margin-bottom: 30px;
}

.chartTitle {
  font-size: 20px;
  font-weight: 600;
  color: #333;
  margin-bottom: 8px;
}

.chartSubtitle {
  font-size: 14px;
  color: #666;
  font-weight: 400;
  margin-bottom: 20px;
}

/* Report Container */
.reportContainer {
  background: white;
  padding: 24px;
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  margin-bottom: 30px;
}

/* Filters */
.filterBar {
  display: flex;
  align-items: flex-end;
  gap: 16px;
  background: #ffffff;
  padding: 16px;
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  margin-bottom: 24px;
}

.filterGroup {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.filterGroup label {
  font-size: 14px;
  color: #333;
  font-weight: 600;
}

.filterGroup input[type="date"],
.filterGroup select {
  height: 38px;
  padding: 0 10px;
  border: 1px solid #e0e0e0;
  border-radius: 8px;
  background: #fff;
  color: #333;
}

.filterActions {
  display: flex;
  gap: 10px;
  margin-left: auto;
}

.filterActions button {
  height: 38px;
  padding: 0 14px;
  border-radius: 8px;
  border: 1px solid transparent;
  cursor: pointer;
  font-weight: 600;
}

.filterActions button:first-child {
  background: #0400BA;
  color: #fff;
}

.filterActions button:last-child {
  background: #fff;
  color: #0400BA;
  border-color: #0400BA;
}

/* History Table */
.historyTable {
  width: 100%;
  border-collapse: collapse;
  margin-top: 16px;
}

.historyTable thead {
  background-color: #f8f9fa;
}

.historyTable th {
  padding: 12px;
  text-align: left;
  font-weight: 600;
  color: #333;
  border-bottom: 2px solid #e0e0e0;
}

.historyTable td {
  padding: 12px;
  border-bottom: 1px solid #e0e0e0;
  color: #666;
}

.historyTable tbody tr:hover {
  background-color: #f8f9fa;
}

.statusTomado {
  color: #28a745;
  font-weight: 600;
}

.statusPerdido {
  color: #dc3545;
  font-weight: 600;
}

/* Responsive design */
@media (max-width: 768px) {
  .content {
    padding: 0 15px;
  }

  .content_title {
    font-size: 32px;
  }

  .reportGrid {
    grid-template-columns: 1fr;
    gap: 16px;
  }

  .filterBar {
    flex-direction: column;
    align-items: stretch;
    gap: 12px;
  }

  .filterActions {
    margin-left: 0;
    justify-content: flex-start;
  }

  .reportCard,
  .chartContainer,
  .reportContainer {
    padding: 16px;
  }

  .historyTable {
    font-size: 14px;
  }

  .historyTable th,
  .historyTable td {
    padding: 8px;
  }
}

@media (max-width: 480px) {
  .content_title {
    font-size: 28px;
  }

  .cardTitle,
  .chartTitle {
    font-size: 18px;
  }

  .historyTable {
    font-size: 12px;
  }

  .historyTable th,
  .historyTable td {
    padding: 6px;
  }
}

================
File: src/app/(dashboard)/relatorios/page.tsx
================
"use client";

import { useState, useEffect, useMemo } from 'react';
import { Bar } from 'react-chartjs-2';
import { useAuth } from '@/contexts/AuthContext';
import { useRouter } from 'next/navigation';
import { createClient } from '@/lib/supabase/client';
import { useIdoso } from '@/contexts/IdosoContext';
import { FullScreenLoader } from '@/components/FullScreenLoader';
import {
  Chart as ChartJS,
  CategoryScale,
  LinearScale,
  BarElement,
  Title,
  Tooltip,
  Legend,
} from 'chart.js';
import styles from './page.module.css';

ChartJS.register(
  CategoryScale,
  LinearScale,
  BarElement,
  Title,
  Tooltip,
  Legend
);

interface EventoHistorico {
  id: string;
  tipo: 'Medicamento' | 'Rotina';
  nome: string;
  horario: string;
  status: string;
  created_at: string;
}

export default function Relatorios() {
  const { user } = useAuth();
  const router = useRouter();
  const supabase = useMemo(() => createClient(), []);
  const { idosoSelecionadoId, listaIdososVinculados } = useIdoso();
  const [loading, setLoading] = useState(true);
  const [eventos, setEventos] = useState<EventoHistorico[]>([]);
  const [dataInicio, setDataInicio] = useState<string>('');
  const [dataFim, setDataFim] = useState<string>('');
  const [tipoSelecionado, setTipoSelecionado] = useState<'Todos' | 'Medicamento' | 'Rotina'>('Todos');
  const [applyTick, setApplyTick] = useState<number>(0);
  const isFamiliar = user?.user_metadata?.account_type === 'familiar';
  const selectedElderName = useMemo(() => (
    listaIdososVinculados.find((i) => i.id === idosoSelecionadoId)?.nome || null
  ), [listaIdososVinculados, idosoSelecionadoId]);

  const chartOptions: any = {
    responsive: true,
    maintainAspectRatio: false,
    plugins: {
      legend: {
        display: false,
      },
      title: {
        display: false,
      },
    },
    scales: {
      x: {
        grid: {
          display: false,
        },
      },
      y: {
        beginAtZero: true,
        max: 100,
        ticks: {
          callback: (value: number) => `${value}%`,
        },
        grid: {
          borderDash: [2, 4],
        },
      },
    },
  };

  useEffect(() => {
    const hoje = new Date();
    const seteDiasAtras = new Date();
    seteDiasAtras.setDate(hoje.getDate() - 7);
    const toYMD = (d: Date) => {
      const y = d.getFullYear();
      const m = String(d.getMonth() + 1).padStart(2, '0');
      const day = String(d.getDate()).padStart(2, '0');
      return `${y}-${m}-${day}`;
    };
    setDataInicio((prev) => prev || toYMD(seteDiasAtras));
    setDataFim((prev) => prev || toYMD(hoje));
  }, []);

  useEffect(() => {
    const fetchEventos = async () => {
      if (!user) {
        router.push('/auth');
        return;
      }
      if (isFamiliar && !idosoSelecionadoId) {
        setEventos([]);
        setLoading(false);
        return;
      }
      try {
        setLoading(true);
        const { data: sessionData } = await supabase.auth.getSession();
        const token = sessionData.session?.access_token;
        const params = new URLSearchParams();
        if (idosoSelecionadoId) params.set('idoso_id', idosoSelecionadoId);
        if (dataInicio) params.set('dataInicio', dataInicio);
        if (dataFim) params.set('dataFim', dataFim);
        if (tipoSelecionado && tipoSelecionado !== 'Todos') params.set('tipoEvento', tipoSelecionado);
        const qs = params.toString() ? `?${params.toString()}` : '';
        const res = await fetch(`/api/relatorios/historico${qs}`, {
          headers: token ? { Authorization: `Bearer ${token}` } : undefined,
          cache: 'no-store',
        });
        if (!res.ok) {
          throw new Error(`HTTP ${res.status}`);
        }
        const historico = await res.json();
        const eventosFormatados: EventoHistorico[] = (historico || []).map((evento: any) => ({
          id: evento.id,
          tipo: evento.tipo_evento as 'Medicamento' | 'Rotina',
          nome: evento.evento,
          horario: evento.horario_programado,
          status: evento.status,
          created_at: evento.horario_programado,
        }));
        setEventos(eventosFormatados);
      } catch (err) {
        console.error('Erro ao buscar eventos:', err);
      } finally {
        setLoading(false);
      }
    };

    fetchEventos();
  }, [user, router, supabase, idosoSelecionadoId, isFamiliar, dataInicio, dataFim, tipoSelecionado, applyTick]);

  // Função para calcular estatísticas por período
  const calcularEstatisticas = (dias: number) => {
    const dataLimite = new Date();
    dataLimite.setDate(dataLimite.getDate() - dias);

    const eventosRecentes = eventos.filter(evento => 
      new Date(evento.horario) >= dataLimite
    );

    const total = eventosRecentes.length;
    const tomados = eventosRecentes.filter(e => 
      e.status === 'Tomado' || e.status === 'Realizado' || e.status === 'Confirmado'
    ).length;
    const perdidos = eventosRecentes.filter(e => 
      e.status === 'Não tomado' || e.status === 'Perdido' || e.status === 'Atrasado'
    ).length;

    return {
      total,
      tomados,
      perdidos
    };
  };

  const stats7Dias = useMemo(() => calcularEstatisticas(7), [eventos]);
  const stats30Dias = useMemo(() => calcularEstatisticas(30), [eventos]);

  // Dados do gráfico semanal
  const chartData = useMemo(() => {
    const daysOfWeek = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb'];
    const hoje = new Date();
    const seteDiasAtras = new Date(hoje);
    seteDiasAtras.setDate(hoje.getDate() - 7);

    // Inicializar contadores por dia da semana
    const dailyStats = daysOfWeek.map(() => ({ total: 0, realizados: 0 }));

    // Filtrar eventos dos últimos 7 dias
    const eventosUltimos7Dias = eventos.filter(evento => {
      const dataEvento = new Date(evento.horario);
      return dataEvento >= seteDiasAtras && dataEvento <= hoje;
    });

    // Contar eventos por dia da semana
    eventosUltimos7Dias.forEach(evento => {
      const data = new Date(evento.horario);
      const dayIndex = data.getDay();
      dailyStats[dayIndex].total++;
      
      if (evento.status === 'Tomado' || evento.status === 'Realizado' || evento.status === 'Confirmado') {
        dailyStats[dayIndex].realizados++;
      }
    });

    return {
      labels: daysOfWeek,
      datasets: [{
        label: 'Realizados (%)',
        data: dailyStats.map(day => 
          day.total > 0 ? Math.round((day.realizados / day.total) * 100) : 0
        ),
        backgroundColor: '#0400BA',
        borderRadius: 6,
        barThickness: 20,
      }]
    };
  }, [eventos]);

  // Função para formatar data
  const formatarData = (dataString: string) => {
    const data = new Date(dataString);
    return data.toLocaleDateString('pt-BR', {
      day: '2-digit',
      month: '2-digit',
      year: 'numeric'
    });
  };

  // Função para formatar hora
  const formatarHora = (dataString: string) => {
    const data = new Date(dataString);
    return data.toLocaleTimeString('pt-BR', {
      hour: '2-digit',
      minute: '2-digit'
    });
  };

  // Função para determinar classe do status
  const getStatusClassName = (status: string) => {
    const statusesPositivos = ['Tomado', 'Realizado', 'Confirmado'];
    const statusesNegativos = ['Não tomado', 'Perdido', 'Atrasado'];
    
    if (statusesPositivos.includes(status)) {
      return styles.statusTomado;
    } else if (statusesNegativos.includes(status)) {
      return styles.statusPerdido;
    }
    return '';
  };

  if (loading) {
    return (
      <div className={styles.main}>
        <div className={styles.content}>
          <FullScreenLoader />
        </div>
      </div>
    );
  }

  return (
    <div className={styles.main}>
      <div className={styles.content}>
        <h1 className={styles.content_title}>
          {selectedElderName ? `Histórico de ${selectedElderName}` : 'Histórico de Medicamentos e Rotinas'}
        </h1>
        {isFamiliar && !idosoSelecionadoId && (
          <div className={styles.emptyState}>
            <p>Selecione um idoso no menu superior para visualizar os relatórios.</p>
          </div>
        )}
        <div className={styles.filterBar}>
          <div className={styles.filterGroup}>
            <label>Data Início</label>
            <input type="date" value={dataInicio} onChange={(e) => setDataInicio(e.target.value)} />
          </div>
          <div className={styles.filterGroup}>
            <label>Data Fim</label>
            <input type="date" value={dataFim} onChange={(e) => setDataFim(e.target.value)} />
          </div>
          <div className={styles.filterGroup}>
            <label>Tipo de Evento</label>
            <select value={tipoSelecionado} onChange={(e) => setTipoSelecionado(e.target.value as any)}>
              <option value="Todos">Todos</option>
              <option value="Medicamento">Medicamentos</option>
              <option value="Rotina">Rotinas</option>
            </select>
          </div>
          <div className={styles.filterActions}>
            <button onClick={() => setApplyTick((n) => n + 1)}>Aplicar Filtros</button>
            <button onClick={() => {
              const hoje = new Date();
              const seteDiasAtras = new Date();
              seteDiasAtras.setDate(hoje.getDate() - 7);
              const toYMD = (d: Date) => {
                const y = d.getFullYear();
                const m = String(d.getMonth() + 1).padStart(2, '0');
                const day = String(d.getDate()).padStart(2, '0');
                return `${y}-${m}-${day}`;
              };
              setDataInicio(toYMD(seteDiasAtras));
              setDataFim(toYMD(hoje));
              setTipoSelecionado('Todos');
              setApplyTick((n) => n + 1);
            }}>Limpar Filtros</button>
          </div>
        </div>
        
        <div className={styles.reportGrid}>
          <div className={styles.reportCard}>
            <h2 className={styles.cardTitle}>Eventos Realizados</h2>
            <div className={styles.progressWrapper}>
              <div className={styles.progressLabel}>
                <span>Últimos 7 dias</span>
                <span>{stats7Dias.tomados}/{stats7Dias.total}</span>
              </div>
              <div className={styles.progressBar}>
                <progress value={stats7Dias.tomados} max={stats7Dias.total || 1} />
              </div>
            </div>
            <div className={styles.progressWrapper}>
              <div className={styles.progressLabel}>
                <span>Últimos 30 dias</span>
                <span>{stats30Dias.tomados}/{stats30Dias.total}</span>
              </div>
              <div className={styles.progressBar}>
                <progress value={stats30Dias.tomados} max={stats30Dias.total || 1} />
              </div>
            </div>
          </div>

          <div className={styles.reportCard}>
            <h2 className={styles.cardTitle}>Eventos Não Realizados</h2>
            <div className={styles.progressWrapper}>
              <div className={styles.progressLabel}>
                <span>Últimos 7 dias</span>
                <span>{stats7Dias.perdidos}/{stats7Dias.total}</span>
              </div>
              <div className={styles.progressBar}>
                <progress value={stats7Dias.perdidos} max={stats7Dias.total || 1} className={styles.progressBarRed} />
              </div>
            </div>
            <div className={styles.progressWrapper}>
              <div className={styles.progressLabel}>
                <span>Últimos 30 dias</span>
                <span>{stats30Dias.perdidos}/{stats30Dias.total}</span>
              </div>
              <div className={styles.progressBar}>
                <progress value={stats30Dias.perdidos} max={stats30Dias.total || 1} className={styles.progressBarRed} />
              </div>
            </div>
          </div>
        </div>

        <div className={styles.chartContainer}>
          <h2 className={styles.chartTitle}>Acompanhamento Semanal</h2>
          <h3 className={styles.chartSubtitle}>Porcentagem de eventos realizados por dia da semana</h3>
          <div style={{ height: '300px' }}>
            <Bar options={chartOptions} data={chartData} />
          </div>
        </div>

        <div className={styles.reportContainer}>
          <h2 className={styles.cardTitle}>Detalhamento de Eventos</h2>
          <div className={styles.tableWrapper}>
            <table className={styles.historyTable}>
              <thead>
                <tr>
                  <th>Data</th>
                  <th>Horário</th>
                  <th>Tipo</th>
                  <th>Nome</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody>
                {eventos.length > 0
                  ? eventos.map((evento) => (
                      <tr key={evento.id}>
                        <td>{formatarData(evento.horario)}</td>
                        <td>{formatarHora(evento.horario)}</td>
                        <td>{evento.tipo}</td>
                        <td>{evento.nome}</td>
                        <td className={getStatusClassName(evento.status)}>
                          {evento.status}
                        </td>
                      </tr>
                    ))
                  : (
                      <tr>
                        <td colSpan={5} style={{ textAlign: 'center', padding: '20px' }}>
                          Nenhum evento encontrado. Os eventos serão registrados automaticamente quando você adicionar medicamentos ou rotinas.
                        </td>
                      </tr>
                    )}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  );
}

================
File: src/app/(dashboard)/remedios/page.module.css
================
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');

.main {
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  background-color: transparent;
  font-family: "Poppins", sans-serif; /* alterado para Poppins */
}

.content {
  flex: 1;
  max-width: 1200px;
  width: 100%;
  margin: 0 auto;
  padding: 0 20px;
}

.content_title {
  font-size: 40px;
  font-weight: 700;
  color: #0400BA;
  text-align: left;
  margin-top: 40px;
  margin-bottom: 40px;
  position: relative;
}

.content_title::after {
  content: "";
  position: absolute;
  bottom: -8px;
  left: 0;
  width: 100px;
  height: 4px;
  background-color: #0400BA;
  border-radius: 2px;
}

.content_info {
  background-color: white;
  border-radius: 20px;
  margin-top: 2rem;
  padding: 1.5rem;
}



.headerContainer {
  position: sticky; /* ou fixed, dependendo do seu design */
  top: 0;
  z-index: 950; /* Z-index alto, mas abaixo do sidebar */
  width: 100%;
  transition: margin-left 0.3s ease-in-out, width 0.3s ease-in-out;
}

/* NOVO: Classe que "empurra" o header */
.headerPushed {
  /* IMPORTANTE: O valor aqui DEVE SER IGUAL à largura do seu sidebar! */
  margin-left: 280px;
  width: calc(100% - 280px); /* Ajusta a largura para preencher o espaço restante */
}

/* ======================================================= */
/* Estilos do conteúdo principal (que você já tem) */

.mainContent {
  transition: margin-left 0.3s ease-in-out;
  padding: 24px;
  width: 100%;
}

.contentPushed {
  margin-left: 280px; 
}

/* Responsive design */
@media (max-width: 768px) {
  .header {
    padding: 15px;
    border-radius: 0 0 20px 20px;
  }
  
  .headerContent {
    flex-direction: column;
    gap: 15px;
    text-align: center;
  }
  
  .title {
    font-size: 2rem;
  }
  
  .welcomeText {
    font-size: 1rem;
  }
  
  .content {
    padding: 0 15px;
  }
}

@media (max-width: 480px) {
  .header {
    padding: 12px;
    border-radius: 0 0 15px 15px;
  }
  
  .title {
    font-size: 1.75rem;
  }
  
  .logoutButton {
    padding: 10px 20px;
    font-size: 14px;
  }
}

.gridContainer {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 1.5rem;
  width: 100%;
}

.loadingText,
.errorText,
.emptyState {
  width: 100%;
  text-align: center;
  padding: 2rem;
  background-color: #f9fafb; /* Um cinza bem claro */
  border-radius: 8px;
  margin-top: 1rem;
}

.errorText {
  color: #dc2626; /* Um tom de vermelho */
  background-color: #fef2f2; /* Um vermelho bem claro */
  border: 1px solid #fecaca;
}

.emptyState p {
  color: #6b7280; /* Cinza */
  font-size: 1.1rem;
}

/* Adicione estas classes ao seu arquivo page.module.css */

.pageHeader {
  margin-bottom: 1.5rem;
}

/* Remova os estilos .addCardButton, .addCardContent e coloque estes no lugar */

.actionsContainer {
  margin-bottom: 1.5rem; /* Espaço entre o botão e a lista de cards */
  display: flex;
  gap: 1rem;
}

.addButton {
  background-color: #0400BA; /* Azul do CareMind */
  color: white;
  font-size: 0.95rem;
  border: none;
  border-radius: 9px; /* Totalmente arredondado */
  padding: 0.6rem 1.25rem;
  display: inline-flex;
  align-items: center;
  gap: 0.5rem; /* Espaço entre o ícone e o texto */
  cursor: pointer;
  transition: background-color 0.2s ease, transform 0.1s ease;
  box-shadow: 0 4px 14px 0 rgb(0 118 255 / 39%);
}

.addButton:hover {
  background-color: #1d4ed8; /* Azul um pouco mais escuro */
}

.addButton:active {
    transform: scale(0.98); /* Efeito de clique */
}

.addIcon {
  font-size: 1.4rem;
  font-weight: 300; /* Deixa o '+' mais fino */
  line-height: 1;
}

/* Estilo para o estado vazio, se quiser ajustar */
.emptyState p {
    text-align: center;
    color: #6b7280;
    margin: 0;
}

/* Estilos para o modal de foto */
.photoModalContent {
  display: flex;
  flex-direction: column;
  gap: 1rem;
  padding: 1rem 0;
}

.photoDescription {
  text-align: center;
  color: #6b7280;
  margin-bottom: 1rem;
  font-size: 1rem;
}

.photoOption {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 1rem;
  border: 2px dashed #d1d5db;
  border-radius: 12px;
  background-color: #f9fafb;
  cursor: pointer;
  transition: all 0.2s ease;
}

.photoOption:hover {
  border-color: #0400BA;
  background-color: #eef2ff;
}

.photoOptionLabel {
  font-weight: 600;
  color: #0400BA;
  margin-bottom: 0.5rem;
  cursor: pointer;
}

.photoInput {
  display: none;
}

.photoIcon {
  font-size: 2rem;
  margin-bottom: 0.5rem;
}

================
File: src/app/(dashboard)/remedios/page.tsx
================
'use client';

import React, { useMemo, useState } from 'react';
import { useRouter } from 'next/navigation';

// Componentes e hooks
import { useAuth } from '@/contexts/AuthContext';
import { useIdoso } from '@/contexts/IdosoContext';
import { FullScreenLoader } from '@/components/FullScreenLoader';
import { AddMedicamentoForm } from '@/components/forms/AddMedicamentoForm';
import { Modal } from '@/components/Modal';
import MedicamentoCard from '@/components/MedicamentoCard';
import { useCrudOperations } from '@/hooks/useCrudOperations';
import { createClient } from '@/lib/supabase/client';
import { useAuthRequest } from '@/hooks/useAuthRequest';
import { toast } from '@/components/Toast';

// Estilos
import styles from './page.module.css';

type Medicamento = {
  id: string;
  nome: string;
  dosagem?: string;
  frequencia?: any;
  quantidade?: number;
  created_at: string;
};

// Assinatura de dados de atualização sem 'id' e 'created_at'
type UpdateMedicamentoData = Omit<Medicamento, 'id' | 'created_at'>;

export default function Remedios() {
  // Hooks e estados
  const { user } = useAuth();
  const router = useRouter();
  const { idosoSelecionadoId, listaIdososVinculados } = useIdoso();
  const isFamiliar = user?.user_metadata?.account_type === 'familiar';
  const targetUserId = isFamiliar ? idosoSelecionadoId : user?.id;
  const selectedElderName = useMemo(() => (
    listaIdososVinculados.find((i) => i.id === idosoSelecionadoId)?.nome || null
  ), [listaIdososVinculados, idosoSelecionadoId]);
  const [photoModal, setPhotoModal] = useState({
    isOpen: false,
    open: () => setPhotoModal(prev => ({ ...prev, isOpen: true })),
    close: () => setPhotoModal(prev => ({ ...prev, isOpen: false })),
  });

  const [photoUploading, setPhotoUploading] = useState(false);
  const [photoStatus, setPhotoStatus] = useState<string | null>(null);
  const [photoError, setPhotoError] = useState<string | null>(null);

  const { makeRequest } = useAuthRequest();
  const [eventosDoDia, setEventosDoDia] = useState<Array<{ id: string; tipo_evento: string; evento_id: string; status: string }>>([]);
  const [marking, setMarking] = useState<Record<string, boolean>>({});

  // Usar o hook CRUD personalizado
  const {
    items: medicamentos,
    loading,
    error,
    addModal,
    editModal,
    createItem,
    updateItem,
    editItem,
    deleteItem,
    fetchItems,
    setItems,
  } = useCrudOperations<Medicamento>({
    endpoint: targetUserId ? `/api/medicamentos?idoso_id=${encodeURIComponent(targetUserId)}` : '/api/medicamentos',
    onError: {
      create: (error) => alert(`Erro ao criar medicamento: ${error}`),
      update: (error) => alert(`Erro ao atualizar medicamento: ${error}`),
      delete: (error) => alert(`Erro ao excluir medicamento: ${error}`),
    },
  });

  React.useEffect(() => {
    if (isFamiliar) {
      if (targetUserId) {
        fetchItems();
      } else {
        setItems([] as any);
      }
    } else {
      fetchItems();
    }
  }, [isFamiliar, targetUserId, fetchItems, setItems]);

  // Ouve botões do Header
  React.useEffect(() => {
    const onAddMedicamento = () => addModal.open();
    const onAddMedicamentoFoto = () => photoModal.open();
    window.addEventListener('caremind:add-medicamento', onAddMedicamento as EventListener);
    window.addEventListener('caremind:add-medicamento-foto', onAddMedicamentoFoto as EventListener);
    return () => {
      window.removeEventListener('caremind:add-medicamento', onAddMedicamento as EventListener);
      window.removeEventListener('caremind:add-medicamento-foto', onAddMedicamentoFoto as EventListener);
    };
  }, [addModal, photoModal]);

  React.useEffect(() => {
    const loadAgenda = async () => {
      if (!user) return;
      if (isFamiliar && !targetUserId) return;
      const today = new Date().toISOString().slice(0, 10);
      const params = targetUserId ? `?idoso_id=${encodeURIComponent(targetUserId)}&data=${encodeURIComponent(today)}` : `?data=${encodeURIComponent(today)}`;
      try {
        const data = await makeRequest<Array<any>>(`/api/agenda${params}`, { method: 'GET' });
        setEventosDoDia((data || []).map(e => ({ id: e.id, tipo_evento: e.tipo_evento, evento_id: e.evento_id, status: e.status })));
      } catch (e) {
        // ignora
      }
    };
    loadAgenda();
  }, [user, isFamiliar, targetUserId, makeRequest]);

  const handleSaveMedicamento = async (
    nome: string,
    dosagem: string | null,
    frequencia: any,
    quantidade: number
  ) => {
    if (isFamiliar && !targetUserId) {
      alert('Selecione um idoso no menu superior antes de adicionar medicamentos.');
      return;
    }
    await createItem({
      nome,
      dosagem,
      frequencia,
      quantidade,
      created_at: new Date().toISOString(),
      ...(targetUserId ? { user_id: targetUserId } : {}),
    } as unknown as Omit<Medicamento, 'id'>);
  };

  const handleUpdateMedicamento = async (
    nome: string,
    dosagem: string | null,
    frequencia: any,
    quantidade: number
  ) => {
    if (!editModal.item) return;

    // CORREÇÃO CRÍTICA: Chamada do updateItem.
    // Presumindo que 'updateItem' espera o ID E os dados.
    // Se o hook 'useCrudOperations' estiver definido corretamente, esta chamada
    // deve estar em conformidade com 'updateItem(id, data)'.
    await updateItem(editModal.item.id, {
      nome,
      dosagem,
      frequencia,
      quantidade,
    } as UpdateMedicamentoData); // Tipagem mais clara para o payload
  };

  const hasPendingForMedicamento = (medId: string) =>
    eventosDoDia.some(e => e.tipo_evento === 'medicamento' && e.evento_id === medId && e.status === 'pendente');

  const handleMarkMedicamentoDone = async (medId: string) => {
    const ev = eventosDoDia.find(e => e.tipo_evento === 'medicamento' && e.evento_id === medId && e.status === 'pendente');
    if (!ev) return;
    setMarking(prev => ({ ...prev, [medId]: true }));
    const prevEventos = eventosDoDia;
    setEventosDoDia(prev => prev.map(e => e.id === ev.id ? { ...e, status: 'confirmado' } : e));
    try {
      await makeRequest(`/api/historico_eventos/${ev.id}`, {
        method: 'PATCH',
        body: JSON.stringify({ status: 'confirmado' }),
      });
    } catch (err) {
      setEventosDoDia(prevEventos);
      alert(err instanceof Error ? err.message : 'Falha ao atualizar evento');
    } finally {
      setMarking(prev => ({ ...prev, [medId]: false }));
    }
  };

  const handlePhotoUpload = async (file: File) => {
    if (!user) {
      toast.error('Usuário não autenticado');
      return;
    }
    if (isFamiliar && !targetUserId) {
      toast.error('Selecione um idoso no menu superior antes de adicionar por foto.');
      return;
    }

    setPhotoError(null);
    setPhotoStatus('Enviando foto...');
    toast.info('Enviando foto...');
    setPhotoUploading(true);

    const supabase = createClient();

    try {
      const fileName = `${user.id}/${Date.now()}_${file.name}`;
      const { error: uploadError } = await supabase.storage
        .from('receitas-medicas')
        .upload(fileName, file);

      if (uploadError) {
        setPhotoError(`Erro ao fazer upload: ${uploadError.message}`);
        toast.error(`Erro ao fazer upload: ${uploadError.message}`);
        return;
      }

      setPhotoStatus('Gerando link público...');
      const { data: publicUrlData } = supabase.storage
        .from('receitas-medicas')
        .getPublicUrl(fileName);
      if (!publicUrlData) {
        setPhotoError('Erro ao obter URL pública');
        toast.error('Erro ao obter URL pública');
        return;
      }
      const imageUrl = publicUrlData.publicUrl;

      setPhotoStatus('Registrando processamento...');
      const { data: inserted, error: insertError } = await supabase
        .from('ocr_gerenciamento')
        .insert({
          // Quando familiar, garantir que use o id do idoso selecionado
          user_id: targetUserId || user.id,
          image_url: imageUrl,
          status: 'PENDENTE',
        })
        .select('id')
        .single();

      if (insertError) {
        setPhotoError(`Erro ao salvar no banco: ${insertError.message}`);
        toast.error(`Erro ao salvar no banco: ${insertError.message}`);
        return;
      }

      setPhotoStatus('Foto enviada! Processando receita...');
      toast.success('Foto enviada! Processando receita...');
      photoModal.close();
      setPhotoStatus(null);

      // Polling de status do OCR
      if (inserted?.id) {
        const ocrId = inserted.id as string;
        const start = Date.now();
        const timeoutMs = 10 * 60 * 1000; // 10 minutos
        const interval = 5000; // 5s
        let notifiedStatusError = false;
        const poll = async () => {
          try {
            const { data, error } = await supabase
              .from('ocr_gerenciamento')
              .select('status, error_message')
              .eq('id', ocrId)
              .single();
            if (error) {
              // Falha temporária ao consultar status: avisar uma vez e continuar tentando
              if (!notifiedStatusError) {
                toast.info('Aguardando processamento da receita...');
                notifiedStatusError = true;
              }
              if (Date.now() - start < timeoutMs) {
                setTimeout(poll, interval);
              } else {
                toast.error('Tempo esgotado aguardando processamento da receita.');
              }
              return;
            }
            const status = (data as any)?.status;
            // Sucesso: PROCESSADO ou PROCESSADO_PARCIALMENTE
            if (status === 'PROCESSADO' || status === 'PROCESSADO_PARCIALMENTE') {
              toast.success('Receita processada. Atualizando medicamentos...');
              await fetchItems();
              return; // fim do polling
            }
            // Erros: ERRO_PROCESSAMENTO (ex.: não encontrou medicamentos) ou ERRO_DATABASE
            if (status === 'ERRO_PROCESSAMENTO' || status === 'ERRO_DATABASE') {
              const errMsg = (data as any)?.error_message || 'Não foi possível encontrar medicamento na receita.';
              toast.error(`Falha no processamento: ${errMsg}`);
              return; // fim do polling
            }
            if (Date.now() - start >= timeoutMs) {
              toast.error('Tempo esgotado aguardando processamento da receita.');
              return;
            }
            setTimeout(poll, interval);
          } catch (e) {
            const errMsg = e instanceof Error ? e.message : 'Erro inesperado no polling';
            // Erro inesperado: continuar tentando até timeout
            toast.info('Aguardando processamento da receita...');
            if (Date.now() - start < timeoutMs) {
              setTimeout(poll, interval);
            } else {
              toast.error(`Tempo esgotado: ${errMsg}`);
            }
          }
        };
        setTimeout(poll, interval);
      }
    } catch (e) {
      const errMsg = e instanceof Error ? e.message : 'Erro inesperado';
      setPhotoError(errMsg);
      toast.error(`Erro: ${errMsg}`);
    } finally {
      setPhotoUploading(false);
    }
  };

  // Render content
  const renderContent = () => {
    if (isFamiliar && !targetUserId) {
      return (
        <div className={styles.emptyState}>
          <p>Selecione um idoso no menu superior para visualizar os medicamentos.</p>
        </div>
      );
    }
    if (loading) {
      return <FullScreenLoader />;
    }
    if (error) {
      return <p className={styles.errorText}>Erro: {error}</p>;
    }
    if (medicamentos.length > 0) {
      return (
        <div className={styles.gridContainer}>
          {medicamentos.map((medicamento) => (
            <MedicamentoCard
              key={medicamento.id}
              medicamento={medicamento}
              onEdit={editItem}
              onDelete={deleteItem}
              hasPendingToday={hasPendingForMedicamento(medicamento.id)}
              isMarking={!!marking[medicamento.id]}
              onMarkAsDone={() => handleMarkMedicamentoDone(medicamento.id)}
            />
          ))}
        </div>
      );
    }
    return (
      <div className={styles.emptyState}>
        <p>Nenhum medicamento encontrado.</p>
        <p>Clique em "Adicionar Medicamento" acima para começar.</p>
      </div>
    );
  };

  return (
    <main className={styles.main}>
      <div className={styles.content}>
        <div className={styles.pageHeader}>
          <h1 className={styles.content_title}>
            {selectedElderName ? `Medicamentos de ${selectedElderName}` : 'Medicamentos'}
          </h1>
        </div>

        {!loading && !error && !(isFamiliar && !targetUserId) && (
          <div className={styles.actionsContainer}>
            <button className={styles.addButton} onClick={() => addModal.open()}>
              <span className={styles.addIcon}>+</span>
              Adicionar Medicamento
            </button>
            <button className={styles.addButton} onClick={() => photoModal.open()}>
              <span className={styles.addIcon}>+</span>
              Adicionar por Foto
            </button>
          </div>
        )}

        <section className={styles.content_info}>
          {renderContent()}
        </section>
      </div>

      <Modal isOpen={addModal.isOpen} onClose={addModal.close} title="Adicionar medicamento">
        <AddMedicamentoForm onSave={handleSaveMedicamento} onCancel={addModal.close} />
      </Modal>

      <Modal isOpen={editModal.isOpen} onClose={editModal.close} title="Editar medicamento">
        {editModal.item && (
          <AddMedicamentoForm
            onSave={handleUpdateMedicamento}
            onCancel={editModal.close}
            medicamento={{
              id: editModal.item.id,
              nome: editModal.item.nome,
              dosagem: editModal.item.dosagem ?? '',
              quantidade: editModal.item.quantidade ?? 0,
              frequencia: editModal.item.frequencia ?? null,
            }}
          />
        )}
      </Modal>

      <Modal isOpen={photoModal.isOpen} onClose={photoModal.close} title="Adicionar por Foto">
        <div className={styles.photoModalContent}>
          <p className={styles.photoDescription}>Escolha uma opção para adicionar a foto da receita:</p>
          {photoStatus && (
            <p className={styles.photoDescription}>{photoStatus}</p>
          )}
          {photoError && (
            <p className={styles.errorText}>Erro: {photoError}</p>
          )}
          <fieldset disabled={photoUploading} style={{ border: 'none', padding: 0, margin: 0 }}>
            <label className={styles.photoOption}>
              <div className={styles.photoIcon}>📁</div>
              <span className={styles.photoOptionLabel}>Selecionar do dispositivo</span>
              <input type="file" accept="image/*" className={styles.photoInput} onChange={(e) => {
                const file = e.target.files?.[0];
                if (file) handlePhotoUpload(file);
              }} />
            </label>
            <label className={styles.photoOption}>
              <div className={styles.photoIcon}>📷</div>
              <span className={styles.photoOptionLabel}>Tirar foto com câmera</span>
              <input type="file" accept="image/*" capture="environment" className={styles.photoInput} onChange={(e) => {
                const file = e.target.files?.[0];
                if (file) handlePhotoUpload(file);
              }} />
            </label>
          </fieldset>
        </div>
      </Modal>
    </main>
  );
}

================
File: src/app/(dashboard)/rotinas/page.module.css
================
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');

.main {
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  background-color: transparent;
  font-family: "Poppins", sans-serif; /* alterado para Poppins */
}

.content {
  flex: 1;
  max-width: 1200px;
  width: 100%;
  margin: 0 auto;
  padding: 0 20px;
}

.content_title {
  font-size: 40px;
  font-weight: 700;
  color: #0400BA;
  text-align: left;
  margin-top: 40px;
  margin-bottom: 40px;
  position: relative;
}

.content_title::after {
  content: "";
  position: absolute;
  bottom: -8px;
  left: 0;
  width: 100px;
  height: 4px;
  background-color: #0400BA;
  border-radius: 2px;
}

.content_info {
  background-color: white;
  border-radius: 20px;
  margin-top: 2rem;
  padding: 1.5rem;
}

/* NOVO: Classe que "empurra" o header */
.headerPushed {
  /* IMPORTANTE: O valor aqui DEVE SER IGUAL à largura do seu sidebar! */
  margin-left: 280px;
  width: calc(100% - 280px); /* Ajusta a largura para preencher o espaço restante */
}

/* ======================================================= */
/* Estilos do conteúdo principal (que você já tem) */

.mainContent {
  transition: margin-left 0.3s ease-in-out;
  padding: 24px;
  width: 100%;
}

.contentPushed {
  margin-left: 280px; 
}

/* Responsive design */
@media (max-width: 768px) {
  .header {
    padding: 15px;
    border-radius: 0 0 20px 20px;
  }
  
  .headerContent {
    flex-direction: column;
    gap: 15px;
    text-align: center;
  }
  
  .title {
    font-size: 2rem;
  }
  
  .welcomeText {
    font-size: 1rem;
  }
  
  .content {
    padding: 0 15px;
  }
}

@media (max-width: 480px) {
  .header {
    padding: 12px;
    border-radius: 0 0 15px 15px;
  }
  
  .title {
    font-size: 1.75rem;
  }
  
  .logoutButton {
    padding: 10px 20px;
    font-size: 14px;
  }
}

.gridContainer {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 1.5rem;
  width: 100%;
}

.gridContainer > div {
  width: 100%;
  overflow: visible;
}

.gridContainer > div > div:first-child {
  flex-wrap: wrap !important;
  gap: 8px !important;
}

.gridContainer > div h3 {
  word-break: break-word;
  overflow-wrap: anywhere;
}

.gridContainer > div > div:nth-child(2) {
  word-break: break-word;
  overflow-wrap: anywhere;
}

.gridContainer > div > div:first-child > div:last-child {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.gridContainer > div > div:first-child > div:last-child > button {
  white-space: nowrap;
}

@media (max-width: 1024px) {
  .gridContainer {
    grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
  }
}

@media (max-width: 768px) {
  .gridContainer {
    grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
  }

  .gridContainer > div > div:first-child > div:last-child {
    width: 100%;
    justify-content: flex-start !important;
  }
}

@media (max-width: 480px) {
  .gridContainer {
    grid-template-columns: 1fr;
  }

  .gridContainer > div > div:first-child > div:last-child > button {
    flex: 1 1 100%;
    width: 100%;
  }
}

.loadingText,
.errorText,
.emptyState {
  width: 100%;
  text-align: center;
  padding: 2rem;
  background-color: #f9fafb; /* Um cinza bem claro */
  border-radius: 8px;
  margin-top: 1rem;
}

.errorText {
  color: #dc2626; /* Um tom de vermelho */
  background-color: #fef2f2; /* Um vermelho bem claro */
  border: 1px solid #fecaca;
}

.emptyState p {
  color: #6b7280; /* Cinza */
  font-size: 1.1rem;
}

/* Adicione estas classes ao seu arquivo page.module.css */

.pageHeader {
  margin-bottom: 1.5rem;
}

/* Remova os estilos .addCardButton, .addCardContent e coloque estes no lugar */

.actionsContainer {
  margin-bottom: 1.5rem; /* Espaço entre o botão e a lista de cards */
  display: flex;
  gap: 1rem;
}

.addButton {
  background-color: #0400BA; /* Azul do CareMind */
  color: white;
  font-size: 0.95rem;
  border: none;
  border-radius: 9px; /* Totalmente arredondado */
  padding: 0.6rem 1.25rem;
  display: inline-flex;
  align-items: center;
  gap: 0.5rem; /* Espaço entre o ícone e o texto */
  cursor: pointer;
  transition: background-color 0.2s ease, transform 0.1s ease;
  box-shadow: 0 4px 14px 0 rgb(0 118 255 / 39%);
}

.addButton:hover {
  background-color: #1d4ed8; /* Azul um pouco mais escuro */
}

.addButton:active {
    transform: scale(0.98); /* Efeito de clique */
}

.addIcon {
  font-size: 1.4rem;
  font-weight: 300; /* Deixa o '+' mais fino */
  line-height: 1;
}

/* Estilo para o estado vazio, se quiser ajustar */
.emptyState p {
    text-align: center;
    color: #6b7280;
    margin: 0;
}

/* Estilos para o modal de foto */
.photoModalContent {
  display: flex;
  flex-direction: column;
  gap: 1rem;
  padding: 1rem 0;
}

.photoDescription {
  text-align: center;
  color: #6b7280;
  margin-bottom: 1rem;
  font-size: 1rem;
}

.photoOption {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 1rem;
  border: 2px dashed #d1d5db;
  border-radius: 12px;
  background-color: #f9fafb;
  cursor: pointer;
  transition: all 0.2s ease;
}

.photoOption:hover {
  border-color: #0400BA;
  background-color: #eef2ff;
}

.photoOptionLabel {
  font-weight: 600;
  color: #0400BA;
  margin-bottom: 0.5rem;
  cursor: pointer;
}

.photoInput {
  display: none;
}

.photoIcon {
  font-size: 2rem;
  margin-bottom: 0.5rem;
}

================
File: src/app/(dashboard)/rotinas/page.tsx
================
'use client';

import React, { useMemo, useState } from 'react';
import { useRouter } from 'next/navigation';

// Componentes e hooks
import { useAuth } from '@/contexts/AuthContext';
import { FullScreenLoader } from '@/components/FullScreenLoader';
import { AddRotinaForm } from '@/components/forms/AddRotinaForm';
import { Modal } from '@/components/Modal';
import RotinaCard from '@/components/RotinasCard';
import { useCrudOperations } from '@/hooks/useCrudOperations';
import { createClient } from '@/lib/supabase/client';
import { useIdoso } from '@/contexts/IdosoContext';
import { useAuthRequest } from '@/hooks/useAuthRequest';
import { toast } from '@/components/Toast';

// Estilos
import styles from './page.module.css';

type Rotina = { 
  id: string;
  titulo: string;
  descricao?: string;
  frequencia?: any;
  created_at: string;
};

export default function Rotinas() {
  // Hooks e estados
  const { user } = useAuth();
  const router = useRouter();
  const { idosoSelecionadoId, listaIdososVinculados } = useIdoso();
  const isFamiliar = user?.user_metadata?.account_type === 'familiar';
  const targetUserId = isFamiliar ? idosoSelecionadoId : user?.id;
  const selectedElderName = useMemo(() => (
    listaIdososVinculados.find((i) => i.id === idosoSelecionadoId)?.nome || null
  ), [listaIdososVinculados, idosoSelecionadoId]);
  const [photoModal, setPhotoModal] = useState({
    isOpen: false,
    open: () => setPhotoModal(prev => ({ ...prev, isOpen: true })),
    close: () => setPhotoModal(prev => ({ ...prev, isOpen: false })),
  });

  const { makeRequest } = useAuthRequest();
  const [eventosDoDia, setEventosDoDia] = useState<Array<{ id: string; tipo_evento: string; evento_id: string; status: string }>>([]);
  const [marking, setMarking] = useState<Record<string, boolean>>({});
  const [deleting, setDeleting] = useState<Record<string, boolean>>({});

  // Usar o hook CRUD personalizado
  const {
    items: rotinas,
    loading,
    error,
    addModal,
    editModal,
    createItem,
    updateItem,
    deleteItem,
    editItem,
    fetchItems,
    setItems,
  } = useCrudOperations<Rotina>({
    endpoint: targetUserId ? `/api/rotinas?idoso_id=${encodeURIComponent(targetUserId)}` : '/api/rotinas',
    onError: {
      create: (error) => toast.error(`Erro ao criar rotina: ${error}`),
      update: (error) => toast.error(`Erro ao atualizar rotina: ${error}`),
      delete: (error) => toast.error(`Erro ao excluir rotina: ${error}`),
    },
    onSuccess: {
      create: () => toast.success('Rotina criada com sucesso'),
      update: () => toast.success('Rotina atualizada com sucesso'),
    },
  });

  React.useEffect(() => {
    if (isFamiliar) {
      if (targetUserId) {
        fetchItems();
      } else {
        setItems([] as any);
      }
    } else {
      fetchItems();
    }
  }, [isFamiliar, targetUserId, fetchItems, setItems]);

  // Ouve botões do Header
  React.useEffect(() => {
    const onAddRotina = () => addModal.open();
    window.addEventListener('caremind:add-rotina', onAddRotina as EventListener);
    return () => {
      window.removeEventListener('caremind:add-rotina', onAddRotina as EventListener);
    };
  }, [addModal]);

  React.useEffect(() => {
    const loadAgenda = async () => {
      if (!user) return;
      if (isFamiliar && !targetUserId) return;
      const today = new Date().toISOString().slice(0, 10);
      const params = targetUserId ? `?idoso_id=${encodeURIComponent(targetUserId)}&data=${encodeURIComponent(today)}` : `?data=${encodeURIComponent(today)}`;
      try {
        const data = await makeRequest<Array<any>>(`/api/agenda${params}`, { method: 'GET' });
        setEventosDoDia((data || []).map(e => ({ id: e.id, tipo_evento: e.tipo_evento, evento_id: e.evento_id, status: e.status })));
      } catch (e) {
        // ignora falha de agenda
      }
    };
    loadAgenda();
  }, [user, isFamiliar, targetUserId, makeRequest]);

  // Handlers para formulários
  const handleSaveRotina = async (
    titulo: string,
    descricao: string | null,
    frequencia: any
  ) => {
    if (isFamiliar && !targetUserId) {
      toast.error('Selecione um idoso no menu superior antes de adicionar rotinas.');
      return;
    }
    await createItem({
      titulo,
      descricao: descricao ?? undefined,
      frequencia,
      created_at: new Date().toISOString(),
      ...(targetUserId ? { user_id: targetUserId } : {}),
    } as unknown as Omit<Rotina, 'id'>);
  };

  const handleUpdateRotina = async (
    titulo: string,
    descricao: string | null,
    frequencia: any
  ) => {
    if (!editModal.item) return;

    await updateItem(editModal.item.id, {
      titulo,
      descricao: descricao ?? undefined,
      frequencia,
    });
  };

  const hasPendingForRotina = (rotinaId: string) =>
    eventosDoDia.some(e => e.tipo_evento === 'rotina' && e.evento_id === rotinaId && e.status === 'pendente');

  const handleMarkRotinaDone = async (rotinaId: string) => {
    const ev = eventosDoDia.find(e => e.tipo_evento === 'rotina' && e.evento_id === rotinaId && e.status === 'pendente');
    if (!ev) return;
    setMarking(prev => ({ ...prev, [rotinaId]: true }));
    const prevEventos = eventosDoDia;
    setEventosDoDia(prev => prev.map(e => e.id === ev.id ? { ...e, status: 'confirmado' } : e));
    try {
      await makeRequest(`/api/historico_eventos/${ev.id}`, {
        method: 'PATCH',
        body: JSON.stringify({ status: 'confirmado' }),
      });
    } catch (err) {
      setEventosDoDia(prevEventos);
      toast.error(err instanceof Error ? err.message : 'Falha ao atualizar evento');
    } finally {
      setMarking(prev => ({ ...prev, [rotinaId]: false }));
    }
  };

  const handlePhotoUpload = async (file: File) => {
    if (!user) {
      toast.error('Usuário não autenticado');
      return;
    }

    const supabase = createClient();

    const fileName = `${user.id}/${Date.now()}_${file.name}`;

    console.log('Tentando upload:', fileName);

    const { data, error } = await supabase.storage.from('receitas-medicas').upload(fileName, file);

    if (error) {
      toast.error(`Erro ao fazer upload: ${error.message}`);
      console.error('Upload error:', error);
      return;
    }

    console.log('Upload sucesso, obtendo URL pública');

    const { data: publicUrlData } = supabase.storage.from('receitas-medicas').getPublicUrl(fileName);
    if (!publicUrlData) {
      toast.error('Erro ao obter URL pública');
      return;
    }
    const imageUrl = publicUrlData.publicUrl;

    console.log('URL:', imageUrl);
    console.log('User ID:', user.id);

    const { error: insertError } = await supabase.from('ocr_gerenciamento').insert({
      user_id: targetUserId || user.id,
      image_url: imageUrl,
      status: 'PENDENTE',
    });

    if (insertError) {
      toast.error(`Erro ao salvar no banco: ${insertError.message}`);
      console.error('Insert error:', insertError);
      return;
    }

    console.log('Insert sucesso');
    toast.success('Foto enviada! Processando receita...');
    photoModal.close();
  };

  // Render content
  const renderContent = () => {
    if (isFamiliar && !targetUserId) {
      return (
        <div className={styles.emptyState}>
          <p>Selecione um idoso no menu superior para visualizar as rotinas.</p>
        </div>
      );
    }
    if (loading) {
      return <FullScreenLoader />;
    }
    if (error) {
      return <p className={styles.errorText}>Erro: {error}</p>;
    }
    if (rotinas.length > 0) {
      return (
        <div className={styles.gridContainer}>
          {rotinas.map((rotina) => (
            <RotinaCard
              key={rotina.id}
              rotina={rotina}
              onEdit={editItem}
              onDelete={(id) => {
                setDeleting(prev => ({ ...prev, [id]: true }));
                deleteItem(id).finally(() => {
                  setDeleting(prev => ({ ...prev, [id]: false }));
                });
              }}
              hasPendingToday={hasPendingForRotina(rotina.id)}
              isMarking={!!marking[rotina.id]}
              isDeleting={!!deleting[rotina.id]}
              onMarkAsDone={() => handleMarkRotinaDone(rotina.id)}
            />
          ))}
        </div>
      );
    }
    return (
      <div className={styles.emptyState}>
        <p>Nenhuma rotina encontrada.</p>
        <p>Clique em "Adicionar Rotina" acima para começar.</p>
      </div>
    );
  };

  return (
    <main className={styles.main}>
      <div className={styles.content}>
        <div className={styles.pageHeader}>
          <h1 className={styles.content_title}>{selectedElderName ? `Rotinas de ${selectedElderName}` : 'Rotinas'}</h1>
        </div>

        {!loading && !error && !(isFamiliar && !targetUserId) && (
          <div className={styles.actionsContainer}>
            <button className={styles.addButton} onClick={() => addModal.open()}>
              <span className={styles.addIcon}>+</span>
              Adicionar Rotina
            </button>
          </div>
        )}
        <section className={styles.content_info}>
          {renderContent()}
        </section>
      </div>

      <Modal isOpen={addModal.isOpen} onClose={addModal.close} title="Adicionar rotina">
        <AddRotinaForm onSave={handleSaveRotina} onCancel={addModal.close} />
      </Modal>

      <Modal isOpen={editModal.isOpen} onClose={editModal.close} title="Editar rotina">
        {editModal.item && (
          <AddRotinaForm
            onSave={handleUpdateRotina}
            onCancel={editModal.close}
            rotina={{
              id: editModal.item.id,
              titulo: editModal.item.titulo,
              descricao: editModal.item.descricao ?? '',
            }}
          />
        )}
      </Modal>
    </main>
  );
}

================
File: src/app/ajuda/page.tsx
================
"use client";

import { Footer } from "@/components/Footer";

export default function AjudaPage() {
  return (
    <main style={{ minHeight: "100vh", display: "flex", flexDirection: "column" }}>
      <section style={{ flex: 1, display: "flex", alignItems: "center", justifyContent: "center", padding: 24 }}>
        <div style={{ textAlign: "center", color: "#0b0b2e" }}>
          <h1 style={{ fontSize: 40, fontWeight: 800, margin: 0 }}>Central de Ajuda</h1>
          <p style={{ marginTop: 12, color: "#2d3748" }}>Conteúdos de suporte chegarão em breve.</p>
        </div>
      </section>
      <Footer />
    </main>
  );
}

================
File: src/app/api/agenda/route.ts
================
import { NextResponse } from 'next/server';
import { createClient } from '@/lib/supabase/server';

// CORS dinâmico para dev (localhost) e produção
function buildCorsHeaders(request: Request) {
  const origin = request.headers.get('origin') ?? '';
  const allowedOrigins = new Set([
    'https://caremind.online',
    'http://localhost:3000',
  ]);
  const allowOrigin = allowedOrigins.has(origin) ? origin : 'https://caremind.online';
  return {
    'Access-Control-Allow-Origin': allowOrigin,
    'Vary': 'Origin',
    'Access-Control-Allow-Methods': 'GET, OPTIONS',
    'Access-Control-Allow-Headers': 'Content-Type, Authorization',
  } as Record<string, string>;
}

export async function OPTIONS(request: Request) {
  return new NextResponse(null, { status: 204, headers: buildCorsHeaders(request) });
}

function getDayRange(dateStr?: string) {
  const now = dateStr ? new Date(dateStr) : new Date();
  const start = new Date(Date.UTC(now.getFullYear(), now.getMonth(), now.getDate(), 0, 0, 0));
  const end = new Date(Date.UTC(now.getFullYear(), now.getMonth(), now.getDate() + 1, 0, 0, 0));
  return { start: start.toISOString(), end: end.toISOString() };
}

export async function GET(request: Request) {
  const authHeader = request.headers.get('authorization');
  const token = authHeader?.startsWith('Bearer ')
    ? authHeader.slice('Bearer '.length)
    : undefined;
  const supabase = await createClient(token);

  try {
    const url = new URL(request.url);
    const idosoId = url.searchParams.get('idoso_id');
    const dataStr = url.searchParams.get('data'); // YYYY-MM-DD opcional

    // Obtém usuário a partir do contexto do Supabase
    const { data: userData, error: userErr } = await supabase.auth.getUser();
    if (userErr) throw userErr;
    const user = userData?.user ?? null;

    if (!user) {
      return NextResponse.json(
        { erro: 'Usuário não autenticado' },
        { status: 401, headers: buildCorsHeaders(request) }
      );
    }

    let targetUserId = user.id;
    if (idosoId && idosoId !== user.id) {
      const { data: vinc, error: vincErr } = await supabase
        .from('vinculos_familiares')
        .select('id_idoso')
        .eq('id_familiar', user.id)
        .eq('id_idoso', idosoId);
      if (vincErr) throw vincErr;
      const autorizado = (vinc ?? []).length > 0;
      if (!autorizado) {
        return NextResponse.json(
          { erro: 'Acesso não autorizado ao idoso selecionado' },
          { status: 403, headers: buildCorsHeaders(request) }
        );
      }
      targetUserId = idosoId;
    }

    // Valida formato da data (YYYY-MM-DD)
    const validDate = dataStr && /^\d{4}-\d{2}-\d{2}$/.test(dataStr) ? dataStr : undefined;
    const { start, end } = getDayRange(validDate);

    // Consulta usando as colunas corretas do schema: data_prevista (tempo) e titulo (nome)
    const { data: eventos, error } = await supabase
      .from('historico_eventos')
      .select('*')
      .eq('perfil_id', targetUserId)
      .gte('data_prevista', start)
      .lt('data_prevista', end)
      .order('data_prevista', { ascending: true });
    if (error) throw error;

    // Normaliza saída para o frontend
    const out = (eventos ?? []).map((e: any) => ({
      id: e.id,
      tipo_evento: String(e.tipo_evento || '').toLowerCase(),
      evento_id: e.evento_id,
      evento: e.titulo, // mapeia para o campo esperado pelo frontend
      status: e.status,
      // normaliza para o nome esperado no frontend
      horario_programado: e.data_prevista,
      horario_confirmacao: e.horario_confirmacao ?? null,
    }));

    return NextResponse.json(out, { headers: buildCorsHeaders(request) });
  } catch (error: unknown) {
    const message = error instanceof Error ? error.message : 'Falha ao obter agenda';
    const anyErr = error as any;
    const extra = {
      code: anyErr?.code,
      details: anyErr?.details,
      hint: anyErr?.hint,
    };
    console.error('Erro em GET /api/agenda:', message, extra);
    try {
      const url = new URL(request.url);
      return NextResponse.json(
        {
          erro: message,
          supabase: extra,
          params: {
            idoso_id: url.searchParams.get('idoso_id'),
            data: url.searchParams.get('data'),
          },
        },
        { status: 500, headers: buildCorsHeaders(request) }
      );
    } catch {
      return NextResponse.json(
        { erro: message, supabase: extra },
        { status: 500, headers: buildCorsHeaders(request) }
      );
    }
  }
}

================
File: src/app/api/change-password/route.ts
================
// app/api/change-password/route.ts
import { createClient } from '@/lib/supabase/server';
import { NextRequest, NextResponse } from 'next/server';

export async function POST(request: NextRequest) {
    try {
        // Parse seguro do corpo como JSON
        let body: unknown;
        try {
            body = await request.json();
        } catch (e) {
            console.error('Erro ao ler JSON da requisição:', e);
            return NextResponse.json({ error: 'Corpo da requisição inválido (JSON esperado).' }, { status: 400 });
        }

        const { currentPassword, newPassword } = (body as { currentPassword?: string; newPassword?: string });

        const current = (currentPassword ?? '').trim();
        const nextPwd = (newPassword ?? '').trim();

        // Validações básicas
        if (!current || !nextPwd) {
            return NextResponse.json(
                { error: 'Senha atual e nova senha são obrigatórias' },
                { status: 400 }
            );
        }

        if (nextPwd.length < 6) {
            return NextResponse.json(
                { error: 'A nova senha deve ter pelo menos 6 caracteres' },
                { status: 400 }
            );
        }

        // Criar cliente do Supabase
        const supabase = await createClient();

        // Verificar se o usuário está autenticado
        const { data: { user }, error: authError } = await supabase.auth.getUser();

        if (authError || !user) {
            return NextResponse.json(
                { error: 'Usuário não autenticado' },
                { status: 401 }
            );
        }

        console.log('Usuário autenticado para alteração de senha:', user.email);

        // Alterar a senha diretamente, pois o usuário já está autenticado via sessão
        try {
            const { data, error: updateError } = await supabase.auth.updateUser({ password: nextPwd });

            if (updateError) {
                console.log('Erro ao alterar senha:', updateError);
                // Erros de regra de senha costumam ser 400
                const status = updateError.status ?? 500;
                return NextResponse.json(
                    { error: `Erro ao alterar senha: ${updateError.message}` },
                    { status: status >= 400 && status < 500 ? status : 500 }
                );
            }

            console.log('Senha alterada com sucesso para usuário:', user.email);

            return NextResponse.json(
                {
                    message: 'Senha alterada com sucesso',
                    user: data.user,
                },
                { status: 200 }
            );
        } catch (updateError) {
            console.error('Erro interno na atualização:', updateError);
            return NextResponse.json(
                { error: 'Erro interno ao alterar senha' },
                { status: 500 }
            );
        }
    } catch (error) {
        console.error('Erro geral na API:', error);
        return NextResponse.json(
            { error: 'Erro interno do servidor' },
            { status: 500 }
        );
    }
}

// Método GET para testar se a API está funcionando
export async function GET() {
    return NextResponse.json(
        { message: 'API de alteração de senha funcionando' },
        { status: 200 }
    );
}

================
File: src/app/api/compromissos/[id]/route.ts
================
import { NextResponse } from 'next/server';
import { createClient } from '@/lib/supabase/server';

const corsHeaders = {
  'Access-Control-Allow-Origin': 'https://caremind.online',
  'Vary': 'Origin',
  'Access-Control-Allow-Methods': 'GET, POST, PUT, PATCH, DELETE, OPTIONS',
  'Access-Control-Allow-Headers': 'Content-Type, Authorization',
};

export async function OPTIONS() {
  return new NextResponse(null, { status: 204, headers: corsHeaders });
}

async function getAuthUser(request: Request) {
  const authHeader = request.headers.get('authorization');
  const token = authHeader?.startsWith('Bearer ')
    ? authHeader.slice('Bearer '.length)
    : undefined;
  const supabase = await createClient(token);

  let user = null as null | { id: string };
  if (token) {
    const { data, error: userErr } = await supabase.auth.getUser(token);
    if (userErr) {
      console.error('Supabase getUser(token) error:', userErr.message);
    }
    user = data?.user ?? null;
  } else {
    const { data } = await supabase.auth.getUser();
    user = data.user ?? null;
  }

  return { user, supabase } as const;
}

async function canAccessCompromisso(supabase: any, userId: string, compromissoPerfilId: string) {
  if (userId === compromissoPerfilId) return true;
  const { data: vinc, error: vincErr } = await supabase
    .from('vinculos_familiares')
    .select('id_idoso')
    .eq('id_familiar', userId)
    .eq('id_idoso', compromissoPerfilId)
    .maybeSingle();
  if (vincErr) throw vincErr;
  return !!vinc;
}

export async function PATCH(request: Request, { params }: { params: { id: string } }) {
  const { user, supabase } = await getAuthUser(request);

  if (!user) {
    return NextResponse.json(
      { erro: 'Usuário não autenticado' },
      { status: 401, headers: corsHeaders }
    );
  }

  try {
    const compromissoId = params.id;
    const { data: existente, error: getErr } = await supabase
      .from('compromissos')
      .select('*')
      .eq('id', compromissoId)
      .single();
    if (getErr) throw getErr;
    if (!existente) {
      return NextResponse.json({ erro: 'Compromisso não encontrado' }, { status: 404, headers: corsHeaders });
    }

    const allowed = await canAccessCompromisso(supabase, user.id, existente.perfil_id);
    if (!allowed) {
      return NextResponse.json({ erro: 'Proibido' }, { status: 403, headers: corsHeaders });
    }

    const body = await request.json();
    const updateData: any = {};
    const allowedFields = ['titulo', 'descricao', 'data_hora', 'local', 'tipo', 'lembrete_minutos'];
    for (const key of allowedFields) {
      if (key in body) updateData[key] = body[key];
    }

    const { data: atualizado, error: updErr } = await supabase
      .from('compromissos')
      .update(updateData)
      .eq('id', compromissoId)
      .select()
      .single();

    if (updErr) throw updErr;

    return NextResponse.json(atualizado, { headers: corsHeaders });
  } catch (error: unknown) {
    const message = error instanceof Error ? error.message : 'Falha ao atualizar compromisso';
    console.error('Erro em PATCH /api/compromissos/[id]:', message);
    return NextResponse.json({ erro: message }, { status: 500, headers: corsHeaders });
  }
}

export async function DELETE(request: Request, { params }: { params: { id: string } }) {
  const { user, supabase } = await getAuthUser(request);

  if (!user) {
    return NextResponse.json(
      { erro: 'Usuário não autenticado' },
      { status: 401, headers: corsHeaders }
    );
  }

  try {
    const compromissoId = params.id;
    const { data: existente, error: getErr } = await supabase
      .from('compromissos')
      .select('id, perfil_id')
      .eq('id', compromissoId)
      .single();
    if (getErr) throw getErr;
    if (!existente) {
      return NextResponse.json({ erro: 'Compromisso não encontrado' }, { status: 404, headers: corsHeaders });
    }

    const allowed = await canAccessCompromisso(supabase, user.id, existente.perfil_id);
    if (!allowed) {
      return NextResponse.json({ erro: 'Proibido' }, { status: 403, headers: corsHeaders });
    }

    const { error: delErr } = await supabase
      .from('compromissos')
      .delete()
      .eq('id', compromissoId);

    if (delErr) throw delErr;

    return new NextResponse(null, { status: 204, headers: corsHeaders });
  } catch (error: unknown) {
    const message = error instanceof Error ? error.message : 'Falha ao excluir compromisso';
    console.error('Erro em DELETE /api/compromissos/[id]:', message);
    return NextResponse.json({ erro: message }, { status: 500, headers: corsHeaders });
  }
}

================
File: src/app/api/compromissos/route.ts
================
import { NextResponse } from 'next/server';
import { createClient } from '@/lib/supabase/server';

const corsHeaders = {
  'Access-Control-Allow-Origin': 'https://caremind.online',
  'Vary': 'Origin',
  'Access-Control-Allow-Methods': 'GET, POST, PUT, PATCH, DELETE, OPTIONS',
  'Access-Control-Allow-Headers': 'Content-Type, Authorization',
};

export async function OPTIONS() {
  return new NextResponse(null, { status: 204, headers: corsHeaders });
}

// GET /api/compromissos?user_id=...
export async function GET(request: Request) {
  const authHeader = request.headers.get('authorization');
  const token = authHeader?.startsWith('Bearer ')
    ? authHeader.slice('Bearer '.length)
    : undefined;
  const supabase = await createClient(token);

  try {
    let user = null as null | { id: string };
    if (token) {
      const { data, error: userErr } = await supabase.auth.getUser(token);
      if (userErr) {
        console.error('Supabase getUser(token) error:', userErr.message);
      }
      user = data?.user ?? null;
    } else {
      const { data } = await supabase.auth.getUser();
      user = data.user ?? null;
    }

    if (!user) {
      return NextResponse.json(
        { erro: 'Usuário não autenticado' },
        { status: 401, headers: corsHeaders }
      );
    }

    const url = new URL(request.url);
    const queryUserId = url.searchParams.get('user_id') ?? undefined; // alvo (idoso)

    let targetUserId = user.id;
    if (queryUserId && queryUserId !== user.id) {
      const { data: vinc, error: vincErr } = await supabase
        .from('vinculos_familiares')
        .select('id_idoso')
        .eq('id_familiar', user.id)
        .eq('id_idoso', queryUserId);
      if (vincErr) throw vincErr;
      const autorizado = (vinc ?? []).length > 0;
      if (!autorizado) {
        return NextResponse.json(
          { erro: 'Acesso não autorizado ao idoso selecionado' },
          { status: 403, headers: corsHeaders }
        );
      }
      targetUserId = queryUserId;
    }

    const { data: compromissos, error } = await supabase
      .from('compromissos')
      .select('*')
      .eq('perfil_id', targetUserId)
      .order('data_hora', { ascending: true });

    if (error) throw error;

    return NextResponse.json(compromissos ?? [], { headers: corsHeaders });
  } catch (error: unknown) {
    const message = error instanceof Error ? error.message : 'Falha ao buscar compromissos';
    console.error('Erro em GET /api/compromissos:', message);
    return NextResponse.json(
      { erro: message },
      { status: 500, headers: corsHeaders }
    );
  }
}

// POST /api/compromissos
export async function POST(request: Request) {
  const authHeader = request.headers.get('authorization');
  const token = authHeader?.startsWith('Bearer ')
    ? authHeader.slice('Bearer '.length)
    : undefined;
  const supabase = await createClient(token);

  try {
    let user = null as null | { id: string };
    if (token) {
      const { data, error: userErr } = await supabase.auth.getUser(token);
      if (userErr) {
        console.error('Supabase getUser(token) error:', userErr.message);
      }
      user = data?.user ?? null;
    } else {
      const { data } = await supabase.auth.getUser();
      user = data.user ?? null;
    }

    if (!user) {
      return NextResponse.json(
        { erro: 'Usuário não autenticado' },
        { status: 401, headers: corsHeaders }
      );
    }

    const body = await request.json();
    const {
      titulo,
      descricao,
      data_hora,
      local,
      tipo,
      lembrete_minutos = 60,
      user_id: bodyUserId,
    } = body || {};

    if (!titulo || `${titulo}`.trim() === '') {
      return NextResponse.json({ erro: "O campo 'titulo' é obrigatório." }, { status: 400, headers: corsHeaders });
    }

    let targetUserId = user.id;
    if (bodyUserId && bodyUserId !== user.id) {
      const { data: vinc, error: vincErr } = await supabase
        .from('vinculos_familiares')
        .select('id_idoso')
        .eq('id_familiar', user.id)
        .eq('id_idoso', bodyUserId);
      if (vincErr) throw vincErr;
      const autorizado = (vinc ?? []).length > 0;
      if (!autorizado) {
        return NextResponse.json(
          { erro: 'Acesso não autorizado ao idoso selecionado' },
          { status: 403, headers: corsHeaders }
        );
      }
      targetUserId = bodyUserId;
    }

    const { data: novo, error } = await supabase
      .from('compromissos')
      .insert([
        {
          perfil_id: targetUserId,
          titulo: `${titulo}`.trim(),
          descricao: descricao ?? null,
          data_hora: data_hora ?? null,
          local: local ?? null,
          tipo: tipo ?? 'outros',
          lembrete_minutos: typeof lembrete_minutos === 'number' ? lembrete_minutos : 60,
        },
      ])
      .select()
      .single();

    if (error) throw error;

    return NextResponse.json(novo, { status: 201, headers: corsHeaders });
  } catch (error: unknown) {
    const message = error instanceof Error ? error.message : 'Falha ao criar compromisso';
    console.error('Erro em POST /api/compromissos:', message);
    return NextResponse.json(
      { erro: message },
      { status: 500, headers: corsHeaders }
    );
  }
}

================
File: src/app/api/criar-idoso/route.ts
================
import { NextRequest, NextResponse } from 'next/server';
import { createClient as createAdminClient } from '@supabase/supabase-js';

const corsHeaders = {
  'Access-Control-Allow-Origin': 'https://caremind.online',
  'Vary': 'Origin',
  'Access-Control-Allow-Methods': 'GET, POST, PUT, PATCH, DELETE, OPTIONS',
  'Access-Control-Allow-Headers': 'Content-Type, Authorization',
};

export async function OPTIONS() {
  return new NextResponse(null, { status: 204, headers: corsHeaders });
}

export async function POST(request: NextRequest) {
  try {
    const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;
    const serviceKey = process.env.SUPABASE_SERVICE_ROLE_KEY;

    if (!supabaseUrl || !serviceKey) {
      return NextResponse.json(
        { success: false, message: 'Configuração do Supabase ausente (URL/Service Role Key).' },
        { status: 500, headers: corsHeaders }
      );
    }

    const authHeader = request.headers.get('authorization') || request.headers.get('Authorization');
    if (!authHeader || !authHeader.startsWith('Bearer ')) {
      return NextResponse.json(
        { success: false, message: 'Token de autenticação ausente.' },
        { status: 401, headers: corsHeaders }
      );
    }
    const token = authHeader.slice('Bearer '.length);

    let body: unknown;
    try {
      body = await request.json();
    } catch {
      return NextResponse.json(
        { success: false, message: 'Corpo da requisição inválido (JSON esperado).' },
        { status: 400, headers: corsHeaders }
      );
    }

    const { nome_idoso, email_idoso, senha_idoso } = (body as Record<string, unknown>);
    const nome = typeof nome_idoso === 'string' ? nome_idoso.trim() : '';
    const email = typeof email_idoso === 'string' ? email_idoso.trim() : '';
    const senha = typeof senha_idoso === 'string' ? senha_idoso : '';

    if (!nome || !email || !senha) {
      return NextResponse.json(
        { success: false, message: 'Campos obrigatórios: nome_idoso, email_idoso, senha_idoso.' },
        { status: 400, headers: corsHeaders }
      );
    }

    const supabaseAdmin = createAdminClient(supabaseUrl, serviceKey, {
      auth: { autoRefreshToken: false, persistSession: false },
    });

    // Autentica o usuário familiar a partir do token
    const { data: familiarData, error: familiarErr } = await supabaseAdmin.auth.getUser(token);
    if (familiarErr || !familiarData?.user) {
      return NextResponse.json(
        { success: false, message: 'Usuário não autenticado.' },
        { status: 401, headers: corsHeaders }
      );
    }
    const familiarUser = familiarData.user;

    // Verificação opcional: garantir que seja um familiar
    const { data: perfilFam, error: perfilErr } = await supabaseAdmin
      .from('perfis')
      .select('tipo')
      .eq('user_id', familiarUser.id)
      .single();

    if (perfilErr) {
      return NextResponse.json(
        { success: false, message: `Falha ao verificar perfil do usuário: ${perfilErr.message}` },
        { status: 500, headers: corsHeaders }
      );
    }

    if (!perfilFam || perfilFam.tipo !== 'familiar') {
      return NextResponse.json(
        { success: false, message: 'Apenas usuários do tipo "familiar" podem criar e vincular idosos.' },
        { status: 403, headers: corsHeaders }
      );
    }

    // Cria conta do idoso no Auth (confirmada)
    const { data: newUser, error: createError } = await supabaseAdmin.auth.admin.createUser({
      email: email,
      password: senha,
      user_metadata: {
        nome: nome,
        tipo: 'idoso',
        display_name: nome,
      },
      email_confirm: true,
    });

    if (createError || !newUser?.user) {
      return NextResponse.json(
        { success: false, message: `Erro ao criar usuário do idoso: ${createError?.message || 'Desconhecido'}` },
        { status: 500, headers: corsHeaders }
      );
    }

    const idosoUser = newUser.user;

    // Cria/atualiza o perfil do idoso em 'perfis' para garantir exibição do nome na listagem
    // Usa upsert para evitar erro de chave duplicada caso já exista registro (ex.: triggers/seed)
    const { error: perfilInsertError } = await supabaseAdmin
      .from('perfis')
      .upsert({
        id: idosoUser.id,
        user_id: idosoUser.id,
        nome: nome,
        tipo: 'idoso',
      }, { onConflict: 'id' });

    if (perfilInsertError) {
      try {
        await supabaseAdmin.auth.admin.deleteUser(idosoUser.id);
      } catch {}
      return NextResponse.json(
        { success: false, message: `Erro ao criar perfil do idoso: ${perfilInsertError.message}` },
        { status: 500, headers: corsHeaders }
      );
    }

    // Insere o vínculo familiar
    const { error: linkError } = await supabaseAdmin
      .from('vinculos_familiares')
      .insert({
        id_familiar: familiarUser.id,
        id_idoso: idosoUser.id,
      });

    if (linkError) {
      // Opcional: rollback - desativar/deletar usuário criado
      try {
        await supabaseAdmin.auth.admin.deleteUser(idosoUser.id);
      } catch {}

      return NextResponse.json(
        { success: false, message: `Erro ao criar vínculo: ${linkError.message}` },
        { status: 500, headers: corsHeaders }
      );
    }

    return NextResponse.json(
      { success: true, message: 'Usuário idoso criado e vinculado com sucesso!', user_idoso_id: idosoUser.id },
      { status: 201, headers: corsHeaders }
    );
  } catch (error: unknown) {
    const message = error instanceof Error ? error.message : 'Erro interno do servidor';
    return NextResponse.json(
      { success: false, message },
      { status: 500, headers: corsHeaders }
    );
  }
}

================
File: src/app/api/historico_eventos/[id]/route.ts
================
import { NextResponse } from 'next/server';
import { createClient } from '@/lib/supabase/server';

const corsHeaders = {
  'Access-Control-Allow-Origin': 'https://caremind.online',
  'Vary': 'Origin',
  'Access-Control-Allow-Methods': 'GET, PATCH, OPTIONS',
  'Access-Control-Allow-Headers': 'Content-Type, Authorization',
};

export async function OPTIONS() {
  return new NextResponse(null, { status: 204, headers: corsHeaders });
}

export async function PATCH(request: Request, context: { params: { id: string } }) {
  const authHeader = request.headers.get('authorization');
  const token = authHeader?.startsWith('Bearer ')
    ? authHeader.slice('Bearer '.length)
    : undefined;
  const supabase = await createClient(token);

  try {
    const { id } = context.params;
    if (!id) {
      return NextResponse.json({ erro: 'ID do evento não fornecido' }, { status: 400, headers: corsHeaders });
    }

    const body = await request.json();
    const { status: novoStatus } = body || {};
    if (!novoStatus) {
      return NextResponse.json({ erro: "Campo 'status' é obrigatório" }, { status: 400, headers: corsHeaders });
    }

    let user = null as null | { id: string };
    if (token) {
      const { data } = await supabase.auth.getUser(token);
      user = data?.user ?? null;
    } else {
      const { data } = await supabase.auth.getUser();
      user = data.user ?? null;
    }

    if (!user) {
      return NextResponse.json({ erro: 'Usuário não autenticado' }, { status: 401, headers: corsHeaders });
    }

    const { data: evento, error: fetchErr } = await supabase
      .from('historico_eventos')
      .select('id, perfil_id')
      .eq('id', id)
      .maybeSingle();

    if (fetchErr) throw fetchErr;
    if (!evento) {
      return NextResponse.json({ erro: 'Evento não encontrado' }, { status: 404, headers: corsHeaders });
    }

    let allowed = evento.perfil_id === user.id;
    if (!allowed) {
      const { data: vinc, error: vincErr } = await supabase
        .from('vinculos_familiares')
        .select('id_idoso')
        .eq('id_familiar', user.id)
        .eq('id_idoso', evento.perfil_id)
        .maybeSingle();
      if (vincErr) throw vincErr;
      allowed = Boolean(vinc);
    }

    if (!allowed) {
      return NextResponse.json({ erro: 'Proibido' }, { status: 403, headers: corsHeaders });
    }

    const setConfirm = novoStatus === 'confirmado' ? new Date().toISOString() : null;

    const { data: updated, error: updErr } = await supabase
      .from('historico_eventos')
      .update({ status: novoStatus, horario_confirmacao: setConfirm })
      .eq('id', id)
      .eq('perfil_id', evento.perfil_id)
      .select()
      .single();

    if (updErr) throw updErr;

    return NextResponse.json(updated, { headers: corsHeaders });
  } catch (error: unknown) {
    const message = error instanceof Error ? error.message : 'Falha ao atualizar evento';
    return NextResponse.json({ erro: message }, { status: 500, headers: corsHeaders });
  }
}

================
File: src/app/api/medicamentos/[id]/route.ts
================
import { NextRequest, NextResponse } from 'next/server';
import { createServerClient, type CookieOptions } from '@supabase/ssr';
import { cookies } from 'next/headers';
import type { Session } from '@supabase/supabase-js';

const corsHeaders = {
    'Access-Control-Allow-Origin': 'https://caremind.online',
    'Vary': 'Origin',
    'Access-Control-Allow-Methods': 'GET, POST, PUT, PATCH, DELETE, OPTIONS',
    'Access-Control-Allow-Headers': 'Content-Type, Authorization',
};

export async function OPTIONS() {
    return new NextResponse(null, {
        status: 204,
        headers: corsHeaders,
    });
}

export async function PATCH(
    request: NextRequest,
    context: { params: { id: string } }
) {
    try {
                const cookieStore = await cookies();
        
        // Create Supabase client with cookie handling
        const supabase = createServerClient(
            process.env.NEXT_PUBLIC_SUPABASE_URL!,
            process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
            {
                cookies: {
                    get(name: string) {
                        return cookieStore.get(name)?.value;
                    },
                    set(name: string, value: string, options: CookieOptions) {
                        cookieStore.set({ name, value, ...options });
                    },
                    remove(name: string, options: CookieOptions) {
                        cookieStore.set({ name, value: '', ...options });
                    },
                },
            }
        );

        // Debug: log cookie names in dev
        if (process.env.NODE_ENV !== 'production') {
            const cookieStore = await cookies();
            const allCookies = cookieStore.getAll();
            const authCookie = cookieStore.get('sb-njxsuqvqaeesxmoajzyb-auth-token');
            console.debug('[medicamentos PATCH] incoming cookies:', allCookies.map(c => c.name));
            console.debug('[medicamentos PATCH] auth cookie present:', !!authCookie);
            if (authCookie) {
                console.debug('[medicamentos PATCH] auth cookie value length:', authCookie.value?.length ?? 0);
            }
        }
        
        // Verificar autenticação
        let { data: { session } } = await supabase.auth.getSession();
        
        // Se não houver sessão via cookie, tenta pelo header Authorization
        if (!session) {
            const authHeader = request.headers.get('Authorization');
            if (authHeader?.startsWith('Bearer ')) {
                const accessToken = authHeader.split(' ')[1];
                const { data: { user }, error } = await supabase.auth.getUser(accessToken);
                if (user && !error) {
                    session = { user, access_token: accessToken } as Session;
                }
            }
        }

        if (!session) {
            return NextResponse.json(
                { error: 'Não autorizado' },
                { status: 401, headers: corsHeaders }
            );
        }

        // `context.params` is an async proxy in Next.js route handlers — await it
        // before accessing properties to avoid the sync-dynamic-apis error.
        const params = await context.params;
        const id = params?.id;
        if (!id) {
            return NextResponse.json(
                { error: 'ID não fornecido' },
                { status: 400, headers: corsHeaders }
            );
        }

        const body = await request.json();

        // Garantir que o medicamento pertence ao usuário atual
        const { data: medicamento, error: checkError } = await supabase
            .from('medicamentos')
            .select()
            .eq('id', id)
            .eq('user_id', session.user.id)
            .single();

        if (checkError || !medicamento) {
            return NextResponse.json(
                { error: 'Medicamento não encontrado ou acesso não autorizado' },
                { status: 404, headers: corsHeaders }
            );
        }

        // Atualizar o medicamento
        const { data, error } = await supabase
            .from('medicamentos')
            .update(body)
            .eq('id', id)
            .eq('user_id', session.user.id)
            .select()
            .single();

        if (error) {
            return NextResponse.json(
                { error: error.message },
                { status: 400, headers: corsHeaders }
            );
        }

        return NextResponse.json(data, { 
            headers: corsHeaders 
        });

    } catch (error) {
        console.error('Erro ao atualizar medicamento:', error);
        return NextResponse.json(
            { error: 'Erro interno do servidor' },
            { status: 500, headers: corsHeaders }
        );
    }
}

export async function DELETE(
    request: NextRequest,
    context: { params: { id: string } }
) {
    try {
        // Debug: log cookie names in dev
        if (process.env.NODE_ENV !== 'production') {
            const cookieStore = await cookies();
            const allCookies = cookieStore.getAll();
            const authCookie = cookieStore.get('sb-njxsuqvqaeesxmoajzyb-auth-token');
            console.debug('[medicamentos DELETE] incoming cookies:', allCookies.map(c => c.name));
            console.debug('[medicamentos DELETE] auth cookie present:', !!authCookie);
            if (authCookie) {
                console.debug('[medicamentos DELETE] auth cookie value length:', authCookie.value?.length ?? 0);
            }
        }

        const cookieStore = await cookies();
        
        // Create Supabase client with cookie handling
        const supabase = createServerClient(
            process.env.NEXT_PUBLIC_SUPABASE_URL!,
            process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
            {
                cookies: {
                    get(name: string) {
                        return cookieStore.get(name)?.value;
                    },
                    set(name: string, value: string, options: CookieOptions) {
                        cookieStore.set({ name, value, ...options });
                    },
                    remove(name: string, options: CookieOptions) {
                        cookieStore.set({ name, value: '', ...options });
                    },
                },
            }
        );
        
        // Verificar autenticação e tentar recuperar via Authorization header se necessário
        let { data: { session } } = await supabase.auth.getSession();
        
        if (!session) {
            const authHeader = request.headers.get('Authorization');
            if (authHeader?.startsWith('Bearer ')) {
                const accessToken = authHeader.split(' ')[1];
                const { data: { user }, error } = await supabase.auth.getUser(accessToken);
                if (user && !error) {
                    session = { user, access_token: accessToken } as Session;
                    if (process.env.NODE_ENV !== 'production') {
                        console.debug('[medicamentos DELETE] recovered session from Authorization header');
                    }
                }
            }
        }
        if (!session) {
            return NextResponse.json(
                { error: 'Não autorizado' },
                { status: 401, headers: corsHeaders }
            );
        }

        // `context.params` is an async proxy in Next.js route handlers — await it
        // before accessing properties to avoid the sync-dynamic-apis error.
        const params = await context.params;
        const id = params?.id;
        if (!id) {
            return NextResponse.json(
                { error: 'ID não fornecido' },
                { status: 400, headers: corsHeaders }
            );
        }

        const { error } = await supabase
            .from('medicamentos')
            .delete()
            .eq('id', id)
            .eq('user_id', session.user.id)
            .select()
            .single();

        if (error) {
            return NextResponse.json(
                { error: error.message },
                { status: 400, headers: corsHeaders }
            );
        }

        return new NextResponse(null, { 
            status: 204, 
            headers: corsHeaders 
        });

    } catch (error) {
        console.error('Erro ao excluir medicamento:', error);
        return NextResponse.json(
            { error: 'Erro interno do servidor' },
            { status: 500, headers: corsHeaders }
        );
    }
}

================
File: src/app/api/medicamentos/route.ts
================
import { NextResponse } from 'next/server';
import { createClient } from '@/lib/supabase/server';

const corsHeaders = {
  'Access-Control-Allow-Origin': 'https://caremind.online',
  'Vary': 'Origin',
  'Access-Control-Allow-Methods': 'GET, POST, PUT, PATCH, DELETE, OPTIONS',
  'Access-Control-Allow-Headers': 'Content-Type, Authorization',
};

export async function OPTIONS() {
  return new NextResponse(null, {
    status: 204,
    headers: corsHeaders,
  });
}

// ================================================================= //
// FUNÇÃO GET - Buscar Medicamentos (Corrigida)
// ================================================================= //
export async function GET(request: Request) {
  const authHeader = request.headers.get('authorization');
  const token = authHeader?.startsWith('Bearer ')
    ? authHeader.slice('Bearer '.length)
    : undefined;
  const supabase = await createClient(token);

  try {
    let user = null as null | { id: string };
    if (token) {
      const { data } = await supabase.auth.getUser(token);
      user = data?.user ?? null;
    } else {
      const { data } = await supabase.auth.getUser();
      user = data.user ?? null;
    }

    if (!user) {
      return NextResponse.json(
        { erro: 'Usuário não autenticado' },
        { status: 401, headers: corsHeaders }
      );
    }

    const url = new URL(request.url);
    const idosoId = url.searchParams.get('idoso_id') ?? undefined;

    let targetUserId = user.id;
    if (idosoId && idosoId !== user.id) {
      const { data: vinc, error: vincErr } = await supabase
        .from('vinculos_familiares')
        .select('id_idoso')
        .eq('id_familiar', user.id)
        .eq('id_idoso', idosoId);

      if (vincErr) throw vincErr;
      const autorizado = (vinc ?? []).length > 0;
      if (!autorizado) {
        return NextResponse.json(
          { erro: 'Acesso não autorizado ao idoso selecionado' },
          { status: 403, headers: corsHeaders }
        );
      }
      targetUserId = idosoId;
    } else if (idosoId === user.id) {
      targetUserId = user.id;
    }

    const { data: medicamentos, error } = await supabase
      .from('medicamentos')
      .select('*')
      .eq('user_id', targetUserId)
      .order('created_at', { ascending: false });

    if (error) throw error;

    const out = (medicamentos ?? []).map((m) => ({
      ...m,
      concluido: Boolean(m.concluido),
      data_agendada: m.data_agendada ?? null,
    }));

    return NextResponse.json(out, { headers: corsHeaders });

  } catch (error: unknown) {
    let errorMessage = 'Falha ao buscar medicamentos.';
    if (error instanceof Error) {
      errorMessage = error.message;
    }
    console.error('Erro em GET /api/medicamentos:', errorMessage);
    return NextResponse.json(
      { erro: errorMessage },
      { status: 500, headers: corsHeaders }
    );
  }
}

// ================================================================= //
// FUNÇÃO POST - Criar Novo Medicamento (Corrigida)
// ================================================================= //
export async function POST(request: Request) {
  const authHeader = request.headers.get('authorization');
  const token = authHeader?.startsWith('Bearer ')
    ? authHeader.slice('Bearer '.length)
    : undefined;
  const supabase = await createClient(token);

  try {
    let user = null as null | { id: string };
    if (token) {
      const { data } = await supabase.auth.getUser(token);
      user = data?.user ?? null;
    } else {
      const { data } = await supabase.auth.getUser();
      user = data.user ?? null;
    }

    if (!user) {
      return NextResponse.json(
        { erro: 'Usuário não autenticado' },
        { status: 401, headers: corsHeaders }
      );
    }

    const body = await request.json();
    const {
      nome,
      dosagem,
      frequencia,
      quantidade,
      user_id: bodyUserId,
    } = body;

    // CORREÇÃO: Validação alterada para o campo 'nome', que é essencial
    if (!nome?.trim()) {
      return NextResponse.json(
        { erro: "O campo 'nome' é obrigatório." }, 
        { status: 400, headers: corsHeaders }
      );
    }

    let targetUserId = user.id;
    if (bodyUserId && bodyUserId !== user.id) {
      const { data: vinc, error: vincErr } = await supabase
        .from('vinculos_familiares')
        .select('id_idoso')
        .eq('id_familiar', user.id)
        .eq('id_idoso', bodyUserId);
      if (vincErr) throw vincErr;
      const autorizado = (vinc ?? []).length > 0;
      if (!autorizado) {
        return NextResponse.json(
          { erro: 'Acesso não autorizado ao idoso selecionado' },
          { status: 403, headers: corsHeaders }
        );
      }
      targetUserId = bodyUserId;
    }

    const { data, error } = await supabase
      .from('medicamentos')
      .insert([{
        nome,
        dosagem, 
        frequencia,
        quantidade,
        user_id: targetUserId,
      }])
      .select()
      .single();

    if (error) throw error;

    return NextResponse.json(data, { status: 201, headers: corsHeaders });

  } catch (error: unknown) { 
    let errorMessage = 'Falha ao criar medicamento.';
    if (error instanceof Error) {
      errorMessage = error.message;
    }
    console.error('Erro em POST /api/medicamentos:', errorMessage);
    return NextResponse.json(
      { erro: errorMessage },
      { status: 500, headers: corsHeaders }
    );
  }
}

================
File: src/app/api/perfil/[id]/route.ts
================
import { NextResponse, NextRequest } from 'next/server';
import { createClient } from '@/lib/supabase/server';

const corsHeaders = {
  'Access-Control-Allow-Origin': 'https://caremind.online',
  'Vary': 'Origin',
  'Access-Control-Allow-Methods': 'GET, POST, PUT, PATCH, DELETE, OPTIONS',
  'Access-Control-Allow-Headers': 'Content-Type, Authorization',
};

export async function OPTIONS() {
  return new NextResponse(null, {
    status: 204,
    headers: corsHeaders,
  });
}

// ================================================================= //
// PUT - Atualizar perfil (nome, telefone, data_nascimento, foto_usuario)
// ================================================================= //
export async function PUT(request: NextRequest, context: { params: Promise<{ id: string }> }) {
  try {
    const supabase = await createClient();

    // 1. Verifica se o usuário está autenticado
    const { data: { user }, error: authError } = await supabase.auth.getUser();
    if (authError || !user) {
      return NextResponse.json({ error: 'Usuário não autenticado' }, { status: 401 });
    }

    const { id } = await context.params;
    if (!id) {
      return NextResponse.json({ error: 'ID do perfil não fornecido.' }, { status: 400 });
    }

    // 2. Extrai os dados do corpo da requisição (todos opcionais)
    const body = await request.json();
    const {
      fullName,
      phone,
      dob,
      foto_usuario,
    }: { fullName?: string; phone?: string; dob?: string; foto_usuario?: string } = body || {};

    const updatePayload: Record<string, any> = {};
    if (typeof fullName === 'string') updatePayload.nome = fullName;
    if (typeof phone === 'string') updatePayload.telefone = phone;
    if (typeof dob === 'string') updatePayload.data_nascimento = dob;
    if (typeof foto_usuario === 'string') updatePayload.foto_usuario = foto_usuario;
    if (Object.keys(updatePayload).length === 0) {
      return NextResponse.json({ error: 'Nenhum campo para atualizar.' }, { status: 400 });
    }

    // 3. Atualiza o registro que pertence ao usuário atual
    const { data: updated, error: updateError } = await supabase
      .from('perfis')
      .update(updatePayload)
      .eq('id', id)
      .eq('user_id', user.id) // garante que só atualiza o próprio perfil
      .select('id, nome, foto_usuario, telefone, data_nascimento')
      .single();

    if (updateError) {
      console.error('Erro do Supabase ao atualizar o perfil:', updateError);
      return NextResponse.json({ error: 'Não foi possível atualizar o perfil.' }, { status: 500 });
    }
    return NextResponse.json(updated, { status: 200 });
  } catch (error) {
    console.error('Erro inesperado na API de Perfis:', error);
    return NextResponse.json({ error: 'Erro interno do servidor.' }, { status: 500 });
  }
}
// ================================================================= //
// DELETE - Excluir uma tarefa
// ================================================================= //
export async function DELETE(request: Request, context: { params: Promise<{ id: string }> }) {
  const supabase = await createClient();

  try {
    // Support Bearer token as well as cookie session
    const authHeader = request.headers.get('authorization');
    const token = authHeader?.startsWith('Bearer ')
      ? authHeader.slice('Bearer '.length)
      : undefined;

    let user = null as null | { id: string };
    if (token) {
      const { data, error: userErr } = await supabase.auth.getUser(token);
      if (userErr) {
        console.error('Supabase getUser(token) error:', userErr.message);
      }
      user = data?.user ?? null;
    } else {
      const { data } = await supabase.auth.getUser();
      user = data.user ?? null;
    }

    if (!user) {
      return NextResponse.json(
        { erro: 'Usuário não autenticado' },
        { status: 401, headers: corsHeaders }
      );
    }

    const { id } = await context.params;

    if (!id) {
      return NextResponse.json(
        { erro: 'ID do perfil não fornecido.' },
        { status: 400, headers: corsHeaders }
      );
    }

    const { data, error } = await supabase
      .from('perfis')
      .delete()
      .eq('id', id)
      .eq('user_id', user.id)
      .select();

    if (error) throw error;

    // Se nada foi retornado, significa que o item não existia ou não pertencia ao usuário.
    if (!data || data.length === 0) {
      return NextResponse.json(
        { erro: `Perfil com ID ${id} não encontrado ou não pertence ao usuário.` },
        { status: 404, headers: corsHeaders }
      );
    }

    // Retorna 204 No Content, que é o padrão para um DELETE bem-sucedido
    return new NextResponse(null, { status: 204, headers: corsHeaders });

  } catch (error: unknown) {
    let errorMessage = 'Falha ao processar a exclusão.';
    if (error instanceof Error) {
      errorMessage = error.message;
    }
    console.error('Erro em DELETE /api/perfil/[id]:', errorMessage);

    return NextResponse.json(
      { erro: errorMessage },
      { status: 500, headers: corsHeaders }
    );
  }
}

================
File: src/app/api/perfil/route.ts
================
import { NextResponse } from 'next/server';
import { createClient } from '@/lib/supabase/server';

const corsHeaders = {
  'Access-Control-Allow-Origin': 'https://caremind.online',
  'Vary': 'Origin',
  'Access-Control-Allow-Methods': 'GET, POST, PUT, PATCH, DELETE, OPTIONS',
  'Access-Control-Allow-Headers': 'Content-Type, Authorization',
};

export async function OPTIONS() {
  return new NextResponse(null, {
    status: 204,
    headers: corsHeaders,
  });
}

export async function GET(request: Request) {
  const authHeader = request.headers.get('authorization');
  const token = authHeader?.startsWith('Bearer ')
    ? authHeader.slice('Bearer '.length)
    : undefined;
  const supabase = await createClient(token);

  try {
    let user = null as null | { id: string };
    if (token) {
      const { data } = await supabase.auth.getUser(token);
      user = data?.user ?? null;
    } else {
      const { data } = await supabase.auth.getUser();
      user = data.user ?? null;
    }

    if (!user) {
      return NextResponse.json(
        { erro: 'Usuário não autenticado' },
        { status: 401, headers: corsHeaders }
      );
    }

    const { data: perfil, error } = await supabase
      .from('perfis')
      .select('id, user_id, nome, foto_usuario, telefone, data_nascimento, tipo, codigo_vinculacao')
      .eq('user_id', user.id)
      .maybeSingle();

    if (error) throw error;

    if (!perfil) {
      return new NextResponse(null, { status: 204, headers: corsHeaders });
    }

    return NextResponse.json(perfil, { headers: corsHeaders });

  } catch (error: unknown) {
    let errorMessage = 'Falha ao buscar perfil.';
    if (error instanceof Error) {
      errorMessage = error.message;
    }
    console.error('Erro em GET /api/perfil:', errorMessage);
    return NextResponse.json(
      { erro: errorMessage },
      { status: 500, headers: corsHeaders }
    );
  }
}

// ================================================================= //
// FUNÇÃO POST - Criar Novo Perfil (Corrigida)
// ================================================================= //
export async function POST(request: Request) {
  const authHeader = request.headers.get('authorization');
  const token = authHeader?.startsWith('Bearer ')
    ? authHeader.slice('Bearer '.length)
    : undefined;
  const supabase = await createClient(token);

  try {
    let user = null as null | { id: string };
    if (token) {
      const { data } = await supabase.auth.getUser(token);
      user = data?.user ?? null;
    } else {
      const { data } = await supabase.auth.getUser();
      user = data.user ?? null;
    }

    if (!user) {
      return NextResponse.json(
        { erro: 'Usuário não autenticado' },
        { status: 401, headers: corsHeaders }
      );
    }

    const body = await request.json();
    
    const { 
        nome, 
        tipo,
        codigo_vinculacao,
        foto_usuario
    } = body;

    // CORREÇÃO: Validação alterada para o campo 'nome', que é essencial
    if (!nome?.trim()) {
      return NextResponse.json(
        { erro: "O campo 'nome' é obrigatório." }, 
        { status: 400, headers: corsHeaders }
      );
    }

    // CORREÇÃO: Insert ajustado para conter apenas as colunas que existem na tabela 'medicamentos'
    const { data, error } = await supabase
      .from('perfis')
      .insert([{
        nome, 
        tipo,
        codigo_vinculacao,
        foto_usuario,
        id: user.id,
        user_id: user.id,
      }])
      .select()
      .single();

    if (error) throw error;

    return NextResponse.json(data, { status: 201, headers: corsHeaders });

  } catch (error: unknown) { 
    let errorMessage = 'Falha ao criar perfil.';
    if (error instanceof Error) {
      errorMessage = error.message;
    }
    console.error('Erro em POST /api/perfil:', errorMessage);
    return NextResponse.json(
      { erro: errorMessage },
      { status: 500, headers: corsHeaders }
    );
  }
}

================
File: src/app/api/relatorios/historico/route.ts
================
import { NextResponse } from 'next/server';
import { createClient } from '@/lib/supabase/server';

const corsHeaders = {
  'Access-Control-Allow-Origin': 'https://caremind.online',
  'Vary': 'Origin',
  'Access-Control-Allow-Methods': 'GET, OPTIONS',
  'Access-Control-Allow-Headers': 'Content-Type, Authorization',
};

export async function OPTIONS() {
  return new NextResponse(null, { status: 204, headers: corsHeaders });
}

export async function GET(request: Request) {
  const authHeader = request.headers.get('authorization');
  const token = authHeader?.startsWith('Bearer ')
    ? authHeader.slice('Bearer '.length)
    : undefined;
  const supabase = await createClient(token);

  try {
    const url = new URL(request.url);
    const idosoId = url.searchParams.get('idoso_id');
    const dataInicio = url.searchParams.get('dataInicio');
    const dataFim = url.searchParams.get('dataFim');
    const tipoEvento = url.searchParams.get('tipoEvento');

    let user = null as null | { id: string };
    if (token) {
      const { data } = await supabase.auth.getUser(token);
      user = data?.user ?? null;
    } else {
      const { data } = await supabase.auth.getUser();
      user = data.user ?? null;
    }

    if (!user) {
      return NextResponse.json(
        { erro: 'Usuário não autenticado' },
        { status: 401, headers: corsHeaders }
      );
    }

    let effectiveUserId = user.id;

    if (idosoId && idosoId !== user.id) {
      const { data: vinc, error: vincErr } = await supabase
        .from('vinculos_familiares')
        .select('id_idoso')
        .eq('id_familiar', user.id)
        .eq('id_idoso', idosoId)
        .maybeSingle();
      if (vincErr) throw vincErr;
      if (!vinc) {
        return NextResponse.json(
          { erro: 'Proibido' },
          { status: 403, headers: corsHeaders }
        );
      }
      effectiveUserId = idosoId;
    }

    let query = supabase
      .from('historico_eventos')
      .select('*')
      .eq('perfil_id', effectiveUserId)
      .order('data_prevista', { ascending: false });

    if (dataInicio) {
      // Considerar início do dia em UTC
      query = query.gte('data_prevista', `${dataInicio}T00:00:00Z`);
    }
    if (dataFim) {
      // Considerar fim do dia em UTC
      query = query.lte('data_prevista', `${dataFim}T23:59:59Z`);
    }
    if (tipoEvento && tipoEvento !== 'Todos') {
      // Espera-se valores conforme armazenados: 'Medicamento' | 'Rotina'
      query = query.eq('tipo_evento', tipoEvento);
    }

    const { data: historico, error: historicoError } = await query;

    if (historicoError) throw historicoError;

    return NextResponse.json(historico ?? [], { headers: corsHeaders });
  } catch (error: unknown) {
    const message = error instanceof Error ? error.message : 'Falha ao obter histórico';
    return NextResponse.json(
      { erro: message },
      { status: 500, headers: corsHeaders }
    );
  }
}

================
File: src/app/api/rotinas/[id]/route.ts
================
// app/api/rotinas/[id]/route.ts

import { NextResponse } from 'next/server';
import { createClient } from '@/lib/supabase/server';
import { NextRequest } from 'next/server';

const corsHeaders = {
  'Access-Control-Allow-Origin': 'https://caremind.online',
  'Vary': 'Origin',
  'Access-Control-Allow-Methods': 'GET, POST, PUT, PATCH, DELETE, OPTIONS',
  'Access-Control-Allow-Headers': 'Content-Type, Authorization',
};

export async function OPTIONS() {
  return new NextResponse(null, {
    status: 204,
    headers: corsHeaders,
  });
}

// ================================================================= //
// FUNÇÃO PATCH - Atualizar uma Rotina existente
// ================================================================= //
export async function PATCH(request: NextRequest, { params }: { params: { id: string } }) {
  const { id } = await params;
  const authHeader = request.headers.get('authorization');
  const token = authHeader?.startsWith('Bearer ')
    ? authHeader.slice('Bearer '.length)
    : undefined;
  const supabase = await createClient(token);

  try {
    const { data: { user } } = await supabase.auth.getUser(token);

    if (!user) {
      return NextResponse.json(
        { erro: 'Usuário não autenticado' },
        { status: 401, headers: corsHeaders }
      );
    }
    
    // Pega os dados que serão atualizados do corpo da requisição
    // Ex: { "concluido": true } ou { "titulo": "Novo Título" }
    const body = await request.json();

    const { data: rotina, error } = await supabase
      .from('rotinas')
      .update(body)
      .eq('id', id)
      .eq('user_id', user.id) // Garante que o usuário só pode atualizar sua própria rotina
      .select()
      .single();

    if (error) {
      if (error.code === 'PGRST116') { // Código para "nenhuma linha encontrada"
        return NextResponse.json(
          { erro: 'Rotina não encontrada ou pertence a outro usuário.' },
          { status: 404, headers: corsHeaders }
        );
      }
      throw error;
    }

    return NextResponse.json(rotina, { headers: corsHeaders });

  } catch (error: unknown) {
    let errorMessage = 'Falha ao atualizar rotina.';
    if (error instanceof Error) {
      errorMessage = error.message;
    }
    console.error(`Erro em PATCH /api/rotinas/${id}:`, errorMessage);
    return NextResponse.json(
      { erro: errorMessage },
      { status: 500, headers: corsHeaders }
    );
  }
}

// ================================================================= //
// FUNÇÃO DELETE - Deletar uma Rotina existente
// ================================================================= //
export async function DELETE(request: NextRequest, { params }: { params: { id: string } }) {
  const { id } = await params;
  const authHeader = request.headers.get('authorization');
  const token = authHeader?.startsWith('Bearer ')
    ? authHeader.slice('Bearer '.length)
    : undefined;
  const supabase = await createClient(token);

  try {
    const { data: { user } } = await supabase.auth.getUser(token);
    
    if (!user) {
      return NextResponse.json(
        { erro: 'Usuário não autenticado' },
        { status: 401, headers: corsHeaders }
      );
    }
    
    const { error } = await supabase
      .from('rotinas')
      .delete()
      .eq('id', id)
      .eq('user_id', user.id); // Garante que o usuário só pode deletar sua própria rotina

    if (error) throw error;
    
    // Retorna uma resposta de sucesso sem conteúdo
    return new NextResponse(null, { status: 204, headers: corsHeaders });

  } catch (error: unknown) {
    let errorMessage = 'Falha ao deletar rotina.';
    if (error instanceof Error) {
      errorMessage = error.message;
    }
    console.error(`Erro em DELETE /api/rotinas/${id}:`, errorMessage);
    return NextResponse.json(
      { erro: errorMessage },
      { status: 500, headers: corsHeaders }
    );
  }
}

================
File: src/app/api/rotinas/route.ts
================
// app/api/rotinas/route.ts

import { NextResponse } from 'next/server';
import { createClient } from '@/lib/supabase/server';

const corsHeaders = {
  'Access-Control-Allow-Origin': 'https://caremind.online',
  'Vary': 'Origin',
  'Access-Control-Allow-Methods': 'GET, POST, PUT, PATCH, DELETE, OPTIONS',
  'Access-Control-Allow-Headers': 'Content-Type, Authorization',
};

export async function OPTIONS() {
  return new NextResponse(null, {
    status: 204,
    headers: corsHeaders,
  });
}

// ================================================================= //
// FUNÇÃO GET - Buscar Rotinas
// ================================================================= //
export async function GET(request: Request) {
  const authHeader = request.headers.get('authorization');
  const token = authHeader?.startsWith('Bearer ')
    ? authHeader.slice('Bearer '.length)
    : undefined;
  const supabase = await createClient(token);

  try {
    let user = null as null | { id: string };
    if (token) {
      const { data, error: userErr } = await supabase.auth.getUser(token);
      if (userErr) {
        console.error('Supabase getUser(token) error:', userErr.message);
      }
      user = data?.user ?? null;
    } else {
      const { data } = await supabase.auth.getUser();
      user = data.user ?? null;
    }

    if (!user) {
      return NextResponse.json(
        { erro: 'Usuário não autenticado' },
        { status: 401, headers: corsHeaders }
      );
    }

    const url = new URL(request.url);
    const idosoId = url.searchParams.get('idoso_id') ?? undefined;

    let targetUserId = user.id;
    if (idosoId && idosoId !== user.id) {
      const { data: vinc, error: vincErr } = await supabase
        .from('vinculos_familiares')
        .select('id_idoso')
        .eq('id_familiar', user.id)
        .eq('id_idoso', idosoId);

      if (vincErr) throw vincErr;
      const autorizado = (vinc ?? []).length > 0;
      if (!autorizado) {
        return NextResponse.json(
          { erro: 'Acesso não autorizado ao idoso selecionado' },
          { status: 403, headers: corsHeaders }
        );
      }
      targetUserId = idosoId;
    } else if (idosoId === user.id) {
      targetUserId = user.id;
    }

    const { data: rotinas, error } = await supabase
      .from('rotinas')
      .select('*')
      .eq('user_id', targetUserId)
      .order('created_at', { ascending: true });

    if (error) throw error;

    const out = (rotinas ?? []).map((r) => ({
      ...r,
      concluido: Boolean(r.concluido),
      data_agendada: (r as any).data ?? null,
    }));

    return NextResponse.json(out, { headers: corsHeaders });

  } catch (error: unknown) {
    let errorMessage = 'Falha ao buscar rotinas.';
    if (error instanceof Error) {
      errorMessage = error.message;
    }
    console.error('Erro em GET /api/rotinas:', errorMessage);
    return NextResponse.json(
      { erro: errorMessage },
      { status: 500, headers: corsHeaders }
    );
  }
}

// ================================================================= //
// FUNÇÃO POST - Criar Nova Rotina com Frequência
// ================================================================= //
export async function POST(request: Request) {
  const authHeader = request.headers.get('authorization');
  const token = authHeader?.startsWith('Bearer ')
    ? authHeader.slice('Bearer '.length)
    : undefined;
  const supabase = await createClient(token);

  try {
    let user = null as null | { id: string };
    if (token) {
      const { data, error: userErr } = await supabase.auth.getUser(token);
      if (userErr) {
        console.error('Supabase getUser(token) error:', userErr.message);
      }
      user = data?.user ?? null;
    } else {
      const { data } = await supabase.auth.getUser();
      user = data.user ?? null;
    }

    if (!user) {
      return NextResponse.json(
        { erro: 'Usuário não autenticado' },
        { status: 401, headers: corsHeaders }
      );
    }

    const body = await request.json();
    const {
      titulo,
      descricao,
      frequencia,
      concluido = false,
      user_id: bodyUserId,
    } = body;

    // Validações
    if (!titulo || titulo.trim() === '') {
      return NextResponse.json({ erro: "O campo 'titulo' é obrigatório." }, { status: 400, headers: corsHeaders });
    }
    // A validação de 'data' foi removida. Pode-se adicionar uma validação para 'frequencia' se necessário.

    let targetUserId = user.id;
    if (bodyUserId && bodyUserId !== user.id) {
      const { data: vinc, error: vincErr } = await supabase
        .from('vinculos_familiares')
        .select('id_idoso')
        .eq('id_familiar', user.id)
        .eq('id_idoso', bodyUserId);
      if (vincErr) throw vincErr;
      const autorizado = (vinc ?? []).length > 0;
      if (!autorizado) {
        return NextResponse.json(
          { erro: 'Acesso não autorizado ao idoso selecionado' },
          { status: 403, headers: corsHeaders }
        );
      }
      targetUserId = bodyUserId;
    }

    const { data: novaRotina, error } = await supabase
      .from('rotinas')
      .insert([{
        titulo: titulo.trim(),
        descricao,
        frequencia,
        concluido,
        user_id: targetUserId
      }])
      .select()
      .single();

    if (error) throw error;

    return NextResponse.json(novaRotina, { status: 201, headers: corsHeaders });

  } catch (error: unknown) {
    let errorMessage = 'Falha ao criar rotina.';
    if (error instanceof Error) {
      errorMessage = error.message;
    }
    console.error('Erro em POST /api/rotinas:', errorMessage);
    return NextResponse.json(
      { erro: errorMessage },
      { status: 500, headers: corsHeaders }
    );
  }
}

================
File: src/app/api/vinculos/[id]/route.ts
================
import { NextResponse } from 'next/server';
import { createClient } from '@/lib/supabase/server';

const corsHeaders = {
  'Access-Control-Allow-Origin': 'https://caremind.online',
  'Vary': 'Origin',
  'Access-Control-Allow-Methods': 'GET, POST, PUT, PATCH, DELETE, OPTIONS',
  'Access-Control-Allow-Headers': 'Content-Type, Authorization',
};

export async function OPTIONS() {
  return new NextResponse(null, { status: 204, headers: corsHeaders });
}

export async function DELETE(request: Request, context: { params: { id: string } }) {
  const authHeader = request.headers.get('authorization');
  const token = authHeader?.startsWith('Bearer ')
    ? authHeader.slice('Bearer '.length)
    : undefined;
  const supabase = await createClient(token);

  try {
    let user = null as null | { id: string };
    if (token) {
      const { data } = await supabase.auth.getUser(token);
      user = data?.user ?? null;
    } else {
      const { data } = await supabase.auth.getUser();
      user = data.user ?? null;
    }

    if (!user) {
      return NextResponse.json(
        { erro: 'Usuário não autenticado' },
        { status: 401, headers: corsHeaders }
      );
    }

    const id_idoso = context.params.id;
    if (!id_idoso) {
      return NextResponse.json(
        { erro: 'Parâmetro id do idoso ausente.' },
        { status: 400, headers: corsHeaders }
      );
    }

    // Opcional: checar se o usuário é familiar
    const { data: perfilFam, error: perfilErr } = await supabase
      .from('perfis')
      .select('tipo')
      .eq('user_id', user.id)
      .single();

    if (perfilErr) {
      return NextResponse.json(
        { erro: `Falha ao verificar perfil do usuário: ${perfilErr.message}` },
        { status: 500, headers: corsHeaders }
      );
    }

    if (!perfilFam || perfilFam.tipo !== 'familiar') {
      return NextResponse.json(
        { erro: 'Apenas usuários do tipo "familiar" podem desvincular idosos.' },
        { status: 403, headers: corsHeaders }
      );
    }

    const { error: delErr } = await supabase
      .from('vinculos_familiares')
      .delete()
      .eq('id_familiar', user.id)
      .eq('id_idoso', id_idoso);

    if (delErr) {
      return NextResponse.json(
        { erro: `Erro ao remover vínculo: ${delErr.message}` },
        { status: 500, headers: corsHeaders }
      );
    }

    return NextResponse.json({ success: true }, { headers: corsHeaders });
  } catch (error: unknown) {
    const message = error instanceof Error ? error.message : 'Erro interno';
    return NextResponse.json({ erro: message }, { status: 500, headers: corsHeaders });
  }
}

================
File: src/app/api/vinculos/idosos/route.ts
================
import { NextResponse } from 'next/server';
import { createClient } from '@/lib/supabase/server';

const corsHeaders = {
  'Access-Control-Allow-Origin': 'https://caremind.online',
  'Vary': 'Origin',
  'Access-Control-Allow-Methods': 'GET, POST, PUT, PATCH, DELETE, OPTIONS',
  'Access-Control-Allow-Headers': 'Content-Type, Authorization',
};

export async function OPTIONS() {
  return new NextResponse(null, { status: 204, headers: corsHeaders });
}

export async function GET(request: Request) {
  const authHeader = request.headers.get('authorization');
  const token = authHeader?.startsWith('Bearer ')
    ? authHeader.slice('Bearer '.length)
    : undefined;
  const supabase = await createClient(token);

  try {
    let user = null as null | { id: string };
    if (token) {
      const { data } = await supabase.auth.getUser(token);
      user = data?.user ?? null;
    } else {
      const { data } = await supabase.auth.getUser();
      user = data.user ?? null;
    }

    if (!user) {
      return NextResponse.json(
        { erro: 'Usuário não autenticado' },
        { status: 401, headers: corsHeaders }
      );
    }

    const { data: vinculos, error: vincErr } = await supabase
      .from('vinculos_familiares')
      .select('id_idoso')
      .eq('id_familiar', user.id);

    if (vincErr) throw vincErr;

    const ids = (vinculos ?? []).map(v => v.id_idoso);
    if (ids.length === 0) {
      return NextResponse.json([], { headers: corsHeaders });
    }

    const { data: perfis, error: perfErr } = await supabase
      .from('perfis')
      .select('id, nome, foto_usuario')
      .in('id', ids);

    if (perfErr) throw perfErr;

    // Mapear saída padronizada
    const out = (perfis ?? []).map(p => ({
      id_idoso: p.id,
      nome: p.nome,
      foto_usuario: p.foto_usuario,
    }));

    return NextResponse.json(out, { headers: corsHeaders });
  } catch (error: unknown) {
    const message = error instanceof Error ? error.message : 'Falha ao listar vínculos';
    return NextResponse.json({ erro: message }, { status: 500, headers: corsHeaders });
  }
}

================
File: src/app/auth/AuthClient.tsx
================
'use client';

import { useState, useEffect } from 'react';
import { useAuth } from '@/contexts/AuthContext';
import { useSearchParams } from 'next/navigation';
import Link from 'next/link';
import { Button } from "@/components/ui/button";
import styles from './page.module.css';
import { useRouter } from 'next/navigation';  
import Image from 'next/image';

export default function AuthClient() {
  const searchParams = useSearchParams();
  const mode = searchParams?.get('mode');
  const [isLogin, setIsLogin] = useState(true);
  const [step, setStep] = useState<1 | 2 | 3>(1);
  const [leaving, setLeaving] = useState(false);

  const [fullName, setFullName] = useState('');
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [confirmPassword, setConfirmPassword] = useState('');
  const [error, setError] = useState('');
  const [loading, setLoading] = useState(false);
  const [accountType, setAccountType] = useState<'individual' | 'familiar'>('individual');

  const { signIn, signUp, user, loading: authLoading } = useAuth();
  const router = useRouter();

  useEffect(() => {
    if (!authLoading && user) {
      const tipo = (user.user_metadata?.account_type as string | undefined)?.toLowerCase();
      router.push(tipo === 'familiar' ? '/familiar-dashboard' : '/dashboard');
    }
  }, [user, authLoading, router]);

  useEffect(() => {
    if (mode === 'register') {
      setIsLogin(false);
      setStep(1);
    }
  }, [mode]);

  if (authLoading) {
    return (
      <main className={styles.main}>
        <div style={{ 
          display: 'flex', 
          justifyContent: 'center', 
          alignItems: 'center', 
          height: '100vh',
          fontSize: '18px',
          color: 'white'
        }}>
          Carregando...
        </div>
      </main>
    );
  }

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setError('');

    // Em registro, somente submeter no passo 3
    if (!isLogin && step !== 3) {
      return;
    }
    if (!isLogin) {
      if (!fullName.trim()) {
        return setError('Informe seu nome completo');
      }
      if (!email.trim()) {
        return setError('Informe seu email');
      }
      if (!password) {
        return setError('Informe sua senha');
      }
      if (password !== confirmPassword) {
        return setError('As senhas não coincidem');
      }
    }

    setLoading(true);
    try {
      if (isLogin) {
        const { error, data } = await signIn(email, password);
        if (error) setError('Email ou senha incorretos');
        else {
          const tipo = (data?.user?.user_metadata?.account_type as string | undefined)?.toLowerCase();
          router.push(tipo === 'familiar' ? '/familiar-dashboard' : '/dashboard');
        }
      } else {
        const { error } = await signUp(email, password, fullName, accountType);
        if (error) {
          console.error('Erro detalhado no signUp:', error);
          if (error.message.includes('Configuração do Supabase não encontrada')) {
            setError('❌ Configuração do banco de dados não encontrada. Entre em contato com o suporte.');
          } else {
            setError('Erro ao criar conta: ' + error.message);
          }
        } else {
          router.push('/onboarding');
        }
      }
    } catch {
      setError('Ocorreu um erro inesperado');
    } finally {
      setLoading(false);
    }
  };

  const transitionTo = (next: 1 | 2 | 3) => {
    if (next === step) return;
    setLeaving(true);
    // tempo deve casar com a duração da animação de saída (160ms)
    setTimeout(() => {
      setStep(next);
      setLeaving(false);
    }, 170);
  };

  const handleFormKeyDown = (e: React.KeyboardEvent<HTMLFormElement>) => {
    if (e.key === 'Enter' && !isLogin) {
      if (step !== 3) {
        e.preventDefault();
        handleContinue();
      }
    }
  };

  const handleContinue = () => {
    setError('');
    if (step === 1) {
      if (!fullName.trim()) {
        setError('Informe seu nome completo');
        return;
      }
      if (!email.trim()) {
        setError('Informe seu email');
        return;
      }
      transitionTo(2);
      return;
    }
    if (step === 2) {
      if (!password) {
        setError('Informe sua senha');
        return;
      }
      if (password !== confirmPassword) {
        setError('As senhas não coincidem');
        return;
      }
      transitionTo(3);
    }
  };

  return (
    <main className={styles.main}>
      {/* Efeito de ondas animadas */}
      <div className={styles.waves}>
        <div className={styles.wave}></div>
        <div className={styles.wave}></div>
        <div className={styles.wave}></div>
      </div>

      <div style={{ display: 'flex', justifyContent: 'center', marginTop: '16px', marginBottom: '8px' }}>
        <Image 
          src="/icons/logo.png" 
          alt="CareMind Logo" 
          width={180} 
          height={57} 
          priority 
          style={{ maxWidth: '100%', height: 'auto' }}
        />
      </div>
      
      <section className={styles.section}>
        <div className={styles.container}>
          <div className={`${styles.formContainer} ${!isLogin ? styles.registerMode : ''}`}>
            <h1 className={styles.title}>
              {isLogin ? 'Entrar' : 'Registrar'}
            </h1>
            {!isLogin && (
              <div style={{ color: '#fff', opacity: 0.9, fontSize: 14, marginTop: -8, marginBottom: 8 }}>
                {`Passo ${step} de 3`}
              </div>
            )}

            <form onSubmit={handleSubmit} onKeyDown={handleFormKeyDown} className={styles.form}>
              {!isLogin && (
                <div className={styles.stepWrapper}>
                  <div key={step} className={leaving ? styles.stepContentExit : styles.stepContent}>
                  {step === 1 && (
                    <div className={styles.registerColumns}>
                      <div className={styles.registerColumn}>
                        <div className={styles.inputGroup}>
                          <label htmlFor="fullName">Nome Completo</label>
                          <input
                            id="fullName"
                            type="text"
                            value={fullName}
                            onChange={(e) => setFullName(e.target.value)}
                            className={styles.input}
                            placeholder="Seu nome"
                            required
                          />
                        </div>

                        <div className={styles.inputGroup}>
                          <label htmlFor="email">Email</label>
                          <input
                            id="email"
                            type="email"
                            value={email}
                            onChange={(e) => setEmail(e.target.value)}
                            className={styles.input}
                            placeholder="seu@email.com"
                            required
                          />
                        </div>
                      </div>
                    </div>
                  )}

                  {step === 2 && (
                    <div className={styles.registerColumns}>
                      <div className={styles.registerColumn}>
                        <div className={styles.inputGroup}>
                          <label htmlFor="password">Crie sua senha</label>
                          <input
                            id="password"
                            type="password"
                            value={password}
                            onChange={(e) => setPassword(e.target.value)}
                            className={styles.input}
                            placeholder='Password'
                            required
                          />
                        </div>
                        <div className={styles.inputGroup}>
                          <label htmlFor="confirmPassword">Confirme sua senha</label>
                          <input
                            id="confirmPassword"
                            type="password"
                            value={confirmPassword}
                            onChange={(e) => setConfirmPassword(e.target.value)}
                            className={styles.input}
                            placeholder='Password'
                            required
                          />
                        </div>
                      </div>
                    </div>
                  )}

                  {step === 3 && (
                    <div className={styles.registerColumns}>
                      <div className={styles.registerColumn}>
                        <div className={styles.inputGroup}>
                          <label htmlFor="accountType">Tipo de conta</label>
                          <select
                            id="accountType"
                            value={accountType}
                            onChange={(e) => setAccountType(e.target.value as 'individual' | 'familiar')}
                            className={styles.input}
                            required
                          >
                            <option value="individual">Individual</option>
                            <option value="familiar">Familiar</option>
                          </select>
                          <div className={styles.accountTypeInfo}>
                            {accountType === 'individual'
                              ? 'Conta para uso pessoal, ideal para cuidadores ou usuários que desejam gerenciar seu próprio acompanhamento.'
                              : 'Conta para familiares acompanharem e colaborarem no cuidado de um ente querido, com recursos de compartilhamento.'}
                          </div>
                        </div>
                      </div>
                    </div>
                  )}
                  </div>
                </div>
              )}

              {isLogin && (
                <>
                  <div className={styles.inputGroup}>
                    <label htmlFor="email">Email</label>
                    <input
                      id="email"
                      type="email"
                      value={email}
                      onChange={(e) => setEmail(e.target.value)}
                      className={styles.input}
                      placeholder="seu@email.com"
                      required
                    />
                  </div>

                  <div className={styles.inputGroup}>
                    <label htmlFor="password">{isLogin ? 'Senha' : 'Crie sua senha'}</label>
                    <input
                      id="password"
                      type="password"
                      value={password}
                      onChange={(e) => setPassword(e.target.value)}
                      className={styles.input}
                      placeholder='Password'
                      required
                    />
                  </div>

                  <div className={styles.forgotPassword}>
                    <button
                      type="button"
                      className={styles.linkButton}
                      onClick={() => router.push('/forgot-password')}
                    >
                      Esqueci minha senha
                    </button>
                  </div>
                </>
              )}

              {error && <div className={styles.error}>{error}</div>}

              {isLogin ? (
                <Button type="submit" size="lg" disabled={loading}>
                  {loading ? 'Carregando...' : 'Entrar'}
                </Button>
              ) : step === 1 ? (
                <Button type="button" size="lg" onClick={handleContinue} disabled={loading}>
                  {loading ? 'Carregando...' : 'Continuar'}
                </Button>
              ) : step === 2 ? (
                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 12, width: '100%' }}>
                  <Button type="button" size="lg" onClick={() => transitionTo(1)} style={{ width: '100%' }}>
                    Voltar
                  </Button>
                  <Button type="button" size="lg" onClick={handleContinue} disabled={loading} style={{ width: '100%' }}>
                    {loading ? 'Carregando...' : 'Continuar'}
                  </Button>
                </div>
              ) : (
                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 12, width: '100%' }}>
                  <Button type="button" size="lg" onClick={() => transitionTo(2)} style={{ width: '100%' }}>
                    Voltar
                  </Button>
                  <Button type="submit" size="lg" disabled={loading} style={{ width: '100%' }}>
                    {loading ? 'Carregando...' : 'Registrar'}
                  </Button>
                </div>
              )}
            </form>

            <div className={styles.switchMode}>
              <p className={styles.switchText}>
                {isLogin ? 'Não tem conta ainda?' : 'Já tem uma conta?'}
                <button
                  onClick={() => {
                    setIsLogin(!isLogin);
                    setError('');
                    setEmail('');
                    setPassword('');
                    setFullName('');
                    setConfirmPassword('');
                    setAccountType('individual');
                    setStep(1);
                  }}
                  className={styles.switchButton}
                >
                  {isLogin ? 'Criar conta' : 'Fazer login'}
                </button>
              </p>
            </div>

            {/* Linha divisória */}
            <div style={{
              height: '1px',
              background: 'rgba(255, 255, 255, 0.2)',
              margin: '1.5rem 0'
            }} />

            {/* Botão Voltar ao Início na parte mais inferior */}
            <div className={styles.backButtonContainer}>
              <Link href="/" className={styles.backButton}>
                Voltar ao Início
              </Link>
            </div>
          </div>
        </div>
      </section>
    </main>
  );
}

================
File: src/app/auth/page.module.css
================
@import url('https://fonts.googleapis.com/css2?family=League+Spartan:wght@100..900&display=swap');

.main {
    font-family: "League Spartan", sans-serif;
    min-height: 100vh;
    height: auto;
    background: linear-gradient(135deg, #a8b8ff 0%, #9b7eff 100%); /* Gradiente mais claro */
    position: relative;
    overflow: auto;
    display: flex;
    flex-direction: column;
}

/* Efeito de ondas animadas no fundo */
.main::before {
    content: "";
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 300px;
    background: linear-gradient(180deg, transparent, rgba(4, 0, 186, 0.15));
    z-index: 0;
    pointer-events: none;
}

.section {
    padding: 0;
    position: relative;
    z-index: 10;
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: center; /* Centralizado verticalmente */
    align-items: center;
    width: 100%;
    min-height: auto;
}

.container {
    max-width: min(64rem, 95%);
    margin: 0 auto;
    text-align: center;
    padding: 0;
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center; /* Centralizado verticalmente */
    gap: 1rem;
}

.logoWrapper {
    margin: 1rem 0 1.5rem 0; /* Margem superior bem reduzida */
    position: relative;
    z-index: 15;
}

.logo {
    display: block;
    margin: 0 auto;
    height: clamp(3rem, 8vw, 5rem); /* Logo um pouco menor */
    max-width: 100%;
    object-fit: contain;
    filter: drop-shadow(0 4px 8px rgba(255, 255, 255, 0.3)); /* Destaque na logo */
}

.title {
    font-size: clamp(1.75rem, 6vw, 3rem);
    font-weight: 700;
    color: white;
    margin-bottom: clamp(1rem, 3vw, 1.5rem);
    text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
}

/* Efeito de vidro (Glassmorphism) */
.formContainer {
    max-width: 380px; /* Largura padrão para login */
    width: 85%;
    margin: 0 auto;
    background: rgba(255, 255, 255, 0.25);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    padding: clamp(1rem, 2.5vw, 1.75rem);
    border-radius: 18px;
    box-shadow:
        0 6px 24px 0 rgba(31, 38, 135, 0.3),
        inset 0 1px 1px 0 rgba(255, 255, 255, 0.3);
    border: 1px solid rgba(255, 255, 255, 0.18);
    position: relative;
    transition: max-width 0.3s ease; /* Transição suave */
    min-height: auto; /* Remove altura mínima fixa */
}

/* Quando estiver no modo de registro, mantém largura padrão */
.formContainer:has(.register-mode) {
    max-width: 380px;
    padding: clamp(1rem, 2.5vw, 1.75rem);
}

/* Layout de coluna única para registro */
.registerColumns {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    width: 100%;
    position: relative;
    align-items: stretch;
}

.registerColumn {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    width: 100%;
}

/* Campos específicos para registro em coluna */
.registerColumn .inputGroup {
    margin-bottom: 0;
}

/* Brilho sutil no topo do card */
.formContainer::before {
    content: "";
    position: absolute;
    top: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.5), transparent);
}

.inputGroup {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    margin-bottom: 1rem;
}
.inputGroup label {
    font-size: 16px;
    font-weight: 600;
    color: white;
    margin-bottom: 0.25rem; /* Margem muito pequena */
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    text-align: left;
    width: 100%;
    order: -1;
}
.input {
    padding: 12px 16px;
    border: 2px solid rgba(255, 255, 255, 0.2);
    border-radius: 12px;
    font-size: 16px;
    font-family: inherit;
    transition: all 0.3s ease;
    background: rgba(255, 255, 255, 0.9);
    color: #2d3748;
    backdrop-filter: blur(10px);
    width: 100%;
    box-sizing: border-box;
}

.input:focus {
    outline: none;
    border-color: rgba(255, 255, 255, 0.5);
    box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.2);
    background: rgba(255, 255, 255, 0.95);
}

.inputGroup select {
    padding: 12px 16px;
    border: 2px solid rgba(255, 255, 255, 0.2);
    border-radius: 12px;
    font-size: 16px;
    font-family: inherit;
    transition: all 0.3s ease;
    background: rgba(255, 255, 255, 0.9);
    color: #2d3748;
    backdrop-filter: blur(10px);
    width: 100%;
    box-sizing: border-box;
}

.inputGroup select:focus {
    outline: none;
    border-color: rgba(255, 255, 255, 0.5);
    box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.2);
    background: rgba(255, 255, 255, 0.95);
}

.checkboxGroup {
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
    text-align: left;
    margin: 0.5rem 0; /* Margem reduzida */
    padding: 0.5rem 0; /* Padding interno */
}

.checkboxGroup input[type="checkbox"] {
    margin: 0;
    flex-shrink: 0;
    margin-top: 2px;
    accent-color: #0400ba;
    transform: scale(1.1); /* Checkbox ligeiramente maior */
}

.checkboxGroup label {
    font-size: 14px;
    color: white;
    line-height: 1.4;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    cursor: pointer;
}

.link {
    background: none;
    border: none;
    color: white;
    text-decoration: underline;
    cursor: pointer;
    font-size: inherit;
    font-family: inherit;
    padding: 0;
    margin: 0;
    transition: opacity 0.3s ease;
    font-weight: 600;
}

.link:hover {
    opacity: 0.8;
}

.error {
    background: rgba(254, 215, 215, 0.95);
    backdrop-filter: blur(10px);
    color: #c53030;
    padding: 12px 16px;
    border-radius: 12px;
    font-size: 14px;
    text-align: center;
    border: 1px solid rgba(254, 178, 178, 0.5);
}

/* Explicação do tipo de conta no passo 2 */
.accountTypeInfo {
    margin-top: 0.5rem;
    color: #ffffff;
    font-size: 14px;
    line-height: 1.4;
    opacity: 0.9;
}

/* Transição entre passos */
.stepWrapper {
    position: relative;
}

.stepContent {
    opacity: 0;
    transform: translateY(8px);
    animation: authStepFadeUp 240ms ease forwards;
}

@keyframes authStepFadeUp {
    from { opacity: 0; transform: translateY(8px); }
    to { opacity: 1; transform: translateY(0); }
}

/* Saída do passo atual */
.stepContentExit {
    animation: authStepFadeOut 160ms ease forwards;
}

@keyframes authStepFadeOut {
    from { opacity: 1; transform: translateY(0); }
    to { opacity: 0; transform: translateY(-6px); }
}

/* Estilo para o botão do shadcn/ui */
.form button[type="submit"] {
    background: linear-gradient(135deg, #0400ba 0%, #020054 100%) !important;
    border: 2px solid rgba(255, 255, 255, 0.2) !important;
    color: white !important;
    padding: 16px 24px !important;
    border-radius: 12px !important;
    font-size: 16px !important;
    font-weight: 600 !important;
    cursor: pointer !important;
    font-family: inherit !important;
    transition: all 0.3s ease !important;
    margin-top: 1rem !important;
    width: 100% !important;
    height: auto !important;
    box-shadow: 0 4px 15px rgba(4, 0, 186, 0.3) !important;
}

.form button[type="button"]:not(.linkButton) {
    background: linear-gradient(135deg, #0400ba 0%, #020054 100%) !important;
    border: 2px solid rgba(255, 255, 255, 0.2) !important;
    color: white !important;
    padding: 16px 24px !important;
    border-radius: 12px !important;
    font-size: 16px !important;
    font-weight: 600 !important;
    cursor: pointer !important;
    font-family: inherit !important;
    transition: all 0.3s ease !important;
    margin-top: 1rem !important;
    width: 100% !important;
    height: auto !important;
    box-shadow: 0 4px 15px rgba(4, 0, 186, 0.3) !important;
}

.form button[type="submit"]:hover:not(:disabled) {
    transform: translateY(-2px) !important;
    box-shadow: 0 6px 20px rgba(4, 0, 186, 0.4) !important;
    border-color: rgba(255, 255, 255, 0.4) !important;
}

.form button[type="button"]:not(.linkButton):hover:not(:disabled) {
    transform: translateY(-2px) !important;
    box-shadow: 0 6px 20px rgba(4, 0, 186, 0.4) !important;
    border-color: rgba(255, 255, 255, 0.4) !important;
}

.form button[type="submit"]:disabled {
    opacity: 0.6 !important;
    cursor: not-allowed !important;
    transform: none !important;
}

.form button[type="button"]:not(.linkButton):disabled {
    opacity: 0.6 !important;
    cursor: not-allowed !important;
    transform: none !important;
}

.submitButton {
    background: linear-gradient(135deg, #0400ba 0%, #020054 100%);
    border: 2px solid rgba(255, 255, 255, 0.2);
    color: white;
    padding: 16px 24px;
    border-radius: 12px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    font-family: inherit;
    transition: all 0.3s ease;
    margin-top: 1rem;
    box-shadow: 0 4px 15px rgba(4, 0, 186, 0.3);
}

.submitButton:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(4, 0, 186, 0.4);
    border-color: rgba(255, 255, 255, 0.4);
}

.submitButton:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none;
}

.switchMode {
    margin-top: 1rem; /* Pequena margem do botão de entrar */
    padding-top: 0;
    border-top: none;
    text-align: left; /* Alinhado à direita */
}

.switchText {
    color: white;
    font-size: 14px;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    display: inline; /* Para ficar na mesma linha */
}

.switchButton {
    background: none;
    border: none;
    color: white;
    font-size: 14px; /* Mesmo tamanho do texto */
    font-weight: 600;
    cursor: pointer;
    text-decoration: underline;
    font-family: inherit;
    transition: opacity 0.3s ease;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    display: inline; /* Para ficar na mesma linha */
    margin-left: 0.25rem; /* Pequeno espaço entre o ? e o botão */
}

.switchButton:hover {
    opacity: 0.8;
}

/* Botão Voltar ao Início (substituto do Criar Conta) */
.backButtonContainer {
    margin: 0.5rem 0 0 0; /* Margem superior reduzida */
    text-align: center;
}

.backButton {
    background: rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(15px);
    -webkit-backdrop-filter: blur(15px);
    border: 1px solid rgba(255, 255, 255, 0.18);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
    color: white;
    padding: 12px 24px;
    border-radius: 12px;
    text-decoration: none;
    font-weight: 600;
    font-size: 16px;
    transition: all 0.3s ease;
    display: inline-block;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

.backButton:hover {
    background-color: rgba(255, 255, 255, 0.25);
    border-color: rgba(255, 255, 255, 0.3);
    transform: translateY(-1px);
}

.forgotPassword {
    text-align: left;
    margin-top: -0.5rem;
    margin-bottom: 1rem;
}

.linkButton {
    background: none;
    border: none;
    color: #e9e9e9;
    text-decoration: underline;
    cursor: pointer;
    font-family: "League Spartan", sans-serif;
    font-weight: 600;
    font-size: 14px;
    transition: opacity 0.3s ease, transform 0.2s ease;
    padding: 0;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

.linkButton:hover {
    opacity: 0.8;
    transform: translateY(-1px);
}

/* Responsive design */
@media (max-width: 768px) {
    .backButton {
        padding: 10px 20px;
        font-size: 14px;
    }
}

@media (max-width: 768px) {
    .formContainer {
        max-width: 85vw; /* Card ainda menor em tablets */
        width: 85%;
        padding: clamp(0.875rem, 2vw, 1.5rem);
    }

    .backButton {
        padding: 10px 20px;
        font-size: 14px;
    }
}

@media (max-width: 640px) {
    .formContainer {
        max-width: 95vw; /* Usa quase toda a largura em dispositivos menores */
        width: 95%;
        margin: 0 0.5rem;
        padding: clamp(0.75rem, 2vw, 1.25rem);
        border-radius: 15px;
    }

    .forgotPassword {
        text-align: center;
        margin-top: 0.5rem;
        margin-bottom: 1rem;
    }

    .linkButton {
        font-size: 13px;
    }

    .backButton {
        padding: 8px 16px;
        font-size: 13px;
    }
}

@media (max-width: 480px) {
    .formContainer {
        padding: clamp(0.625rem, 1.5vw, 0.875rem);
        margin: 0 0.25rem;
        border-radius: 12px;
        max-width: calc(100vw - 0.5rem);
    }

    .title {
        font-size: clamp(1.125rem, 3.5vw, 1.5rem);
        margin-bottom: 0.875rem;
    }

    .input {
        padding: 8px 10px;
        font-size: 13px;
    }

    .form {
        gap: 1rem;
    }

    .backButton {
        padding: 8px 12px;
        font-size: 12px;
    }
}

================
File: src/app/auth/page.tsx
================
// src/app/auth/page.tsx
import { Suspense } from 'react';
import AuthClient from './AuthClient';

// Este componente é um Server Component e protege o cliente
// que usa useSearchParams() durante o prerendering.
export default function AuthPage() {
    return (
        <Suspense fallback={<div>Carregando tela de autenticação...</div>}>
            <AuthClient />
        </Suspense>
    );
}

================
File: src/app/blog/page.tsx
================
"use client";

import { Footer } from "@/components/Footer";

export default function BlogPage() {
  return (
    <main style={{ minHeight: "100vh", display: "flex", flexDirection: "column" }}>
      <section style={{ flex: 1, display: "flex", alignItems: "center", justifyContent: "center", padding: 24 }}>
        <div style={{ textAlign: "center", color: "#0b0b2e" }}>
          <h1 style={{ fontSize: 40, fontWeight: 800, margin: 0 }}>Blog</h1>
          <p style={{ marginTop: 12, color: "#2d3748" }}>Artigos e novidades chegarão em breve.</p>
        </div>
      </section>
      <Footer />
    </main>
  );
}

================
File: src/app/contato/page.tsx
================
"use client";

import { Footer } from "@/components/Footer";

export default function ContatoPage() {
  return (
    <main style={{ minHeight: "100vh", display: "flex", flexDirection: "column" }}>
      <section style={{ flex: 1, display: "flex", alignItems: "center", justifyContent: "center", padding: 24 }}>
        <div style={{ textAlign: "center", color: "#0b0b2e" }}>
          <h1 style={{ fontSize: 40, fontWeight: 800, margin: 0 }}>Contato</h1>
          <p style={{ marginTop: 12, color: "#2d3748" }}>Entre em contato conosco — em breve disponibilizaremos canais diretos.</p>
        </div>
      </section>
      <Footer />
    </main>
  );
}

================
File: src/app/cookies/page.tsx
================
"use client";

import { Footer } from "@/components/Footer";

export default function CookiesPage() {
  return (
    <main style={{ minHeight: "100vh", display: "flex", flexDirection: "column" }}>
      <section style={{ flex: 1, display: "flex", alignItems: "center", justifyContent: "center", padding: 24 }}>
        <div style={{ textAlign: "center", color: "#0b0b2e" }}>
          <h1 style={{ fontSize: 40, fontWeight: 800, margin: 0 }}>Cookies</h1>
          <p style={{ marginTop: 12, color: "#2d3748" }}>Política de cookies será definida em breve.</p>
        </div>
      </section>
      <Footer />
    </main>
  );
}

================
File: src/app/forgot-password/page.module.css
================
.main {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100vh;
    text-align: center;
    padding: 0 20px;
}

.title {
    font-size: 2.5rem;
    margin-bottom: 20px;
}

================
File: src/app/forgot-password/page.tsx
================
'use client';

import { useState, useEffect } from 'react';
import { useAuth } from '@/contexts/AuthContext';
import { useRouter } from 'next/navigation';
import Link from 'next/link';
import { Footer } from '@/components/Footer';

export default function ForgotPassword() {
  const { resetPassword, user, loading } = useAuth();
  const router = useRouter();
  const [email, setEmail] = useState('');
  const [message, setMessage] = useState('');
  const [error, setError] = useState('');
  const [isSubmitting, setIsSubmitting] = useState(false);

  useEffect(() => {
    if (!loading && user) {
      router.replace('/dashboard');
    }
  }, [user, loading, router]);

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setError('');
    setMessage('');
    setIsSubmitting(true);
    try {
      const { error } = await resetPassword(email);
      if (error) {
        setError(error.message || 'Não foi possível enviar o email.');
      } else {
        setMessage('Se o email existir, enviaremos um link para redefinir sua senha.');
      }
    } catch {
      setError('Erro inesperado. Tente novamente.');
    } finally {
      setIsSubmitting(false);
    }
  };

  return (
    <main style={{ minHeight: '100vh', display: 'flex', flexDirection: 'column' }}>
      <section style={{ flex: 1, display: 'flex', alignItems: 'center', justifyContent: 'center', padding: 24 }}>
        <form onSubmit={handleSubmit} style={{ background: 'white', padding: 24, borderRadius: 12, maxWidth: 420, width: '100%', boxShadow: '0 10px 30px rgba(147, 155, 238, 0.2)' }}>
          <h1 style={{ margin: 0, fontSize: 28, fontWeight: 800, color: '#0400BA', textAlign: 'center' }}>Esqueci minha senha</h1>
          <p style={{ marginTop: 8, color: '#4a5568', textAlign: 'center' }}>Informe seu email para receber o link de redefinição.</p>
          <div style={{ display: 'flex', flexDirection: 'column', gap: 12, marginTop: 16 }}>
            <label>
              Email
              <input
                type="email"
                value={email}
                onChange={(e) => setEmail(e.target.value)}
                required
                placeholder="voce@exemplo.com"
                style={{ width: '100%', padding: 12, borderRadius: 8, border: '1px solid #e0e7ff', marginTop: 6 }}
              />
            </label>
            {error && <div style={{ color: '#c53030', fontSize: 14 }}>{error}</div>}
            {message && <div style={{ color: '#2f855a', fontSize: 14 }}>{message}</div>}
            <button type="submit" disabled={isSubmitting} style={{ marginTop: 8, background: 'linear-gradient(135deg,#0400ba,#020054)', color: 'white', padding: 12, borderRadius: 10, border: 'none', fontWeight: 700 }}>
              {isSubmitting ? 'Enviando...' : 'Enviar link'}
            </button>
            <Link href="/auth" style={{ textAlign: 'center', marginTop: 8, color: '#0400BA', fontWeight: 600 }}>Voltar ao login</Link>
          </div>
        </form>
      </section>
      <Footer />
    </main>
  );
}

================
File: src/app/funcionalidades/page.tsx
================
"use client";

import { Footer } from "@/components/Footer";

export default function FuncionalidadesPage() {
  return (
    <main style={{ minHeight: "100vh", display: "flex", flexDirection: "column" }}>
      <section style={{ flex: 1, display: "flex", alignItems: "center", justifyContent: "center", padding: 24 }}>
        <div style={{ textAlign: "center", color: "#0b0b2e" }}>
          <h1 style={{ fontSize: 40, fontWeight: 800, margin: 0 }}>Funcionalidades</h1>
          <p style={{ marginTop: 12, color: "#2d3748" }}>Em breve você verá aqui todos os recursos do CareMind.</p>
        </div>
      </section>
      <Footer />
    </main>
  );
}

================
File: src/app/globals.css
================
@import url('https://fonts.googleapis.com/css2?family=League+Spartan:wght@100..900&display=swap');

:root {
  --background: #ffffff;
  --foreground: #171717;
  --primary-color: #0400BA;
  --font-family: "League Spartan", sans-serif;
}


@media (prefers-color-scheme: dark) {
  :root {
    --background: white;
    --foreground: #ededed;
  }
}

html,
body {
  max-width: 100vw;
  overflow-x: hidden;

}

body {
  color: var(--foreground);
  /* Fundo global com o mesmo gradiente da landing/login para evitar "faixa branca" ao lado da barra de rolagem */
  background: linear-gradient(135deg, #a8b8ff 0%, #9b7eff 100%);
  font-family: "League Spartan", sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  position: relative;
  z-index: 1;
}

* {
  box-sizing: border-box;
  padding: 0;
  margin: 0;
}

a {
  color: inherit;
  text-decoration: none;
}

@media (prefers-color-scheme: dark) {
  html {
    color-scheme: dark;
  }
}

/* Global number input tweaks (moved from CSS Module) */
input[type='number']::-webkit-inner-spin-button,
input[type='number']::-webkit-outer-spin-button {
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
  margin: 0;
}

input[type='number'] {
  -moz-appearance: textfield;
  appearance: textfield;
}



/* ==========================================
   Scrollbar global: trilha transparente, só mostra o thumb
   ========================================== */
/* Firefox */
html {
  scrollbar-width: thin;
  scrollbar-color: rgba(4, 0, 186, 0.6) transparent; /* thumb | track */
}

/* Aplicar também no body para cobrir motores que estilizam no body */
body {
  scrollbar-width: thin;
  scrollbar-color: rgba(4, 0, 186, 0.6) transparent;
}

/* Fundo do html igual ao body para eliminar qualquer faixa branca lateral */
html { background: linear-gradient(135deg, #a8b8ff 0%, #9b7eff 100%); }

/* WebKit (Chrome, Edge, Safari) */
::-webkit-scrollbar {
  width: 10px;
  height: 10px;
}

/* ==========================
   Global Waves Background
   ========================== */
.global-waves {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  height: 300px;
  z-index: 0; /* below content but visible */
  pointer-events: none;
}

.global-wave {
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-repeat: repeat-x;
  background-size: 100% 100%;
  will-change: transform, background-position;
  animation: globalWaveDrift 18s linear infinite, globalWaveBob 6s ease-in-out infinite;
}

.global-wave:nth-child(1) {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 120' preserveAspectRatio='none'%3E%3Cpath d='M0,60 C150,90 450,30 600,60 S1050,90 1200,60 L1200,120 L0,120 Z' fill='%230400BA' fill-opacity='0.35'/%3E%3C/svg%3E");
  animation-duration: 16s, 5.5s;
}

.global-wave:nth-child(2) {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 120' preserveAspectRatio='none'%3E%3Cpath d='M0,70 C200,90 400,50 600,70 S1000,90 1200,70 L1200,120 L0,120 Z' fill='%230400BA' fill-opacity='0.45'/%3E%3C/svg%3E");
  animation-duration: 22s, 7s;
  animation-delay: -4s, -1s;
}

.global-wave:nth-child(3) {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 120' preserveAspectRatio='none'%3E%3Cpath d='M0,55 C150,65 450,45 600,55 S1050,65 1200,55 L1200,120 L0,120 Z' fill='%230400BA' fill-opacity='0.25'/%3E%3C/svg%3E");
  animation-duration: 28s, 8.5s;
  animation-delay: -8s, -2s;
}

.global-wave:nth-child(4) {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3 .org/2000/svg' viewBox='0 0 1200 120' preserveAspectRatio='none'%3E%3Cpath d='M0,85 C250,75 350,95 550,85 S850,75 1050,85 S1150,95 1200,85 L1200,120 L0,120 Z' fill='%230400BA' fill-opacity='0.15'/%3E%3C/svg%3E");
  animation-duration: 35s, 10s;
  animation-delay: -12s, -3s;
}

@keyframes globalWaveDrift {
  0% { background-position-x: 0; }
  100% { background-position-x: -100%; }
}

@keyframes globalWaveBob {
  0% { transform: translateY(0); }
  50% { transform: translateY(8px); }
  100% { transform: translateY(0); }
}

::-webkit-scrollbar-track {
  background: transparent;
}

::-webkit-scrollbar-thumb {
  background: linear-gradient(135deg, #0400ba 0%, #020054 100%);
  border-radius: 10px;
  border: 2px solid transparent; /* cria borda para destacar o thumb sem trilha */
  background-clip: padding-box;
}

::-webkit-scrollbar-thumb:hover {
  background: linear-gradient(135deg, #0600e0 0%, #020044 100%);
}

/* Escopos específicos no body para cobrir algumas variações de engine */
body::-webkit-scrollbar { width: 10px; height: 10px; }
body::-webkit-scrollbar-track { background: transparent; }
body::-webkit-scrollbar-thumb { background: linear-gradient(135deg, #0400ba 0%, #020054 100%); border-radius: 10px; border: 2px solid transparent; background-clip: padding-box; }
body::-webkit-scrollbar-thumb:hover { background: linear-gradient(135deg, #0600e0 0%, #020044 100%); }
body::-webkit-scrollbar-corner { background: transparent; }

/* Estilos para o toast de confirmação */
.toast-message {
  animation: slideIn 0.3s ease-out;
  z-index: 10000;
}

.toast-message button {
  padding: 8px 16px;
  border-radius: 6px;
  border: none;
  cursor: pointer;
  font-weight: 500;
  transition: background 0.2s;
  margin-left: 8px;
}

.toast-message button:first-child {
  background: #16a34a;
  color: white;
}

.toast-message button:first-child:hover {
  background: #15803d;
}

.toast-message button:last-child {
  background: transparent;
  border: 1px solid #4b5563;
  color: white;
}

.toast-message button:last-child:hover {
  background: rgba(255, 255, 255, 0.1);
}

@keyframes slideIn {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Garantir que nenhum canto/trilha pinte de branco */
::-webkit-scrollbar-corner { background: transparent; }
::-webkit-scrollbar-track-piece { background: transparent; }

================
File: src/app/layout.tsx
================
import type { Metadata } from "next";
import { AuthProvider } from "@/contexts/AuthContext";
import { LoadingProvider } from "@/contexts/LoadingContext";
import { ProfileProvider } from "@/contexts/ProfileContext";
import { Waves } from "@/components/Waves";
import { ToastContainer } from "@/components/Toast";
import { DevUnhandledRejectionLogger } from "@/components/DevUnhandledRejectionLogger";
import PWAInstallPrompt from '@/components/InstallPWA';
import { Analytics } from "@vercel/analytics/next"
import { SpeedInsights } from "@vercel/speed-insights/next"
import "./globals.css";

export const metadata: Metadata = {
  title: "CareMind",
  description: "Assistente virtual para auxiliar idosos no gerenciamento de medicações e rotinas diárias.",
  icons: {
    icon: "/favicon.ico",
  },
};

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="pt-BR">
      <head>
        <link rel="manifest" href="/manifest.json" />
        <link rel="icon" href="/favicon.ico" />
        <meta name="theme-color" content="#0400BA" />
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossOrigin="anonymous" />
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
      </head>

      <body suppressHydrationWarning={true}>
        <AuthProvider>
          <LoadingProvider>
            <ProfileProvider>
              <DevUnhandledRejectionLogger />
              {children}
              <SpeedInsights />
              <Analytics />
              <Waves />
              <PWAInstallPrompt />
              <ToastContainer />
            </ProfileProvider>
          </LoadingProvider>
        </AuthProvider>
      </body>
    </html>
  );
}

================
File: src/app/offline/offline.module.css
================
.main {
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  background: linear-gradient(135deg, #a8b8ff 0%, #9b7eff 100%);
  padding: 24px;
  font-family: "League Spartan", sans-serif;
}

.container {
  width: 100%;
  max-width: 560px;
}

.card {
  background-color: white;
  border-radius: 12px;
  padding: 48px 32px;
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
  border: 1px solid #e5e7eb;
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
  gap: 24px;
}

.iconContainer {
  width: 96px;
  height: 96px;
  background: linear-gradient(135deg, #a8b8ff 0%, #9b7eff 100%);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

.icon {
  width: 48px;
  height: 48px;
  color: white;
}

.content {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.title {
  font-size: 28px;
  font-weight: 700;
  color: #111827;
  margin: 0;
}

.description {
  font-size: 16px;
  color: #6b7280;
  margin: 0;
  line-height: 1.6;
}

.actions {
  display: flex;
  flex-direction: column;
  gap: 12px;
  width: 100%;
  margin-top: 12px;
}

.primaryButton {
  width: 100%;
  padding: 12px 16px;
  font-size: 16px;
  font-weight: 600;
  border-radius: 8px;
  background-color: #0400BA;
  color: white;
  border: none;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  transition: background-color 0.2s ease, box-shadow 0.2s ease;
}

.primaryButton:hover {
  background-color: #0300a0;
  box-shadow: 0 4px 12px rgba(4, 0, 186, 0.3);
}

.primaryButton:active {
  background-color: #020070;
}

.secondaryButton {
  width: 100%;
  padding: 12px 16px;
  font-size: 16px;
  font-weight: 600;
  border-radius: 8px;
  background-color: transparent;
  color: #0400BA;
  border: 2px solid #0400BA;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  transition: background-color 0.2s ease, color 0.2s ease;
}

.secondaryButton:hover {
  background-color: #f0f0ff;
}

.secondaryButton:active {
  background-color: #e0e0ff;
}

.buttonIcon {
  width: 18px;
  height: 18px;
}

.footer {
  font-size: 14px;
  color: #9ca3af;
  margin-top: 12px;
  padding-top: 16px;
  border-top: 1px solid #e5e7eb;
}

.footer p {
  margin: 0;
}

/* Responsividade */
@media (max-width: 768px) {
  .main {
    padding: 20px;
  }

  .card {
    padding: 32px 24px;
    gap: 20px;
  }

  .title {
    font-size: 24px;
  }

  .description {
    font-size: 15px;
  }

  .iconContainer {
    width: 80px;
    height: 80px;
  }

  .icon {
    width: 40px;
    height: 40px;
  }
}

@media (max-width: 480px) {
  .main {
    padding: 16px;
  }

  .card {
    padding: 24px 16px;
    gap: 16px;
  }

  .title {
    font-size: 20px;
  }

  .description {
    font-size: 14px;
  }

  .iconContainer {
    width: 72px;
    height: 72px;
  }

  .icon {
    width: 36px;
    height: 36px;
  }

  .primaryButton,
  .secondaryButton {
    padding: 10px 14px;
    font-size: 14px;
  }

  .footer {
    font-size: 12px;
  }
}

================
File: src/app/offline/page.tsx
================
"use client";
import { WifiOff, RefreshCw } from "lucide-react";
import { Button } from "@/components/ui/button";
import Link from "next/link";
import styles from "./offline.module.css";

export default function OfflinePage() {
  return (
    <main className={styles.main}>
      <div className={styles.container}>
        <div className={styles.card}>
          <div className={styles.iconContainer}>
            <WifiOff className={styles.icon} />
          </div>
          
          <div className={styles.content}>
            <h1 className={styles.title}>Você está offline</h1>
            <p className={styles.description}>
              Parece que você perdeu a conexão com a internet. 
              Verifique sua conexão e tente novamente.
            </p>
          </div>

          <div className={styles.actions}>
            <Button 
              onClick={() => window.location.reload()} 
              className={styles.primaryButton}
            >
              <RefreshCw className={styles.buttonIcon} />
              Tentar novamente
            </Button>
            
            <Button variant="outline" asChild className={styles.secondaryButton}>
              <Link href="/">
                Voltar ao início
              </Link>
            </Button>
          </div>

          <div className={styles.footer}>
            <p>Algumas funcionalidades podem estar disponíveis offline</p>
          </div>
        </div>
      </div>
    </main>
  );
}

================
File: src/app/onboarding/page.tsx
================
'use client';

import React, { useEffect, useState } from 'react';
import { useRouter } from 'next/navigation';
import { createClient } from '@/lib/supabase/client';
import { useAuth } from '@/contexts/AuthContext';
import cardStyles from '@/components/MedicamentoCard.module.css';

export default function OnboardingPage() {
  const router = useRouter();
  const supabase = createClient();
  const { user, loading: authLoading } = useAuth();

  const [phone, setPhone] = useState('');
  const [saving, setSaving] = useState(false);
  const [error, setError] = useState<string | null>(null);

  // Carrega dados existentes do perfil/metadados para preencher o formulário
  useEffect(() => {
    const loadProfile = async () => {
      if (!user) return;
      // Tenta pelos metadados do usuário
      const metaPhone = (user.user_metadata as any)?.phone as string | undefined;
      if (metaPhone) {
        setPhone(metaPhone);
        return;
      }
      // Fallback: tenta buscar no perfil caso eventualmente exista a coluna
      const { data } = await supabase
        .from('perfis')
        .select('telefone, phone')
        .eq('id', user.id)
        .single();
      const tablePhone = (data?.telefone as string) || (data?.phone as string);
      if (tablePhone) setPhone(tablePhone);
    };
    if (!authLoading) loadProfile();
  }, [user, authLoading, supabase]);

  const goToDashboardByProfile = async () => {
    // Busca o perfil para decidir o destino final
    const userId = user?.id;
    if (!userId) {
      router.push('/dashboard');
      return;
    }
    const { data } = await supabase
      .from('perfis')
      .select('tipo')
      .eq('user_id', userId)
      .single();

    const tipo = (data?.tipo as string | undefined)?.toLowerCase();
    // Rotas-alvo conforme requisito; se não existirem, usar fallback
    const target = tipo === 'familiar' ? '/familiar-dashboard' : '/dashboard';
    // Fallback para rota existente caso as específicas não existam
    router.push(target || '/dashboard');
  };

  const handleSaveContinue = async (e: React.FormEvent) => {
    e.preventDefault();
    setError(null);
    setSaving(true);
    try {
      if (!user) throw new Error('Usuário não autenticado');
      // Atualiza metadados do usuário (armazenamento recomendado)
      const { error: metaErr } = await supabase.auth.updateUser({ data: { phone } });
      if (metaErr) throw metaErr;
      await goToDashboardByProfile();
    } catch (err) {
      const msg = err instanceof Error ? err.message : 'Erro ao salvar dados';
      setError(msg);
    } finally {
      setSaving(false);
    }
  };

  const handleSkip = async () => {
    await goToDashboardByProfile();
  };

  if (authLoading) {
    return (
      <main style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', height: '60vh' }}>
        Carregando...
      </main>
    );
  }

  return (
    <main
      style={{
        minHeight: '100vh',
        display: 'flex',
        alignItems: 'center',
        justifyContent: 'center',
        padding: '24px',
        background: 'linear-gradient(135deg, #a8b8ff 0%, #9b7eff 100%)',
      }}
    >
      <div
        className={cardStyles.card}
        style={{
          width: '100%',
          maxWidth: 560,
        }}
      >
        <div style={{ marginBottom: 8, color: '#6b7280', fontSize: 14 }}>Passo 2 de 2</div>
        <h1 style={{ marginBottom: 8, fontSize: 24, fontWeight: 700, color: '#111827' }}>Complete seu perfil</h1>
        <p style={{ marginBottom: 20, color: '#4b5563' }}>
          Informe seus dados adicionais. Você pode pular e fazer isso depois.
        </p>

        <form onSubmit={handleSaveContinue} style={{ display: 'grid', gap: 16 }}>
          <div style={{ display: 'grid', gap: 8 }}>
            <label htmlFor="phone" style={{ color: '#111827', fontWeight: 600 }}>Número (telefone)</label>
            <input
              id="phone"
              type="tel"
              value={phone}
              onChange={(e) => setPhone(e.target.value)}
              placeholder="(00) 00000-0000"
              style={{ padding: '12px 14px', borderRadius: 10, border: '1px solid #e5e7eb' }}
            />
          </div>

          {error && (
            <div style={{ color: '#b00020', fontSize: 14 }}>{error}</div>
          )}

          <div style={{ display: 'flex', gap: 12 }}>
            <button
              type="submit"
              disabled={saving}
              style={{
                padding: '12px 16px',
                borderRadius: 10,
                background: '#2563eb',
                color: 'white',
                border: 0,
                cursor: 'pointer',
                flex: 1,
              }}
            >
              {saving ? 'Salvando...' : 'Salvar e Continuar'}
            </button>
            <button
              type="button"
              onClick={handleSkip}
              style={{
                padding: '12px 16px',
                borderRadius: 10,
                background: 'transparent',
                color: '#2563eb',
                border: '1px solid #2563eb',
                cursor: 'pointer',
                flex: 1,
              }}
            >
              Pular por enquanto
            </button>
          </div>
        </form>
      </div>
    </main>
  );
}

================
File: src/app/page.module.css
================
/* ==========================================
   1. RESET E CONFIGURAÇÕES GLOBAIS
   ========================================== */
.main {
    font-family: "League Spartan", sans-serif;
    min-height: 100vh;
    background: linear-gradient(135deg, #a8b8ff 0%, #9b7eff 100%);
    position: relative;
    overflow-x: hidden;
    width: 100%;
    max-width: 100vw;
    margin: 0;
    padding: 0;
}

/* ==========================================
   4. HERO SECTION (Landing Page)
   ========================================== */
.heroSection {
    position: relative;
    z-index: 2;
    width: 100%;
    box-sizing: border-box;
    max-width: 100%;
    margin: 0 auto;
    padding: 40px 20px 20px;
}

.heroContainer {
    max-width: 1200px;
    margin: 0 auto;
    display: grid;
    grid-template-columns: 1.1fr 0.9fr;
    gap: 40px;
    align-items: center;
    padding: 0 20px;
    box-sizing: border-box;
    width: 100%;
}

.heroContent {
    color: white;
    width: 100%;
    max-width: 100%;
    box-sizing: border-box;
}

.heroTitle {
    font-size: clamp(30px, 4.5vw, 50px);
    font-weight: 800;
    line-height: 1.15;
    margin: 0 0 16px 0;
    text-shadow: 0 2px 10px rgba(0,0,0,0.2);
    display: block;
    border-radius: 12px;
    text-align: left;
    width: 100%;
    max-width: 100%;
    box-sizing: border-box;
}

.heroDescription {
    font-size: clamp(16px, 2vw, 20px);
    color: #eef2ff;
    line-height: 1.6;
    margin: 0 0 28px 0;
    max-width: 620px;
}

.heroButton {
    display: flex;
    gap: 16px;
}

.heroImage {
    display: flex;
    justify-content: center;
    align-items: center;
    width: 100%;
    max-width: 100%;
    box-sizing: border-box;
}

.heroImg {
    filter: drop-shadow(0 12px 30px rgba(0,0,0,0.25));
    border-radius: 16px;
}

/* ==========================================
   5. SEÇÕES E CONTAINERS
   ========================================== */
.section {
    padding: 60px 20px;
    position: relative;
    z-index: 2;
    width: 100%;
    max-width: 100%;
    box-sizing: border-box;
    margin: 0 auto;
}

.section_3 {
    margin-bottom: 100px;
}

.container {
    max-width: 1200px;
    margin: 0 auto;
    text-align: center;
    padding: 0 20px;
    width: 100%;
    box-sizing: border-box;
}

/* ==========================================
   6. LOGO
   ========================================== */
.logoWrapper {
    margin-bottom: 30px;
    margin-top: 40px;
    display: flex;
    justify-content: center;
    align-items: center;
    width: 100%;
    max-width: 100%;
    box-sizing: border-box;
}

.logo {
    max-width: 100%;
    height: auto;
    object-fit: contain;
}

/* ==========================================
   7. TIPOGRAFIA
   ========================================== */
.title {
    font-size: 60px;
    font-weight: 700;
    color: #0400ba;
    margin-bottom: 20px;
    line-height: 1.2;
}

.container_title {
    font-size: clamp(30px, 4.5vw, 50px);
    font-weight: 800;
    line-height: 1.15;
    margin: 0 0 16px 0;
    text-shadow: 0 2px 10px rgba(0,0,0,0.2);
    display: inline-block;
    border-radius: 12px;
    background: rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    padding: 20px 24px;
    box-shadow: 0 8px 32px rgba(31, 38, 135, 0.25);
}

.description {
    font-size: 20px;
    color: #4a5568;
    margin-bottom: 40px;
    line-height: 1.6;
    max-width: 800px;
    margin-left: auto;
    margin-right: auto;
}

.sectionTitle {
    color: white;
    font-size: clamp(28px, 4vw, 42px);
    font-weight: 700;
    margin: 0 0 24px 0;
    text-align: left;
    text-shadow: 0 2px 10px rgba(0,0,0,0.2);
}

/* ==========================================
   8. BOTÕES
   ========================================== */
.buttonGroup {
    display: flex;
    gap: 20px;
    justify-content: center;
    align-items: center;
    flex-wrap: wrap;
    margin-top: 30px;
}

.primaryButton,
.outlineButton {
    padding: 15px 30px;
    border-radius: 8px;
    font-size: 20px;
    text-decoration: none;
    transition: all 0.3s ease;
    text-align: center;
    cursor: pointer;
    font-family: inherit;
    font-weight: 600;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    min-width: 150px;
}

.primaryButton {
    background-color: #0400ba;
    color: white;
    border: 2px solid #0400ba;
}

.primaryButton:hover {
    background-color: #020054;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(4, 0, 186, 0.3);
}

.outlineButton {
    background-color: white;
    color: #0400ba;
    border: 2px solid #0400ba;
}

.outlineButton:hover {
    background-color: #0400ba;
    color: white;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(4, 0, 186, 0.2);
}

.ctaButton {
    font-weight: 500;
    font-family: 'League Spartan', sans-serif;
    background: linear-gradient(135deg, #0400ba 0%, #020054 100%) !important;
    color: white !important;
    border-radius: 12px !important;
    padding: 16px 20px !important;
    box-shadow: 0 4px 15px rgba(4,0,186,0.3) !important;
    border: 1px solid rgba(255,255,255,0.25) !important;
    font-size: 18px;
}

.ctaButton:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(4,0,186,0.4) !important;
}

/* ==========================================
   9. CARDS
   ========================================== */
.container_cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 40px;
    width: 100%;
    max-width: 1200px;
    margin: 100px auto 50px;
    padding: 0 20px;
}

.card {
    background-color: white;
    padding: 30px;
    border-radius: 12px;
    box-shadow: 0 0 30px rgba(0, 0, 0, 0.1);
    text-align: left;
    transition: all 0.3s ease;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    gap: 15px;
}

.card:hover {
    transform: translateY(-8px);
    box-shadow: 0 0 40px rgba(0, 0, 0, 0.15);
}

.card svg {
    font-size: 48px;
    color: #0400BA;
    margin-bottom: 10px;
}

.card h1 {
    font-size: 24px;
    margin: 0;
    color: #1a202c;
    font-weight: 600;
}

.card p {
    font-size: 16px;
    line-height: 1.6;
    margin: 0;
    color: #4a5568;
}

/* ==========================================
   10. FEATURES SECTION
   ========================================== */
.featuresSection {
    position: relative;
    z-index: 2;
    padding: 10px 20px 80px;
}

.featuresGrid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 28px;
}

.featureCard {
    background: rgba(255,255,255,0.25);
    backdrop-filter: blur(14px);
    -webkit-backdrop-filter: blur(14px);
    border: 1px solid rgba(255,255,255,0.25);
    border-radius: 16px;
    padding: 20px;
    color: #1a202c;
    box-shadow: 0 6px 24px rgba(31,38,135,0.25);
    transition: transform .2s ease, box-shadow .2s ease;
    text-align: left;
}

.featureCard:hover {
    transform: translateY(-4px);
    box-shadow: 0 10px 28px rgba(31,38,135,0.3);
}

.featureIcon {
    width: 56px;
    height: 56px;
    padding: 12px;
    border-radius: 14px;
    background: rgba(255, 255, 255, 0.6);
    border: 1px solid rgba(4, 0, 186, 0.15);
    box-shadow: 0 6px 18px rgba(31, 38, 135, 0.2);
    margin-bottom: 10px;
    display: inline-block;
    object-fit: contain;
}

.featureCard h3 {
    font-size: 20px;
    font-weight: 700;
    color: #1a202c;
    margin: 0 0 8px 0;
}

.featureCard p {
    font-size: 16px;
    line-height: 1.6;
    color: #2d3748;
    margin: 0;
}

/* ==========================================
   11. LISTAS E CONTEÚDO
   ========================================== */
.container_itens {
    display: flex;
    margin-top: 90px;
    gap: 80px;
    align-items: flex-start;
    max-width: 1200px;
    margin-left: auto;
    margin-right: auto;
    padding: 0 20px;
}

.container_list {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    margin-top: 60px;
    flex: 1;
}

.container_list ol {
    display: flex;
    flex-direction: column;
    gap: 30px;
    padding-left: 30px;
    margin: 0;
}

.container_list ol li {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.container_list h1 {
    font-size: 32px;
    color: #0026ff;
    text-align: left;
    margin: 0 0 10px 0;
    font-weight: 700;
}

.container_list p {
    font-size: 18px;
    color: #ffffff;
    text-align: left;
    margin: 0;
    line-height: 1.6;
}

.container_list_ol {
    border-radius: 12px;
    background: rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    padding: 20px 24px;
    box-shadow: 0 8px 32px rgba(31, 38, 135, 0.25);
}

/* ==========================================
   12. IMPACTO SOCIAL
   ========================================== */
.impactContainer {
    background-color: #f7f9ff;
    border-radius: 24px;
    padding: 40px;
    max-width: 650px;
    margin: 60px auto;
    box-shadow: 0 10px 30px rgba(147, 155, 238, 0.2);
    text-align: center;
    border: 1px solid #e0e7ff;
}

.iconWrapper {
    width: 80px;
    height: 80px;
    border-radius: 20px;
    background: linear-gradient(135deg, #0400BA, #0026ff);
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 24px auto;
    box-shadow: 0 4px 12px rgba(4, 0, 186, 0.3);
}

.impactContainer .title {
    color: #0400BA;
    font-size: 36px;
    font-weight: 700;
    margin-bottom: 16px;
}

.impactContainer .description {
    color: #4a5568;
    font-size: 18px;
    line-height: 1.6;
    max-width: 500px;
    margin: 0 auto 32px auto;
}

.impactContainer .heroButton {
    justify-content: center;
    margin-top: 24px;
}

.statsGrid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
    justify-content: center;
    align-items: stretch;
}

.statCard {
    background-color: white;
    padding: 24px;
    border-radius: 16px;
    box-shadow: 0 4px 15px rgba(224, 231, 255, 0.6);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 140px;
    gap: 6px;
}

.statNumber {
    color: #0400BA;
    font-size: 48px;
    font-weight: 700;
    margin: 0 0 4px 0;
}

.statLabel {
    color: #6c757d;
    font-size: 14px;
    margin: 0;
    font-weight: 500;
}

.statsGrid .statCard:nth-child(3) .statNumber {
    margin-bottom: 6px;
}

.statsGrid .statCard:nth-child(3) .statLabel {
    margin-top: 0;
}

/* ==========================================
   13. ONDAS ANIMADAS (Background)
   ========================================== */
.waves {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 400px;
    z-index: 0;
    pointer-events: none;
    overflow: hidden;
}

.wave {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 200%;
    height: 100%;
    background-repeat: repeat-x;
    background-size: 50% 100%;
    will-change: transform;
}

.wave:nth-child(1) {
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 250' preserveAspectRatio='none'%3E%3Cpath d='M0,120 C100,80 300,160 600,120 C900,80 1100,160 1200,120 C1300,80 1500,160 1800,120 L1800,250 L0,250 Z' fill='%230018A0' fill-opacity='0.2'/%3E%3C/svg%3E");
    animation: wave-animation1 20s linear infinite;
    opacity: 0.9;
}

.wave:nth-child(2) {
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 250' preserveAspectRatio='none'%3E%3Cpath d='M0,140 C150,100 350,180 600,140 C850,100 1050,180 1200,140 C1350,100 1550,180 1800,140 L1800,250 L0,250 Z' fill='%23003A8C' fill-opacity='0.3'/%3E%3C/svg%3E");
    animation: wave-animation2 16s linear infinite reverse;
    opacity: 0.8;
}

.wave:nth-child(3) {
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 250' preserveAspectRatio='none'%3E%3Cpath d='M0,160 C200,120 400,200 600,160 C800,120 1000,200 1200,160 C1400,120 1600,200 1800,160 L1800,250 L0,250 Z' fill='%23005C8A' fill-opacity='0.4'/%3E%3C/svg%3E");
    animation: wave-animation3 24s linear infinite;
    opacity: 0.7;
}

@keyframes wave-animation1 {
    0% { transform: translateX(0); }
    100% { transform: translateX(-50%); }
}

@keyframes wave-animation2 {
    0% { transform: translateX(0); }
    100% { transform: translateX(-50%); }
}

@keyframes wave-animation3 {
    0% { transform: translateX(0); }
    100% { transform: translateX(-50%); }
}

/* ==========================================
   14. FOOTER
   ========================================== */
.footerWrapper {
    position: relative;
    z-index: 5;
}

/* ==========================================
   15. MEDIA QUERIES - MOBILE (640px)
   ========================================== */
@media (max-width: 680px) {
    /* Tipografia */
    .title,
    .container_title {
        font-size: 36px;
    }

    .heroTitle {
        font-size: 10px;
        text-align: justify;
    }

    .heroDescription {
        font-size: 16px;
        text-align: justify;
        text-justify: inter-word;
        word-spacing: 0.02em;
        line-height: 1.6;
    }
    
    .description {
        font-size: 16px;
    }
    
    .sectionTitle {
        font-size: 28px;
    }
    
    /* Header */
    .header {
        margin-left: 15px;
        margin-right: 15px;
        max-width: calc(100% - 30px);
        padding: 12px 15px;
    }
    
    /* Cards */
    .container_cards {
        grid-template-columns: 1fr;
        gap: 25px;
        margin-top: 50px;
    }
    
    .card {
        padding: 20px;
    }
    
    /* Features */
    .featuresGrid {
        grid-template-columns: 1fr;
        gap: 20px;
    }
    
    /* Container de itens */
    .container_itens {
        flex-direction: column;
        gap: 30px;
        margin-top: 50px;
    }
    
    .container_list h1 {
        font-size: 24px;
    }
    
    .container_list p {
        font-size: 15px;
    }
    
    /* Impacto */
    .impactContainer {
        margin: 30px 10px;
        padding: 25px 15px;
    }
    
    .impactContainer .title {
        font-size: 28px;
    }
    
    .impactContainer .description {
        font-size: 15px;
    }
    
    .statsGrid {
        grid-template-columns: 1fr;
        gap: 15px;
    }
    
    .statNumber {
        font-size: 36px;
    }
    
    .statCard {
        min-height: 120px;
    }
    
    /* Hero */
    .heroSection {
        padding: 0 20px 20px;
    }
    
    .heroContainer {
        grid-template-columns: 1fr;
        gap: 30px;
    }
    
    .heroImg {
        display: none;
    }
    
    .heroButton {
        flex-direction: column;
        width: 90%;
        gap: 12px;
    }
    
    /* Logo */
    .logoWrapper {
        margin-bottom: 20px;
        margin-top: 25px;
    }
    
    .logo {
        max-width: 240px;
    }
    
    /* Ondas */
    .waves {
        height: 150px;
    }
    
    /* Botões */
    .primaryButton,
    .outlineButton,
    .ctaButton {
        width: 100%;
        font-size: 16px;
    }
}

/* ==========================================
   16. MEDIA QUERIES - TABLET (641px - 1024px)
   ========================================== */
@media (max-width: 1024px) {
    .heroSection {
        padding: 0 20px 20px;
    }
    .heroContainer {
        grid-template-columns: 1fr;
        text-align: center;
        gap: 30px;
    }

    .heroTitle {
        font-size: 29px;
        text-align: justify;
    }

    .heroDescription {
        font-size: 16px;
        text-align: justify;
        text-justify: inter-word;
        word-spacing: 0.02em;
        line-height: 1.6;
    }
    
    .heroButton {
        justify-content: center;
    }
    
    .heroImage {
        order: -1;
        margin-bottom: 20px;
    }
    .heroImg{
        width: 50%;
    }
}

@media (min-width: 641px) and (max-width: 1024px) {
    /* Tipografia */
    .title,
    .container_title {
        font-size: 48px;
    }
    
    .description {
        font-size: 18px;
    }
    
    /* Header */
    .header {
        margin-left: 20px;
        margin-right: 20px;
        max-width: calc(100% - 40px);
    }
    
    /* Cards */
    .container_cards {
        grid-template-columns: repeat(2, 1fr);
        gap: 30px;
        margin-top: 70px;
    }
    
    .card {
        padding: 25px;
    }
    
    /* Features */
    .featuresGrid {
        grid-template-columns: repeat(2, 1fr);
        gap: 24px;
    }
    
    /* Container de itens */
    .container_itens {
        flex-direction: column;
        gap: 50px;
        margin-top: 70px;
    }
    
    .container_list h1 {
        font-size: 30px;
    }
    
    .container_list p {
        font-size: 17px;
    }
    
    /* Impacto */
    .impactContainer {
        margin: 50px 20px;
        padding: 35px 25px;
    }
    
    .impactContainer .title {
        font-size: 34px;
    }
    
    .impactContainer .description {
        font-size: 17px;
    }
    
    .statsGrid {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .statNumber {
        font-size: 44px;
    }
    
    /* Hero */
    .heroSection {
        padding: 0 20px 20px;
    }
    
    .heroContainer {
        grid-template-columns: 1fr;
        gap: 35px;
    }
    
    .heroImg {
        max-width: 80%;
        margin: 0 auto;
    }
    
    /* Logo */
    .logoWrapper {
        margin-bottom: 28px;
        margin-top: 35px;
    }
    
    .logo {
        max-width: 320px;
    }
    
    /* Ondas */
    .waves {
        height: 250px;
    }
}

/* ==========================================
   17. MEDIA QUERIES - LAPTOP/PC (1025px+)
   ========================================== */
@media (min-width: 1025px) {
    /* Header otimizado para desktop */
    .header_list {
        justify-content: space-around;
    }
    
    .header_text {
        gap: 40px;
    }
    
    .header_a {
        font-size: 22px;
    }
    
    .header_btn {
        font-size: 18px;
        padding: 16px 24px;
    }
    
    /* Tipografia desktop */
    .title,
    .container_title {
        font-size: 70px;
    }
    
    .description {
        font-size: 22px;
    }
    
    /* Cards em 3 colunas */
    .container_cards {
        grid-template-columns: repeat(3, 1fr);
    }
    
    /* Features em 3 colunas */
    .featuresGrid {
        grid-template-columns: repeat(3, 1fr);
    }
    
    /* Stats em 3 colunas */
    .statsGrid {
        grid-template-columns: repeat(3, 1fr);
    }
    
    /* Hero com layout lado a lado */
    .heroContainer {
        grid-template-columns: 1.1fr 0.9fr;
    }
}

================
File: src/app/page.tsx
================
'use client';

import { useAuth } from '@/contexts/AuthContext';
import { useRouter } from 'next/navigation';
import { useEffect } from 'react';
import Link from 'next/link';
import { Button } from "@/components/ui/button";
import { Header } from '@/components/headers/HeaderHome';
import { Footer } from '@/components/Footer';
import styles from './page.module.css';
import Image from 'next/image';

export default function Home() {
  const { user, loading } = useAuth();
  const router = useRouter();

  useEffect(() => {
    const handleAuthCheck = async () => {
      try {
        if (!loading && user) {
          const tipo = (user.user_metadata?.account_type as string | undefined)?.toLowerCase();
          await router.push(tipo === 'familiar' ? '/familiar-dashboard' : '/dashboard');
        }
      } catch (error) {
        console.error('Navigation error:', error);
        // You can add more sophisticated error handling here
      }
    };

    handleAuthCheck();
  }, [user, loading, router]);

  if (loading) {
    return (
      <main className={styles.main}>
        <div style={{
          display: 'flex',
          justifyContent: 'center',
          alignItems: 'center',
          height: '100vh',
          fontSize: '18px',
          color: 'white'
        }}>
          Carregando...
        </div>
      </main>
    );
  }

  return (
    <main className={styles.main}>
      <Header />

      <section className={styles.heroSection}>
        <div className={styles.heroContainer}>
          <div className={styles.heroContent}>
            <h1 className={styles.heroTitle}>
              Cuidado inteligente que traz segurança e autonomia todos os dias.
            </h1>
            <p className={styles.heroDescription}>
              O CareMind ajuda no controle de medicações e rotinas, prevenindo esquecimentos e garantindo mais tranquilidade para famílias e cuidadores.
            </p>
            <div className={styles.heroButton}>
              <Link href="/auth?mode=register">
                <Button size="lg" className={styles.ctaButton}>
                  Quero conhecer o CareMind
                </Button>
              </Link>
            </div>
          </div>

          <div className={styles.heroImage}>
            <Image
              src="/images/hero-elderly.svg"
              alt="Idoso usando assistente virtual"
              width={500}
              height={400}
              className={styles.heroImg}
              style={{
                maxWidth: '100%',
                height: 'auto',
              }}
            />
          </div>
        </div>
      </section>

      <section className={styles.featuresSection}>
        <div className={styles.container}>
          <h1 className={styles.sectionTitle}>Tecnologia simples para um cuidado completo</h1>
          <div className={styles.featuresGrid}>
            <div className={styles.featureCard}>
              <Image
                src="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/icons/camera.svg"
                alt="Camera"
                className={styles.featureIcon}
                width={32}height={32}
              />
              <h3>Reconhecimento automático de medicamentos</h3>
              <p>Cadastre com uma foto: o sistema identifica o remédio e cria os lembretes sozinho.</p>
            </div>
            <div className={styles.featureCard}>
              <Image
                src="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/icons/mic.svg"
                alt="Microfone"
                className={styles.featureIcon}
                width={32}
                height={32}
              />
              <h3>Comandos por voz</h3>
              <p>Compatível com Alexa e Google Home. Lembretes e confirmações de dose por voz, sem tocar no aparelho.</p>
            </div>
            <div className={styles.featureCard}>
              <Image
                src="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/icons/bell.svg"
                alt="Alerta"
                className={styles.featureIcon}
                width={32}
                height={32}
              />
              <h3>Alertas inteligentes</h3>
              <p>O CareMind detecta atrasos e envia avisos antes que o esquecimento se torne um risco.</p>
            </div>
            <div className={styles.featureCard}>
              <Image
                src="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/icons/people.svg"
                alt="Pessoas"
                className={styles.featureIcon}
                width={32}
                height={32}
              />
              <h3>Família conectada</h3>
              <p>Parentes recebem notificações instantâneas sobre o andamento da rotina.</p>
            </div>
            <div className={styles.featureCard}>
              <Image
                src="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/icons/alarm.svg"
                alt="Alarme"
                className={styles.featureIcon}
                width={32}
                height={32}
              />
              <h3>Rotina personalizada</h3>
              <p>Organize horários de refeições, hidratação e atividades diárias com poucos toques.</p>
            </div>
            <div className={styles.featureCard}>
              <Image
                src="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/icons/shield.svg"
                alt="Escudo"
                className={styles.featureIcon}
                width={32}
                height={32}
              />
              <h3>Interface acessível</h3>
              <p>Textos grandes, alto contraste e navegação simples para todos os níveis de familiaridade digital.</p>
            </div>
          </div>
        </div>
      </section>

      {/* Por Que Escolher o CareMind? */}
      <section className={styles.section}>
        <div className={styles.container}>
          <h1 className={styles.container_title}>Mais independência para quem precisa, mais tranquilidade pra quem cuida.</h1>
        </div>

        <div className={styles.container_itens}>
          {/* Lista à esquerda */}
          <div className={styles.container_list}>
            <ol className={styles.container_list_ol}>
              <li>
                <h1>Autonomia com segurança</h1>
                <p>Permite que idosos mantenham suas rotinas com confiança e sem dependência constante.</p>
              </li>
              <li>
                <h1>Proteção familiar</h1>
                <p>Envia alertas automáticos para familiares em caso de esquecimento ou irregularidade.</p>
              </li>
              <li>
                <h1>Prevenção de riscos</h1>
                <p>Monitora padrões e antecipa esquecimentos, garantindo cuidado contínuo.</p>
              </li>
              <li>
                <h1>Tecnologia humana</h1>
                <p>Criado para ser usado com naturalidade — sem barreiras técnicas, sem complicação.</p>
              </li>
            </ol>
          </div>

          {/* Card de Impacto Social à direita */}
          <div className={styles.impactContainer}>
            <h2 className={styles.title}>Cuidado inteligente que já transforma famílias</h2>
            <p className={styles.description}>
              Com o envelhecimento da população e o aumento dos casos de Alzheimer, o CareMind se tornou uma ferramenta essencial no apoio diário ao cuidado familiar.
            </p>

            <div className={styles.statsGrid}>
              <div className={styles.statCard}>
                <p className={styles.statNumber}>85%</p>
                <p className={styles.statLabel}>menos esquecimentos registrados</p>
              </div>
              <div className={styles.statCard}>
                <p className={styles.statNumber}>92%</p>
                <p className={styles.statLabel}>das famílias relatam mais tranquilidade</p>
              </div>
              <div className={styles.statCard}>
                <p className={styles.statNumber}>✓</p>
                <p className={styles.statLabel}>Presente em centenas de lares que cuidam com inteligência</p>
              </div>
            </div>

            <div className={styles.heroButton}>
              <Link href="/auth?mode=register">
                <Button size="lg" className={styles.ctaButton}>
                  Quero conhecer o CareMind
                </Button>
              </Link>
            </div>
          </div>
        </div>
      </section>

      <footer>
        <Footer />
      </footer>
    </main>
  );
}

================
File: src/app/politica-privacidade/page.module.css
================
.main {
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  background: linear-gradient(135deg, #a8b8ff 0%, #9b7eff 100%);
  font-family: "League Spartan", sans-serif;
  position: relative;
  padding: 20px;
  z-index: 10;
}

.backButton {
  position: fixed;
  top: 20px;
  left: 20px;
  background: white;
  border: none;
  border-radius: 50%;
  width: 48px;
  height: 48px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  transition: background 0.2s ease, box-shadow 0.2s ease;
  z-index: 100;
  color: #0400BA;
}

.backButton:hover {
  background: #f0f0ff;
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
}

.content {
  flex: 1;
  max-width: 900px;
  width: 100%;
  margin: 0 auto;
  padding: 60px 0 40px 0;
}

.content_title {
  font-size: 36px;
  font-weight: 700;
  color: white;
  text-align: left;
  margin-bottom: 12px;
}

.subtitle {
  color: rgba(255, 255, 255, 0.9);
  font-size: 16px;
  margin-bottom: 32px;
  line-height: 1.6;
}

.section {
  background-color: white;
  border-radius: 12px;
  margin-bottom: 24px;
  padding: 32px;
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
  border: 1px solid #e5e7eb;
}

.section h3 {
  font-size: 18px;
  font-weight: 700;
  color: #0400BA;
  margin-top: 24px;
  margin-bottom: 12px;
  padding-bottom: 8px;
  border-bottom: 2px solid #f0f0ff;
}

.section h3:first-child {
  margin-top: 0;
}

.section p {
  color: #4b5563;
  line-height: 1.7;
  margin-bottom: 16px;
  font-size: 15px;
}

.section ul {
  color: #4b5563;
  line-height: 1.7;
  margin-bottom: 16px;
  padding-left: 24px;
  font-size: 15px;
}

.section li {
  margin-bottom: 12px;
}

.section li strong {
  color: #111827;
  font-weight: 700;
}

/* Responsividade */
@media (max-width: 768px) {
  .main {
    padding: 16px;
  }

  .content {
    padding: 50px 0 30px 0;
  }

  .content_title {
    font-size: 28px;
  }

  .subtitle {
    font-size: 14px;
  }

  .section {
    padding: 24px;
  }

  .section h3 {
    font-size: 16px;
    margin-top: 20px;
  }

  .section p,
  .section ul {
    font-size: 14px;
  }
}

@media (max-width: 480px) {
  .main {
    padding: 12px;
  }

  .backButton {
    width: 44px;
    height: 44px;
  }

  .content {
    padding: 45px 0 25px 0;
  }

  .content_title {
    font-size: 24px;
  }

  .subtitle {
    font-size: 13px;
    margin-bottom: 24px;
  }

  .section {
    padding: 20px;
    margin-bottom: 16px;
  }

  .section h3 {
    font-size: 15px;
    margin-top: 16px;
  }

  .section p,
  .section ul {
    font-size: 13px;
  }

  .section li {
    margin-bottom: 10px;
  }
}

================
File: src/app/politica-privacidade/page.tsx
================
"use client";

import { ArrowLeft } from "lucide-react";
import { useRouter } from 'next/navigation';
import styles from "./page.module.css";

export default function PoliticaPrivacidadePage() {
  const router = useRouter();

  return (
    <main className={styles.main}>
      <button 
        onClick={() => router.push('/')} 
        className={styles.backButton}
        aria-label="Voltar à página inicial"
      >
        <ArrowLeft size={24} />
      </button>
      <div className={styles.content}>
        <h1 className={styles.content_title}>Política de Privacidade</h1>
        <p className={styles.subtitle}>
          Saiba como seus dados são coletados, armazenados e utilizados no Caremind.
        </p>

        <section className={styles.section}>
          <p>
            O Caremind é um aplicativo dedicado ao cuidado de idosos, ajudando cuidadores a gerenciar medicamentos, rotinas e compromissos de forma organizada e segura.
          </p>

          <h3>Dados Coletados</h3>
          <p>
            Coletamos os seguintes tipos de dados pessoais:
          </p>
          <ul>
            <li><strong>Dados de Conta:</strong> Nome, email, tipo de conta (individual ou familiar).</li>
            <li><strong>Dados de Medicamentos:</strong> Nome do medicamento, dosagem, frequência, quantidade.</li>
            <li><strong>Dados de Compromissos:</strong> Título, descrição, data e hora, local, tipo de compromisso.</li>
            <li><strong>Dados de Integração:</strong> Tokens de acesso para integrações com terceiros, como Amazon Alexa.</li>
          </ul>

          <h3>Armazenamento e Segurança</h3>
          <p>
            Todos os dados são armazenados no Supabase, um banco de dados seguro na nuvem, protegido por Row Level Security (RLS). Isso significa que cada usuário só pode acessar seus próprios dados ou dados de idosos vinculados a eles (no caso de contas familiares).
          </p>
          <p>
            Implementamos medidas de segurança para proteger seus dados contra acesso não autorizado, alteração, divulgação ou destruição.
          </p>

          <h3>Uso dos Dados</h3>
          <p>
            Os dados são utilizados exclusivamente para fornecer as funcionalidades do aplicativo:
          </p>
          <ul>
            <li>Gerenciamento de medicamentos e lembretes.</li>
            <li>Organização de compromissos e rotinas.</li>
            <li>Relatórios e dashboards para cuidadores.</li>
            <li>Integrações com dispositivos inteligentes para lembretes automáticos.</li>
          </ul>

          <h3>Integrações e Compartilhamento</h3>
          <p>
            Para integrações com Amazon Alexa, coletamos tokens de acesso necessários para a autenticação. Esses tokens são usados exclusivamente para funcionalidades de lembrete e confirmação de medicamentos, rotinas e compromissos. Não compartilhamos esses dados com terceiros além do necessário para a integração.
          </p>
          <p>
            Em conformidade com a Lei Geral de Proteção de Dados (LGPD), não vendemos, alugamos ou compartilhamos seus dados pessoais com terceiros para fins comerciais, exceto quando exigido por lei.
          </p>

          <h3>Seus Direitos</h3>
          <p>
            Você tem o direito de acessar, corrigir, excluir ou portar seus dados. Para exercer esses direitos, entre em contato conosco através do email de suporte.
          </p>
        </section>
      </div>
    </main>
  );
}

================
File: src/app/privacidade/page.module.css
================
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');

.main {
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  background-color: transparent;
  font-family: "Poppins", sans-serif;
}

.content {
  flex: 1;
  max-width: 1200px;
  width: 100%;
  margin: 0 auto;
  padding: 0 20px;
}

.content_title {
  font-size: 40px;
  font-weight: 700;
  color: #0400BA;
  text-align: left;
  margin-top: 40px;
  margin-bottom: 16px;
  position: relative;
}

.content_title::after {
  content: "";
  position: absolute;
  bottom: -8px;
  left: 0;
  width: 100px;
  height: 4px;
  background-color: #0400BA;
  border-radius: 2px;
}

.subtitle {
  color: #1f2937; /* gray-800 */
  font-size: 1.125rem; /* text-lg */
  margin-top: 24px;
}

.section {
  background-color: white;
  border-radius: 20px;
  margin-top: 2rem;
  padding: 1.5rem;
  box-shadow: 0 1px 2px rgba(0,0,0,0.04);
}

.section_title {
  font-size: 1.5rem;
  font-weight: 700;
  color: #0400BA;
  margin-bottom: 1rem;
}

.section h3 {
  font-size: 1.25rem;
  font-weight: 600;
  color: #1f2937;
  margin-top: 1.5rem;
  margin-bottom: 0.5rem;
}

.section p {
  color: #374151;
  line-height: 1.6;
  margin-bottom: 1rem;
}

.section ul {
  color: #374151;
  line-height: 1.6;
  margin-bottom: 1rem;
  padding-left: 1.5rem;
}

.section li {
  margin-bottom: 0.5rem;
}

================
File: src/app/privacidade/page.tsx
================
"use client";

import { Footer } from "@/components/Footer";
import styles from "./page.module.css";

export default function PrivacidadePage() {
  return (
    <main className={styles.main}>
      <div className={styles.content}>
        <h1 className={styles.content_title}>Política de Privacidade e Termos de Uso</h1>
        <p className={styles.subtitle}>
          Saiba como seus dados são coletados, armazenados e utilizados no Caremind.
        </p>

        <section className={styles.section}>
          <h2 className={styles.section_title}>Política de Privacidade</h2>
          <p>
            O Caremind é um aplicativo dedicado ao cuidado de idosos, ajudando cuidadores a gerenciar medicamentos, rotinas e compromissos de forma organizada e segura.
          </p>

          <h3>Dados Coletados</h3>
          <p>
            Coletamos os seguintes tipos de dados pessoais:
          </p>
          <ul>
            <li><strong>Dados de Conta:</strong> Nome, email, tipo de conta (individual ou familiar).</li>
            <li><strong>Dados de Medicamentos:</strong> Nome do medicamento, dosagem, frequência, quantidade.</li>
            <li><strong>Dados de Compromissos:</strong> Título, descrição, data e hora, local, tipo de compromisso.</li>
            <li><strong>Dados de Integração:</strong> Tokens de acesso para integrações com terceiros, como Amazon Alexa.</li>
          </ul>

          <h3>Armazenamento e Segurança</h3>
          <p>
            Todos os dados são armazenados no Supabase, um banco de dados seguro na nuvem, protegido por Row Level Security (RLS). Isso significa que cada usuário só pode acessar seus próprios dados ou dados de idosos vinculados a eles (no caso de contas familiares).
          </p>
          <p>
            Implementamos medidas de segurança para proteger seus dados contra acesso não autorizado, alteração, divulgação ou destruição.
          </p>

          <h3>Uso dos Dados</h3>
          <p>
            Os dados são utilizados exclusivamente para fornecer as funcionalidades do aplicativo:
          </p>
          <ul>
            <li>Gerenciamento de medicamentos e lembretes.</li>
            <li>Organização de compromissos e rotinas.</li>
            <li>Relatórios e dashboards para cuidadores.</li>
            <li>Integrações com dispositivos inteligentes para lembretes automáticos.</li>
          </ul>

          <h3>Integrações e Compartilhamento</h3>
          <p>
            Para integrações com Amazon Alexa, coletamos tokens de acesso necessários para a autenticação. Esses tokens são usados exclusivamente para funcionalidades de lembrete e confirmação de medicamentos, rotinas e compromissos. Não compartilhamos esses dados com terceiros além do necessário para a integração.
          </p>
          <p>
            Em conformidade com a Lei Geral de Proteção de Dados (LGPD), não vendemos, alugamos ou compartilhamos seus dados pessoais com terceiros para fins comerciais, exceto quando exigido por lei.
          </p>

          <h3>Seus Direitos</h3>
          <p>
            Você tem o direito de acessar, corrigir, excluir ou portar seus dados. Para exercer esses direitos, entre em contato conosco através do email de suporte.
          </p>
        </section>

        <section className={styles.section}>
          <h2 className={styles.section_title}>Termos de Uso</h2>
          <p>
            Ao usar o Caremind, você concorda com estes termos de uso.
          </p>

          <h3>Uso do Serviço</h3>
          <p>
            O Caremind é fornecido para uso pessoal e não comercial. Você é responsável por manter a confidencialidade de suas credenciais de acesso.
          </p>

          <h3>Responsabilidades</h3>
          <ul>
            <li>O aplicativo é uma ferramenta de apoio, não substitui aconselhamento médico profissional.</li>
            <li>O usuário é responsável pela precisão dos dados inseridos (medicamentos, horários, etc.).</li>
            <li>Não use o aplicativo para fins ilegais ou prejudiciais.</li>
          </ul>

          <h3>Limitação de Responsabilidade</h3>
          <p>
            O Caremind não se responsabiliza por danos diretos, indiretos ou consequenciais decorrentes do uso do aplicativo, incluindo erros médicos ou falhas em lembretes.
          </p>

          <h3>Modificações</h3>
          <p>
            Podemos atualizar estes termos periodicamente. Continuando a usar o aplicativo após alterações, você concorda com os novos termos.
          </p>

          <h3>Contato</h3>
          <p>
            Para dúvidas sobre privacidade ou termos, entre em contato: suporte@caremind.com
          </p>
        </section>
      </div>
      <Footer />
    </main>
  );
}

================
File: src/app/reset-password/page.tsx
================
"use client";

import { useState } from "react";
import { useRouter } from "next/navigation";
import { createClient } from "@/lib/supabase/client";
import { Footer } from "@/components/Footer";

export default function ResetPasswordPage() {
  const router = useRouter();
  const supabase = createClient();
  const [password, setPassword] = useState("");
  const [confirm, setConfirm] = useState("");
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState("");
  const [message, setMessage] = useState("");

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setError("");
    setMessage("");
    if (password.length < 6) return setError("A senha deve ter pelo menos 6 caracteres.");
    if (password !== confirm) return setError("As senhas não coincidem.");
    setLoading(true);
    try {
      const { error } = await supabase.auth.updateUser({ password });
      if (error) return setError(error.message);
      setMessage("Senha atualizada com sucesso. Faça login novamente.");
      setTimeout(() => router.replace("/auth"), 1200);
    } catch (err) {
      setError("Não foi possível atualizar a senha.");
    } finally {
      setLoading(false);
    }
  };

  return (
    <main style={{ minHeight: "100vh", display: "flex", flexDirection: "column" }}>
      <section style={{ flex: 1, display: "flex", alignItems: "center", justifyContent: "center", padding: 24 }}>
        <form onSubmit={handleSubmit} style={{ background: "white", padding: 24, borderRadius: 12, maxWidth: 400, width: "100%", boxShadow: "0 10px 30px rgba(147, 155, 238, 0.2)" }}>
          <h1 style={{ margin: 0, fontSize: 28, fontWeight: 800, color: "#0400BA", textAlign: "center" }}>Redefinir senha</h1>
          <div style={{ display: "flex", flexDirection: "column", gap: 12, marginTop: 16 }}>
            <label>
              Nova senha
              <input type="password" value={password} onChange={(e) => setPassword(e.target.value)} required style={{ width: "100%", padding: 12, borderRadius: 8, border: "1px solid #e0e7ff", marginTop: 6 }} />
            </label>
            <label>
              Confirmar senha
              <input type="password" value={confirm} onChange={(e) => setConfirm(e.target.value)} required style={{ width: "100%", padding: 12, borderRadius: 8, border: "1px solid #e0e7ff", marginTop: 6 }} />
            </label>
            {error && <div style={{ color: "#c53030", fontSize: 14 }}>{error}</div>}
            {message && <div style={{ color: "#2f855a", fontSize: 14 }}>{message}</div>}
            <button type="submit" disabled={loading} style={{ marginTop: 8, background: "linear-gradient(135deg,#0400ba,#020054)", color: "white", padding: 12, borderRadius: 10, border: "none", fontWeight: 700 }}>
              {loading ? "Salvando..." : "Salvar nova senha"}
            </button>
          </div>
        </form>
      </section>
      <Footer />
    </main>
  );
}

================
File: src/app/seguranca/page.tsx
================
"use client";

import { Footer } from "@/components/Footer";

export default function SegurancaPage() {
  return (
    <main style={{ minHeight: "100vh", display: "flex", flexDirection: "column" }}>
      <section style={{ flex: 1, display: "flex", alignItems: "center", justifyContent: "center", padding: 24 }}>
        <div style={{ textAlign: "center", color: "#0b0b2e" }}>
          <h1 style={{ fontSize: 40, fontWeight: 800, margin: 0 }}>Segurança</h1>
          <p style={{ marginTop: 12, color: "#2d3748" }}>Informações sobre segurança estarão disponíveis em breve.</p>
        </div>
      </section>
      <Footer />
    </main>
  );
}

================
File: src/app/sobre/page.tsx
================
"use client";

import { Footer } from "@/components/Footer";

export default function SobrePage() {
  return (
    <main style={{ minHeight: "100vh", display: "flex", flexDirection: "column" }}>
      <section style={{ flex: 1, display: "flex", alignItems: "center", justifyContent: "center", padding: 24 }}>
        <div style={{ textAlign: "center", color: "#0b0b2e" }}>
          <h1 style={{ fontSize: 40, fontWeight: 800, margin: 0 }}>Sobre</h1>
          <p style={{ marginTop: 12, color: "#2d3748" }}>Conheça a história e missão do CareMind (conteúdo em breve).</p>
        </div>
      </section>
      <Footer />
    </main>
  );
}

================
File: src/app/status/page.tsx
================
"use client";

import { Footer } from "@/components/Footer";

export default function StatusPage() {
  return (
    <main style={{ minHeight: "100vh", display: "flex", flexDirection: "column" }}>
      <section style={{ flex: 1, display: "flex", alignItems: "center", justifyContent: "center", padding: 24 }}>
        <div style={{ textAlign: "center", color: "#0b0b2e" }}>
          <h1 style={{ fontSize: 40, fontWeight: 800, margin: 0 }}>Status</h1>
          <p style={{ marginTop: 12, color: "#2d3748" }}>Monitoramento de status do sistema será listado aqui.</p>
        </div>
      </section>
      <Footer />
    </main>
  );
}

================
File: src/app/termos/page.module.css
================
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');

.main {
  display: flex;
  flex-direction: column;
  min-height: 100vh;
  background-color: transparent;
  font-family: "Poppins", sans-serif;
  position: relative;
}

.backButton {
  position: absolute;
  top: 20px;
  left: 20px;
  background: rgba(255, 255, 255, 0.9);
  border: none;
  border-radius: 50%;
  width: 48px;
  height: 48px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  transition: background 0.2s ease;
  z-index: 10;
}

.backButton:hover {
  background: rgba(255, 255, 255, 1);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.content {
  flex: 1;
  max-width: 1200px;
  width: 100%;
  margin: 0 auto;
  padding: 0 20px;
}

.content_title {
  font-size: 40px;
  font-weight: 700;
  color: #0400BA;
  text-align: left;
  margin-top: 40px;
  margin-bottom: 16px;
  position: relative;
}

.content_title::after {
  content: "";
  position: absolute;
  bottom: -8px;
  left: 0;
  width: 100px;
  height: 4px;
  background-color: #0400BA;
  border-radius: 2px;
}

.subtitle {
  color: #1f2937; /* gray-800 */
  font-size: 1.125rem; /* text-lg */
  margin-top: 24px;
}

.section {
  background-color: white;
  border-radius: 20px;
  margin-top: 2rem;
  margin-bottom: 2rem;
  padding: 1.5rem;
  box-shadow: 0 1px 2px rgba(0,0,0,0.04);
}

.section h3 {
  font-size: 1.25rem;
  font-weight: 600;
  color: #1f2937;
  margin-top: 1.5rem;
  margin-bottom: 0.5rem;
}

.section p {
  color: #374151;
  line-height: 1.6;
  margin-bottom: 1rem;
}

.section ul {
  color: #374151;
  line-height: 1.6;
  margin-bottom: 1rem;
  padding-left: 1.5rem;
}

.section li {
  margin-bottom: 0.5rem;
}

================
File: src/app/termos/page.tsx
================
"use client";

import { ArrowLeft } from "lucide-react";
import { useRouter } from 'next/navigation';
import styles from "./page.module.css";

export default function TermosPage() {
  const router = useRouter();

  return (
    <main className={styles.main}>
      <button 
        onClick={() => router.push('/')} 
        className={styles.backButton}
        aria-label="Voltar à página inicial"
      >
        <ArrowLeft size={24} />
      </button>
      <div className={styles.content}>
        <h1 className={styles.content_title}>Termos de Uso</h1>
        <p className={styles.subtitle}>
          Leia os termos e condições para o uso do Caremind.
        </p>

        <section className={styles.section}>
          <p>
            Ao usar o Caremind, você concorda com estes termos de uso.
          </p>

          <h3>Uso do Serviço</h3>
          <p>
            O Caremind é fornecido para uso pessoal e não comercial. Você é responsável por manter a confidencialidade de suas credenciais de acesso.
          </p>

          <h3>Responsabilidades</h3>
          <ul>
            <li>O aplicativo é uma ferramenta de apoio, não substitui aconselhamento médico profissional.</li>
            <li>O usuário é responsável pela precisão dos dados inseridos (medicamentos, horários, etc.).</li>
            <li>Não use o aplicativo para fins ilegais ou prejudiciais.</li>
          </ul>

          <h3>Limitação de Responsabilidade</h3>
          <p>
            O Caremind não se responsabiliza por danos diretos, indiretos ou consequenciais decorrentes do uso do aplicativo, incluindo erros médicos ou falhas em lembretes.
          </p>

          <h3>Modificações</h3>
          <p>
            Podemos atualizar estes termos periodicamente. Continuando a usar o aplicativo após alterações, você concorda com os novos termos.
          </p>

          <h3>Contato</h3>
          <p>
            Para dúvidas sobre privacidade ou termos, entre em contato: suporte@caremind.com
          </p>
        </section>
      </div>
    </main>
  );
}

================
File: src/components/ClientAreaHeader.module.css
================
.header {
  position: sticky;
  top: 0;
  z-index: 950;
  display: flex;
  align-items: center;
  justify-content: space-between;
  height: 64px;
  padding: 0 16px;
  background: #ffffff;
  border-bottom: 1px solid #eef2f7;
}

.left {
  display: flex;
  align-items: center;
  gap: 12px;
}

.logoLink { display: inline-flex; align-items: center; }

.right {
  display: flex;
  align-items: center;
  gap: 10px;
}

.profileContainer { position: relative; }
.profileButton {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  background: transparent;
  border: 1px solid #e5e7eb;
  border-radius: 9999px;
  padding: 6px 10px;
  cursor: pointer;
}
.profileName { color: #111827; font-weight: 500; font-size: 14px; }
.profilePicture { border-radius: 9999px; object-fit: cover; }
.person { color: #0400BA; }

.dropdownMenu {
  position: absolute;
  right: 0;
  margin-top: 8px;
  background: #fff;
  border: 1px solid #e5e7eb;
  border-radius: 8px;
  box-shadow: 0 10px 20px rgba(0,0,0,0.08);
  min-width: 180px;
  overflow: hidden;
  z-index: 1000;
}
.dropdownItem {
  display: block;
  padding: 10px 12px;
  color: #111827;
  text-decoration: none;
  border: none;
  background: transparent;
  width: 100%;
  text-align: left;
  cursor: pointer;
}
.dropdownItem:hover { background: #f9fafb; }
.dropdownLogout { color: #b91c1c; }

================
File: src/components/ClientAreaHeader.tsx
================
"use client";
import { useState, useEffect, useRef } from "react";
import Link from "next/link";
import Image from "next/image";
import { useRouter } from "next/navigation";
import { useAuth } from "@/contexts/AuthContext";
import { useProfile } from "@/contexts/ProfileContext";
import styles from "./ClientAreaHeader.module.css";
import { IoPersonCircleOutline } from "react-icons/io5";

export function ClientAreaHeader() {
  const { user, signOut } = useAuth();
  const { photoUrl } = useProfile();
  const router = useRouter();

  const [isProfileOpen, setIsProfileOpen] = useState(false);
  const profileMenuRef = useRef<HTMLDivElement>(null);

  useEffect(() => {
    const onDocClick = (e: MouseEvent) => {
      if (profileMenuRef.current && !profileMenuRef.current.contains(e.target as Node)) {
        setIsProfileOpen(false);
      }
    };
    document.addEventListener("mousedown", onDocClick);
    return () => document.removeEventListener("mousedown", onDocClick);
  }, []);

  const displayName = user?.user_metadata?.full_name || user?.email || "";

  const handleLogout = async () => {
    await signOut();
    router.push("/");
  };

  return (
    <header className={styles.header}>
      <div className={styles.left}>
        <Link href="/dashboard" className={styles.logoLink} aria-label="Voltar para o dashboard">
          <Image src="/logo_coracao.png" alt="CareMind" width={140} height={44} priority />
        </Link>
      </div>
      <div className={styles.right}>
        <div className={styles.profileContainer} ref={profileMenuRef}>
          <button className={styles.profileButton} onClick={() => setIsProfileOpen((v) => !v)} aria-haspopup="menu" aria-expanded={isProfileOpen}>
            {photoUrl ? (
              <Image 
                src={photoUrl} 
                alt="Foto de perfil" 
                width={28} 
                height={28} 
                className={styles.profilePicture}
                key={photoUrl}
              />
            ) : (
              <IoPersonCircleOutline className={styles.person} size={28} />
            )}
            <span className={styles.profileName}>{displayName}</span>
          </button>
          {isProfileOpen && (
            <div className={styles.dropdownMenu} role="menu">
              <Link href="/perfil" className={styles.dropdownItem} onClick={() => setIsProfileOpen(false)}>
                Perfil
              </Link>
              <button className={`${styles.dropdownItem} ${styles.dropdownLogout}`} onClick={handleLogout}>
                Sair
              </button>
            </div>
          )}
        </div>
      </div>
    </header>
  );
}

================
File: src/components/ConfirmDialog.module.css
================
.dialogContent {
  padding: 0 0 1rem;
}

.message {
  margin: 0 0 1.5rem;
  color: #4b5563;
  line-height: 1.5;
  font-size: 1rem;
}

.buttons {
  display: flex;
  justify-content: flex-end;
  gap: 0.75rem;
  margin-top: 1.5rem;
}

.button {
  padding: 0.5rem 1.25rem;
  border-radius: 0.5rem;
  font-weight: 500;
  font-size: 0.875rem;
  cursor: pointer;
  transition: all 0.2s ease;
  border: 1px solid transparent;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  min-width: 100px;
}

.cancelButton {
  background-color: #f3f4f6;
  color: #374151;
  border-color: #e5e7eb;
}

.cancelButton:hover {
  background-color: #e5e7eb;
}

.confirmButton {
  background-color: #0400BA;
  color: white;
}

.confirmButton:hover {
  background-color: #2d2dff;
  transform: translateY(-1px);
}

.dangerButton {
  background-color: #dc2626;
  color: white;
}

.dangerButton:hover {
  background-color: #b91c1c;
  transform: translateY(-1px);
}

/* Efeito de clique */
.button:active {
  transform: translateY(0);
}

/* Foco visível para acessibilidade */
.button:focus-visible {
  outline: 2px solid #0400BA;
  outline-offset: 2px;
}

/* Responsividade */
@media (max-width: 480px) {
  .buttons {
    flex-direction: column;
    gap: 0.5rem;
  }
  
  .button {
    width: 100%;
    padding: 0.625rem 1.25rem;
  }
}

================
File: src/components/ConfirmDialog.tsx
================
'use client';

import { Modal } from './Modal';
import styles from './ConfirmDialog.module.css';

interface ConfirmDialogProps {
  isOpen: boolean;
  title: string;
  message: string;
  confirmText?: string;
  cancelText?: string;
  onConfirm: () => void;
  onCancel: () => void;
  danger?: boolean;
}

export function ConfirmDialog({
  isOpen,
  title,
  message,
  confirmText = 'Confirmar',
  cancelText = 'Cancelar',
  onConfirm,
  onCancel,
  danger = true
}: ConfirmDialogProps) {
  if (!isOpen) return null;

  return (
    <Modal isOpen={isOpen} onClose={onCancel} title={title}>
      <div className={styles.dialogContent}>
        <p className={styles.message}>{message}</p>
        <div className={styles.buttons}>
          <button 
            onClick={onCancel}
            className={`${styles.button} ${styles.cancelButton}`}
          >
            {cancelText}
          </button>
          <button
            onClick={onConfirm}
            className={`${styles.button} ${danger ? styles.dangerButton : styles.confirmButton}`}
            autoFocus
          >
            {confirmText}
          </button>
        </div>
      </div>
    </Modal>
  );
}

================
File: src/components/dashboard/DashboardOverview.module.css
================
.wrapper {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.banner {
  background: linear-gradient(135deg, rgba(4,0,185,0.12), rgba(4,0,185,0.04));
  border: 1px solid rgba(4,0,185,0.14);
  padding: 20px;
  border-radius: 16px;
}

.bannerTitle {
  margin: 0;
  font-size: 22px;
  font-weight: 800;
  color: #0f172a;
}

.bannerSubtitle {
  margin: 4px 0 0 0;
  color: #334155;
  font-size: 14px;
}

.kpis {
  display: grid;
  grid-template-columns: repeat(4, minmax(0, 1fr));
  gap: 12px;
}

.card {
  background: #ffffff;
  border: 1px solid rgba(0,0,0,0.06);
  border-radius: 12px;
  padding: 14px;
}

.cardTitle {
  font-size: 12px;
  color: #64748b;
}

.cardValue {
  display: block;
  margin-top: 6px;
  font-size: 18px;
  font-weight: 700;
  color: #0f172a;
}

.grid {
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 12px;
}

.panel {
  background: #ffffff;
  border: 1px solid rgba(0,0,0,0.06);
  border-radius: 12px;
  padding: 16px;
}

.panelTitle {
  margin: 0 0 10px 0;
  font-size: 16px;
  font-weight: 700;
  color: #0f172a;
}

.placeholder {
  height: 160px;
  display: grid;
  place-items: center;
  color: #475569;
  background: repeating-linear-gradient(
    45deg,
    #f8fafc,
    #f8fafc 10px,
    #f1f5f9 10px,
    #f1f5f9 20px
  );
  border-radius: 8px;
  border: 1px dashed rgba(0,0,0,0.08);
}

@media (max-width: 1024px) {
  .kpis {
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }
  .grid {
    grid-template-columns: 1fr;
  }
}

================
File: src/components/dashboard/DashboardOverview.tsx
================
"use client";
import styles from "./DashboardOverview.module.css";

export default function DashboardOverview() {
  return (
    <div className={styles.wrapper}>
      <section className={styles.banner}>
        <div>
          <h2 className={styles.bannerTitle}>Dashboard CareMind</h2>
          <p className={styles.bannerSubtitle}>Visão completa do seu cuidado</p>
        </div>
      </section>

      <section className={styles.kpis}>
        <div className={styles.card}>
          <span className={styles.cardTitle}>Medicamentos de Hoje</span>
          <span className={styles.cardValue}>2 de 5 concluídos</span>
        </div>
        <div className={styles.card}>
          <span className={styles.cardTitle}>Rotinas do Dia</span>
          <span className={styles.cardValue}>1 de 3 concluídas</span>
        </div>
        <div className={styles.card}>
          <span className={styles.cardTitle}>Alertas Pendentes</span>
          <span className={styles.cardValue}>0</span>
        </div>
        <div className={styles.card}>
          <span className={styles.cardTitle}>Status do Vínculo Familiar</span>
          <span className={styles.cardValue}>Conectado</span>
        </div>
      </section>

      <section className={styles.grid}>
        <div className={styles.panel}>
          <h3 className={styles.panelTitle}>Próximos Medicamentos</h3>
          <div className={styles.placeholder}>Lista de próximos horários aparecerá aqui.</div>
        </div>
        <div className={styles.panel}>
          <h3 className={styles.panelTitle}>Resumo da Semana</h3>
          <div className={styles.placeholder}>Gráfico e indicadores semanais aparecerão aqui.</div>
        </div>
      </section>
    </div>
  );
}

================
File: src/components/DashboardClient.module.css
================
.dashboard_client {
  padding: 32px;
  min-height: 100vh;
  max-width: none;
  margin: 0;
  position: relative;
  width: 100%;
}

.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 32px;
  padding: 24px;
  background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
  border: 1px solid rgba(255, 255, 255, 0.2);
  backdrop-filter: blur(10px);
}

.header h1 {
  color: #1e293b;
  font-size: 2rem;
  font-weight: 800;
  margin: 0;
  background: linear-gradient(135deg, #0400BA 0%, #2d2dff 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  letter-spacing: -0.02em;
}

.actions {
  display: flex;
  gap: 12px;
  align-items: center;
}

.button {
  padding: 12px 24px;
  border: none;
  border-radius: 12px;
  font-size: 0.95rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  display: flex;
  align-items: center;
  gap: 8px;
  position: relative;
  overflow: hidden;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.button::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
  transition: left 0.5s ease;
}

.button:hover::before {
  left: 100%;
}

.button.primary {
  background: linear-gradient(135deg, #0400BA 0%, #2d2dff 100%);
  color: white;
}

.button.primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(4, 0, 186, 0.3);
}

.button:not(.primary) {
  background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
  color: #475569;
  border: 1px solid #e2e8f0;
}

.button:not(.primary):hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
  border-color: #cbd5e1;
}

.cards_container {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
  gap: 24px;
  margin-bottom: 40px;
}

/* Seções principais no dashboard (alertas e agenda) */
.alerts_section {
  margin-top: 12px;
  margin-bottom: 20px; /* espaço abaixo dos alertas antes da agenda */
}

.agenda_section {
  margin-top: 24px; /* espaço adicional acima da agenda */
}

.section_title {
  display: flex;
  align-items: center;
  gap: 8px;
  margin: 0 0 12px 0;
  font-size: 1rem;
  font-weight: 800;
  color: #0f172a;
}

.card {
  background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
  border-radius: 20px;
  padding: 2rem;
  box-shadow: 
    0 10px 40px rgba(0, 0, 0, 0.08),
    0 4px 12px rgba(0, 0, 0, 0.04);
  border: 1px solid rgba(255, 255, 255, 0.2);
  display: flex;
  flex-direction: column;
  position: relative;
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  overflow: hidden;
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
}

.card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(90deg, #0400BA, #2d2dff);
  transform: scaleX(0);
  transform-origin: left;
  transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  z-index: 1;
}

.card:hover {
  transform: translateY(-2px) scale(1.02);
  box-shadow: 
    0 20px 60px rgba(0, 0, 0, 0.12),
    0 8px 20px rgba(0, 0, 0, 0.08);
  border-color: rgba(4, 0, 186, 0.2);
}

.card:hover::before {
  transform: scaleX(1);
}

.card h3 {
  margin: 0 0 1.25rem 0;
  color: #1a1a2e;
  font-size: 1.25rem;
  font-weight: 700;
  letter-spacing: -0.01em;
  position: relative;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.card h3::before {
  content: '';
  display: block;
  width: 6px;
  height: 1.5rem;
  background: linear-gradient(to bottom, #0400BA, #2d2dff);
  border-radius: 3px;
  margin-right: 0.5rem;
}

.card p {
  color: #4a5568;
  font-size: 0.95rem;
  margin: 0.25rem 0;
  line-height: 1.5;
  margin: 4px 0;
  font-weight: 500;
  display: flex;
  justify-content: space-between;
  align-items: center;
  width: 100%;
}

.card p:first-of-type {
  color: #475569;
  font-weight: 600;
}

.alerts_summary{
  display: flex;
  flex-direction: column;
  gap: 12px;
  color: black;
}

.card_content {
  display: flex;
  justify-content: space-between;
  align-items: center;
  width: 100%;
  gap: 32px;
  margin-top: 16px;
}

.card_stat {
  text-align: center;
  flex: 1;
  position: relative;
}

.card_stat:not(:last-child)::after {
  content: '';
  position: absolute;
  right: -16px;
  top: 50%;
  transform: translateY(-50%);
  width: 1px;
  height: 40px;
  background: linear-gradient(to bottom, transparent, #e2e8f0, transparent);
}

.stat_number {
  display: block;
  font-size: 3rem;
  font-weight: 900;
  background: linear-gradient(135deg, #0400BA 0%, #2d2dff 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  line-height: 1;
  margin-bottom: 8px;
  transition: all 0.3s ease;
}

.stat_label {
  display: block;
  font-size: 0.875rem;
  color: #64748b;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.1em;
}

.add_btn {
  margin-top: 14px;
  background: #0400BA;
  color: #fff;
  border: none;
  border-radius: 10px;
  padding: 10px 16px;
  font-size: 0.9rem;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.2s ease;
  box-shadow: 0 4px 12px rgba(4, 0, 186, 0.25);
  position: relative;
  overflow: hidden;
  width: fit-content;
}

.add_btn::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.15), transparent);
  transition: left 0.4s ease;
}

.add_btn:hover {
  background: #2d2dff;
  transform: translateY(-1px);
  box-shadow: 0 6px 18px rgba(4, 0, 186, 0.35);
}

.add_btn:hover::before {
  left: 100%;
}

.add_btn:active {
  transform: translateY(0);
}

.list_section {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 40px;
  margin-top: 40px;
  background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
  border-radius: 24px;
  padding: 32px;
  box-shadow: 
    0 12px 40px rgba(0, 0, 0, 0.08),
    0 4px 12px rgba(0, 0, 0, 0.04);
  border: 1px solid rgba(255, 255, 255, 0.2);
  backdrop-filter: blur(10px);
}

.list_container {
  display: flex;
  flex-direction: column;
}

.list_header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
  padding-bottom: 12px;
  border-bottom: 2px solid #f1f5f9;
  position: relative;
}

.list_header h3 {
  color: #1e293b;
  font-size: 1.25rem;
  font-weight: 700;
  margin: 0;
  background: linear-gradient(135deg, #0400BA 0%, #2d2dff 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.add_button {
  padding: 8px 16px;
  background: linear-gradient(135deg, #0400BA 0%, #2d2dff 100%);
  color: white;
  border: none;
  border-radius: 10px;
  font-size: 0.875rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  display: flex;
  align-items: center;
  gap: 6px;
  box-shadow: 0 4px 12px rgba(4, 0, 186, 0.2);
}

.add_button:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(4, 0, 186, 0.3);
}

.empty_list {
  text-align: center;
  color: #64748b;
  font-style: italic;
  padding: 60px 20px;
  background: linear-gradient(145deg, #f8fafc 0%, #f1f5f9 100%);
  border-radius: 16px;
  border: 2px dashed #cbd5e1;
  font-size: 1.1rem;
  font-weight: 500;
}

.list {
  list-style: none;
  padding: 0;
  margin: 0;
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.list_item {
  background: linear-gradient(145deg, #ffffff 0%, #fefefe 100%);
  border-radius: 16px;
  border: 1px solid #e2e8f0;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
  padding: 20px;
  display: flex;
}

.list_item:hover {
  transform: translateY(-4px);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
  border-color: rgba(4, 0, 186, 0.2);
}

.list_item.completed {
  opacity: 0.7;
  background-color: #f8fafc;
}

.list_item.completed .medicamento_header,
.list_item.completed .medicamento_schedule {
  text-decoration: line-through;
  opacity: 0.8;
}

.item_info {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.item_info strong {
  font-size: 1.1rem;
  font-weight: 700;
  color: #1e293b;
  margin-bottom: 4px;
}

.item_info span {
  font-size: 0.9rem;
  color: #64748b;
  line-height: 1.5;
  max-width: 75%;
}

.item_actions {
  display: flex;
  gap: 8px;
  align-items: center;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.list_item:hover .item_actions {
  opacity: 1;
}

.medicamento_info {
  flex: 1;
  min-width: 0;
}

.medicamento_header {
  display: flex;
  align-items: center;
  flex-wrap: wrap;
  gap: 8px;
  margin-bottom: 6px;
  font-size: 1rem;
  color: #1e293b;
}

.medicamento_header strong {
  font-weight: 600;
  color: #1e293b;
}

.medicamento_header span {
  color: #64748b;
  font-size: 0.9em;
}

.medicamento_schedule {
  display: flex;
  flex-direction: column;
  gap: 4px;
  font-size: 0.85rem;
  color: #64748b;
}

.frequencia {
  display: inline-flex;
  align-items: center;
  background: #f1f5ff;
  color: #1e40af;
  padding: 2px 8px;
  border-radius: 4px;
  font-size: 0.8rem;
  margin-top: 4px;
  line-height: 1.4;
}

.rotina_info {
  flex: 1;
}

.rotina_header {
  margin-bottom: 4px;
}

.rotina_header strong {
  font-weight: 600;
  color: #1e293b;
}

.rotina_schedule {
  font-size: 0.85rem;
  color: #64748b;
}

.button_primary,
.button_secondary,
.editButton {
  padding: 8px 16px;
  border: none;
  border-radius: 6px;
  font-size: 0.85rem;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s ease;
  white-space: nowrap;
  min-width: 100px;
  text-align: center;
}

.button_primary {
  background-color: #0400BA;
  color: white;
}

.button_primary:hover {
  background-color: #2d2dff;
  transform: translateY(-1px);
}

.button_secondary {
  background-color: #f1f5f9;
  color: #475569;
  border: 1px solid #e2e8f0;
}

.button_secondary:hover {
  background-color: #e2e8f0;
  transform: translateY(-1px);
}

.list_item button {
  background: #0400BA;
  color: #fff;
  border: none;
  border-radius: 6px;
  padding: 6px 14px;
  font-size: 0.875rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s ease;
  box-shadow: 0 1px 3px rgba(4, 0, 186, 0.2);
  min-width: 80px;
}

.list_item button:hover {
  background: #2d2dff;
  transform: translateY(-1px);
  box-shadow: 0 2px 6px rgba(4, 0, 186, 0.3);
}

.list_item button:active {
  transform: translateY(0);
}

/* Estilos para os botões de ação */
.actions {
  display: flex;
  gap: 6px;
  margin-left: auto;
  padding-left: 12px;
  opacity: 0;
  transition: opacity 0.2s ease;
}

.list_item:hover .actions {
  opacity: 1;
}

.icon_button {
  width: 36px;
  height: 36px;
  border: none;
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  background: #f8fafc;
  color: #64748b;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
}

.icon_button:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  background: #f1f5f9;
  color: #0400BA;
}

.icon_button.danger {
  color: #ef4444;
  background: #fef2f2;
}

.icon_button.danger:hover {
  background: #fee2e2;
  color: #dc2626;
}

.iconButton {
  background: #f8fafc;
  color: #64748b;
  border: 1px solid #e2e8f0;
  border-radius: 8px;
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  padding: 0;
  flex-shrink: 0;
  box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
  position: relative;
  overflow: hidden;
}

.iconButton::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 5px;
  height: 5px;
  background: rgba(255, 255, 255, 0.5);
  opacity: 0;
  border-radius: 100%;
  transform: scale(1, 1) translate(-50%, -50%);
  transform-origin: 50% 50%;
}

.iconButton:focus:not(:active)::after {
  animation: ripple 0.6s ease-out;
}

@keyframes ripple {
  0% {
    transform: scale(0, 0);
    opacity: 0.5;
  }
  100% {
    transform: scale(20, 20);
    opacity: 0;
  }
}

.iconButton:hover {
  background: #f1f5f9;
  color: #0400BA;
  border-color: #cbd5e1;
  transform: translateY(-1px);
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
}

.iconButton:active {
  transform: translateY(0);
  box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
}

.deleteButton {
  color: #ef4444;
  border-color: #fee2e2;
  background: #fef2f2;
}

.deleteButton:hover {
  background: #fee2e2;
  color: #dc2626;
  border-color: #fecaca;
}

/* Estilo para o botão de status (concluir/desfazer) */
.statusButton {
  background: #f0fdf4;
  border: 1px solid #bbf7d0;
  margin-right: 10px;
  border-radius: 8px;
  width: 36px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  padding: 0;
  flex-shrink: 0;
  box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
  position: relative;
  overflow: hidden;
}

.statusButton::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 5px;
  height: 5px;
  background: rgba(255, 255, 255, 0.5);
  opacity: 0;
  border-radius: 100%;
  transform: scale(1, 1) translate(-50%, -50%);
  transform-origin: 50% 50%;
}

.statusButton:focus:not(:active)::after {
  animation: ripple 0.6s ease-out;
}

.statusButton:hover {
  background: #dcfce7;
  border-color: #86efac;
  transform: translateY(-1px);
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
}

.statusButton:active {
  transform: translateY(0);
  box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
}

.statusButton.completed {
  background: #f0f9ff;
  color: #0ea5e9;
  border-color: #bae6fd;
}

.statusButton.completed:hover {
  background: #e0f2fe;
  color: #0284c7;
  border-color: #7dd3fc;
}

/* Melhorias na acessibilidade */
.iconButton:focus,
.statusButton:focus {
  outline: none;
  box-shadow: 0 0 0 3px rgba(4, 0, 186, 0.2);
}

/* Transição suave para o hover dos botões */
.iconButton,
.statusButton {
  will-change: transform, box-shadow;
  backface-visibility: hidden;
  -webkit-font-smoothing: subpixel-antialiased;
}

/* Ajustes para o layout dos itens */
.medicamento_header,
.rotina_header {
  display: flex;
  align-items: flex-start;
  gap: 8px;
  width: 100%;
}

.medicamento_header strong,
.rotina_header strong {
  margin-right: auto;
}

.medicamento_schedule {
  width: 100%;
  margin-top: 6px;
  padding-top: 6px;
  border-top: 1px dashed #e2e8f0;
}

/* Estados especiais */
.list_item.completed {
  opacity: 0.7;
  background: #f8fafc;
  border-color: #e2e8f0;
}

.list_item.completed .medicamento_header,
.list_item.completed .medicamento_schedule,
.list_item.completed .rotina_header,
.list_item.completed .rotina_schedule {
  opacity: 0.8;
}

.list_item.completed .medicamento_header strong,
.list_item.completed .rotina_header strong {
  text-decoration: line-through;
  color: #94a3b8;
}

.list_item.completed .medicamento_schedule,
.list_item.completed .rotina_schedule {
  color: #94a3b8;
}

.list_item.completed .frequencia {
  background: #f1f5f9;
  color: #94a3b8;
}

/* Animações sutis */
@keyframes slideInUp {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.card, .list_section {
  animation: slideInUp 0.4s ease-out;
}

.card:nth-child(2) {
  animation-delay: 0.05s;
}

/* Responsivo para tablets */
@media (max-width: 1024px) {
  .dashboard_client {
    padding: 24px;
  }

  .header {
    padding: 20px;
    flex-direction: column;
    gap: 16px;
    text-align: center;
  }

  .actions {
    width: 100%;
    justify-content: center;
  }

  .cards_container {
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
  }

  .card {
    padding: 24px;
  }

  .list_section {
    grid-template-columns: 1fr;
    gap: 32px;
    padding: 28px;
  }
}

/* Responsivo para dispositivos móveis */
@media (max-width: 768px) {
  .dashboard_client {
    padding: 20px;
  }

  .header {
    padding: 20px;
    flex-direction: column;
    gap: 16px;
    text-align: center;
  }

  .header h1 {
    font-size: 1.75rem;
  }

  .actions {
    flex-direction: column;
    width: 100%;
    gap: 12px;
  }

  .button {
    width: 100%;
    justify-content: center;
    padding: 14px 20px;
  }

  .cards_container {
    grid-template-columns: 1fr;
    gap: 20px;
    margin-bottom: 32px;
  }

  .card {
    padding: 24px;
  }

  .card_content {
    gap: 24px;
  }

  .stat_number {
    font-size: 2.5rem;
  }

  .list_section {
    grid-template-columns: 1fr;
    gap: 32px;
    padding: 24px;
    margin-top: 32px;
  }

  .list_item {
    padding: 18px;
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
  }

  .item_actions {
    opacity: 1;
    flex-direction: column;
    gap: 6px;
  }

  .icon_button {
    width: 32px;
    height: 32px;
  }
}

/* Responsivo para telas pequenas */
@media (max-width: 480px) {
  .dashboard_client {
    padding: 16px;
  }

  .header {
    padding: 16px;
  }

  .header h1 {
    font-size: 1.5rem;
  }

  .button {
    padding: 12px 16px;
    font-size: 0.9rem;
  }

  .card {
    padding: 20px;
  }

  .card h3 {
    font-size: 1.1rem;
  }

  .card_content {
    flex-direction: column;
    gap: 16px;
  }

  .card_stat:not(:last-child)::after {
    display: none;
  }

  .stat_number {
    font-size: 2.25rem;
  }

  .list_section {
    padding: 20px;
    margin-top: 24px;
  }

  .list_header {
    flex-direction: column;
    align-items: flex-start;
    gap: 12px;
  }

  .add_button {
    width: 100%;
    justify-content: center;
  }

  .list_item {
    padding: 16px;
    flex-direction: column;
    gap: 12px;
  }

  .item_actions {
    width: 100%;
    justify-content: flex-end;
    flex-direction: row;
  }

  .empty_list {
    padding: 40px 16px;
    font-size: 1rem;
  }
}

/* Responsivo para telas muito pequenas */
@media (max-width: 360px) {
  .dashboard_client {
    padding: 12px;
  }

  .header {
    padding: 12px;
  }

  .header h1 {
    font-size: 1.25rem;
  }

  .button {
    padding: 10px 14px;
    font-size: 0.85rem;
  }

  .card {
    padding: 16px;
  }

  .card h3 {
    font-size: 1rem;
  }

  .stat_number {
    font-size: 2rem;
  }

  .stat_label {
    font-size: 0.8rem;
  }

  .list_section {
    padding: 16px;
  }

  .list_item {
    padding: 14px;
  }

  .icon_button {
    width: 28px;
    height: 28px;
  }

  .empty_list {
    padding: 32px 12px;
    font-size: 0.95rem;
  }
}

/* Estados de foco para acessibilidade */
.add_btn:focus,
.list_item button:focus {
  outline: 2px solid #0400BA;
  outline-offset: 2px;
}

/* Progress bar melhorada (se existir) */
.progress_bar {
  width: 100%;
  height: 10px;
  background-color: #e2e8f0;
  border-radius: 5px;
  margin: 10px 0;
  overflow: hidden;
  position: relative;
}

.progress_fill {
  height: 100%;
  background: linear-gradient(90deg, #0400BA, #2d2dff);
  border-radius: 5px;
  transition: width 0.5s ease-in-out;
  position: relative;
  overflow: hidden;
}

.progress_fill::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(
    90deg,
    rgba(255, 255, 255, 0) 0%,
    rgba(255, 255, 255, 0.2) 50%,
    rgba(255, 255, 255, 0) 100%
  );
  animation: shimmer 2s infinite linear;
}

@keyframes shimmer {
  0% {
    transform: translateX(-100%);
  }
  100% {
    transform: translateX(100%);
  }
}

================
File: src/components/DashboardClient.tsx
================
'use client';

// Importações básicas do React
import React, { useState, useEffect, useCallback, useMemo, useRef } from 'react';
import { createClient } from '@/lib/supabase/client';
import { useAuth } from '@/contexts/AuthContext';
import { shouldResetMedicamento } from '@/lib/medicamentoUtils';

import styles from './DashboardClient.module.css';
import { Modal } from './Modal';
import { ConfirmDialog } from './ConfirmDialog';
import { AddMedicamentoForm } from './forms/AddMedicamentoForm';
import { AddRotinaForm } from './forms/AddRotinaForm';
import { useLoading } from '@/contexts/LoadingContext';
import { FiPlus, FiAlertTriangle, FiClock, FiEdit2, FiTrash2 } from 'react-icons/fi';

// ===== TIPOS DE DADOS =====

// Tipos para as frequências de medicamentos
type FrequenciaDiaria = {
    tipo: 'diario';
    horarios: string[];  // Ex: ['08:00', '14:00', '20:00']
};

type FrequenciaIntervalo = {
    tipo: 'intervalo';
    intervalo_horas: number;  // Ex: 8 (a cada 8 horas)
    inicio: string;           // Ex: '08:00'
};

type FrequenciaDiasAlternados = {
    tipo: 'dias_alternados';
    intervalo_dias: number;  // Ex: 2 (a cada 2 dias)
    horario: string;         // Ex: '09:00'
};

type FrequenciaSemanal = {
    tipo: 'semanal';
    dias_da_semana: number[];  // Números de 1 a 7 representando os dias da semana
    horario: string;           // Ex: '09:00'
};

// Tipo que une todos os tipos de frequência
type Frequencia = FrequenciaDiaria | FrequenciaIntervalo | FrequenciaDiasAlternados | FrequenciaSemanal;

// Interface para um medicamento
interface Medicamento {
    id: string;
    nome: string;
    dosagem: string | null;  // Ex: '500mg', '1 comprimido'
    quantidade: number;       // Quantidade em estoque
    frequencia: Frequencia | null;
    data_agendada: string;    // Próxima data/hora da dose
    concluido: boolean;       // Se a última dose foi tomada
    ultimaAtualizacao?: string; // Quando foi a última atualização
}

// Interface para uma rotina
interface Rotina {
    id: string;
    titulo?: string;
    descricao?: string;
    concluido: boolean;      // API usa 'concluido'
    frequencia?: any;
    data_agendada?: string;  // opcional
}

// Interface para os dados de medicamentos
interface MedicamentosData {
    total: number;           // Total de medicamentos
    concluidos: number;      // Quantos estão marcados como concluídos
    lista: Medicamento[];    // Lista de medicamentos
}

// Interface para os dados de rotinas
interface RotinasData {
    total: number;           // Total de rotinas
    concluidas: number;      // Quantas estão marcadas como concluídas
    lista: Rotina[];         // Lista de rotinas
}

// Interface para itens da agenda vindos de historico_eventos
interface AgendaItem {
    id: string;
    tipo_evento: 'medicamento' | 'rotina' | string;
    evento_id: string;
    titulo: string;
    horario?: Date;
    status: 'pendente' | 'confirmado' | 'esquecido' | string;
}

// Estado inicial para medicamentos
const estadoInicialMedicamentos: MedicamentosData = {
    total: 0,
    concluidos: 0,
    lista: []
};

// Estado inicial para rotinas
const estadoInicialRotinas: RotinasData = {
    total: 0,
    concluidas: 0,
    lista: []
};

// Estado inicial para agenda
const estadoInicialAgenda: AgendaItem[] = [];

// ===== COMPONENTE PRINCIPAL =====

export default function DashboardClient({ readOnly = false, idosoId }: { readOnly?: boolean; idosoId?: string }): React.ReactElement {
    // Estados para controle do modal
    const [isModalOpen, setIsModalOpen] = useState(false);
    const [modalType, setModalType] = useState<'medicamento' | 'rotina'>('medicamento');
    const [isEditing, setIsEditing] = useState(false);

    // Estados para os itens atuais sendo editados
    const [currentMedicamento, setCurrentMedicamento] = useState<Medicamento | null>(null);
    const [currentRotina, setCurrentRotina] = useState<Rotina | null>(null);

    // Estados para o diálogo de confirmação
    const [confirmDialog, setConfirmDialog] = useState<{
        isOpen: boolean;
        title: string;
        message: string;
        onConfirm: (() => void) | null;
        itemId?: string;
        itemType?: 'medicamentos' | 'rotinas';
    }>({
        isOpen: false,
        title: '',
        message: '',
        onConfirm: null
    });

    // Estados para armazenar os dados
    const [medicamentos, setMedicamentos] = useState<MedicamentosData>(estadoInicialMedicamentos);
    const [rotinas, setRotinas] = useState<RotinasData>(estadoInicialRotinas);
    const [agenda, setAgenda] = useState<AgendaItem[]>(estadoInicialAgenda);

    // Estados para controle de carregamento
    const { setIsLoading } = useLoading();

    // Conexão com o banco de dados
    const supabase = useMemo(() => createClient(), []);

    // Dados do usuário logado
    const { user } = useAuth();
    const alertsRef = useRef<HTMLDivElement>(null);
    const pendingControllers = useRef<AbortController[]>([]);

    // ===== FUNÇÕES PARA MANIPULAR O MODAL =====

    // Fecha o modal e limpa os dados
    const closeModal = useCallback(() => {
        setIsModalOpen(false);
        setIsEditing(false);
        setCurrentMedicamento(null);
        setCurrentRotina(null);
    }, []);

    const isSameDay = useCallback((a: Date, b: Date) => (
        a.getFullYear() === b.getFullYear() && a.getMonth() === b.getMonth() && a.getDate() === b.getDate()
    ), []);

    const toDate = useCallback((iso?: string) => (iso ? new Date(iso) : undefined), []);

    const now = useMemo(() => new Date(), []);
    const yesterday = useMemo(() => {
        const d = new Date(now);
        d.setDate(d.getDate() - 1);
        return d;
    }, [now]);

    // Abre o modal para adicionar ou editar um item
    const openModal = useCallback((type: 'medicamento' | 'rotina', medicamento: Medicamento | null = null) => {
        setModalType(type);
        setIsModalOpen(true);

        if (medicamento) {
            setIsEditing(true);
            setCurrentMedicamento(medicamento);
        } else {
            setIsEditing(false);
            setCurrentMedicamento(null);
        }
    }, []);

    // ===== FUNÇÕES AUXILIARES =====

    // Pega o token de autenticação do usuário
    const getAuthToken = useCallback(async () => {
        try {
            const { data: { session } } = await supabase.auth.getSession();
            return session?.access_token;
        } catch (error) {
            console.error('Erro ao obter token de autenticação:', error);
            return null;
        }
    }, [supabase]);

    // Mostra mensagens de erro
    const handleApiError = useCallback((error: unknown, mensagemPadrao: string) => {
        const mensagem = error instanceof Error ? error.message : mensagemPadrao;
        console.error('Erro na API:', error);
        alert(`Erro: ${mensagem}`);
    }, []);

    // Determina se um medicamento está previsto para o dia de hoje quando data_agendada está ausente
    const isMedicamentoHoje = useCallback((m: Medicamento): boolean => {
        const d = toDate(m.data_agendada);
        if (d && isSameDay(d, now)) return true;
        const f = m.frequencia;
        if (!f) return false;
        if (f.tipo === 'diario') return true;
        if (f.tipo === 'semanal') {
            const today = now.getDay(); // 0=Dom, 6=Sáb
            return Array.isArray(f.dias_da_semana) && f.dias_da_semana.includes(today + 1); // API usa 1=Dom
        }
        return false;
    }, [now, isSameDay, toDate]);

    // Determina se uma rotina está prevista para o dia de hoje quando data_agendada está ausente
    const isRotinaHoje = useCallback((r: Rotina): boolean => {
        const d = toDate(r.data_agendada as any);
        if (d && isSameDay(d, now)) return true;
        const f: any = r.frequencia as any;
        if (!f || typeof f !== 'object') return false;
        if (f.tipo === 'diario') return true;
        if (f.tipo === 'semanal') {
            const today = now.getDay();
            return Array.isArray(f.dias_da_semana) && f.dias_da_semana.includes(today + 1);
        }
        return false;
    }, [now, isSameDay, toDate]);

    // ===== FUNÇÕES PARA BUSCAR DADOS =====

    // Busca a lista de medicamentos da API
    const buscarMedicamentos = useCallback(async (token: string, signal?: AbortSignal): Promise<Medicamento[]> => {
        try {
            const url = '/api/medicamentos' + (idosoId ? `?idoso_id=${encodeURIComponent(idosoId)}` : '');
            const resposta = await fetch(url, {
                headers: { 'Authorization': `Bearer ${token}` },
                cache: 'no-store',
                signal,
            });
            if (!resposta.ok) {
                let msg = `Erro HTTP! status: ${resposta.status}`;
                try {
                    const j = await resposta.json();
                    msg = j?.erro || j?.message || msg;
                } catch { }
                throw new Error(msg);
            }
            return await resposta.json();
        } catch (erro) {
            console.error('Falha ao buscar medicamentos:', erro);
            const { normalizeError } = await import('@/utils/errors');
            throw normalizeError(erro, 'Falha ao buscar medicamentos');
        }
    }, [idosoId]);

    // Busca a lista de rotinas da API
    const buscarRotinas = useCallback(async (token: string, signal?: AbortSignal): Promise<Rotina[]> => {
        try {
            const url = '/api/rotinas' + (idosoId ? `?idoso_id=${encodeURIComponent(idosoId)}` : '');
            const resposta = await fetch(url, {
                headers: { 'Authorization': `Bearer ${token}` },
                cache: 'no-store',
                signal,
            });
            if (!resposta.ok) throw new Error(`Erro HTTP! status: ${resposta.status}`);
            return await resposta.json();
        } catch (erro) {
            console.error('Falha ao buscar rotinas:', erro);
            const { normalizeError } = await import('@/utils/errors');
            throw normalizeError(erro, 'Falha ao buscar rotinas');
        }
    }, [idosoId]);

    // Busca a lista de itens da agenda da API
    const buscarAgenda = useCallback(async (token: string, signal?: AbortSignal): Promise<AgendaItem[]> => {
        try {
            const hoje = new Date();
            const data = hoje.toISOString().slice(0, 10);
            const url = '/api/agenda' + (idosoId ? `?idoso_id=${encodeURIComponent(idosoId)}&data=${encodeURIComponent(data)}` : `?data=${encodeURIComponent(data)}`);
            const resposta = await fetch(url, {
                headers: { 'Authorization': `Bearer ${token}` },
                cache: 'no-store',
                signal,
            });
            if (!resposta.ok) {
                let msg = `Erro HTTP! status: ${resposta.status}`;
                try {
                    const j = await resposta.json();
                    msg = j?.erro || j?.message || msg;
                } catch { }
                throw new Error(msg);
            }
            const raw = await resposta.json();
            const itens: AgendaItem[] = (raw ?? []).map((e: any) => {
                const titulo = e.titulo ?? e.evento;
                const horarioIso = e.data_prevista ?? e.horario_programado ?? e.horario;
                return {
                    id: e.id,
                    tipo_evento: e.tipo_evento,
                    evento_id: e.evento_id,
                    titulo: titulo,
                    horario: horarioIso ? new Date(horarioIso) : undefined,
                    status: e.status,
                } as AgendaItem;
            });
            const rank = (it: AgendaItem) => it.status === 'confirmado' ? 2 : (it.horario && it.horario < new Date() ? 0 : 1);
            itens.sort((a, b) => {
                const ra = rank(a); const rb = rank(b);
                if (ra !== rb) return ra - rb;
                const ta = a.horario?.getTime() || 0; const tb = b.horario?.getTime() || 0;
                return ta - tb;
            });
            return itens;
        } catch (erro) {
            console.error('Falha ao buscar agenda:', erro);
            const { normalizeError } = await import('@/utils/errors');
            throw normalizeError(erro, 'Falha ao buscar agenda');
        }
    }, [idosoId]);

    // ===== EFEITOS =====

    // Efeito para verificar periodicamente se os medicamentos precisam ser desmarcados
    useEffect(() => {
        const intervalo = setInterval(() => {
            setMedicamentos(medicamentosAtuais => {
                const listaAtualizada = medicamentosAtuais.lista.map(med => {
                    if (med.concluido && shouldResetMedicamento(med)) {
                        return { ...med, concluido: false };
                    }
                    return med;
                });

                if (JSON.stringify(listaAtualizada) !== JSON.stringify(medicamentosAtuais.lista)) {
                    return {
                        ...medicamentosAtuais,
                        lista: listaAtualizada,
                        concluidos: listaAtualizada.filter(med => med.concluido).length
                    };
                }

                return medicamentosAtuais;
            });
        }, 60000);

        return () => clearInterval(intervalo);
    }, []);

    // Função para carregar todos os dados
    const carregarDados = useCallback(async () => {
        if (!user) return;
        const token = await getAuthToken();
        if (!token) return;

        try {
            setIsLoading(true);
            const controller = new AbortController();
            pendingControllers.current.push(controller);
            const [dadosMedicamentos, dadosRotinas, itensAgenda] = await Promise.all([
                buscarMedicamentos(token, controller.signal),
                buscarRotinas(token, controller.signal),
                buscarAgenda(token, controller.signal),
            ]);

            setMedicamentos({
                total: dadosMedicamentos.length,
                concluidos: dadosMedicamentos.filter(m => m.concluido).length,
                lista: dadosMedicamentos
            });

            setRotinas({
                total: dadosRotinas.length,
                concluidas: dadosRotinas.filter((r: any) => r.concluido || r.concluida).length,
                lista: dadosRotinas as Rotina[]
            });

            setAgenda(itensAgenda);
        } catch (erro) {
            if (erro instanceof DOMException && erro.name === 'AbortError') {
                // Requisição cancelada, não fazer nada
            } else {
                handleApiError(erro, 'Não foi possível carregar os dados do dashboard.');
            }
        } finally {
            setIsLoading(false);
            // Remove controladores finalizados
            pendingControllers.current = pendingControllers.current.filter((c: AbortController) => !c.signal.aborted);
        }
    }, [user, idosoId, getAuthToken, buscarMedicamentos, buscarRotinas, buscarAgenda, handleApiError, setIsLoading]);

    // Carrega os dados quando o componente é montado ou quando o usuário muda
    useEffect(() => {
        if (user) {
            carregarDados();
        } else {
            // Aborta quaisquer requisições pendentes ao sair
            pendingControllers.current.forEach((c: AbortController) => {
                try { c.abort(); } catch { }
            });
            pendingControllers.current = [];
            setMedicamentos(estadoInicialMedicamentos);
            setRotinas(estadoInicialRotinas);
            setAgenda(estadoInicialAgenda);
        }
        return () => {
            // Cleanup ao desmontar
            pendingControllers.current.forEach((c: AbortController) => {
                try { c.abort(); } catch { }
            });
            pendingControllers.current = [];
        };
    }, [user, carregarDados, idosoId]);

    // ===== FUNÇÕES CRUD (Criação, Leitura, Atualização, Deleção) =====

    // Função para criar um novo medicamento
    const criarMedicamento = useCallback(async (data: any) => {
        const token = await getAuthToken();
        if (!token) throw new Error('Sessão não encontrada');

        const resposta = await fetch('/api/medicamentos', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
            body: JSON.stringify(data)
        });

        if (!resposta.ok) {
            const erro = await resposta.json();
            throw new Error(erro.error || 'Falha ao criar medicamento');
        }

        const novoMedicamento = await resposta.json();
        setMedicamentos(anterior => ({
            ...anterior,
            lista: [...anterior.lista, novoMedicamento],
            total: anterior.total + 1
        }));
    }, [getAuthToken]);

    // Função para atualizar um medicamento existente
    const atualizarMedicamento = useCallback(async (id: string, data: any) => {
        const token = await getAuthToken();
        if (!token) throw new Error('Sessão não encontrada');

        const resposta = await fetch(`/api/medicamentos/${id}`, {
            method: 'PATCH', // Usar PATCH para atualizações parciais
            headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
            body: JSON.stringify(data)
        });

        if (!resposta.ok) {
            const erro = await resposta.json();
            throw new Error(erro.error || 'Falha ao atualizar medicamento');
        }

        const medicamentoAtualizado = await resposta.json();
        setMedicamentos(anterior => ({
            ...anterior,
            lista: anterior.lista.map(m => m.id === id ? { ...m, ...medicamentoAtualizado } : m)
        }));
    }, [getAuthToken]);

    // Função para criar uma nova rotina
    const criarRotina = useCallback(async (data: any) => {
        const token = await getAuthToken();
        if (!token) throw new Error('Sessão não encontrada');

        const resposta = await fetch('/api/rotinas', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
            body: JSON.stringify(data)
        });

        if (!resposta.ok) {
            const erro = await resposta.json();
            throw new Error(erro.error || 'Falha ao criar rotina');
        }

        const novaRotina = await resposta.json();
        setRotinas(anterior => ({
            ...anterior,
            lista: [...anterior.lista, novaRotina],
            total: anterior.total + 1
        }));
    }, [getAuthToken]);

    // Função para atualizar uma rotina existente
    const atualizarRotina = useCallback(async (id: string, data: Partial<Rotina>) => {
        const token = await getAuthToken();
        if (!token) throw new Error('Sessão não encontrada');

        const resposta = await fetch(`/api/rotinas/${id}`, {
            method: 'PATCH',
            headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
            body: JSON.stringify(data)
        });

        if (!resposta.ok) {
            const erro = await resposta.json();
            throw new Error(erro.error || 'Falha ao atualizar rotina');
        }

        const rotinaAtualizada = await resposta.json();
        setRotinas(prev => ({
            ...prev,
            lista: prev.lista.map(rot => rot.id === id ? { ...rot, ...rotinaAtualizada } : rot)
        }));
    }, [getAuthToken]);

    // Função para confirmar a exclusão
    const confirmarExclusao = (tipo: 'medicamentos' | 'rotinas', id: string) => {
        const itemType = tipo === 'medicamentos' ? 'medicamento' : 'rotina';
        setConfirmDialog({
            isOpen: true,
            title: `Excluir ${itemType}`,
            message: `Tem certeza que deseja excluir este ${itemType}?`,
            onConfirm: () => executarExclusao(tipo, id)
        });
    };

    // Função que executa a exclusão
    const executarExclusao = async (tipo: 'medicamentos' | 'rotinas', id: string) => {
        try {
            const token = await getAuthToken();
            if (!token) throw new Error('Sessão não encontrada');

            // Atualização otimista
            if (tipo === 'medicamentos') {
                setMedicamentos(anterior => ({
                    ...anterior,
                    lista: anterior.lista.filter(med => med.id !== id),
                    total: anterior.total - 1
                }));
            } else {
                setRotinas(anterior => ({
                    ...anterior,
                    lista: anterior.lista.filter(rot => rot.id !== id),
                    total: anterior.total - 1
                }));
            }

            const resposta = await fetch(`/api/${tipo}/${id}`, {
                method: 'DELETE',
                headers: { 'Authorization': `Bearer ${token}` }
            });

            if (!resposta.ok) throw new Error('Falha ao excluir o item');

            // Recarrega os dados após excluir com sucesso
            await carregarDados();
        } catch (erro) {
            handleApiError(erro, 'Erro ao excluir item');
            await carregarDados(); // Recarrega os dados em caso de falha
        } finally {
            setConfirmDialog({ isOpen: false, title: '', message: '', onConfirm: null });
        }
    };

    const fecharConfirmacao = useCallback(() => {
        setConfirmDialog(prev => ({ ...prev, isOpen: false }));
    }, []);

    // Formata a frequência para exibição
    const formatarFrequencia = useCallback((frequencia: Frequencia | null): string => {
        if (!frequencia) return 'Sem repetição';
        switch (frequencia.tipo) {
            case 'diario': return `Diário - ${frequencia.horarios.join(', ')}`;
            case 'intervalo': return `A cada ${frequencia.intervalo_horas}h (início: ${frequencia.inicio})`;
            case 'dias_alternados': return `A cada ${frequencia.intervalo_dias} dias (${frequencia.horario})`;
            case 'semanal': {
                const diasSemana = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb'];
                const dias = frequencia.dias_da_semana.map(dia => diasSemana[dia - 1]).join(', ');
                return `Toda ${dias} (${frequencia.horario})`;
            }
            default: return 'Frequência personalizada';
        }
    }, []);

    // ===== HANDLERS PARA FORMULÁRIOS =====

    // Lida com o salvamento de medicamento
    const handleSaveMedicamento = useCallback(async (nome: string, dosagem: string | null, frequencia: Frequencia, quantidade: number) => {
        try {
            const data = { nome, dosagem, frequencia, quantidade, data_agendada: new Date().toISOString(), concluido: false };
            if (isEditing && currentMedicamento) {
                await atualizarMedicamento(currentMedicamento.id, data);
            } else {
                await criarMedicamento(data);
            }
            closeModal();
            await carregarDados(); // Recarrega os dados após salvar
        } catch (erro) {
            handleApiError(erro, `Erro ao ${isEditing ? 'atualizar' : 'criar'} medicamento`);
        }
    }, [isEditing, currentMedicamento, atualizarMedicamento, criarMedicamento, closeModal, handleApiError, carregarDados]);

    // Lida com o salvamento de rotina
    const handleSaveRotina = useCallback(async (titulo: string, descricao: string, frequencia: any) => {
        try {
            // A API espera: { titulo, descricao, frequencia, concluido }
            const data = {
                titulo,
                descricao,
                frequencia,
                concluido: false,
            };
            if (isEditing && currentRotina) {
                await atualizarRotina(currentRotina.id, data);
            } else {
                await criarRotina(data);
            }
            closeModal();
            await carregarDados(); // Recarrega os dados após salvar
        } catch (erro) {
            handleApiError(erro, `Erro ao ${isEditing ? 'atualizar' : 'criar'} rotina`);
        }
    }, [isEditing, currentRotina, criarRotina, atualizarRotina, closeModal, handleApiError, carregarDados]);

    // Lida com a edição de medicamento
    const handleEditMedicamento = useCallback((medicamento: Medicamento) => {
        setCurrentMedicamento(medicamento);
        setModalType('medicamento');
        setIsEditing(true);
        setIsModalOpen(true);
    }, []);

    // Lida com a edição de rotina
    const handleEditRotina = useCallback((rotina: Rotina) => {
        setCurrentRotina(rotina);
        setModalType('rotina');
        setIsEditing(true);
        setIsModalOpen(true);
    }, []);

    // Alterna status de conclusão do medicamento usando histórico do dia
    const handleToggleStatus = useCallback(async (id: string, historicoEventoId?: string) => {
        try {
            const token = await getAuthToken();
            if (!token) throw new Error('Sessão não encontrada');

            // Encontra o item
            const agendaItem = agenda.find(it =>
                it.tipo_evento === 'medicamento' &&
                it.evento_id === id
            );
            const medicamento = medicamentos.lista.find(m => m.id === id);
            if (!medicamento) return;

            // Inverte o status baseado no estado atual do medicamento
            const novoStatus = medicamento.concluido ? 'pendente' : 'confirmado';
            const novoConcluido = !medicamento.concluido;

            // Atualização otimista da agenda e medicamentos
            setAgenda(prevAgenda => prevAgenda.map(item =>
                item.tipo_evento === 'medicamento' && item.evento_id === id
                    ? { ...item, status: novoStatus }
                    : item
            ));
            
            // Atualização otimista dos medicamentos
            setMedicamentos(prev => ({
                ...prev,
                lista: prev.lista.map(m => m.id === id ? { ...m, concluido: novoConcluido } : m),
                concluidos: prev.lista.reduce((acc, m) => acc + ((m.id === id ? novoConcluido : m.concluido) ? 1 : 0), 0)
            }));

            // Atualiza o status no histórico de eventos (mantém a funcionalidade existente)
            if (historicoEventoId) {
                const respostaHistorico = await fetch(`/api/historico_eventos/${historicoEventoId}`, {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        status: novoStatus
                    })
                });

                if (!respostaHistorico.ok) {
                    throw new Error('Falha ao atualizar status do histórico');
                }
            }

            // Atualiza o status na tabela de medicamentos
            const respostaMedicamento = await fetch(`/api/medicamentos/${id}`, {
                method: 'PATCH',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify({
                    concluido: novoConcluido
                })
            });

            if (!respostaMedicamento.ok) {
                throw new Error('Falha ao atualizar status do medicamento');
            }

        } catch (erro) {
            // Em caso de erro, reverte as alterações otimistas
            setAgenda(prevAgenda => prevAgenda.map(item =>
                item.tipo_evento === 'medicamento' && item.evento_id === id
                    ? { ...item, status: item.status === 'confirmado' ? 'pendente' : 'confirmado' }
                    : item
            ));
            setMedicamentos(prev => ({
                ...prev,
                lista: prev.lista.map(m => m.id === id ? { ...m, concluido: !m.concluido } : m)
            }));
            handleApiError(erro, 'Erro ao atualizar status do medicamento');
        }
    }, [getAuthToken, handleApiError, medicamentos.lista]);

    // Alterna status de conclusão da rotina usando histórico do dia
    const handleToggleRotinaStatus = useCallback(async (id: string, historicoEventoId?: string) => {
        try {
            const token = await getAuthToken();
            if (!token) throw new Error('Sessão não encontrada');

            // Encontra o item
            const agendaItem = agenda.find(it =>
                it.tipo_evento === 'rotina' &&
                it.evento_id === id
            );
            const rotina = rotinas.lista.find(r => r.id === id);
            if (!rotina) return;

            // Inverte o status baseado no estado atual da rotina
            const novoStatus = rotina.concluido ? 'pendente' : 'confirmado';
            const novoConcluido = !rotina.concluido;

            // Atualização otimista da agenda e rotinas
            setAgenda(prevAgenda => prevAgenda.map(item =>
                item.tipo_evento === 'rotina' && item.evento_id === id
                    ? { ...item, status: novoStatus }
                    : item
            ));
            
            // Atualização otimista das rotinas
            setRotinas(prev => ({
                ...prev,
                lista: prev.lista.map(r => r.id === id ? { ...r, concluido: novoConcluido } : r),
                concluidas: prev.lista.reduce((acc, r) => acc + ((r.id === id ? novoConcluido : r.concluido) ? 1 : 0), 0)
            }));

            // Atualiza o status no histórico de eventos
            if (historicoEventoId) {
                const respostaHistorico = await fetch(`/api/historico_eventos/${historicoEventoId}`, {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        status: novoStatus
                    })
                });

                if (!respostaHistorico.ok) {
                    throw new Error('Falha ao atualizar status do histórico');
                }
            }

            // Atualiza o status na tabela de rotinas
            const respostaRotina = await fetch(`/api/rotinas/${id}`, {
                method: 'PATCH',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify({
                    concluido: novoConcluido
                })
            });

            if (!respostaRotina.ok) {
                throw new Error('Falha ao atualizar status da rotina');
            }

        } catch (erro) {
            // Em caso de erro, reverte as alterações otimistas
            setAgenda(prevAgenda => prevAgenda.map(item =>
                item.tipo_evento === 'rotina' && item.evento_id === id
                    ? { ...item, status: item.status === 'confirmado' ? 'pendente' : 'confirmado' }
                    : item
            ));
            setRotinas(prev => ({
                ...prev,
                lista: prev.lista.map(r => r.id === id ? { ...r, concluido: !r.concluido } : r)
            }));
            handleApiError(erro, 'Erro ao atualizar status da rotina');
        }
    }, [getAuthToken, handleApiError, rotinas.lista]);

    // Dados focados no dia
    const medsHoje = useMemo(() => {
        return medicamentos.lista.filter(m => isMedicamentoHoje(m));
    }, [medicamentos.lista, isMedicamentoHoje]);

    const rotinasHoje = useMemo(() => {
        return rotinas.lista.filter(r => isRotinaHoje(r));
    }, [rotinas.lista, isRotinaHoje]);

    const medsHojeConcluidos = useMemo(() => medsHoje.filter(m => m.concluido).length, [medsHoje]);
    const rotinasHojeConcluidas = useMemo(() => rotinasHoje.filter(r => r.concluido).length, [rotinasHoje]);

    const dosesOmitidas = useMemo(() => {
        return medicamentos.lista.filter(m => {
            const d = toDate(m.data_agendada);
            return d && !m.concluido && d < now && (isSameDay(d, now) || isSameDay(d, yesterday));
        });
    }, [medicamentos.lista, now, isSameDay, yesterday, toDate]);

    const estoqueBaixo = useMemo(() => medicamentos.lista.filter(m => typeof m.quantidade === 'number' && m.quantidade <= 3), [medicamentos.lista]);

    const alertasPendentes = useMemo(() => dosesOmitidas.length + estoqueBaixo.length, [dosesOmitidas.length, estoqueBaixo.length]);

    const agendaDoDia = useMemo(() => agenda, [agenda]);

    // Localiza o ID do histórico correspondente a um medicamento/rotina na agenda
    const getHistoricoIdForMedicamento = useCallback((medId: string): string | undefined => {
        const itens = agendaDoDia.filter(it => it.tipo_evento === 'medicamento' && it.evento_id === medId);
        const pendente = itens.find(it => it.status !== 'confirmado');
        return (pendente || itens[0])?.id;
    }, [agendaDoDia]);

    const getHistoricoIdForRotina = useCallback((rotinaId: string): string | undefined => {
        const itens = agendaDoDia.filter(it => it.tipo_evento === 'rotina' && it.evento_id === rotinaId);
        const pendente = itens.find(it => it.status !== 'confirmado');
        return (pendente || itens[0])?.id;
    }, [agendaDoDia]);

    const getStatusBadge = useCallback((status: string, horario?: Date) => {
        if (status === 'confirmado') return 'concluido';
        if (horario && horario < now) return 'atrasado';
        return 'pendente';
    }, [now]);

    // Alterna status de conclusão de um item da agenda (historico_eventos)
    const handleToggleAgendaStatus = useCallback(async (id: string) => {
        let previous: AgendaItem[] = [];
        setAgenda(prev => {
            previous = prev;
            return prev.map(it => it.id === id ? { ...it, status: it.status === 'confirmado' ? 'pendente' : 'confirmado' } : it);
        });

        try {
            const token = await getAuthToken();
            if (!token) throw new Error('Sessão não encontrada');
            const item = (previous || []).find(i => i.id === id);
            const novoStatus = item && item.status === 'confirmado' ? 'pendente' : 'confirmado';
            const resp = await fetch(`/api/historico_eventos/${id}`, {
                method: 'PATCH',
                headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
                body: JSON.stringify({ status: novoStatus })
            });
            if (!resp.ok) throw new Error('Falha ao atualizar status do evento');
        } catch (erro) {
            if (previous) setAgenda(previous);
            handleApiError(erro, 'Erro ao atualizar status do evento');
        }
    }, [getAuthToken, handleApiError]);

    // ===== RENDERIZAÇÃO =====

    // Renderização do modal
    const renderModal = useMemo(() => {
        if (!isModalOpen) return null;

        return (
            <Modal
                isOpen={isModalOpen}
                onClose={closeModal}
                title={isEditing ? `Editar ${modalType}` : `Adicionar ${modalType}`}
            >
                {modalType === 'medicamento' ? (
                    <AddMedicamentoForm
                        onSave={handleSaveMedicamento}
                        onCancel={closeModal}
                        medicamento={currentMedicamento ?? undefined}
                    />
                ) : (
                    <AddRotinaForm
                        onSave={handleSaveRotina}
                        onCancel={closeModal}
                        rotina={currentRotina ?? undefined}
                    />
                )}
            </Modal>
        );
    }, [isModalOpen, modalType, isEditing, currentMedicamento, currentRotina, handleSaveMedicamento, handleSaveRotina, closeModal]);

    // Removido: listas completas de medicamentos e rotinas do dashboard

    return (
        <div className={styles.dashboard_client}>
            <div className={styles.cards_container}>
                <div className={styles.card}>
                    <h3>Medicamentos Hoje</h3>
                    <p><strong></strong> {medsHojeConcluidos} de {medsHoje.length} concluídos</p>
                    <div className={styles.progress_bar}>
                        <div
                            className={styles.progress_fill}
                            style={{ width: `${medsHoje.length ? (medsHojeConcluidos / medsHoje.length) * 100 : 0}%` }}
                        />
                    </div>
                    {!readOnly && (
                        <button className={styles.add_btn} onClick={() => openModal('medicamento')}>
                            <FiPlus size={16} /> Adicionar Medicamento
                        </button>
                    )}
                </div>

                <div className={styles.card}>
                    <h3>Rotinas Hoje</h3>
                    <p><strong></strong> {rotinasHojeConcluidas} de {rotinasHoje.length} concluídas</p>
                    <div className={styles.progress_bar}>
                        <div
                            className={styles.progress_fill}
                            style={{ width: `${rotinasHoje.length ? (rotinasHojeConcluidas / rotinasHoje.length) * 100 : 0}%` }}
                        />
                    </div>
                    {!readOnly && (
                        <button className={styles.add_btn} onClick={() => openModal('rotina')}>
                            <FiPlus size={16} /> Adicionar Rotina
                        </button>
                    )}
                </div>

                <div className={styles.card} onClick={() => alertsRef.current?.scrollIntoView({ behavior: 'smooth', block: 'start' })} style={{ cursor: 'pointer' }}>
                    <h3>Alertas Pendentes</h3>
                    <p><strong></strong> {alertasPendentes}</p>
                    <div className={styles.alerts_summary}>
                        <span className={styles.alert_badge}><FiAlertTriangle /> {dosesOmitidas.length} doses omitidas</span>
                        <span className={styles.alert_badge_low}><FiAlertTriangle /> {estoqueBaixo.length} estoques baixos</span>
                    </div>
                </div>
            </div>

            <div className={styles.alerts_section} ref={alertsRef}>
                <h3 className={styles.section_title}><FiAlertTriangle /> Alertas Importantes</h3>
                {alertasPendentes === 0 ? (
                    <p className={styles.empty_list}>Nenhum alerta importante no momento.</p>
                ) : (
                    <ul className={styles.list}>
                        {dosesOmitidas.map(m => (
                            <li key={'dose-' + m.id} className={styles.list_item + ' ' + styles.alert_item}>
                                <div className={styles.item_info}>
                                    <strong> Dose omitida: {m.nome}</strong>
                                    <span>Agendada para {toDate(m.data_agendada)?.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</span>
                                </div>
                            </li>
                        ))}
                        {estoqueBaixo.map(m => (
                            <li key={'stock-' + m.id} className={styles.list_item + ' ' + styles.alert_item_low}>
                                <div className={styles.item_info}>
                                    <strong> Estoque baixo: {m.nome}</strong>
                                    <span>Quantidade atual: {m.quantidade}</span>
                                </div>
                            </li>
                        ))}
                    </ul>
                )}
            </div>

            <div className={styles.list_section}>
                <div className={styles.list_container}>
                    <div className={styles.list_header}>
                        <h3>Medicamentos de hoje</h3>
                    </div>
                    {medsHoje.length === 0 ? (
                        <p className={styles.empty_list}>Nenhum medicamento para hoje.</p>
                    ) : (
                        <ul className={styles.list}>
                            {medsHoje.map(m => {
                                const agendaItem = agendaDoDia.find(it => it.tipo_evento === 'medicamento' && it.evento_id === m.id);
                                const isDone = agendaItem?.status === 'confirmado' || m.concluido;
                                const historicoId = getHistoricoIdForMedicamento(m.id);
                                
                                return (
                                    <li key={m.id} className={`${styles.list_item} ${isDone ? styles.completed : ''}`}>
                                        <div className={styles.item_info}>
                                            <strong>{m.nome}</strong>
                                            {m.dosagem && <span>Dosagem: {m.dosagem},  Quantidade: {m.quantidade}</span>}
                                            {m.frequencia && <span className={styles.frequencia}>{formatarFrequencia(m.frequencia)}</span>}
                                            <span className={styles.quantidade}></span>
                                        </div>
                                        {!readOnly && (
                                            <div className={styles.item_actions}>
                                                <button
                                                    onClick={() => handleToggleStatus(m.id, historicoId)}
                                                    className={isDone ? styles.desfazer_btn : styles.concluir_btn}
                                                >
                                                    {isDone ? 'Desfazer' : 'Concluir'}
                                                </button>
                                            </div>
                                        )}
                                    </li>
                                );
                            })}
                        </ul>
                    )}
                </div>

                <div className={styles.list_container}>
                    <div className={styles.list_header}>
                        <h3>Rotinas de hoje</h3>
                    </div>
                    {rotinasHoje.length === 0 ? (
                        <p className={styles.empty_list}>Nenhuma rotina para hoje.</p>
                    ) : (
                        <ul className={styles.list}>
                            {rotinasHoje.map(r => {
                                const agendaItem = agendaDoDia.find(it => it.tipo_evento === 'rotina' && it.evento_id === r.id);
                                const isDone = agendaItem?.status === 'confirmado' || r.concluido;
                                return (
                                    <li key={r.id} className={`${styles.list_item} ${isDone ? styles.completed : ''}`}>
                                        <div className={styles.item_info}>
                                            <strong>{r.titulo || 'Rotina'}</strong>
                                            {r.descricao ? <span>{r.descricao}</span> : null}
                                            {r.frequencia ? <span className={styles.frequencia}>{formatarFrequencia(r.frequencia as any)}</span> : null}
                                        </div>
                                        {!readOnly && (
                                            <div className={styles.item_actions}>
                                                <button
                                                    onClick={() => handleToggleRotinaStatus(r.id, getHistoricoIdForRotina(r.id))}
                                                    className={isDone ? styles.desfazer_btn : styles.concluir_btn}
                                                >
                                                    {isDone ? 'Desfazer' : 'Concluir'}
                                                </button>
                                            </div>
                                        )}
                                    </li>
                                );
                            })}
                        </ul>
                    )}
                </div>
            </div>

            <div className={styles.agenda_section}>
                <h3 className={styles.section_title}><FiClock /> Agenda do Dia</h3>
                {agendaDoDia.length === 0 ? (
                    <p className={styles.empty_list}>Nenhuma tarefa agendada para hoje.</p>
                ) : (
                    <ul className={styles.list}>
                        {agendaDoDia.map(item => {
                            const statusBadge = getStatusBadge(item.status, item.horario);
                            return (
                                <li key={item.id} className={styles.list_item}>
                                    <div className={styles.item_info}>
                                        <strong>{item.titulo}</strong>
                                        <span>{item.horario ? item.horario.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) : ''}</span>
                                    </div>
                                    <div className={styles.item_actions}>
                                        <span
                                            onClick={() => handleToggleAgendaStatus(item.id)}
                                            className={statusBadge === 'atrasado' ? styles.status_badge_late : statusBadge === 'concluido' ? styles.status_badge_done : styles.status_badge}
                                            style={{ cursor: 'pointer' }}
                                        >
                                            {statusBadge === 'atrasado' ? 'Atrasado' : statusBadge === 'concluido' ? 'Concluído' : 'Pendente'}
                                        </span>
                                    </div>
                                </li>
                            );
                        })}
                    </ul>
                )}
            </div>

            {!readOnly && renderModal}

            {!readOnly && (
                <ConfirmDialog
                    isOpen={confirmDialog.isOpen}
                    title={confirmDialog.title}
                    message={confirmDialog.message}
                    confirmText="Excluir"
                    cancelText="Cancelar"
                    onConfirm={confirmDialog.onConfirm || (() => { })}
                    onCancel={fecharConfirmacao}
                    danger
                />
            )}
        </div>
    );
}

================
File: src/components/DevUnhandledRejectionLogger.tsx
================
"use client";

import { useEffect } from "react";

export function DevUnhandledRejectionLogger() {
	useEffect(() => {
		if (process.env.NODE_ENV !== "development") return;

		const onUnhandled = (event: PromiseRejectionEvent) => {
			// Ajuda a identificar objetos não-Error, ex.: [object Event]
			const reason = event.reason;
			 
			console.error("Unhandled rejection (dev logger):", reason);
		};

		window.addEventListener("unhandledrejection", onUnhandled);
		return () => window.removeEventListener("unhandledrejection", onUnhandled);
	}, []);

	return null;
}

================
File: src/components/EditProfileModal.module.css
================
.modalOverlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: rgba(0, 0, 0, 0.5);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000;
  padding: 1rem;
}

.modalContent {
  background: white;
  border-radius: 8px;
  width: 100%;
  max-width: 500px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
  overflow: hidden;
  animation: modalFadeIn 0.3s ease-out;
}

@keyframes modalFadeIn {
  from {
    opacity: 0;
    transform: translateY(-20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.modalHeader {
  padding: 1.25rem 1.5rem;
  border-bottom: 1px solid #e5e7eb;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.modalHeader h2 {
  margin: 0;
  font-size: 1.25rem;
  font-weight: 600;
  color: #1f2937;
}

.closeButton {
  background: none;
  border: none;
  font-size: 1.5rem;
  cursor: pointer;
  color: #6b7280;
  line-height: 1;
  padding: 0.25rem;
  border-radius: 4px;
  transition: all 0.2s;
}

.closeButton:hover {
  color: #1f2937;
  background-color: #f3f4f6;
}

.form {
  padding: 1.5rem;
}

.formGroup {
  margin-bottom: 1.25rem;
}

.formGroup label {
  display: block;
  margin-bottom: 0.5rem;
  font-weight: 500;
  color: #374151;
  font-size: 0.875rem;
}

.input {
  width: 100%;
  padding: 0.625rem 0.875rem;
  border: 1px solid #d1d5db;
  border-radius: 6px;
  font-size: 0.9375rem;
  transition: border-color 0.2s, box-shadow 0.2s;
}

.input:focus {
  outline: none;
  border-color: #4f46e5;
  box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
}

.input:disabled {
  background-color: #f9fafb;
  cursor: not-allowed;
}

.errorMessage {
  background-color: #fef2f2;
  color: #dc2626;
  padding: 0.75rem 1rem;
  border-radius: 6px;
  margin: 0 1.5rem 1.5rem;
  font-size: 0.875rem;
  border-left: 4px solid #dc2626;
}

.modalFooter {
  display: flex;
  justify-content: flex-end;
  gap: 0.75rem;
  padding-top: 1rem;
  border-top: 1px solid #e5e7eb;
}

.button {
  padding: 0.625rem 1.25rem;
  border-radius: 6px;
  font-weight: 500;
  font-size: 0.9375rem;
  cursor: pointer;
  transition: all 0.2s;
  border: none;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  min-width: 100px;
}

.button:disabled {
  opacity: 0.7;
  cursor: not-allowed;
}

.cancelButton {
  background-color: #f3f4f6;
  color: #4b5563;
}

.cancelButton:hover:not(:disabled) {
  background-color: #e5e7eb;
}

.saveButton {
  background-color: #4f46e5;
  color: white;
}

.saveButton:hover:not(:disabled) {
  background-color: #4338ca;
}

/* Responsividade */
@media (max-width: 480px) {
  .modalContent {
    margin: 0 1rem;
    width: calc(100% - 2rem);
  }
  
  .modalFooter {
    flex-direction: column;
    gap: 0.5rem;
  }
  
  .button {
    width: 100%;
  }
}

================
File: src/components/EditProfileModal.tsx
================
'use client';

import { useState, ChangeEvent } from 'react';
import { createClient } from '@/lib/supabase/client';
import { useAuth } from '@/contexts/AuthContext';
import { useAuthRequest } from '@/hooks/useAuthRequest';
import styles from './EditProfileModal.module.css';

interface EditProfileModalProps {
  isOpen: boolean;
  onClose: () => void;
  onSave: (data: { fullName: string; phone: string; dob: string }) => void;
  initialData: {
    fullName: string;
    phone: string;
    dob: string;
  };
  loading?: boolean;
}

export function EditProfileModal({
  isOpen,
  onClose,
  onSave,
  initialData,
  loading = false,
}: EditProfileModalProps) {
  const [formData, setFormData] = useState(initialData);
  const [error, setError] = useState<string>('');
  const { user } = useAuth();
  const supabase = createClient();
  const { makeRequest } = useAuthRequest();

  const handleInputChange = (e: ChangeEvent<HTMLInputElement>) => {
    const { name, value } = e.target;
    setFormData(prev => ({
      ...prev,
      [name]: value,
    }));
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setError('');
    
    if (!formData.fullName.trim()) {
      setError('O nome completo é obrigatório');
      return;
    }

    try {
      await onSave(formData);
      onClose();
    } catch (err) {
      console.error('Erro ao salvar perfil:', err);
      setError('Erro ao salvar as alterações. Tente novamente.');
    }
  };

  if (!isOpen) return null;

  return (
    <div className={styles.modalOverlay}>
      <div className={styles.modalContent} onClick={e => e.stopPropagation()}>
        <div className={styles.modalHeader}>
          <h2>Editar Perfil</h2>
          <button onClick={onClose} className={styles.closeButton}>
            &times;
          </button>
        </div>
        
        {error && <div className={styles.errorMessage}>{error}</div>}
        
        <form onSubmit={handleSubmit} className={styles.form}>
          <div className={styles.formGroup}>
            <label htmlFor="fullName">Nome Completo</label>
            <input
              type="text"
              id="fullName"
              name="fullName"
              value={formData.fullName}
              onChange={handleInputChange}
              className={styles.input}
              disabled={loading}
            />
          </div>
          
          <div className={styles.formGroup}>
            <label htmlFor="phone">Telefone</label>
            <input
              type="tel"
              id="phone"
              name="phone"
              value={formData.phone}
              onChange={handleInputChange}
              className={styles.input}
              disabled={loading}
            />
          </div>
          
          <div className={styles.formGroup}>
            <label htmlFor="dob">Data de Nascimento</label>
            <input
              type="date"
              id="dob"
              name="dob"
              value={formData.dob}
              onChange={handleInputChange}
              className={styles.input}
              disabled={loading}
            />
          </div>
          
          <div className={styles.modalFooter}>
            <button
              type="button"
              onClick={onClose}
              className={`${styles.button} ${styles.cancelButton}`}
              disabled={loading}
            >
              Cancelar
            </button>
            <button
              type="submit"
              className={`${styles.button} ${styles.saveButton}`}
              disabled={loading}
            >
              {loading ? 'Salvando...' : 'Salvar'}
            </button>
          </div>
        </form>
      </div>
    </div>
  );
}

================
File: src/components/ErrorBoundary.tsx
================
'use client';

import { Component, ErrorInfo, ReactNode } from 'react';

interface Props {
  children: ReactNode;
  fallback?: ReactNode;
}

interface State {
  hasError: boolean;
  error?: Error;
}

class ErrorBoundary extends Component<Props, State> {
  public state: State = {
    hasError: false
  };

  public static getDerivedStateFromError(error: Error): State {
    return { hasError: true, error };
  }

  public componentDidCatch(error: Error, errorInfo: ErrorInfo) {
    console.error('Uncaught error:', error, errorInfo);
  }

  public render() {
    if (this.state.hasError) {
      return this.props.fallback || (
        <div style={{ 
          padding: '2rem',
          textAlign: 'center',
          color: '#333',
          backgroundColor: '#fff5f5',
          minHeight: '100vh',
          display: 'flex',
          flexDirection: 'column',
          justifyContent: 'center',
          alignItems: 'center'
        }}>
          <h1>Algo deu errado</h1>
          <p>Por favor, recarregue a página ou tente novamente mais tarde.</p>
          <button 
            onClick={() => window.location.reload()}
            style={{
              marginTop: '1rem',
              padding: '0.5rem 1rem',
              backgroundColor: '#2563eb',
              color: 'white',
              border: 'none',
              borderRadius: '0.25rem',
              cursor: 'pointer'
            }}
          >
            Recarregar Página
          </button>
        </div>
      );
    }

    return this.props.children;
  }
}

export default ErrorBoundary;

================
File: src/components/Footer.module.css
================
/* Estilo principal do rodapé */
.footer {
    position: relative ;
    left: 0;
    right: 0;
    bottom: 0;
    width: 100%;
    z-index: 50;
    color: black;
    padding: 60px 0;
    font-size: 15px;
    background: #ffffff;
    /* full-bleed background without causing horizontal scroll */
}

/* Removido pseudo-elemento; full-bleed é gerenciado por box-shadow/clip-path */

.footerContainer {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 20px;
    color: black;
}

/* Seção superior com as colunas */
.footerTop {
    display: grid;
    grid-template-columns: 2fr 1fr 1fr 1fr;
    gap: 40px;
}

/* Coluna 1: Sobre */
.footerLogo {
    display: flex;
    align-items: center;
    gap: 12px;
    color: #FFFFFF;
    font-size: 24px;
    font-weight: 700;
    margin-bottom: 20px;
    text-decoration: none;
}

.footerDescription {
    line-height: 1.6;
    max-width: 300px;
}

.footerSocialIcons {
    display: flex;
    gap: 12px;
    margin-top: 24px;
}

.footerSocialIcons a {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: linear-gradient(45deg, #4F46E5, #7C3AED);
    color: white;
    border-radius: 8px;
    font-size: 18px; /* Ajusta o tamanho do ícone */
    text-decoration: none;
    transition: transform 0.3s ease;
}

.footerSocialIcons a:hover {
    transform: scale(1.1);
}

/* Colunas 2, 3 e 4: Links */
.footerColumnLinks h4 {
    color: black;
    font-size: 16px;
    font-weight: 600;
    margin-top: 0;
    margin-bottom: 24px;
}

.footerColumnLinks ul {
    list-style: none;
    padding: 0;
    margin: 0;
}

.footerColumnLinks li {
    margin-bottom: 14px;
}

.footerColumnLinks a {
    color: black;
    text-decoration: none;
    transition: color 0.3s ease;
}

/* Divisor horizontal */
.footerDivider {
    border: none;
    height: 1px;
    background-color: rgba(255, 255, 255, 0.1);
    margin: 40px 0;
}

/* Seção inferior */
.footerBottom {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 15px;
}

.footerCopyright {
    margin: 0;
}

.footerLegalLinks {
    display: flex;
    gap: 30px;
}

.footerLegalLinks a {
    color: black;
    text-decoration: none;
    transition: color 0.3s ease;
}

/* Responsividade */
@media (max-width: 1024px) {
    .footer {
        padding: 50px 0;
    }
    
    .footerContainer {
        padding: 0 18px;
    }
    
    .footerTop {
        grid-template-columns: 2fr 1fr 1fr;
        gap: 35px;
    }
    
    .footerColumnLinks h4 {
        font-size: 15px;
        margin-bottom: 20px;
    }
}

@media (max-width: 992px) {
    .footerTop {
        grid-template-columns: repeat(2, 1fr);
        gap: 40px;
    }
    
    .footerDescription {
        max-width: 280px;
    }
}

@media (max-width: 768px) {
    .footer {
        padding: 40px 0;
        font-size: 14px;
    }
    
    .footerContainer {
        padding: 0 15px;
    }
    
    .footerTop {
        grid-template-columns: 1fr;
        text-align: center;
        gap: 30px;
    }
    
    .footerLogo {
        justify-content: center;
        font-size: 22px;
        margin-bottom: 16px;
    }
    
    .footerSocialIcons {
        justify-content: center;
        margin-top: 20px;
    }
    
    .footerSocialIcons a {
        width: 36px;
        height: 36px;
        font-size: 16px;
    }
    
    .footerDescription {
        margin-left: auto;
        margin-right: auto;
        max-width: 280px;
    }
    
    .footerColumnLinks h4 {
        font-size: 14px;
        margin-bottom: 18px;
    }
    
    .footerColumnLinks li {
        margin-bottom: 12px;
    }
    
    .footerBottom {
        flex-direction: column-reverse;
        text-align: center;
        gap: 18px;
    }
    
    .footerLegalLinks {
        gap: 20px;
    }
}

@media (max-width: 480px) {
    .footer {
        padding: 35px 0;
        font-size: 13px;
    }
    
    .footerContainer {
        padding: 0 12px;
    }
    
    .footerTop {
        gap: 25px;
    }
    
    .footerLogo {
        font-size: 20px;
        margin-bottom: 14px;
    }
    
    .footerSocialIcons {
        gap: 10px;
        margin-top: 16px;
    }
    
    .footerSocialIcons a {
        width: 32px;
        height: 32px;
        font-size: 14px;
    }
    
    .footerDescription {
        max-width: 250px;
        font-size: 13px;
        line-height: 1.5;
    }
    
    .footerColumnLinks h4 {
        font-size: 13px;
        margin-bottom: 16px;
    }
    
    .footerColumnLinks li {
        margin-bottom: 10px;
    }
    
    .footerColumnLinks a {
        font-size: 12px;
    }
    
    .footerBottom {
        gap: 15px;
    }
    
    .footerLegalLinks {
        flex-direction: column;
        gap: 12px;
    }
    
    .footerLegalLinks a {
        font-size: 12px;
    }
    
    .footerCopyright {
        font-size: 12px;
    }
}

@media (max-width: 360px) {
    .footer {
        padding: 30px 0;
    }
    
    .footerContainer {
        padding: 0 10px;
    }
    
    .footerLogo {
        font-size: 18px;
    }
    
    .footerSocialIcons a {
        width: 28px;
        height: 28px;
        font-size: 12px;
    }
    
    .footerDescription {
        max-width: 220px;
        font-size: 12px;
    }
    
    .footerColumnLinks h4 {
        font-size: 12px;
    }
    
    .footerColumnLinks a {
        font-size: 11px;
    }
}

================
File: src/components/Footer.tsx
================
import Image from 'next/image';
import Link from 'next/link';
import styles from './Footer.module.css';

export function Footer() {
    return (
        <footer className={styles.footer}>
            <div className={styles.footerContainer}>
                {/* Seção Superior do Rodapé */}
                <div className={styles.footerTop}>
                    {/* Coluna 1: Sobre a Empresa e Social */}
                    <div className={styles.footerColumnAbout}>
                        <Link href="/" className={styles.footerLogo}>
                            <Image src="/logo_coracao.png" alt="Logo CareMind" width={300} height={90} />
                        </Link>
                        <p className={styles.footerDescription}>
                            CareMind - tecnologia que aproxima, cuida e protege.
                        </p>
                    </div>

                    {/* Coluna 2: Links de Produto */}
                    <div className={styles.footerColumnLinks}>
                        <h4>Produto</h4>
                        <nav>
                            <ul>
                                <li><Link href="/funcionalidades">Funcionalidades</Link></li>
                                <li><Link href="/seguranca">Segurança</Link></li>
                            </ul>
                        </nav>
                    </div>

                    {/* Coluna 3: Links de Suporte */}
                    <div className={styles.footerColumnLinks}>
                        <h4>Suporte</h4>
                        <nav>
                            <ul>
                                <li><Link href="/ajuda">Central de Ajuda</Link></li>
                                <li><Link href="/contato">Contato</Link></li>
                                <li><Link href="/status">Status</Link></li>
                            </ul>
                        </nav>
                    </div>

                    {/* Coluna 4: Links da Empresa */}
                    <div className={styles.footerColumnLinks}>
                        <h4>Empresa</h4>
                        <nav>
                            <ul>
                                <li><Link href="/sobre">Sobre</Link></li>
                                <li><Link href="/blog">Blog</Link></li>
                                <li><Link href="/politica-privacidade">Privacidade</Link></li>
                            </ul>
                        </nav>
                    </div>
                </div>

                <hr className={styles.footerDivider} />

                {/* Seção Inferior do Rodapé */}
                <div className={styles.footerBottom}>
                    <p className={styles.footerCopyright}>© {new Date().getFullYear()} CareMind. Todos os direitos reservados.</p>
                    <div className={styles.footerLegalLinks}>
                        <Link href="/termos">Termos de Uso</Link>
                        <Link href="/politica-privacidade">Política de Privacidade</Link>
                        <Link href="/cookies">Cookies</Link>
                    </div>
                </div>
            </div>
        </footer>
    );
}

================
File: src/components/forms/AddForm.module.css
================
.form {
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
  padding: 0.5rem 0.5rem 1rem 0.5rem;
  background: transparent;
  width: 100%;
  margin: 0;
  border: none;
  box-shadow: none;
  max-height: 100%;
  overflow-y: visible;
  scroll-behavior: smooth;
  scroll-padding: 1rem;
}

.formGroup {
  display: flex;
  flex-direction: column;
  position: relative;
  transition: all 0.3s ease;
  padding: 0.5rem;
  border-radius: 8px;
}

.formGroup:focus-within {
  background-color: rgba(4, 0, 186, 0.03);
}

.formGroup.hasError {
  background-color: rgba(220, 38, 38, 0.05);
  border-left: 3px solid #ef4444;
  padding-left: 0.75rem;
  animation: shake 0.5s ease-in-out;
}

@keyframes shake {
  0%, 100% { transform: translateX(0); }
  20%, 60% { transform: translateX(-3px); }
  40%, 80% { transform: translateX(3px); }
}

.formGroup label {
  display: block;
  margin-bottom: 0.5rem;
  font-weight: 500;
  color: #374151;
  font-size: 0.9375rem;
  transition: color 0.2s ease;
}

.formGroup:focus-within label {
  color: #0400BA;
}

.errorText {
  color: #ef4444;
  font-size: 0.85rem;
  font-weight: 400;
  margin-left: 0.5rem;
  white-space: nowrap;
}

.formGroup input,
.select,
.timeInput {
  padding: 12px;
  border: 1px solid #d1d5db;
  border-radius: 8px;
  font-size: 1rem;
  color: #374151;
  background: #ffffff;
  transition: all 0.2s ease;
  outline: none;
  width: 100%;
  box-sizing: border-box;
  font-family: inherit;
}

.inputError {
  border-color: #ef4444 !important;
  background-color: #fff5f5;
  animation: pulseError 1.5s infinite;
}

@keyframes pulseError {
  0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.2); }
  70% { box-shadow: 0 0 0 5px rgba(239, 68, 68, 0); }
  100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
}

.formGroup input:focus,
.select:focus,
.timeInput:focus {
  border-color: #0400BA;
  box-shadow: 0 0 0 3px rgba(4, 0, 186, 0.1);
  background-color: #fff;
}

.formGroup.hasError input,
.formGroup.hasError .select,
.formGroup.hasError .timeInput {
  border-color: #fca5a5;
  background-color: #fff5f5;
}

.formGroup.hasError input:focus,
.formGroup.hasError .select:focus,
.formGroup.hasError .timeInput:focus {
  box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
}

.select {
  appearance: none;
  -webkit-appearance: none;
  -moz-appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%236b7280' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 12px center;
  padding: 12px 40px 12px 16px;
  font-size: 1rem;
  color: #1f2937;
  background-color: #fff;
  border: 1px solid #d1d5db;
  border-radius: 8px;
  cursor: pointer;
  min-height: 48px;
  width: 100%;
  transition: all 0.2s ease;
  box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
  font-family: inherit;
  line-height: 1.5;
}

.select:focus {
  outline: none;
  border-color: #4f46e5;
  box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
}

.select:hover {
  border-color: #9ca3af;
}

/* Estilo para as opções do select */
.select option {
  padding: 12px 16px;
  font-size: 1rem;
  color: #1f2937;
  background-color: #fff;
  border: none;
  transition: background-color 0.2s ease;
}

.select option:hover,
.select option:focus,
.select option:checked {
  background-color: #f3f4f6;
  color: #1f2937;
}

/* Melhorando o foco para acessibilidade */
.select:focus-visible {
  outline: 3px solid #4f46e5;
  outline-offset: 2px;
  border-color: transparent;
}

/* Efeito de hover mais suave */
.select:hover:not(:disabled) {
  border-color: #9ca3af;
  background-color: #f9fafb;
}

/* Estilo para quando o select está aberto */
.select:focus {
  border-color: #4f46e5;
  box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
}

/* Estilo para o container do select */
.selectWrapper {
  position: relative;
  width: 100%;
}

/* Adicionando uma seta personalizada */
.selectWrapper::after {
  content: '';
  position: absolute;
  top: 50%;
  right: 16px;
  transform: translateY(-50%);
  width: 0;
  height: 0;
  border-left: 5px solid transparent;
  border-right: 5px solid transparent;
  border-top: 5px solid #6b7280;
  pointer-events: none;
}

/* Melhorando o estilo para navegação por teclado */
.select:focus-visible {
  outline: 3px solid #4f46e5;
  outline-offset: 2px;
}

/* Estilo para quando o select está desativado */
.select:disabled {
  background-color: #f3f4f6;
  color: #9ca3af;
  cursor: not-allowed;
  opacity: 0.7;
}

/* Estilo para quando o select está desabilitado */
.select:disabled {
  background-color: #f3f4f6;
  cursor: not-allowed;
  opacity: 0.7;
}

.horarioInputContainer {
  position: relative;
  width: 100%;
  margin-bottom: 8px;
}

.horarioInputContainer .errorMessage {
  color: #ef4444;
  font-size: 0.75rem;
  margin-top: 4px;
  position: absolute;
  bottom: -20px;
  left: 0;
  white-space: nowrap;
}

.horariosContainer {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
  gap: 10px;
  margin: 12px 0;
  max-height: 220px;
  overflow-y: auto;
  overflow-x: hidden;
  padding: 12px;
  scrollbar-width: thin;
  scrollbar-color: #d1d5db #f3f4f6;
  align-items: start;
  position: relative;
  min-height: 60px;
  background-color: #f9fafb;
  border-radius: 8px;
  border: 1px dashed #e5e7eb;
}

.horariosContainer::-webkit-scrollbar {
  width: 4px;
}

.horariosContainer::-webkit-scrollbar-track {
  background: #f3f4f6;
  border-radius: 4px;
}

.horariosContainer::-webkit-scrollbar-thumb {
  background-color: #d1d5db;
  border-radius: 4px;
}

.placeholderText {
  color: #9ca3af;
  font-size: 0.9rem;
  padding: 12px;
  font-style: italic;
  text-align: center;
  background-color: #f8fafc;
  border-radius: 6px;
  border: 1px dashed #e2e8f0;
  grid-column: 1 / -1;
  margin: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 60px;
}

.horarioItem {
  display: inline-flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 10px;
  background-color: white;
  border-radius: 6px;
  border: 1px solid #e5e7eb;
  transition: all 0.2s ease;
  animation: popIn 0.2s ease-out;
  font-size: 0.9rem;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
  position: relative;
  overflow: hidden;
  min-width: 0;
}

@keyframes popIn {
  0% {
    opacity: 0;
    transform: scale(0.9) translateY(5px);
  }
  50% {
    transform: scale(1.05);
  }
  100% {
    opacity: 1;
    transform: scale(1) translateY(0);
  }
}

.horarioItem:hover {
  background-color: #f8fafc;
  border-color: #cbd5e1;
  transform: translateY(-1px);
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
}

.horarioItem:active {
  transform: translateY(0);
  box-shadow: none;
}

.horarioItem span {
  flex: 1;
  text-align: center;
  font-feature-settings: 'tnum';
  font-variant-numeric: tabular-nums;
}

/* Melhorias na responsividade */
@media (max-width: 480px) {
  .horariosContainer {
    grid-template-columns: 1fr;
    padding: 8px;
  }
  
  .addHorarioContainer {
    grid-template-columns: 1fr;
    padding: 12px;
  }
}

.addHorarioContainer {
  display: grid;
  grid-template-columns: 1fr auto;
  gap: 12px;
  margin: 16px 0 8px;
  position: relative;
  background: white;
  padding: 16px;
  border-radius: 8px;
  border: 1px solid #e5e7eb;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
  align-items: center;
}

.addHorarioContainer .timeInput {
  width: 100%;
  min-width: 120px;
  max-width: 180px;
  padding: 12px;
  font-size: 1rem;
  border: 1px solid #9ca3af; /* mais contraste */
  border-radius: 6px;
  background-color: #ffffff; /* garante branco puro */
  color: #111827; /* texto mais escuro */
  transition: all 0.2s ease;
  font-weight: 500;
}

/* Aumenta contraste dos campos nativos do time input (WebKit) */
.addHorarioContainer .timeInput::-webkit-datetime-edit, 
.addHorarioContainer .timeInput::-webkit-datetime-edit-text, 
.addHorarioContainer .timeInput::-webkit-datetime-edit-hour-field, 
.addHorarioContainer .timeInput::-webkit-datetime-edit-minute-field {
  color: #111827;
}
.addHorarioContainer .timeInput::-webkit-calendar-picker-indicator {
  opacity: 0.9;
  filter: none;
}

.addHorarioContainer .timeInput:hover {
  border-color: #6b7280;
}

.addHorarioContainer .timeInput:focus {
  border-color: #0400BA;
  box-shadow: 0 0 0 3px rgba(4, 0, 186, 0.15);
}

.addHorarioContainer .addButton {
  background-color: #0400BA;
  color: white;
  border: none;
  border-radius: 6px;
  padding: 12px 16px;
  font-size: 0.95rem;
  font-weight: 500;
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  transition: all 0.2s ease;
  white-space: nowrap;
  width: auto;
  margin-top: 0;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}

.addHorarioContainer .addButton:hover:not(:disabled) {
  background-color: #03008f;
  transform: translateY(-1px);
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
}

.addHorarioContainer .addButton:active:not(:disabled) {
  transform: translateY(0);
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}

.addHorarioContainer .addButton:disabled {
  background-color: #9ca3af;
  cursor: not-allowed;
  opacity: 0.7;
}

.removeButton {
  background: rgba(239, 68, 68, 0.1);
  border: none;
  border-radius: 6px;
  padding: 0 12px;
  font-size: 0.9rem;
  font-weight: 500;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background-color 0.2s ease;
  white-space: nowrap;
}

.addButton:hover {
  background-color: #c7d2fe;
}

.diasSemanaContainer {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin: 8px 0 0;
}

.diaSemanaLabel {
  display: flex;
  align-items: center;
  gap: 6px;
  cursor: pointer;
  font-size: 0.9rem;
  padding: 8px 12px;
  background-color: #f9fafb;
  border-radius: 8px;
  border: 1px solid #e5e7eb;
  transition: all 0.2s ease;
  user-select: none;
  margin: 0;
  flex: 1;
  min-width: calc(33.333% - 6px);
  justify-content: center;
  text-align: center;
}

@media (min-width: 400px) {
  .diaSemanaLabel {
    min-width: calc(25% - 6px);
  }
}

@media (min-width: 500px) {
  .diaSemanaLabel {
    min-width: auto;
    flex: 0 0 auto;
  }
}

.diaSemanaLabel:hover {
  background-color: #f3f4f6;
  border-color: #d1d5db;
}

.diaSelecionado {
  background-color: #e0e7ff;
  border-color: #c7d2fe;
  color: #4338ca;
  font-weight: 500;
}

.diaSelecionado .checkbox {
  border-color: #4338ca;
  background-color: #4338ca;
}

.diaSemanaLabel:hover {
  background-color: #f3f4f6;
}

.checkbox {
  width: 16px;
  height: 16px;
  border: 1px solid #d1d5db;
  border-radius: 4px;
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
  margin: 0;
  cursor: pointer;
  position: relative;
  flex-shrink: 0;
  transition: all 0.2s ease;
}

.checkbox:checked {
  background-color: #0400BA;
  border-color: #0400BA;
}

.checkbox:checked::after {
  content: '✓';
  position: absolute;
  color: white;
  font-size: 12px;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  line-height: 1;
}

.formGroup input:hover,
.select:hover {
  border-color: #9ca3af;
}

.formGroup input:focus,
.select:focus {
  border-color: #0400BA;
  box-shadow: 0 0 0 3px rgba(4, 0, 186, 0.1);
}

.buttonGroup {
  display: flex;
  justify-content: flex-end;
  gap: 12px;
  margin-top: 1.5rem;
  padding-top: 1rem;
  border-top: 1px solid #e5e7eb;
  width: 100%;
  position: sticky;
  bottom: 0;
  background: white;
  z-index: 10;
  padding: 1rem 0 0.5rem 0;
}

@media (max-width: 480px) {
  .buttonGroup {
    flex-direction: column-reverse;
    gap: 8px;
  }
  
  .buttonGroup button {
    width: 100%;
  }
}

.buttonGroup button {
  padding: 12px 24px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 500;
  font-size: 0.95rem;
  transition: all 0.2s ease;
  min-width: 100px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  position: relative;
  overflow: hidden;
}

.buttonGroup button:focus {
  outline: 2px solid #0400BA;
  outline-offset: 2px;
}

.buttonGroup button:active {
  transform: translateY(1px);
}

.cancelButton {
  background-color: #f3f4f6;
  color: #4b5563;
}

.cancelButton:hover {
  background-color: #e5e7eb;
}

.saveButton {
  background-color: #0400BA;
  color: white;
  position: relative;
  overflow: hidden;
}

.saveButton:hover:not(:disabled) {
  background-color: #03008f;
  box-shadow: 0 2px 8px rgba(4, 0, 186, 0.2);
}

.saveButton:disabled {
  background-color: #9ca3af;
  cursor: not-allowed;
  opacity: 0.8;
}

.saveButton.loading {
  pointer-events: none;
  padding-left: 2.5rem;
}

.spinner {
  width: 16px;
  height: 16px;
  border: 2px solid rgba(255, 255, 255, 0.3);
  border-radius: 50%;
  border-top-color: white;
  animation: spin 1s ease-in-out infinite;
  position: absolute;
  left: 1rem;
  opacity: 0;
  transform: scale(0.8);
  transition: opacity 0.2s ease, transform 0.2s ease;
}

.saveButton.loading .spinner {
  opacity: 1;
  transform: scale(1);
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.buttonGroup button:focus {
  outline: 2px solid transparent;
  outline-offset: 2px;
}

.cancelButton {
  background-color: #f3f4f6;
  color: #4b5563;
  border: 1px solid #d1d5db;
}

.cancelButton:hover {
  background-color: #e5e7eb;
  color: #374151;
}

.cancelButton:active {
  transform: translateY(1px);
}

.saveButton {
  background-color: #0400BA;
  color: #ffffff;
}

.saveButton:hover {
  background-color: #0300a0;
}

.saveButton:active {
  transform: translateY(1px);
}

.saveButton:disabled {
  background-color: #9ca3af;
  cursor: not-allowed;
  opacity: 0.7;
  transform: none;
}

.saveButton:disabled:hover {
  background-color: #9ca3af;
}

/* Responsivo para tablets */
@media (max-width: 1024px) {
  .form {
    gap: 1.4rem;
  }

  .formGroup input,
  .select {
    padding: 13px 14px;
  }

  .buttonGroup {
    margin-top: 22px;
  }

  .buttonGroup button {
    padding: 13px 26px;
  }
}

/* Responsivo para dispositivos móveis */
/* Animações de feedback */
@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes slideUp {
  from { 
    opacity: 0;
    transform: translateY(10px);
  }
  to { 
    opacity: 1;
    transform: translateY(0);
  }
}

/* Animações específicas para os campos */
.formGroup {
  animation: fadeIn 0.3s ease-out;
}

.horarioItem {
  animation: slideUp 0.2s ease-out;
}

/* Responsividade */
@media (max-width: 768px) {
  .form {
    gap: 1.25rem;
  }

  .buttonGroup {
    flex-direction: column-reverse;
    gap: 10px;
    margin-top: 20px;
  }

  .buttonGroup button {
    width: 100%;
    padding: 14px 24px;
  }

  .formGroup input,
  .select {
    padding: 14px 12px;
    font-size: 16px; /* Evita zoom no iOS */
  }

  .horariosContainer {
    gap: 10px;
  }

  .horarioItem {
    padding: 10px 14px;
  }

  .diasSemanaContainer {
    gap: 8px;
  }

  .diaSemanaLabel {
    padding: 7px 12px;
    font-size: 0.9rem;
  }
}

/* Responsivo para telas pequenas */
@media (max-width: 480px) {
  .form {
    gap: 1rem;
  }

  .formGroup label {
    font-size: 0.9rem;
    margin-bottom: 6px;
  }

  .formGroup input,
  .select {
    padding: 12px;
    font-size: 16px;
  }

  .buttonGroup {
    margin-top: 16px;
  }
  
  .addHorarioContainer {
    flex-direction: column;
    align-items: stretch;
    gap: 10px;
  }
  
  .timeInput {
    min-width: auto;
  }
  
  .addButton {
    justify-content: center;
    padding: 10px 12px;
    width: 100%;
  }
  
  .horariosContainer {
    gap: 8px;
  }
  
  .horarioItem {
    padding: 8px 12px;
    flex-direction: column;
    align-items: flex-start;
    gap: 8px;
  }
  
  .removeButton {
    align-self: flex-end;
    padding: 4px 8px;
  }
  
  .diasSemanaContainer {
    gap: 6px;
  }
  
  .diaSemanaLabel {
    padding: 5px 9px;
    font-size: 0.85rem;
  }

  .checkbox {
    width: 14px;
    height: 14px;
  }
}

/* Responsivo para telas muito pequenas */
@media (max-width: 360px) {
  .form {
    gap: 0.9rem;
  }

  .formGroup label {
    font-size: 0.85rem;
  }

  .formGroup input,
  .select {
    padding: 10px;
    font-size: 15px;
  }

  .buttonGroup {
    margin-top: 14px;
    gap: 8px;
  }

  .buttonGroup button {
    padding: 12px 20px;
    font-size: 0.9rem;
  }

  .addButton {
    padding: 8px 10px;
    font-size: 0.85rem;
  }

  .horarioItem {
    padding: 6px 10px;
  }

  .diaSemanaLabel {
    padding: 4px 8px;
    font-size: 0.8rem;
  }

  .checkbox {
    width: 12px;
    height: 12px;
  }

  .removeButton {
    font-size: 1rem;
    padding: 2px 6px;
  }
}

/* Estilos para o campo de horário */
.timeInput {
  width: 100%;
  padding: 0.5rem 0.75rem;
  border: 1px solid #d1d5db;
  border-radius: 0.375rem;
  font-size: 0.9375rem;
  color: #111827;
  background-color: #fff;
  transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
  height: 2.5rem;
}

.timeInput:focus {
  outline: none;
  border-color: #4f46e5;
  box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
}

.timeInput.inputError {
  border-color: #ef4444;
  padding-right: 2.5rem;
  background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='%23ef4444' viewBox='-2 -2 7 7'%3e%3cpath stroke='%23ef4444' d='M0 0l3 3m0-3L0 3'/%3e%3ccircle r='.5'/%3e%3ccircle cx='3' r='.5'/%3e%3ccircle cy='3' r='.5'/%3e%3ccircle cx='3' cy='3' r='.5'/%3e%3c/svg%3E");
  background-repeat: no-repeat;
  background-position: right 0.75rem center;
  background-size: 1.25rem 1.25rem;
}

.timeInput.inputError:focus {
  border-color: #ef4444;
  box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
}

.timeInput:disabled {
  background-color: #f3f4f6;
  cursor: not-allowed;
  opacity: 0.7;
}

/* Estilo para o container do campo de horário */
.timeInputContainer {
  position: relative;
  display: flex;
  width: 100%;
}

/* Estilo para a mensagem de erro */
.errorMessage {
  color: #ef4444;
  font-size: 0.75rem;
  margin-top: 0.25rem;
  display: block;
  line-height: 1.25;
}

/* Estilo para o botão de adicionar horário */
.addButton {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 0.5rem 1rem;
  background-color: #4f46e5;
  color: white;
  border: none;
  border-radius: 0.375rem;
  font-size: 0.875rem;
  font-weight: 500;
  cursor: pointer;
  transition: background-color 0.2s ease-in-out;
  margin-top: 0.5rem;
}

.addButton:hover {
  background-color: #4338ca;
}

.addButton:disabled {
  background-color: #9ca3af;
  cursor: not-allowed;
}

.addButton .plusIcon {
  margin-right: 0.5rem;
  font-size: 1rem;
  line-height: 1;
}

/* Melhorias para acessibilidade */
.timeInput:focus-visible {
  outline: 2px solid #4f46e5;
  outline-offset: 2px;
}

.timeInput[aria-invalid="true"] {
  border-color: #ef4444;
  padding-right: 2.5rem;
}

.timeInput[aria-invalid="true"]:focus {
  box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
}

/* Estilo para o container de horários */
.horariosList {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
  margin-top: 0.5rem;
}

.horarioTag {
  display: inline-flex;
  align-items: center;
  background-color: #eef2ff;
  color: #4f46e5;
  padding: 0.25rem 0.75rem;
  border-radius: 9999px;
  font-size: 0.875rem;
  font-weight: 500;
}

.horarioTag button {
  margin-left: 0.5rem;
  color: #4f46e5;
  background: none;
  border: none;
  cursor: pointer;
  padding: 0.125rem;
  border-radius: 0.25rem;
  display: flex;
  align-items: center;
  justify-content: center;
}

.horarioTag button:hover {
  background-color: rgba(79, 70, 229, 0.1);
}

.horarioTag button:focus {
  outline: 2px solid #4f46e5;
  outline-offset: 2px;
}

================
File: src/components/forms/AddMedicamentoForm.tsx
================
'use client';
import React, { useState, useEffect } from 'react';
import styles from './AddForm.module.css';

type FrequenciaDiaria = {
  tipo: 'diario';
  horarios: string[];
};

type FrequenciaIntervalo = {
  tipo: 'intervalo';
  intervalo_horas: number;
  inicio: string;
};
    
type FrequenciaDiasAlternados = {
  tipo: 'dias_alternados';
  intervalo_dias: number;
  horario: string;
};

type FrequenciaSemanal = {
  tipo: 'semanal';
  dias_da_semana: number[];
  horario: string;
};

type Frequencia = FrequenciaDiaria | FrequenciaIntervalo | FrequenciaDiasAlternados | FrequenciaSemanal;

interface MedicamentoBase {
  id?: string;
  nome: string;
  dosagem: string | null;
  quantidade: number;
  frequencia: Frequencia | null;
  data_agendada?: string;
  concluido?: boolean;
  ultimaAtualizacao?: string;
}

interface AddMedicamentoFormProps {
  onSave: (nome: string, dosagem: string | null, frequencia: Frequencia, quantidade: number) => Promise<void>;
  onCancel: () => void;
  medicamento?: MedicamentoBase;
}

export function AddMedicamentoForm({ onSave, onCancel, medicamento }: AddMedicamentoFormProps) {
  const [nome, setNome] = useState(medicamento?.nome || '');
  const [dosagem, setDosagem] = useState<string | null>(medicamento?.dosagem ?? null);
  const [quantidade, setQuantidade] = useState(medicamento?.quantidade || 30);

  const initTipoFrequencia = medicamento?.frequencia?.tipo || 'diario';
  const [tipoFrequencia, setTipoFrequencia] = useState<
    'diario' | 'intervalo' | 'dias_alternados' | 'semanal'
  >(initTipoFrequencia as any);

  const [horarios, setHorarios] = useState<string[]>(
    (medicamento?.frequencia as FrequenciaDiaria)?.horarios || ['08:00']
  );

  const [novoHorario, setNovoHorario] = useState('');

  const [intervaloHoras, setIntervaloHoras] = useState(
    (medicamento?.frequencia as FrequenciaIntervalo)?.intervalo_horas || 8
  );

  // Inicializa com um valor padrão
  const [horaInicio, setHoraInicio] = useState('08:00');

  const [intervaloDias, setIntervaloDias] = useState(
    (medicamento?.frequencia as FrequenciaDiasAlternados)?.intervalo_dias || 2
  );

  const [diasSemana, setDiasSemana] = useState<number[]>(
    (medicamento?.frequencia as FrequenciaSemanal)?.dias_da_semana || []
  );

  const [loading, setLoading] = useState(false);
  const [formErrors, setFormErrors] = useState<Record<string, string>>({});
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [horarioError, setHorarioError] = useState('');

  const diasDaSemana = [
    { id: 1, label: 'Seg' },
    { id: 2, label: 'Ter' },
    { id: 3, label: 'Qua' },
    { id: 4, label: 'Qui' },
    { id: 5, label: 'Sex' },
    { id: 6, label: 'Sáb' },
    { id: 7, label: 'Dom' },
  ];

  const adicionarHorario = () => {
    const horarioFormatado = novoHorario.trim();
    
    // Limpa erros anteriores
    setHorarioError('');
    
    if (!horarioFormatado) {
      setHorarioError('Por favor, informe um horário');
      return;
    }

    // Garante que o horário tenha o formato HH:MM
    const horarioValido = /^([01]?[0-9]|2[0-3]):[0-5][0-9]$/.test(horarioFormatado);
    if (!horarioValido) {
      setHorarioError('Formato inválido. Use HH:MM (ex: 08:00)');
      return;
    }

    // Verifica se o horário já existe
    const horarioJaExiste = horarios.some(h => h === horarioFormatado);
    
    if (horarioJaExiste) {
      setHorarioError('Este horário já foi adicionado');
      return;
    }

    // Adiciona o horário e limpa o campo
    setHorarios(prev => [...prev, horarioFormatado].sort((a, b) => a.localeCompare(b)));
    setNovoHorario('');
    
    // Limpa mensagem de erro se existir
    if (formErrors.horarios) {
      setFormErrors(prev => ({ ...prev, horarios: '' }));
    }
  };

  const removerHorario = (horario: string) => {
    setHorarios(horarios.filter(h => h !== horario));
  };

  const toggleDiaSemana = (dia: number) => {
    setDiasSemana(prev =>
      prev.includes(dia)
        ? prev.filter(d => d !== dia)
        : [...prev, dia].sort()
    );
  };

  const validateForm = () => {
    const errors: Record<string, string> = {};
    
    if (!nome.trim()) {
      errors.nome = 'O nome do medicamento é obrigatório';
    }
    
    if (tipoFrequencia === 'diario' && horarios.length === 0) {
      errors.horarios = 'Adicione pelo menos um horário';
    }
    
    if (tipoFrequencia === 'semanal' && diasSemana.length === 0) {
      errors.diasSemana = 'Selecione pelo menos um dia da semana';
    }
    
    if (quantidade <= 0) {
      errors.quantidade = 'A quantidade deve ser maior que zero';
    }
    
    setFormErrors(errors);
    return Object.keys(errors).length === 0;
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    
    if (!validateForm()) {
      return;
    }
    
    setIsSubmitting(true);

    let frequencia: Frequencia;

    switch (tipoFrequencia) {
      case 'diario':
        if (horarios.length === 0) {
          alert('Por favor, adicione pelo menos um horário.');
          return;
        }
        frequencia = { tipo: 'diario', horarios };
        break;

      case 'intervalo':
        if (!horaInicio) {
          alert('Por favor, informe o horário de início.');
          return;
        }
        frequencia = {
          tipo: 'intervalo',
          intervalo_horas: Number(intervaloHoras) || 8,
          inicio: horaInicio
        };
        break;

      case 'dias_alternados':
        if (!horaInicio) {
          alert('Por favor, informe o horário.');
          return;
        }
        frequencia = {
          tipo: 'dias_alternados',
          intervalo_dias: Number(intervaloDias) || 2,
          horario: horaInicio
        };
        break;

      case 'semanal':
        if (diasSemana.length === 0) {
          alert('Por favor, selecione pelo menos um dia da semana.');
          return;
        }
        if (!horaInicio) {
          alert('Por favor, informe o horário.');
          return;
        }
        frequencia = {
          tipo: 'semanal',
          dias_da_semana: diasSemana,
          horario: horaInicio
        };
        break;

      default:
        return;
    }

    setLoading(true);
    try {
      await onSave(nome, dosagem, frequencia, quantidade);
    } finally {
      setLoading(false);
    }
  };

  // Efeito para inicializar os estados quando o componente monta ou quando o medicamento muda
  useEffect(() => {
    if (medicamento) {
      // Garante que o TypeScript entenda que medicamento não é undefined aqui
      const med = medicamento as MedicamentoBase;
      
      setNome(med.nome);
      setDosagem(med.dosagem ?? null);
      setQuantidade(med.quantidade);

      if (med.frequencia) {
        const freq = med.frequencia;
        setTipoFrequencia(freq.tipo as any);

        // Inicializa os estados específicos do tipo de frequência
        // Usando type guards para garantir que estamos acessando as propriedades corretas
        if (freq.tipo === 'diario' && 'horarios' in freq) {
          setHorarios(freq.horarios);
        } else if (freq.tipo === 'intervalo' && 'intervalo_horas' in freq) {
          setIntervaloHoras(freq.intervalo_horas);
          setHoraInicio('inicio' in freq ? freq.inicio : '08:00');
        } else if (freq.tipo === 'dias_alternados' && 'intervalo_dias' in freq) {
          setIntervaloDias(freq.intervalo_dias);
          setHoraInicio('horario' in freq ? freq.horario : '08:00');
        } else if (freq.tipo === 'semanal' && 'dias_da_semana' in freq) {
          setDiasSemana(freq.dias_da_semana);
          setHoraInicio('horario' in freq ? freq.horario : '08:00');
        }
      } else {
        // Se não houver frequência definida, define valores padrão
        setTipoFrequencia('diario');
        setHorarios(['08:00']);
        setHoraInicio('08:00');
      }
    } else {
      // Se não houver medicamento (criação), define valores padrão
      setNome('');
      setDosagem(null);
      setQuantidade(30);
      setTipoFrequencia('diario');
      setHorarios(['08:00']);
      setHoraInicio('08:00');
      setIntervaloHoras(8);
      setIntervaloDias(2);
      setDiasSemana([]);
    }
  }, [medicamento]);

  // Efeito para rolar até o primeiro erro quando houver validação
  React.useEffect(() => {
    const firstError = Object.keys(formErrors)[0];
    if (firstError) {
      const element = document.querySelector(`[data-field="${firstError}"]`);
      element?.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
  }, [formErrors]);

  return (
    <form className={styles.form} onSubmit={handleSubmit} noValidate>
      <div className={`${styles.formGroup} ${formErrors.nome ? styles.hasError : ''}`} data-field="nome">
        <label htmlFor="nome">
          Nome do Medicamento
          {formErrors.nome && <span className={styles.errorText}> - {formErrors.nome}</span>}
        </label>
        <input
          id="nome"
          type="text"
          value={nome}
          onChange={(e) => {
            setNome(e.target.value);
            if (formErrors.nome) {
              setFormErrors(prev => ({ ...prev, nome: '' }));
            }
          }}
          placeholder="Ex: Paracetamol"
          required
          className={formErrors.nome ? styles.inputError : ''}
          aria-invalid={!!formErrors.nome}
          aria-describedby={formErrors.nome ? 'nome-error' : undefined}
        />
      </div>
      
      <div className={styles.formGroup}>
        <label htmlFor="dosagem">Dosagem (ex: 500mg, 1 comprimido)</label>
        <input
          id="dosagem"
          type="text"
          value={dosagem || ''}
          onChange={(e) => setDosagem(e.target.value || null)}
          placeholder="Ex: 1 comprimido"
        />
      </div>
      
      <div className={`${styles.formGroup} ${formErrors.quantidade ? styles.hasError : ''}`} data-field="quantidade">
        <label htmlFor="quantidade">
          Quantidade
          {formErrors.quantidade && <span className={styles.errorText}> - {formErrors.quantidade}</span>}
        </label>
        <input
          id="quantidade"
          type="number"
          min="1"
          value={quantidade}
          onChange={(e) => {
            const value = Math.max(1, Number(e.target.value) || 1);
            setQuantidade(value);
            if (formErrors.quantidade) {
              setFormErrors(prev => ({ ...prev, quantidade: '' }));
            }
          }}
          onBlur={(e) => {
            const value = Math.max(1, Number(e.target.value) || 1);
            setQuantidade(value);
          }}
          placeholder="Ex: 30"
          className={formErrors.quantidade ? styles.inputError : ''}
          aria-invalid={!!formErrors.quantidade}
          aria-describedby={formErrors.quantidade ? 'quantidade-error' : undefined}
        />
      </div>

      <div className={styles.formGroup} data-field="frequencia">
        <label>Frequência</label>
        <select
          className={styles.select}
          value={tipoFrequencia}
          onChange={(e) => {
            setTipoFrequencia(e.target.value as any);
            // Limpa erros de validação quando o tipo de frequência muda
            setFormErrors(prev => ({
              ...prev,
              horarios: '',
              diasSemana: ''
            }));
          }}
        >
          <option value="diario">Diariamente</option>
          <option value="intervalo">Intervalo de Horas</option>
          <option value="dias_alternados">Dias Alternados</option>
          <option value="semanal">Dias da Semana</option>
        </select>
      </div>

      {/* Lista de horários para frequência diária */}
      {tipoFrequencia === 'diario' && (
        <div className={`${styles.formGroup} ${formErrors.horarios ? styles.hasError : ''}`} data-field="horarios">
          <label>
            Horários
            {formErrors.horarios && <span className={styles.errorText}> - {formErrors.horarios}</span>}
          </label>
          <div className={styles.horariosContainer}>
            {horarios.length > 0 ? (
              horarios.map((horario, index) => (
                <div key={index} className={styles.horarioItem}>
                  <span>{horario}</span>
                  <button
                    type="button"
                    className={styles.removeButton}
                    onClick={() => {
                      removerHorario(horario);
                      if (formErrors.horarios && horarios.length === 1) {
                        setFormErrors(prev => ({ ...prev, horarios: '' }));
                      }
                    }}
                    aria-label={`Remover horário ${horario}`}
                  >
                    ×
                  </button>
                </div>
              ))
            ) : (
              <div className={styles.placeholderText}>Nenhum horário adicionado</div>
            )}
          </div>
          <div className={styles.addHorarioContainer}>
            <div className={styles.horarioInputContainer}>
              <input
                type="time"
                value={novoHorario}
                onChange={(e) => {
                  setNovoHorario(e.target.value);
                  if (horarioError) setHorarioError('');
                  if (formErrors.horarios) setFormErrors(prev => ({ ...prev, horarios: '' }));
                }}
                onKeyDown={(e) => e.key === 'Enter' && (e.preventDefault(), adicionarHorario())}
                className={`${styles.timeInput} ${horarioError || formErrors.horarios ? styles.inputError : ''}`}
                aria-invalid={!!horarioError || !!formErrors.horarios}
                aria-describedby={horarioError || formErrors.horarios ? 'horario-error' : undefined}
                placeholder="HH:MM"
              />
              {horarioError && (
                <div id="horario-error" className={styles.errorMessage}>
                  {horarioError}
                </div>
              )}
            </div>
            <button
              type="button"
              className={styles.addButton}
              onClick={adicionarHorario}
              disabled={!novoHorario.trim()}
            >
              <span className={styles.plusIcon}>+</span> Adicionar Horário
            </button>
          </div>
        </div>
      )}

      {/* Intervalo de Horas */}
      {tipoFrequencia === 'intervalo' && (
        <div className={styles.formGroup}>
          <label htmlFor="intervaloHoras">A cada quantas horas?</label>
          <input
            id="intervaloHoras"
            type="number"
            min="1"
            max="24"
            value={intervaloHoras}
            onChange={(e) => setIntervaloHoras(Number(e.target.value))}
            className={styles.input}
          />
          <div className={styles.formGroup}>
            <label htmlFor="horaUnica">A partir das</label>
            <input
              id="horaUnica"
              type="time"
              value={horaInicio}
              onChange={(e) => setHoraInicio(e.target.value)}
              className={styles.input}
              aria-required="true"
            />
          </div>
        </div>
      )}

      {/* Dias Alternados */}
      {tipoFrequencia === 'dias_alternados' && (
        <div className={styles.formGroup}>
          <label htmlFor="intervaloDias">A cada quantos dias?</label>
          <input
            id="intervaloDias"
            type="number"
            min="1"
            value={intervaloDias}
            onChange={(e) => setIntervaloDias(Number(e.target.value))}
            className={styles.input}
          />
          <div className={styles.formGroup}>
            <label htmlFor="horaUnica">No horário</label>
            <input
              id="horaUnica"
              type="time"
              value={horaInicio}
              onChange={(e) => setHoraInicio(e.target.value)}
              className={styles.input}
              aria-required="true"
            />
          </div>
        </div>
      )}

      {/* Dias da Semana */}
      {tipoFrequencia === 'semanal' && (
        <div className={`${styles.formGroup} ${formErrors.diasSemana ? styles.hasError : ''}`} data-field="diasSemana">
          <label>
            Dias da Semana
            {formErrors.diasSemana && <span className={styles.errorText}> - {formErrors.diasSemana}</span>}
          </label>
          <div className={styles.diasSemanaContainer}>
            {diasDaSemana.map((dia) => (
              <label 
                key={dia.id} 
                className={`${styles.diaSemanaLabel} ${
                  diasSemana.includes(dia.id) ? styles.diaSelecionado : ''
                }`}
              >
                <input
                  type="checkbox"
                  className={styles.checkbox}
                  checked={diasSemana.includes(dia.id)}
                  onChange={() => {
                    toggleDiaSemana(dia.id);
                    if (formErrors.diasSemana) {
                      setFormErrors(prev => ({
                        ...prev,
                        diasSemana: diasSemana.length === 1 && diasSemana.includes(dia.id) ? 
                          'Selecione pelo menos um dia' : ''
                      }));
                    }
                  }}
                  aria-label={`Dia ${dia.label}`}
                />
                {dia.label}
              </label>
            ))}
          </div>
          <div className={styles.formGroup}>
            <label htmlFor="horaUnica">No horário</label>
            <input
              id="horaUnica"
              type="time"
              value={horaInicio}
              onChange={(e) => setHoraInicio(e.target.value)}
              className={styles.input}
              aria-required="true"
            />
          </div>
        </div>
      )}


      <div className={styles.buttonGroup}>
        <button
          type="button"
          onClick={onCancel}
          className={styles.cancelButton}
          disabled={isSubmitting}
        >
          Cancelar
        </button>
        <button
          type="submit"
          className={`${styles.saveButton} ${isSubmitting ? styles.loading : ''}`}
          disabled={isSubmitting}
        >
          {isSubmitting ? (
            <>
              <span className={styles.spinner} aria-hidden="true" />
              <span>Salvando...</span>
            </>
          ) : 'Salvar'}
        </button>
      </div>
    </form>
  );
}

================
File: src/components/forms/AddRotinaForm.tsx
================
'use client';

import { useState, useEffect } from 'react';
import styles from './AddForm.module.css';

// Tipos de Frequência
type FrequenciaDiaria = {
  tipo: 'diario';
  horarios: string[];
};

type FrequenciaIntervalo = {
  tipo: 'intervalo';
  intervalo_horas: number;
  inicio: string;
};

type FrequenciaDiasAlternados = {
  tipo: 'dias_alternados';
  intervalo_dias: number;
  horario: string;
};

type FrequenciaSemanal = {
  tipo: 'semanal';
  dias_da_semana: number[];
  horario: string;
};

type Frequencia = FrequenciaDiaria | FrequenciaIntervalo | FrequenciaDiasAlternados | FrequenciaSemanal;

// Tipo leve para edição/pré-preenchimento no formulário
type RotinaFormData = {
  id?: string;
  titulo?: string;
  descricao?: string;
};

// Interface de Props atualizada
interface AddRotinaFormProps {
  onSave: (titulo: string, descricao: string, frequencia: Frequencia) => Promise<void>;
  onCancel: () => void;
  rotina?: RotinaFormData;
}

export function AddRotinaForm({ onSave, onCancel, rotina }: AddRotinaFormProps) {
  // Estados para os campos da rotina
  const [titulo, setTitulo] = useState(rotina?.titulo || rotina?.descricao || '');
  const [descricao, setDescricao] = useState('');
  
  // Estados para o controle da frequência
  const [tipoFrequencia, setTipoFrequencia] = useState<'diario' | 'intervalo' | 'dias_alternados' | 'semanal'>('diario');
  const [horarios, setHorarios] = useState<string[]>(['09:00']);
  const [novoHorario, setNovoHorario] = useState('');
  const [intervaloHoras, setIntervaloHoras] = useState(8);
  const [horaInicio, setHoraInicio] = useState('09:00');
  const [intervaloDias, setIntervaloDias] = useState(2);
  const [diasSemana, setDiasSemana] = useState<number[]>([]);
  const [loading, setLoading] = useState(false);
  const [formErrors, setFormErrors] = useState<Record<string, string>>({});

  const diasDaSemana = [
    { id: 1, label: 'Seg' },
    { id: 2, label: 'Ter' },
    { id: 3, label: 'Qua' },
    { id: 4, label: 'Qui' },
    { id: 5, label: 'Sex' },
    { id: 6, label: 'Sáb' },
    { id: 7, label: 'Dom' },
  ];

  const adicionarHorario = () => {
    if (novoHorario && !horarios.includes(novoHorario)) {
      setHorarios([...horarios, novoHorario].sort());
      setNovoHorario('');
    }
  };

  const removerHorario = (horario: string) => {
    setHorarios(horarios.filter(h => h !== horario));
  };

  const toggleDiaSemana = (dia: number) => {
    setDiasSemana(prev => 
      prev.includes(dia) 
        ? prev.filter(d => d !== dia) 
        : [...prev, dia].sort()
    );
  };

  const validateForm = () => {
    const errors: Record<string, string> = {};
    
    if (!titulo.trim()) {
      errors.titulo = 'O título da rotina é obrigatório';
    }
    
    if (tipoFrequencia === 'diario' && horarios.length === 0) {
      errors.horarios = 'Adicione pelo menos um horário';
    }
    
    if (tipoFrequencia === 'semanal' && diasSemana.length === 0) {
      errors.diasSemana = 'Selecione pelo menos um dia da semana';
    }
    
    setFormErrors(errors);
    return Object.keys(errors).length === 0;
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    
    if (!validateForm()) {
      return;
    }

    let frequencia: Frequencia;

    switch (tipoFrequencia) {
      case 'diario':
        if (horarios.length === 0) {
          alert('Por favor, adicione pelo menos um horário.');
          return;
        }
        frequencia = { tipo: 'diario', horarios };
        break;
      
      case 'intervalo':
        if (!horaInicio) {
          alert('Por favor, informe o horário de início.');
          return;
        }
        frequencia = { 
          tipo: 'intervalo', 
          intervalo_horas: Number(intervaloHoras) || 8, 
          inicio: horaInicio 
        };
        break;
      
      case 'dias_alternados':
        if (!horaInicio) {
          alert('Por favor, informe o horário.');
          return;
        }
        frequencia = { 
          tipo: 'dias_alternados', 
          intervalo_dias: Number(intervaloDias) || 2, 
          horario: horaInicio 
        };
        break;
      
      case 'semanal':
        if (diasSemana.length === 0) {
          alert('Por favor, selecione pelo menos um dia da semana.');
          return;
        }
        if (!horaInicio) {
          alert('Por favor, informe o horário.');
          return;
        }
        frequencia = { 
          tipo: 'semanal', 
          dias_da_semana: diasSemana, 
          horario: horaInicio 
        };
        break;
      
      default:
        return;
    }

    setLoading(true);
    try {
      // Chama onSave com os dados da rotina e o objeto de frequência
      await onSave(titulo, descricao, frequencia);
    } finally {
      setLoading(false);
    }
  };

  // Efeito para rolar até o primeiro erro quando houver validação
  useEffect(() => {
    const firstError = Object.keys(formErrors)[0];
    if (firstError) {
      const element = document.querySelector(`[data-field="${firstError}"]`);
      element?.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
  }, [formErrors]);

  return (
    <form onSubmit={handleSubmit} className={styles.form}>
      <div className={`${styles.formGroup} ${formErrors.titulo ? styles.hasError : ''}`} data-field="titulo">
        <label htmlFor="titulo">
          Título da Rotina
          {formErrors.titulo && <span className={styles.errorText}> - {formErrors.titulo}</span>}
        </label>
        <input
          id="titulo"
          type="text"
          value={titulo}
          onChange={(e) => {
            setTitulo(e.target.value);
            if (formErrors.titulo) {
              setFormErrors(prev => ({ ...prev, titulo: '' }));
            }
          }}
          className={formErrors.titulo ? styles.inputError : ''}
          aria-invalid={!!formErrors.titulo}
          aria-describedby={formErrors.titulo ? 'titulo-error' : undefined}
        />
      </div>
      
      <div className={styles.formGroup}>
        <label htmlFor="descricao">Descrição (opcional)</label>
        <input
          id="descricao"
          type="text"
          value={descricao}
          onChange={(e) => setDescricao(e.target.value)}
        />
      </div>

      <div className={styles.formGroup}>
        <label htmlFor="tipoFrequencia">Frequência</label>
        <select
          id="tipoFrequencia"
          value={tipoFrequencia}
          onChange={(e) => setTipoFrequencia(e.target.value as any)}
          className={styles.select}
        >
          <option value="diario">Diariamente</option>
          <option value="intervalo">Intervalo de Horas</option>
          <option value="dias_alternados">Dias Alternados</option>
          <option value="semanal">Dias da Semana</option>
        </select>
      </div>

      {/* Inputs Condicionais para Frequência */}

      {tipoFrequencia === 'diario' && (
        <div className={`${styles.formGroup} ${formErrors.horarios ? styles.hasError : ''}`} data-field="horarios">
          <label>
            Horários
            {formErrors.horarios && <span className={styles.errorText}> - {formErrors.horarios}</span>}
          </label>
          <div className={styles.horariosContainer}>
            {horarios.length > 0 ? (
              horarios.map((horario, index) => (
                <div key={index} className={styles.horarioItem}>
                  <span>{horario}</span>
                  <button 
                    type="button" 
                    onClick={() => {
                      removerHorario(horario);
                      if (formErrors.horarios && horarios.length === 1) {
                        setFormErrors(prev => ({ ...prev, horarios: '' }));
                      }
                    }} 
                    className={styles.removeButton}
                    aria-label={`Remover horário ${horario}`}
                  >
                    ×
                  </button>
                </div>
              ))
            ) : (
              <div className={styles.placeholderText}>Nenhum horário adicionado</div>
            )}
          </div>
          <div className={styles.addHorarioContainer}>
            <div className={styles.horarioInputContainer}>
              <input
                type="time"
                value={novoHorario}
                onChange={(e) => {
                  setNovoHorario(e.target.value);
                  if (formErrors.horarios) {
                    setFormErrors(prev => ({ ...prev, horarios: '' }));
                  }
                }}
                onKeyDown={(e) => e.key === 'Enter' && (e.preventDefault(), adicionarHorario())}
                className={`${styles.timeInput} ${formErrors.horarios ? styles.inputError : ''}`}
                aria-invalid={!!formErrors.horarios}
                aria-describedby={formErrors.horarios ? 'horarios-error' : undefined}
                placeholder="HH:MM"
              />
            </div>
            <button
              type="button"
              onClick={() => {
                adicionarHorario();
                if (formErrors.horarios) {
                  setFormErrors(prev => ({ ...prev, horarios: '' }));
                }
              }}
              className={styles.addButton}
              disabled={!novoHorario.trim()}
            >
              <span className={styles.plusIcon}>+</span> Adicionar Horário
            </button>
          </div>
        </div>
      )}

      {tipoFrequencia === 'intervalo' && (
        <>
          <div className={styles.formGroup}>
            <label htmlFor="intervaloHoras">A cada quantas horas?</label>
            <input id="intervaloHoras" type="number" min="1" max="24" value={intervaloHoras} onChange={(e) => setIntervaloHoras(Number(e.target.value))} className={styles.input} />
          </div>
          <div className={styles.formGroup}>
            <label htmlFor="horaInicio">A partir das</label>
            <input id="horaInicio" type="time" value={horaInicio} onChange={(e) => setHoraInicio(e.target.value)} className={styles.input} />
          </div>
        </>
      )}

      {tipoFrequencia === 'dias_alternados' && (
        <>
          <div className={styles.formGroup}>
            <label htmlFor="intervaloDias">A cada quantos dias?</label>
            <input id="intervaloDias" type="number" min="1" value={intervaloDias} onChange={(e) => setIntervaloDias(Number(e.target.value))} className={styles.input} />
          </div>
          <div className={styles.formGroup}>
            <label htmlFor="horaDiasAlternados">No horário</label>
            <input id="horaDiasAlternados" type="time" value={horaInicio} onChange={(e) => setHoraInicio(e.target.value)} className={styles.input} />
          </div>
        </>
      )}

      {tipoFrequencia === 'semanal' && (
        <>
          <div className={`${styles.formGroup} ${formErrors.diasSemana ? styles.hasError : ''}`} data-field="diasSemana">
            <label>
              Dias da semana
              {formErrors.diasSemana && <span className={styles.errorText}> - {formErrors.diasSemana}</span>}
            </label>
            <div className={styles.diasSemanaContainer}>
              {diasDaSemana.map((dia) => (
                <label 
                  key={dia.id} 
                  className={`${styles.diaSemanaLabel} ${diasSemana.includes(dia.id) ? styles.diaSelecionado : ''}`}
                >
                  <input 
                    type="checkbox" 
                    checked={diasSemana.includes(dia.id)} 
                    onChange={() => {
                      toggleDiaSemana(dia.id);
                      if (formErrors.diasSemana) {
                        setFormErrors(prev => ({
                          ...prev, 
                          diasSemana: diasSemana.length === 1 && diasSemana.includes(dia.id) ? 
                            'Selecione pelo menos um dia' : ''
                        }));
                      }
                    }} 
                    className={styles.checkbox} 
                    aria-label={`Dia ${dia.label}`}
                  />
                  {dia.label}
                </label>
              ))}
            </div>
          </div>
          <div className={styles.formGroup}>
            <label htmlFor="horaSemanal">No horário</label>
            <input 
              id="horaSemanal" 
              type="time" 
              value={horaInicio} 
              onChange={(e) => setHoraInicio(e.target.value)} 
              className={styles.input} 
            />
          </div>
        </>
      )}

      <div className={styles.buttonGroup}>
        <button 
          type="button" 
          onClick={onCancel} 
          className={styles.cancelButton}
          disabled={loading}
        >
          Cancelar
        </button>
        <button 
          type="submit" 
          disabled={loading} 
          className={`${styles.saveButton} ${loading ? styles.loading : ''}`}
        >
          {loading ? (
            <>
              <span className={styles.spinner} aria-hidden="true" />
              <span>Salvando...</span>
            </>
          ) : 'Salvar'}
        </button>
      </div>
    </form>
  );
}

================
File: src/components/FullScreenLoader.module.css
================
/*
  Este CSS cria uma camada que cobre a tela inteira com um spinner no centro.
*/
.overlay {
    position: fixed; /* Fica fixo na tela, mesmo se a página rolar */
    top: 0;
    left: 0;
    width: 100vw; /* 100% da largura da janela */
    height: 100vh; /* 100% da altura da janela */
    background-color: rgba(255, 255, 255, 0.9); /* Fundo branco com 90% de opacidade */
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 9999; /* Garante que ele fique na frente de todos os outros elementos */
    transition: opacity 0.3s ease-in-out;
}

.spinner {
    width: 50px;
    height: 50px;
    border: 5px solid #e0e0e0; /* Cor da borda do círculo */
    border-top: 5px solid #0400BA; /* Cor do indicador de progresso (seu azul) */
    border-radius: 50%;
    animation: spin 1s linear infinite; /* Animação de rotação */
}

.text {
    margin-top: 1rem;
    font-size: 1.2rem;
    color: #333;
    font-weight: 500;
}

/* Animação que faz o spinner girar */
@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

================
File: src/components/FullScreenLoader.tsx
================
import styles from './FullScreenLoader.module.css';

export function FullScreenLoader() {
    return (
        <div className={styles.overlay}>
            <div className={styles.spinner}></div>
            <p className={styles.text}>Carregando...</p>
        </div>
    );
}

================
File: src/components/Header/Header.module.css
================
.header {
  width: 100%;
  height: 80px;
  background-color: #fff;
  display: flex;
  align-items: center;
  padding: 0 24px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.logoContainer {
  height: 40px;
}

================
File: src/components/Header/Header.tsx
================
import React from 'react';
import Image from 'next/image';
import styles from './Header.module.css';

export default function Header() {
  return (
    <header className={styles.header}>
      <div className={styles.logoContainer}>
        <Image
          src="/logo_coracao.png"
          alt="CareMind Logo"
          width={150}
          height={40}
          priority
        />
      </div>
    </header>
  );
}

================
File: src/components/headers/Header.module.css
================
/* HeaderDashboard.module.css */

.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px 24px;
  background-color: #f8f9fa;
  border-bottom: 1px solid #dee2e6;
}

/* NOVO: Classe para alinhar o logo e o botão de menu */
.headerLeft {
  display: flex;
  align-items: center;
  gap: 20px; /* Espaço entre o botão e o logo */
}

/* A position: relative é essencial para posicionar o menu dropdown */
.profileContainer {
  position: relative;
  align-items: center;
  justify-content: center;
}

.actions {
  display: flex;
  align-items: center;
  gap: 16px;
  cursor: pointer;
  padding: 8px;
  border-radius: 8px;
  transition: background-color 0.2s ease;
  user-select: none;
}

.actions:hover {
  background-color: #e9ecef;
}

.welcomeText {
  margin: 0;
  color: #0400BA;
  font-weight: 500;
  font-size: 25px;
}

.dropdownMenu {
  position: absolute;
  top: calc(100% + 8px);
  right: 0;
  background-color: white;
  border-radius: 8px;
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);
  border: 1px solid #dee2e6;
  z-index: 100;
  width: 180px;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  padding: 8px 0;
}

.dropdownMenu a, .dropdownLogout {
  font-size: 18px;
}

.dropdownItem {
  padding: 10px 20px;
  color: #212529;
  text-decoration: none;
  font-size: 16px;
  background: none;
  border: none;
  width: 100%;
  text-align: left;
  cursor: pointer;
  transition: background-color 0.2s ease;
}

.dropdownItem:hover {
  background-color: #f8f9fa;
}

.dropdownLogout {
  color: #e63946;
  font-weight: 500;
}

.person {
  color: black;
}

/* ============================================= */
/* Estilos do Menu Hambúrguer                  */
/* ============================================= */
.hamburger {
  display: flex; 
  flex-direction: column;
  gap: 4px;
  cursor: pointer;
  z-index: 1001;
  background: none;
  border: none;
  padding: 5px;
}

.hamburger span {
  width: 28px;
  height: 3px;
  background-color: #0400BA; /* Cor primária do seu projeto */
  transition: all 0.3s ease-in-out;
  border-radius: 2px;
}

/* Animação do "X" */
.hamburger.active span:nth-child(1) {
  transform: rotate(45deg) translate(6px, 6px);
}
.hamburger.active span:nth-child(2) {
  opacity: 0;
}
.hamburger.active span:nth-child(3) {
  transform: rotate(-45deg) translate(6px, -6px);
}

/* Responsividade para tablets */
@media (max-width: 1024px) {
  .header {
    padding: 14px 20px;
  }
  
  .welcomeText {
    font-size: 22px;
  }
  
  .dropdownMenu {
    width: 160px;
  }
}

/* Responsividade para dispositivos móveis */
@media (max-width: 768px) {
  .header {
    padding: 12px 16px;
  }
  
  .headerLeft {
    gap: 15px;
  }
  
  .welcomeText {
    font-size: 20px;
  }
  
  .actions {
    padding: 6px;
  }
  
  .dropdownMenu {
    width: 140px;
    right: -10px;
  }
  
  .dropdownItem {
    padding: 8px 16px;
    font-size: 14px;
  }
  
  .hamburger span {
    width: 24px;
    height: 2.5px;
  }
}

/* Responsividade para telas pequenas */
@media (max-width: 480px) {
  .header {
    padding: 10px 12px;
  }
  
  .headerLeft {
    gap: 10px;
  }
  
  .welcomeText {
    font-size: 18px;
  }
  
  .actions {
    padding: 4px;
  }
  
  .dropdownMenu {
    width: 120px;
    right: -15px;
  }
  
  .dropdownItem {
    padding: 6px 12px;
    font-size: 13px;
  }
  
  .hamburger span {
    width: 22px;
    height: 2px;
  }
}

/* Responsividade para telas muito pequenas */
@media (max-width: 360px) {
  .header {
    padding: 8px 10px;
  }
  
  .welcomeText {
    font-size: 16px;
  }
  
  .dropdownMenu {
    width: 110px;
    right: -20px;
  }
  
  .dropdownItem {
    padding: 5px 10px;
    font-size: 12px;
  }
}

================
File: src/components/headers/HeaderDashboard.module.css
================
/* HeaderDashboard.module.css */

.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px 24px;
  background-color: white;
  border-bottom: 1px solid #dee2e6;
}

/* NOVO: Classe para alinhar o logo e o botão de menu */
.headerLeft {
  display: flex;
  align-items: center;
  gap: 20px; /* Espaço entre o botão e o logo */
}

/* A position: relative é essencial para posicionar o menu dropdown */
.profileContainer {
  position: relative;
  align-items: center;
  justify-content: center;
}

/* Seletor de Idoso (melhor visual) */
.elderWrap {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-left: 12px;
}

.elderLabel {
  font-weight: 700;
  font-size: 14px;
  color: #0f172a;
}

.elderSelect {
  padding: 8px 36px 8px 12px;
  border-radius: 10px;
  border: 1px solid #e2e8f0;
  background: #ffffff;
  color: #0f172a;
  min-width: 220px;
  outline: none;
  transition: all 0.2s ease;
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
}

.elderSelect:focus {
  border-color: #0400BA;
  box-shadow: 0 0 0 3px rgba(4, 0, 185, 0.15);
}

.elderSelectWrapper {
  position: relative;
  display: inline-flex;
  align-items: center;
}

.elderCaret {
  position: absolute;
  right: 12px;
  width: 0;
  height: 0;
  border-left: 6px solid transparent;
  border-right: 6px solid transparent;
  border-top: 6px solid #64748b; /* caret color */
  pointer-events: none;
}

/* Custom dropdown (results list) */
.elderButton {
  padding: 8px 36px 8px 12px;
  border-radius: 10px;
  border: 1px solid #e2e8f0;
  background: #ffffff;
  color: #0f172a;
  min-width: 220px;
  text-align: left;
  cursor: pointer;
  transition: all 0.2s ease;
}

.elderButton:focus {
  outline: none;
  border-color: #0400BA;
  box-shadow: 0 0 0 3px rgba(4, 0, 185, 0.15);
}

.elderMenu {
  position: absolute;
  top: calc(100% + 6px);
  left: 0;
  background: #ffffff;
  border: 1px solid #e2e8f0;
  border-radius: 12px;
  box-shadow: 0 12px 30px rgba(0,0,0,0.10);
  width: 100%;
  max-height: 280px;
  overflow-y: auto;
  z-index: 200;
}

.elderOption {
  padding: 10px 12px;
  color: #0f172a;
  font-size: 14px;
  cursor: pointer;
  transition: background-color 0.15s ease;
}

.elderOption:hover,
.elderOption[aria-selected="true"] {
  background: #f8fafc;
}

.elderEmpty {
  padding: 10px 12px;
  color: #64748b;
  font-size: 14px;
}

/* Ações contextuais da página (direita do header) */
.pageActions {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-right: 12px;
}

.pageActionBtn {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  height: 36px;
  padding: 0 14px;
  border-radius: 10px;
  border: 1px solid #e2e8f0;
  background: #ffffff;
  color: #0f172a;
  font-weight: 600;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.pageActionBtn:hover {
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.08);
}

.pageActionBtn.primary {
  background: #0400BA;
  color: #ffffff;
  border-color: transparent;
}

.pageActionBtn.primary:hover {
  background: #2d2dff;
}

.actions {
  display: flex;
  align-items: center;
  gap: 16px;
  cursor: pointer;
  padding: 8px;
  border-radius: 8px;
  transition: background-color 0.2s ease;
  user-select: none;
}

.actions:hover {
  background-color: #e9ecef;
}

.welcomeText {
  margin: 0;
  color: #495057;
  font-weight: 500;
  font-size: 20px;
}

.dropdownMenu {
  position: absolute;
  top: calc(100% + 8px);
  right: 0;
  background-color: white;
  border-radius: 8px;
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);
  border: 1px solid #dee2e6;
  z-index: 100;
  width: 180px;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  padding: 8px 0;
}

.dropdownMenu a, .dropdownLogout {
  font-size: 18px;
}

.dropdownItem {
  padding: 10px 20px;
  color: #212529;
  text-decoration: none;
  font-size: 16px;
  background: none;
  border: none;
  width: 100%;
  text-align: left;
  cursor: pointer;
  transition: background-color 0.2s ease;
}

.dropdownItem:hover {
  background-color: #f8f9fa;
}

.dropdownLogout {
  color: #e63946;
  font-weight: 500;
}

.person {
  color: black;
}

/* ============================================= */
/* Estilos do Menu Hambúrguer                  */
/* ============================================= */
.hamburger {
  display: flex; 
  flex-direction: column;
  gap: 4px;
  cursor: pointer;
  z-index: 1001;
  background: none;
  border: none;
  padding: 5px;
}

.hamburger span {
  width: 28px;
  height: 3px;
  background-color: #0400BA; /* Cor primária do seu projeto */
  transition: all 0.3s ease-in-out;
  border-radius: 2px;
  transform-origin: center;
}

/* Animação do "X" */
.hamburger.active span:nth-child(1) {
  transform: translateY(7px) rotate(45deg);
}
.hamburger.active span:nth-child(2) {
  opacity: 0;
}
.hamburger.active span:nth-child(3) {
  transform: translateY(-7px) rotate(-45deg);
}

/* Responsividade para tablets */
@media (max-width: 1024px) {
  .header {
    padding: 14px 20px;
  }
  
  .welcomeText {
    font-size: 18px;
  }
  
  .dropdownMenu {
    width: 160px;
  }
}

/* Responsividade para dispositivos móveis */
@media (max-width: 768px) {
  .header {
    padding: 12px 16px;
  }
  .elderSelect {
    min-width: 160px;
  }
  .pageActions {
    gap: 8px;
  }
  
  .welcomeText {
    font-size: 16px;
    display: none; /* Oculta o texto de boas-vindas em telas pequenas */
  }
  
  .actions {
    padding: 6px;
  }
  
  .dropdownMenu {
    width: 140px;
    right: -10px;
  }
  
  .dropdownItem {
    padding: 8px 16px;
    font-size: 14px;
  }
  
  .hamburger span {
    width: 24px;
    height: 2.5px;
  }
}

/* Responsividade para telas pequenas */
@media (max-width: 480px) {
  .header {
    padding: 10px 12px;
  }
  
  .headerLeft {
    gap: 10px;
  }
  
  .actions {
    padding: 4px;
  }
  
  .dropdownMenu {
    width: 120px;
    right: -15px;
  }
  
  .dropdownItem {
    padding: 6px 12px;
    font-size: 13px;
  }
  
  .hamburger span {
    width: 22px;
    height: 2px;
  }
}

/* Responsividade para telas muito pequenas */
@media (max-width: 360px) {
  .header {
    padding: 8px 10px;
  }
  
  .dropdownMenu {
    width: 110px;
    right: -20px;
  }
  
  .dropdownItem {
    padding: 5px 10px;
    font-size: 12px;
  }
}

/* Estilos para o logo do usuário */
.userLogo {
  border-radius: 50%;
  object-fit: cover;
  border: 2px solid #0400BA;
}

.defaultLogo {
  display: flex;
  align-items: center;
  justify-content: center;
  color: #0400BA;
}

.profilePicture{
  border-radius: 50%;
  object-fit: cover;
  border: 2px solid #0400BA;
}

================
File: src/components/headers/HeaderDashboard.tsx
================
'use client';
import { useState, useEffect, useRef } from 'react';
import { useRouter } from 'next/navigation';
import { usePathname } from 'next/navigation';
import { useAuth } from '@/contexts/AuthContext';
import { useProfile } from '@/contexts/ProfileContext';
import { useIdoso } from '@/contexts/IdosoContext';
import Link from 'next/link';
import Image from 'next/image';
import styles from './HeaderDashboard.module.css';
import { IoPersonCircleOutline } from "react-icons/io5";

interface HeaderProps {
    isMenuOpen: boolean;
    onMenuToggle: () => void;
}

export function Header({ isMenuOpen, onMenuToggle }: HeaderProps) {
    const { user, signOut } = useAuth();
    const { photoUrl, refresh, profile } = useProfile();
    const { listaIdososVinculados, idosoSelecionadoId, setIdosoSelecionado } = useIdoso();
    const router = useRouter();
    const pathname = usePathname();

    const [isProfileOpen, setIsProfileOpen] = useState(false);
    const profileMenuRef = useRef<HTMLDivElement>(null);
    const [elderOpen, setElderOpen] = useState(false);
    const elderRef = useRef<HTMLDivElement>(null);
    const lastErrorUrlRef = useRef<string | null>(null);

    const accountTypeRaw = (profile?.tipo || user?.user_metadata?.account_type) as string | undefined;
    const isFamiliar = (accountTypeRaw || '').toString().toLowerCase() === 'familiar';

    // Atualiza a foto quando o usuário muda ou quando volta para a página
    useEffect(() => {
        const handleVisibilityChange = () => {
            // Só atualiza se a aba ficou oculta por mais de 5 segundos
            if (!document.hidden && Date.now() - (window as any).lastVisibilityChange > 5000) {
                refresh();
            }
            (window as any).lastVisibilityChange = Date.now();
        };

        const handleStorageChange = (e: StorageEvent) => {
            if (e.key === 'profileUpdated') {
                refresh();
                localStorage.removeItem('profileUpdated');
            }
        };

        const handleProfilePhotoUpdate = () => {
            refresh();
        };

        // Só força refresh inicial se não houver foto em cache
        if (!photoUrl) {
            refresh();
        }

        document.addEventListener('visibilitychange', handleVisibilityChange);
        window.addEventListener('storage', handleStorageChange);
        window.addEventListener('profilePhotoUpdated', handleProfilePhotoUpdate);

        return () => {
            document.removeEventListener('visibilitychange', handleVisibilityChange);
            window.removeEventListener('storage', handleStorageChange);
            window.removeEventListener('profilePhotoUpdated', handleProfilePhotoUpdate);
        };
    }, [refresh, user?.id]);

    const handleLogout = async () => {
        await signOut();
        router.push('/');
    };

    useEffect(() => {
        const handleClickOutside = (event: MouseEvent) => {
            if (profileMenuRef.current && !profileMenuRef.current.contains(event.target as Node)) {
                setIsProfileOpen(false);
            }
            if (elderRef.current && !elderRef.current.contains(event.target as Node)) {
                setElderOpen(false);
            }
        };
        document.addEventListener('mousedown', handleClickOutside);
        return () => {
            document.removeEventListener('mousedown', handleClickOutside);
        };
    }, []);

    const displayName = user?.user_metadata?.full_name || user?.email;

    return (
        <header className={styles.header}>
            <div className={styles.headerLeft}>
                <button
                    className={`${styles.hamburger} ${isMenuOpen ? styles.active : ''}`}
                    onClick={onMenuToggle}
                    aria-label="Abrir menu"
                >
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
                {(isFamiliar && listaIdososVinculados.length > 0) && (
                  <div className={styles.elderWrap} ref={elderRef}>
                    <span className={styles.elderLabel}>Idoso:</span>
                    <div className={styles.elderSelectWrapper}>
                      <button
                        type="button"
                        className={styles.elderButton}
                        onClick={() => setElderOpen((v) => !v)}
                        aria-haspopup="listbox"
                        aria-expanded={elderOpen}
                        aria-label="Selecionar idoso"
                      >
                        {listaIdososVinculados.find(i => i.id === idosoSelecionadoId)?.nome || 'Selecionar'}
                      </button>
                      <span className={styles.elderCaret} />
                      {elderOpen && (
                        <div className={styles.elderMenu} role="listbox" aria-label="Lista de idosos">
                          {listaIdososVinculados.length === 0 ? (
                            <div className={styles.elderEmpty}>Nenhum idoso</div>
                          ) : (
                            listaIdososVinculados.map((i) => (
                              <div
                                key={i.id}
                                role="option"
                                aria-selected={i.id === idosoSelecionadoId}
                                className={styles.elderOption}
                                onClick={() => { setIdosoSelecionado(i.id); setElderOpen(false); }}
                              >
                                {i.nome}
                              </div>
                            ))
                          )}
                        </div>
                      )}
                    </div>
                  </div>
                )}
            </div>

            {/* Ações contextuais removidas do Header. As ações principais ficam acima do conteúdo da página. */}

            <div className={styles.profileContainer} ref={profileMenuRef}>
                <div className={styles.actions} onClick={() => setIsProfileOpen(!isProfileOpen)}>
                    {photoUrl ? (
                        <Image
                            src={photoUrl}
                            alt="Foto de perfil"
                            width={40}
                            height={40}
                            className={styles.profilePicture}
                            key={photoUrl}
                            priority
                            loading="eager"
                            onError={() => {
                                if (lastErrorUrlRef.current !== photoUrl) {
                                    lastErrorUrlRef.current = photoUrl;
                                    refresh();
                                }
                            }}
                        />
                    ) : (
                        <IoPersonCircleOutline className={styles.person} size={35} />
                    )}
                </div>

                {isProfileOpen && (
                    <div className={styles.dropdownMenu}>
                        <Link href="/perfil" className={styles.dropdownItem} onClick={() => setIsProfileOpen(false)}>
                            Perfil
                        </Link>
                        <button onClick={handleLogout} className={`${styles.dropdownItem} ${styles.dropdownLogout}`}>
                            Sair
                        </button>
                    </div>
                )}
            </div>
        </header>
    );
}

================
File: src/components/headers/HeaderHome.module.css
================
/* ============================================= */
/* 2. Estilos do Header                          */
/* ============================================= */
.header {
  font-family: var(--font-family);
  background-color: white;
  color: var(--primary-color);
  font-weight: 700;
  border-radius: 30px;
  width: 100%;
  max-width: 1300px;
  margin: 20px auto 0 auto;
  padding: 15px 25px;
  box-shadow: 0 0 13px rgb(147, 155, 238);
  box-sizing: border-box;
  position: relative;
  z-index: 100;
}

.header__container {
  display: flex;
  align-items: center;
  justify-content: space-between;
  width: 100%;
}

.header__logo {
  flex-shrink: 0;
  display: flex;
  align-items: center;
}

.header__logo img {
  max-width: 100%;
  height: auto;
  object-fit: contain;
}

/* Navegação Desktop */
.header__nav_desktop {
  display: flex;
  align-items: center;
  gap: 35px;
  font-size: 20px;
}

.header__nav_desktop a {
  text-decoration: none;
  transition: opacity 0.3s ease;
  white-space: nowrap;
}

.header__nav_desktop a:not([class*="btn"]):hover {
  opacity: 0.7;
}

.header__nav_desktop_item {
  color: #0400ba;
}

/* ============================================= */
/* 3. Responsividade corrigida                   */
/* ============================================= */

@media (max-width: 1350px) {
  .header {
    margin-left: 20px;
    margin-right: 20px;
    max-width: calc(100% - 40px);
  }
}

@media (max-width: 1024px) {
  .header {
    margin: 20px auto;
    padding: 12px 20px;
  }

  .header__nav_desktop {
    gap: 25px;
    font-size: 18px;
  }
}

@media (max-width: 768px) {
  .header {
    border-radius: 25px;
    padding: 12px 15px;
    max-width: 90%;
    box-shadow: none; 
  }

  .header__container {
    flex-wrap: nowrap;
    justify-content: space-between;
    align-items: center;
  }

  .header__logo img {
    max-width: 150px;
  }

  .header__nav_desktop {
    display: none !important;
  }

  .hamburger {
    display: flex !important;
    flex-direction: column !important;
    gap: 4px !important;
    cursor: pointer !important;
    background: none !important;
    border: none !important;
    padding: 8px !important;
  }

  .hamburger span {
    width: 28px !important;
    height: 3px !important;
    background-color: #0400BA !important;
    border-radius: 2px !important;
    transition: all 0.3s ease-in-out !important;
  }
}


/* ============================================= */
/* 4. Menu Hambúrguer e Mobile                   */
/* ============================================= */
.hamburger {
  display: none;
  flex-direction: column;
  gap: 4px;
  cursor: pointer;
  z-index: 1002;
  background: none;
  border: none;
  padding: 8px;
  position: relative;
}

.hamburger span {
  width: 28px;
  height: 3px;
  background-color: var(--primary-color);
  transition: all 0.3s ease-in-out;
  border-radius: 2px;
}

.hamburger.active span:nth-child(1) {
  transform: rotate(45deg) translate(6px, 6px);
}
.hamburger.active span:nth-child(2) {
  opacity: 0;
}
.hamburger.active span:nth-child(3) {
  transform: rotate(-45deg) translate(6px, -6px);
}

.mobile_menu {
  position: fixed;
  top: 0;
  left: 0;
  width: 80%;
  max-width: 300px;
  height: 100vh;
  background-color: white;
  z-index: 1000;
  transform: translateX(-100%);
  transition: transform 0.3s ease-in-out;
  padding: 60px 20px 20px;
  box-shadow: 2px 0 10px rgba(0,0,0,0.1);
  border-right: 1px solid #e2e8f0;
}

.close_button {
  position: absolute;
  top: 15px;
  right: 15px;
  background: none;
  border: none;
  font-size: 32px;
  color: #0400BA;
  cursor: pointer;
  padding: 5px;
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  transition: all 0.3s ease;
  z-index: 1001;
}

.close_button:hover {
  background-color: #f1f5ff;
  color: #020054;
  transform: scale(1.1);
}

.mobile_menu.active {
  transform: translateX(0);
}

.mobile_menu__nav {
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
  gap: 30px;
}

.mobile_menu__nav a {
  font-size: 22px;
  color: #0400BA;
  text-decoration: none;
  padding: 12px 20px;
  width: 100%;
  border-radius: 8px;
  transition: all 0.3s ease;
  font-weight: 500;
}

.mobile_menu__nav a:hover {
  background-color: #f1f5ff;
  color: #020054;
  transform: translateX(5px);
}

.menu_overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0,0,0,0.5);
  z-index: 999;
  opacity: 0;
  visibility: hidden;
  transition: all 0.3s ease;
}

.menu_overlay.active {
  opacity: 1;
  visibility: visible;
}

/* ============================================= */
/* 5. Botões                                     */
/* ============================================= */
.btn {
  padding: 15px 30px;
  border-radius: 8px;
  font-weight: bold;
  text-decoration: none;
  transition: all 0.3s ease;
  font-size: 18px;
  cursor: pointer;
  text-align: center;
  border: 2px solid transparent;
  display: inline-block;
}

.btn_primary {
  background: #0400BA;
  color: white !important;
  border: 2px solid #0400BA;
}

.btn_primary:hover {
  background: #020054;
  border-color: #020054;
  color: white !important;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(4, 0, 186, 0.3);
}

.btn_outline {
  background-color: white;
  color: #0400BA !important;
  border: 2px solid #0400BA;
}

.btn_outline:hover {
  background-color: #0400BA;
  color: white !important;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(4, 0, 186, 0.2);
}

/* Botões no menu mobile */
.mobile_menu__nav .btn {
  margin-top: 10px;
  width: 90%;
  max-width: 250px;
  font-size: 16px;
  padding: 12px 24px;
}

.mobile_menu__nav .btn_primary {
  background: #0400BA;
  color: white !important;
  border: 2px solid #0400BA;
}

.mobile_menu__nav .btn_primary:hover {
  background: #020054;
  border-color: #020054;
  color: white !important;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(4, 0, 186, 0.4);
}

================
File: src/components/headers/HeaderHome.tsx
================
import Image from 'next/image';
import Link from 'next/link';
import { useState } from 'react';
import styles from './HeaderHome.module.css'; // Supondo que o CSS está em um module

export function Header() {
  const [isMenuOpen, setIsMenuOpen] = useState(false);

  const toggleMenu = () => setIsMenuOpen(!isMenuOpen);
  const closeMenu = () => setIsMenuOpen(false);

  return (
    // A tag <header> é mais semântica para o cabeçalho
    <header className={styles.header}>
      <div className={styles.header__container}>
        {/* Logo */}
        <Link href="/" className={styles.header__logo}>
          <Image 
            src="/icons/logo.png" 
            alt="CareMind Logo" 
            width={180} 
            height={57} 
            priority 
            style={{
              maxWidth: '100%',
              height: 'auto',
            }}
          />
        </Link>

        {/* Navegação Desktop */}
        <nav className={styles.header__nav_desktop}>
          <a className={styles.header__nav_desktop_item} href="#">Funcionalidades</a>
          <a className={styles.header__nav_desktop_item} href="#">Como Funciona</a>
          <a className={styles.header__nav_desktop_item} href="#">Para Famílias</a>
          <Link href="/auth" className={`${styles.btn} ${styles.btn_primary}`}>
            Área do cliente
          </Link>
        </nav>

        {/* Botão Hambúrguer */}
        <button
          className={`${styles.hamburger} ${isMenuOpen ? styles.active : ''}`}
          onClick={toggleMenu}
          aria-label="Abrir menu"
        >
          <span></span>
          <span></span>
          <span></span>
        </button>
      </div>

      {/* Overlay */}
      <div
        className={`${styles.menu_overlay} ${isMenuOpen ? styles.active : ''}`}
        onClick={closeMenu}
      ></div>

      {/* Menu Mobile */}
      <div className={`${styles.mobile_menu} ${isMenuOpen ? styles.active : ''}`}>
        {/* Botão de fechar */}
        <button 
          className={styles.close_button}
          onClick={closeMenu}
          aria-label="Fechar menu"
        >
          ×
        </button>
        
        <nav className={styles.mobile_menu__nav}>
          <a href="#" onClick={closeMenu}>Funcionalidades</a>
          <a href="#" onClick={closeMenu}>Como Funciona</a>
          <a href="#" onClick={closeMenu}>Para Famílias</a>
          <Link href="/auth" className={`${styles.btn} ${styles.btn_primary}`} onClick={closeMenu}>
            Área do cliente
          </Link>
        </nav>
      </div>
    </header>
  );
}

================
File: src/components/headers/HeaderLogin.module.css
================
/* HeaderLogin.module.css - Versão Final (Botão Voltar Fixo + Classe da Logo Centralizada) */
@import url('https://fonts.googleapis.com/css2?family=League+Spartan:wght@100..900&display=swap');


/* --- Header Container (Apenas para Posicionamento do Botão "Voltar") --- */
.header {
    display: flex;
    justify-content: flex-start; /* Alinha o conteúdo à esquerda */
    align-items: center;

    /* Torna o cabeçalho fixo, invisível e flutuante */
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    padding: 24px clamp(20px, 4vw, 50px);

    background: transparent;
    box-shadow: none;
    border: none;
    z-index: 1000;

    font-family: "League Spartan", sans-serif;
}

/* Esconde containers internos que não são o botão "Voltar" */
.headerLeft {
    display: none;
}

/* Garante que o container do botão apareça */
.profileContainer {
    display: flex;
}

/* --- Estilo do Botão "Voltar ao Início" (Classe .actions) --- */
.actions {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    cursor: pointer;
    padding: 12px 18px;
    border-radius: 12px;
    transition: all 0.3s ease;

    /* Estilo Glassmorphism */
    background: rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(15px);
    -webkit-backdrop-filter: blur(15px);
    border: 1px solid rgba(255, 255, 255, 0.18);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
    user-select: none;
}

.actions:hover {
    background-color: rgba(255, 255, 255, 0.25);
    border-color: rgba(255, 255, 255, 0.3);
    transform: translateY(-1px);
}

.welcomeText {
    margin: 0;
    color: white;
    font-weight: 600;
    font-size: 16px;
    text-decoration: none;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

/* ----------------------------------------------------------------- */
/* --- CLASSE PARA POSICIONAMENTO DA LOGO (CENTRALIZADA ACIMA) --- */
/* ----------------------------------------------------------------- */
.logoAboveLogin {
    /* POSICIONAMENTO: Absoluto e Centralizado */
    position: absolute;
    top: 50px; /* Distância do topo */
    left: 50%;
    transform: translateX(-50%); /* Centraliza perfeitamente */
    z-index: 900;
}

.logoAboveLogin img {
    height: auto;
    width: clamp(150px, 15vw, 250px);
    /*Destaque suave na Logo */
    filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.5));
}

/* --- Media Queries --- */

@media (max-width: 768px) {
    .header {
        padding: 16px 20px;
    }

    .actions {
        padding: 10px 14px;
        border-radius: 10px;
    }

    .welcomeText {
        font-size: 14px;
    }

    .logoAboveLogin {
        top: 30px;
    }

    .logoAboveLogin img {
        width: 120px;
    }
}

================
File: src/components/headers/HeaderLogin.tsx
================
'use client';

import Link from 'next/link';
import styles from './HeaderLogin.module.css';

export function Header() {
  return (
    <header className={styles.header}>
      <div className={styles.profileContainer}>
        <Link href="/" className={styles.actions}>
          <span className={styles.welcomeText}>
            Voltar ao Início
          </span>
        </Link>
      </div>
    </header>
  );
}

================
File: src/components/InstallPWA.module.css
================
.container {
  position: fixed;
  bottom: 24px;
  right: 24px;
  background: white;
  border-radius: 16px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
  padding: 24px;
  width: 380px;
  max-width: 90%;
  z-index: 1000;
  animation: slideIn 0.4s cubic-bezier(0.16, 1, 0.3, 1);
  border: 1px solid rgba(226, 232, 240, 0.8);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  transform: translateY(10px);
  opacity: 0;
  animation-fill-mode: forwards;
}

@keyframes slideIn {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.header {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  gap: 12px;
  margin-bottom: 16px;
}

.content {
  flex: 1;
}

.title {
  font-size: 18px;
  font-weight: 700;
  margin-bottom: 8px;
  color: #1a1a1a;
  line-height: 1.3;
  letter-spacing: -0.01em;
}

.description {
  font-size: 14px;
  color: #4b5563;
  margin-bottom: 24px;
  line-height: 1.5;
  opacity: 0.9;
  font-weight: 400;
}

.closeButton {
  position: absolute;
  top: 16px;
  right: 16px;
  background: none;
  border: none;
  cursor: pointer;
  color: #9ca3af;
  padding: 6px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
  width: 30px;
  height: 30px;
  background-color: rgba(0, 0, 0, 0.02);
}

.closeButton:hover {
  background-color: #f1f5f9;
  color: #6b7280;
  transform: rotate(90deg);
}

.closeButton:active {
  transform: scale(0.95) rotate(90deg);
}

.closeIcon {
  width: 20px;
  height: 20px;
}

.actions {
  display: flex;
  gap: 12px;
}

.primaryButton {
  flex: 1;
  padding: 12px 20px;
  border-radius: 10px;
  font-weight: 600;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  letter-spacing: 0.3px;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
  background-color: #0400BA;
  color: white;
  border: none;
  position: relative;
  overflow: hidden;
}

.primaryButton::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(rgba(255, 255, 255, 0.1), transparent);
  pointer-events: none;
}

.primaryButton:hover {
  background-color: #03008a;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(4, 0, 186, 0.2);
}

.primaryButton:active {
  transform: translateY(0);
  box-shadow: 0 2px 5px rgba(4, 0, 186, 0.2);
}

.secondaryButton {
  background-color: #f8fafc;
  color: #4b5563;
  border: 1px solid #e2e8f0;
  transition: all 0.2s ease;
  align-items: center;
  justify-content: center;
  gap: 6px;
  transition: background-color 0.2s ease, color 0.2s ease;
}

.secondaryButton:hover {
  background-color: #f0f0ff;
}

.secondaryButton:active {
  background-color: #e0e0ff;
}

.buttonIcon {
  width: 16px;
  height: 16px;
}

/* Responsividade */
@media (max-width: 1024px) {
  .container {
    width: 40%;
    max-width: 420px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
  }
}

@media (max-width: 768px) {
  .container {
    width: 90%;
    max-width: 380px;
    bottom: 20px;
    left: 50%;
    right: auto;
    transform: translateX(-50%);
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 6px 24px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
  }

  .container:hover {
    transform: translateX(-50%) translateY(-2px);
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
  }

  .title {
    font-size: 18px;
    margin-bottom: 8px;
    color: #1a1a1a;
  }

  .description {
    font-size: 13px;
  }

  .actions {
    gap: 10px;
  }

  .primaryButton,
  .secondaryButton {
    padding: 9px 12px;
    font-size: 13px;
  }
}

================
File: src/components/InstallPWA.tsx
================
"use client";

import { useState, useEffect } from "react";
import { Button } from "@/components/ui/button";
import { X, Download } from "lucide-react";
import { usePWA } from "@/hooks/use-pwa";
import styles from "./InstallPWA.module.css";

export default function PWAInstallPrompt() {
  const { isInstalled, isInstallable, installApp } = usePWA();
  const [showInstallPrompt, setShowInstallPrompt] = useState(false);
  const [hasShownPrompt, setHasShownPrompt] = useState(false);

  useEffect(() => {
    // Mostrar prompt apenas se for instalável, não estiver instalado e não tiver mostrado antes
    if (isInstallable && !isInstalled && !hasShownPrompt) {
      // Aguardar um pouco antes de mostrar o prompt
      const timer = setTimeout(() => {
        setShowInstallPrompt(true);
      }, 3000);

      return () => clearTimeout(timer);
    }
  }, [isInstallable, isInstalled, hasShownPrompt]);

  const handleInstallClick = async () => {
    const success = await installApp();
    if (success) {
      console.log("PWA instalado com sucesso");
    }
    setShowInstallPrompt(false);
    setHasShownPrompt(true);
  };

  const handleDismiss = () => {
    setShowInstallPrompt(false);
    setHasShownPrompt(true);
  };

  if (!showInstallPrompt || isInstalled) {
    return null;
  }

  return (
    <div className={styles.container}>
      <div className={styles.header}>
        <div className={styles.content}>
          <h3 className={styles.title}>Instalar CareMind</h3>
          <p className={styles.description}>
            Instale o app para acesso rápido e funcionalidades offline
          </p>
        </div>
        
        <button
          onClick={handleDismiss}
          className={styles.closeButton}
          aria-label="Fechar"
        >
          <X className={styles.closeIcon} />
        </button>
      </div>
      
      <div className={styles.actions}>
        <Button
          onClick={handleInstallClick}
          className={styles.primaryButton}
        >
          <Download className={styles.buttonIcon} />
          Instalar
        </Button>
        <Button
          variant="outline"
          onClick={handleDismiss}
          className={styles.secondaryButton}
        >
          Agora não
        </Button>
      </div>
    </div>
  );
}

================
File: src/components/layout/AppLayout.module.css
================
.shell {
  display: flex;
  min-height: 100vh;
}

.mainArea {
  margin-left: 280px;
  display: flex;
  flex-direction: column;
  width: calc(100% - 280px);
  background: transparent; /* keep waves visible */
  min-height: 100vh;
  position: relative;
  z-index: 2; /* above global waves */
}

.contentArea {
  padding: 20px;
  position: relative;
  z-index: 3;
}

@media (max-width: 1024px) {
  .mainArea {
    margin-left: 280px;
    width: calc(100% - 280px);
  }
}

================
File: src/components/layout/AppLayout.tsx
================
"use client";
import { usePersistentState } from "@/hooks/usePersistentState";
import { useCallback } from "react";
import SidebarDashboard from "./SidebarDashboard";
import { Header } from "../headers/HeaderDashboard";
import styles from "./AppLayout.module.css";
import { ToastContainer } from "@/components/Toast";

export default function AppLayout({ children }: { children: React.ReactNode }) {
  const [collapsed, setCollapsed] = usePersistentState<boolean>("ui.sidebar.collapsed", false);
  const handleMenuToggle = useCallback(() => setCollapsed((v) => !v), [setCollapsed]);
  return (
    <div className={styles.shell}>
      <SidebarDashboard collapsed={collapsed} />
      <div
        className={styles.mainArea}
        style={{ marginLeft: collapsed ? 80 : 280, width: `calc(100% - ${collapsed ? 80 : 280}px)` }}
      >
        <Header isMenuOpen={!collapsed} onMenuToggle={handleMenuToggle} />
        <div className={styles.contentArea}>{children}</div>
      </div>
      <ToastContainer />
    </div>
  );
}

================
File: src/components/layout/HeaderDashboard.module.css
================
.header {
  position: sticky;
  top: 0;
  height: 60px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 20px;
  background: #ffffff;
  border-bottom: 1px solid rgba(0,0,0,0.06);
  z-index: 20;
}

.title {
  font-size: 18px;
  font-weight: 700;
  color: #0f172a;
}

.actions {
  display: flex;
  align-items: center;
  gap: 12px;
}

.iconBtn {
  width: 36px;
  height: 36px;
  display: grid;
  place-items: center;
  border: 1px solid rgba(0,0,0,0.06);
  border-radius: 10px;
  background: #ffffff;
  cursor: pointer;
}

/* Black variant for the menu (collapse) button */
.menuBtn {
  background: transparent;
  border: none;
  color: #000000; /* icon color */
}

.separator {
  width: 1px;
  height: 20px;
  background: rgba(0,0,0,0.08);
}

.userBadge {
  display: flex;
  align-items: center;
  gap: 8px;
}

.avatarCircle {
  width: 28px;
  height: 28px;
  border-radius: 50%;
  display: grid;
  place-items: center;
  font-weight: 700;
  color: #ffffff;
  background: #0400b9;
  font-size: 12px;
}

================
File: src/components/layout/HeaderDashboard.tsx
================
"use client";
import { usePathname } from "next/navigation";
import { IoNotificationsOutline } from "react-icons/io5";
import { PanelLeftClose, PanelLeftOpen } from "lucide-react";
import styles from "./HeaderDashboard.module.css";
import { useEffect, useRef, useState } from "react";
import Link from "next/link";
import { useAuth } from "@/contexts/AuthContext";
import { useRouter } from "next/navigation";

function prettify(segment: string) {
  if (!segment) return "";
  return segment
    .split("-")
    .map((s) => s.charAt(0).toUpperCase() + s.slice(1))
    .join(" ");
}

export default function HeaderDashboard({ collapsed, onToggle }: { collapsed: boolean; onToggle: () => void }) {
  const { signOut } = useAuth();
  const router = useRouter();
  const pathname = usePathname();
  const last = pathname?.split("/").filter(Boolean).slice(-1)[0] || "Dashboard";
  const title = last === "dashboard" ? "Dashboard" : prettify(last);

  const [open, setOpen] = useState(false);
  const ref = useRef<HTMLDivElement>(null);
  useEffect(() => {
    const onDoc = (e: MouseEvent) => {
      if (ref.current && !ref.current.contains(e.target as Node)) setOpen(false);
    };
    document.addEventListener("mousedown", onDoc);
    return () => document.removeEventListener("mousedown", onDoc);
  }, []);

  return (
    <header className={styles.header}>
      <div style={{ display: 'flex', alignItems: 'center', gap: 10 }}>
        <button className={`${styles.iconBtn} ${styles.menuBtn}`} aria-label={collapsed ? 'Expandir menu' : 'Recolher menu'} onClick={onToggle}>
          {collapsed ? <PanelLeftOpen size={18} /> : <PanelLeftClose size={18} />}
        </button>
        <h1 className={styles.title}>{title}</h1>
      </div>
      <div className={styles.actions}>
        <button className={styles.iconBtn} aria-label="Notificações">
          <IoNotificationsOutline size={20} />
        </button>
        <div className={styles.separator} />
        <div className={styles.userBadge} ref={ref}>
          <button className={styles.iconBtn} aria-label="Perfil" onClick={() => setOpen((v) => !v)}>
            <span className={styles.avatarCircle}>CM</span>
          </button>
          {open && (
            <div className={styles.dropdownMenu} role="menu" style={{ position: 'absolute', right: 16, top: 52, background: '#fff', border: '1px solid rgba(0,0,0,0.06)', borderRadius: 10, boxShadow: '0 8px 24px rgba(0,0,0,0.08)', minWidth: 160, zIndex: 50 }}>
              <Link href="/perfil" className={styles.dropdownItem} style={{ display: 'block', padding: '10px 12px', color: '#0f172a' }} onClick={() => setOpen(false)}>
                Perfil
              </Link>
              <button className={styles.dropdownItem} style={{ display: 'block', padding: '10px 12px', width: '100%', textAlign: 'left', border: 'none', background: 'transparent', color: '#ef4444', cursor: 'pointer' }} onClick={async () => { await signOut(); router.push('/auth'); }}>
                Sair
              </button>
            </div>
          )}
        </div>
      </div>
    </header>
  );
}

================
File: src/components/layout/SidebarDashboard.module.css
================
.sidebar {
  position: fixed;
  inset: 0 auto 0 0;
  width: 280px;
  background: #0400b9;
  color: #ffffff;
  display: flex;
  flex-direction: column;
  border-right: 1px solid rgba(255,255,255,0.1);
  z-index: 30;
  transition: width 0.25s ease;
}

.collapsed {
  width: 80px;
}

.topArea {
  padding: 20px 16px 12px 16px;
}

.logoRow {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 14px;
}

.logoCircle {
  width: 28px;
  height: 28px;
  border-radius: 50%;
  background: #ffffff;
  color: #0400b9;
  display: grid;
  place-items: center;
  font-weight: 700;
  font-size: 12px;
}

.logoText {
  font-weight: 700;
  letter-spacing: 0.2px;
  font-size: 20px;
}

.userBox {
  display: flex;
  gap: 10px;
  align-items: center;
  background: rgba(255,255,255,0.08);
  padding: 10px;
  border-radius: 10px;
}

.avatar {
  width: 36px;
  height: 36px;
}

.avatarImg, .avatarFallback {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  object-fit: cover;
  background: rgba(255,255,255,0.2);
  display: grid;
  place-items: center;
}

.userText {
  display: flex;
  flex-direction: column;
  line-height: 1.2;
}

.userName {
  font-size: 14px;
  font-weight: 600;
}

.userEmail {
  font-size: 12px;
  opacity: 0.8;
}

.nav {
  display: flex;
  flex-direction: column;
  gap: 4px;
  padding: 10px;
  margin-top: 8px;
}

.navItem {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 10px;
  border-radius: 8px;
  color: #ffffff;
  text-decoration: none;
  opacity: 0.95;
}

.navItem:hover {
  background: rgba(255,255,255,0.12);
}

.active {
  background: rgba(255,255,255,0.18);
}

.icon {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 24px;
  opacity: 0.95;
}

.label {
  font-size: 14px;
}

.bottomArea {
  margin-top: auto;
  padding: 12px;
}

.logoutBtn {
  width: 100%;
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 10px 12px;
  border-radius: 8px;
  border: none;
  background: rgba(255,255,255,0.12);
  color: #ffffff;
  cursor: pointer;
}

.logoutBtn:hover {
  background: rgba(255,255,255,0.18);
}

================
File: src/components/layout/SidebarDashboard.tsx
================
"use client";
import Link from "next/link";
import Image from "next/image";
import { useAuth } from "@/contexts/AuthContext";
import { useProfile } from "@/contexts/ProfileContext";
import { usePathname } from "next/navigation";
import { IoHomeOutline, IoBarChartOutline, IoClipboardOutline, IoMedkitOutline, IoPersonOutline, IoSettingsOutline, IoLogOutOutline, IoPeopleOutline, IoCalendarOutline } from "react-icons/io5";
import { Plug } from "lucide-react";
import styles from "./SidebarDashboard.module.css";

export default function SidebarDashboard({ collapsed }: { collapsed: boolean }) {
  const { user, signOut } = useAuth();
  const { photoUrl } = useProfile();
  const pathname = usePathname();

  const displayName = user?.user_metadata?.full_name || "";
  const displayEmail = user?.email || "";
  const isFamiliar = (user?.user_metadata?.account_type || '').toLowerCase() === 'familiar';

  const NavItem = ({ href, label, icon: Icon }: { href: string; label: string; icon: any }) => {
    const active = pathname === href;
    return (
      <Link 
        href={href} 
        className={`${styles.navItem} ${active ? styles.active : ""}`} 
        aria-label={label}
        prefetch={true}
      >
        <span className={styles.icon}><Icon size={22} /></span>
        {!collapsed && <span className={styles.label}>{label}</span>}
      </Link>
    );
  };

  return (
    <aside className={`${styles.sidebar} ${collapsed ? styles.collapsed : ""}`}>
      <div className={styles.topArea}>
        <div className={styles.logoRow}>
          {!collapsed && <span className={styles.logoText}>Caremind</span>}
        </div>
      </div>
      <nav className={styles.nav}>
        <NavItem href={isFamiliar ? "/familiar-dashboard" : "/dashboard"} label="Dashboard" icon={IoHomeOutline} />
        <NavItem href="/relatorios" label="Relatórios" icon={IoBarChartOutline} />
        <NavItem href="/integracoes" label="Integrações" icon={Plug} />
        <NavItem href="/rotinas" label="Rotinas" icon={IoClipboardOutline} />
        <NavItem href="/compromissos" label="Compromissos" icon={IoCalendarOutline} />
        <NavItem href="/remedios" label="Medicamentos" icon={IoMedkitOutline} />
        {user?.user_metadata?.account_type === 'familiar' && (
          <NavItem href="/familia" label="Família" icon={IoPeopleOutline} />
        )}
        <NavItem href="/perfil" label="Perfil" icon={IoPersonOutline} />
        <NavItem href="/configuracoes" label="Configurações" icon={IoSettingsOutline} />
      </nav>
      <div className={styles.bottomArea}>
        <div className={styles.userBox}>
          <div className={styles.avatar}>
            {photoUrl ? (
              <Image 
                src={photoUrl} 
                alt="Foto de perfil" 
                width={36} 
                height={36} 
                className={styles.avatarImg}
                key={photoUrl}
                priority
                loading="eager"
                onError={() => {
                  // força um re-render em caso de cache quebrado
                  const bust = `${photoUrl}${photoUrl.includes('?') ? '&' : '?'}v=${Date.now()}`;
                  (window as any).requestAnimationFrame?.(() => {
                    // simples fallback local: recarrega a imagem ajustando a querystring
                  });
                }}
              />
            ) : (
              <div className={styles.avatarFallback}>👤</div>
            )}
          </div>
          {!collapsed && (
            <div className={styles.userText}>
              <span className={styles.userName}>{displayName}</span>
              <span className={styles.userEmail}>{displayEmail}</span>
            </div>
          )}
        </div>
      </div>
    </aside>
  );
}

================
File: src/components/MedicamentoCard.module.css
================
.card {
  background-color: white;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
  border-radius: 0.5rem;
  padding: 1.5rem;
  border: 1px solid #e5e7eb;
  transition: box-shadow 0.3s ease;
  margin-top: 10px;
}

.card:hover {
  box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
}

.card_header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 0.5rem;
}

.card_title {
  font-size: 1.25rem;
  font-weight: bold;
  color: #1f2937;
  margin-bottom: 0.75rem;
}

.card_actions {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.actionButton {
  padding: 0.35rem 0.6rem;
  font-size: 0.875rem;
  border-radius: 0.375rem;
  border: 1px solid transparent;
  cursor: pointer;
  transition: background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease;
}

.editButton {
  background-color: #f3f4f6;
  color: #111827;
}
.editButton:hover {
  background-color: #e5e7eb;
}

.deleteButton {
  background-color: #fee2e2;
  color: #991b1b;
}
.deleteButton:hover {
  background-color: #fecaca;
}

.card_info {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  color: #4b5563;
}

.card_info p {
  margin: 0;
}

.card_info strong {
  font-weight: 600;
}

.card_footer {
  margin-top: 1rem;
  padding-top: 1rem;
  border-top: 1px solid #e5e7eb;
}

.card_footer p {
  margin: 0;
  font-size: 0.875rem;
  color: #9ca3af;
}

================
File: src/components/MedicamentoCard.tsx
================
import React from 'react';
// Importa o objeto 'styles' do seu arquivo de módulo CSS
import styles from './MedicamentoCard.module.css';

// Define o formato esperado para os dados de um medicamento
type Medicamento = {
  id: string;
  nome: string;
  dosagem?: string;
  // Pode vir como string (já formatada pela API) ou como objeto (formas diferentes de frequência)
  frequencia?: string | Frequencia;
  quantidade?: number;
  created_at: string;
};

// Tipos possíveis de frequência quando vier como objeto
type FrequenciaDiaria = {
  tipo: 'diario';
  horarios: string[];
};

type FrequenciaIntervalo = {
  tipo: 'intervalo';
  intervalo_horas: number;
  inicio: string;
};

type FrequenciaDiasAlternados = {
  tipo: 'dias_alternados';
  intervalo_dias: number;
  horario: string;
};

type FrequenciaSemanal = {
  tipo: 'semanal';
  dias_da_semana: number[];
  horario: string;
};

type Frequencia = FrequenciaDiaria | FrequenciaIntervalo | FrequenciaDiasAlternados | FrequenciaSemanal;

// Formata a frequência (string ou objeto) para exibição
function formatarFrequencia(freq?: string | Frequencia): string | null {
  if (!freq) return null;
  if (typeof freq === 'string') return freq;
  switch (freq.tipo) {
    case 'diario':
      return `Diário - ${freq.horarios.join(', ')}`;
    case 'intervalo':
      return `A cada ${freq.intervalo_horas}h (início: ${freq.inicio})`;
    case 'dias_alternados':
      return `A cada ${freq.intervalo_dias} dias (${freq.horario})`;
    case 'semanal': {
      const diasSemana = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb'];
      const dias = freq.dias_da_semana.map(dia => diasSemana[dia - 1]).join(', ');
      return `Toda ${dias} (${freq.horario})`;
    }
    default:
      return 'Frequência personalizada';
  }
}

// Define as props que o componente vai receber
interface MedicamentoCardProps {
  medicamento: Medicamento;
  onEdit?: (medicamento: Medicamento) => void;
  onDelete?: (id: string, event?: React.MouseEvent) => void;
  onMarkAsDone?: () => void;
  hasPendingToday?: boolean;
  isMarking?: boolean;
}

const MedicamentoCard: React.FC<MedicamentoCardProps> = ({ medicamento, onEdit, onDelete, onMarkAsDone, hasPendingToday, isMarking }) => {
  const frequenciaTexto = formatarFrequencia(medicamento.frequencia);
  return (
    <div className={styles.card}>
      <div className={styles.card_header}>
        <h3 className={styles.card_title}>{medicamento.nome}</h3>
        <div className={styles.card_actions}>
          {hasPendingToday && onMarkAsDone && (
            <button
              type="button"
              className={`${styles.actionButton} ${styles.editButton}`}
              onClick={onMarkAsDone}
              disabled={isMarking}
              aria-label="Marcar como concluído hoje"
            >
              {isMarking ? 'Concluindo...' : 'Concluir hoje'}
            </button>
          )}
          {onEdit && (
            <button
              type="button"
              className={`${styles.actionButton} ${styles.editButton}`}
              onClick={() => onEdit(medicamento)}
              aria-label="Editar medicamento"
            >
              Editar
            </button>
          )}
          {onDelete && (
            <button
              type="button"
              className={`${styles.actionButton} ${styles.deleteButton}`}
              onClick={(e) => {
                e.stopPropagation();
                onDelete(medicamento.id, e);
              }}
              aria-label="Excluir medicamento"
            >
              Excluir
            </button>
          )}
        </div>
      </div>
      <div className={styles.card_info}>
        {medicamento.dosagem && (
          <p>
            <strong>Dosagem:</strong> {medicamento.dosagem}
          </p>
        )}
        {frequenciaTexto && (
          <p>
            <strong>Frequência:</strong> {frequenciaTexto}
          </p>
        )}
        {medicamento.quantidade !== undefined && (
          <p>
            <strong>Quantidade:</strong> {medicamento.quantidade}
          </p>
        )}
      </div>
      {medicamento.created_at && (
        <div className={styles.card_footer}>
          <p>
            Adicionado em: {new Date(medicamento.created_at).toLocaleDateString('pt-BR')}
          </p>
        </div>
      )}
    </div>
  );
};

export default MedicamentoCard;

================
File: src/components/Modal.module.css
================
/* Em @/components/Modal.module.css */

/* Adiciona classe para bloquear a rolagem do body quando o modal estiver aberto */
body.modalOpen {
  overflow: hidden;
  position: fixed;
  width: 100%;
  height: 100%;
}

.modalOverlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: rgba(17, 24, 39, 0.6); /* Fundo semi-transparente */
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 1000; /* Garante que o modal fique na frente de tudo */
  backdrop-filter: blur(4px);
  -webkit-backdrop-filter: blur(4px);
  animation: fadeIn 0.3s ease-out;
  overflow-y: auto;
  padding: 20px 0;
}

.modalContent {
  background: white;
  padding: 24px;
  border-radius: 12px;
  box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
  max-width: 500px;
  width: 90%;
  max-height: 90vh;
  overflow-y: auto;
  animation: slideUp 0.3s ease-out;
  margin: 20px;
  position: relative;
  scrollbar-width: thin;
  scrollbar-color: #c1c1c1 #f0f0f0;
}

.modalHeader {
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-bottom: 1px solid #e5e7eb;
  padding-bottom: 16px;
  margin-bottom: 20px;
}

.modalTitle {
  font-size: 1.25rem;
  font-weight: 600;
  color: #111827;
  margin: 0;
}

.closeButton {
  background: none;
  border: none;
  font-size: 2rem;
  line-height: 1;
  color: #6b7280;
  cursor: pointer;
  padding: 0;
  transition: color 0.2s ease;
}

.closeButton:hover {
  color: #111827;
}

/* Animações */
@keyframes fadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

@keyframes slideUp {
  from {
    transform: translateY(30px);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

.modalContent::-webkit-scrollbar {
  width: 8px; /* Largura da barra de rolagem */
}

.modalContent::-webkit-scrollbar-track {
  background: transparent; /* Fundo da trilha da barra (trilho) */
}

.modalContent::-webkit-scrollbar-thumb {
  background-color: #cccccc; /* Cor da própria barra */
  border-radius: 20px;       /* Bordas arredondadas */
  border: 3px solid transparent; /* Cria um preenchimento em volta da barra */
  background-clip: content-box;
}

.modalContent::-webkit-scrollbar-thumb:hover {
  background-color: #a8a8a8; /* Cor da barra ao passar o mouse */
}

/* Responsividade para tablets */
@media (max-width: 768px) {
  .modalContent {
    max-width: 95%;
    width: 95%;
    padding: 20px;
    margin: 15px;
    max-height: 85vh;
  }
  
  .modalTitle {
    font-size: 1.1rem;
  }
  
  .closeButton {
    font-size: 1.75rem;
  }
}

/* Responsividade para dispositivos móveis */
@media (max-width: 480px) {
  .modalOverlay {
    padding: 10px;
  }
  
  .modalContent {
    max-width: 100%;
    width: 100%;
    padding: 16px;
    margin: 10px;
    max-height: 90vh;
    border-radius: 8px;
  }
  
  .modalHeader {
    padding-bottom: 12px;
    margin-bottom: 16px;
  }
  
  .modalTitle {
    font-size: 1rem;
  }
  
  .closeButton {
    font-size: 1.5rem;
    padding: 4px;
  }
}

/* Responsividade para telas muito pequenas */
@media (max-width: 360px) {
  .modalContent {
    padding: 12px;
    margin: 5px;
  }
  
  .modalTitle {
    font-size: 0.95rem;
  }
}

================
File: src/components/Modal.tsx
================
// Em @/components/Modal.tsx

'use client';

import { useEffect, useRef } from 'react';
import { createPortal } from 'react-dom';
import styles from './Modal.module.css';

interface ModalProps {
  isOpen: boolean;
  onClose: () => void;
  title: string;
  children: React.ReactNode;
}

export function Modal({ isOpen, onClose, title, children }: ModalProps) {
  const modalRef = useRef<HTMLDivElement>(null);
  const scrollPosition = useRef(0);

  // Efeito para controlar a rolagem do body quando o modal está aberto
  useEffect(() => {
    if (isOpen) {
      // Salva a posição atual do scroll
      scrollPosition.current = window.scrollY;
      
      // Bloqueia a rolagem do body
      document.body.style.overflow = 'hidden';
      document.body.style.position = 'fixed';
      document.body.style.top = `-${scrollPosition.current}px`;
      document.body.style.width = '100%';
      
      // Foca no modal quando ele é aberto para acessibilidade
      if (modalRef.current) {
        modalRef.current.focus();
      }
    }
    
    // Limpa o efeito quando o componente é desmontado ou quando o modal é fechado
    return () => {
      // Restaura a rolagem do body
      document.body.style.overflow = '';
      document.body.style.position = '';
      document.body.style.top = '';
      document.body.style.width = '';
      
      // Restaura a posição de rolagem
      if (isOpen) {
        window.scrollTo(0, scrollPosition.current);
      }
    };
  }, [isOpen]);

  // Efeito para fechar o modal com a tecla "Escape"
  useEffect(() => {
    const handleEsc = (event: KeyboardEvent) => {
      if (event.key === 'Escape') {
        onClose();
      }
    };
    
    window.addEventListener('keydown', handleEsc);
    return () => window.removeEventListener('keydown', handleEsc);
  }, [onClose]);

  // Não renderiza nada se o modal não estiver aberto
  if (!isOpen) {
    return null;
  }

  // Usando createPortal para renderizar o modal no final do body
  // Isso evita problemas de z-index e contexto de empilhamento.
  return createPortal(
    <div 
      className={styles.modalOverlay}
      onClick={(e) => {
        // Fecha o modal ao clicar fora do conteúdo
        if (e.target === e.currentTarget) {
          onClose();
        }
      }}
    >
      <div 
        ref={modalRef}
        className={styles.modalContent}
        role="dialog"
        aria-modal="true"
        aria-labelledby="modal-title"
        tabIndex={-1}
      >
        <div className={styles.modalHeader}>
          <h2 id="modal-title" className={styles.modalTitle}>
            {title}
          </h2>
          <button 
            onClick={onClose} 
            className={styles.closeButton}
            aria-label="Fechar modal"
          >
            &times;
          </button>
        </div>
        <div className={styles.modalBody}>
          {children}
        </div>
      </div>
    </div>,
    document.body // Onde o portal será renderizado
  );
}

================
File: src/components/modals/AddEditCompromissoModal.module.css
================
/* Styles for Add/Edit Compromisso form */

.form {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.field {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.label {
  font-size: 0.95rem;
  font-weight: 600;
  color: #111827;
}

.input,
.textarea,
.select,
.number {
  width: 100%;
  padding: 10px 12px;
  border-radius: 10px;
  border: 1px solid #e5e7eb;
  outline: none;
  transition: border-color 0.15s ease, box-shadow 0.15s ease;
  background: #ffffff;
}

.input:focus,
.textarea:focus,
.select:focus,
.number:focus {
  border-color: #0400BA;
  box-shadow: 0 0 0 3px rgba(4, 0, 186, 0.15);
}

.textarea {
  resize: vertical;
  min-height: 90px;
}

.actions {
  display: flex;
  justify-content: flex-end;
  gap: 10px;
  margin-top: 4px;
}

.btn {
  padding: 10px 14px;
  border-radius: 10px;
  font-weight: 600;
  cursor: pointer;
  transition: transform 0.05s ease, background-color 0.2s ease, color 0.2s ease;
}

.btn:active {
  transform: scale(0.98);
}

.btnSecondary {
  background: #ffffff;
  border: 1px solid #e5e7eb;
  color: #111827;
}

.btnSecondary:hover {
  background: #f9fafb;
}

.btnPrimary {
  background: #0400BA;
  border: none;
  color: #ffffff;
}

.btnPrimary:hover {
  background: #1d1aa6;
}

.hint {
  font-size: 0.8rem;
  color: #6b7280;
}

================
File: src/components/modals/AddEditCompromissoModal.tsx
================
'use client';

import React, { useMemo, useState, useEffect } from 'react';
import styles from '@/components/forms/AddForm.module.css';

export type Compromisso = {
  id?: string;
  titulo: string;
  descricao?: string | null;
  data_hora?: string | null; // ISO string
  local?: string | null;
  tipo?: 'consulta' | 'exame' | 'procedimento' | 'outros';
  lembrete_minutos?: number | null;
};

export function AddEditCompromissoForm({
  compromisso,
  onSave,
  onCancel,
}: {
  compromisso?: Compromisso | null;
  onSave: (data: Compromisso) => Promise<void> | void;
  onCancel: () => void;
}) {
  const [form, setForm] = useState<Compromisso>(() => ({
    titulo: compromisso?.titulo || '',
    descricao: compromisso?.descricao ?? '',
    data_hora: compromisso?.data_hora ?? new Date().toISOString().slice(0, 16),
    local: compromisso?.local ?? '',
    tipo: (compromisso?.tipo as any) || 'consulta',
    lembrete_minutos: compromisso?.lembrete_minutos ?? 60,
  }));
  const [submitting, setSubmitting] = useState(false);
  const [formErrors, setFormErrors] = useState<Record<string, string>>({});

  const title = useMemo(() => (compromisso ? 'Editar Compromisso' : 'Adicionar Compromisso'), [compromisso]);

  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement>) => {
    const { name, value } = e.target;
    setForm(prev => ({
      ...prev,
      [name]: name === 'lembrete_minutos' ? Number(value) : value,
    }));
  };

  const validateForm = () => {
    const errors: Record<string, string> = {};
    
    if (!form.titulo || form.titulo.trim() === '') {
      errors.titulo = 'O título é obrigatório';
    }
    
    if (!form.data_hora) {
      errors.data_hora = 'A data e hora são obrigatórias';
    }
    
    setFormErrors(errors);
    return Object.keys(errors).length === 0;
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    
    if (!validateForm()) {
      return;
    }
    
    setSubmitting(true);
    try {
      await onSave({ ...form });
    } finally {
      setSubmitting(false);
    }
  };
  
  // Efeito para rolar até o primeiro erro quando houver validação
  useEffect(() => {
    const firstError = Object.keys(formErrors)[0];
    if (firstError) {
      const element = document.querySelector(`[data-field="${firstError}"]`);
      element?.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
  }, [formErrors]);

  return (
    <form onSubmit={handleSubmit} className={styles.form}>
      <div className={`${styles.formGroup} ${formErrors.titulo ? styles.hasError : ''}`} data-field="titulo">
        <label htmlFor="titulo">
          Título
          {formErrors.titulo && <span className={styles.errorText}> - {formErrors.titulo}</span>}
        </label>
        <input
          id="titulo"
          name="titulo"
          type="text"
          value={form.titulo}
          onChange={(e) => {
            setForm(prev => ({ ...prev, titulo: e.target.value }));
            if (formErrors.titulo) {
              setFormErrors(prev => ({ ...prev, titulo: '' }));
            }
          }}
          placeholder="Ex.: Consulta com cardiologista"
          className={formErrors.titulo ? styles.inputError : ''}
          aria-invalid={!!formErrors.titulo}
          aria-describedby={formErrors.titulo ? 'titulo-error' : undefined}
        />
      </div>

      <div className={styles.formGroup}>
        <label htmlFor="descricao">Descrição (opcional)</label>
        <input
          id="descricao"
          name="descricao"
          type="text"
          value={form.descricao ?? ''}
          onChange={handleChange}
          placeholder="Observações, orientações, documentos..."
        />
      </div>

      <div className={`${styles.formGroup} ${formErrors.data_hora ? styles.hasError : ''}`} data-field="data_hora">
        <label htmlFor="data_hora">
          Data e Hora
          {formErrors.data_hora && <span className={styles.errorText}> - {formErrors.data_hora}</span>}
        </label>
        <input
          id="data_hora"
          name="data_hora"
          type="datetime-local"
          value={form.data_hora || ''}
          onChange={(e) => {
            setForm(prev => ({ ...prev, data_hora: e.target.value }));
            if (formErrors.data_hora) {
              setFormErrors(prev => ({ ...prev, data_hora: '' }));
            }
          }}
          className={formErrors.data_hora ? styles.inputError : ''}
          aria-invalid={!!formErrors.data_hora}
          aria-describedby={formErrors.data_hora ? 'data_hora-error' : undefined}
        />
      </div>

      <div className={styles.formGroup}>
        <label htmlFor="local">Local (opcional)</label>
        <input
          id="local"
          name="local"
          type="text"
          value={form.local ?? ''}
          onChange={handleChange}
          placeholder="Ex.: Hospital X, Clínica Y"
        />
      </div>

      <div className={styles.formGroup}>
        <label htmlFor="tipo">Tipo</label>
        <select
          id="tipo"
          className={styles.select}
          name="tipo"
          value={form.tipo || 'consulta'}
          onChange={handleChange}
        >
          <option value="consulta">Consulta</option>
          <option value="exame">Exame</option>
          <option value="procedimento">Procedimento</option>
          <option value="outros">Outros</option>
        </select>
      </div>

      <div className={styles.formGroup}>
        <label htmlFor="lembrete_minutos">Lembrete (minutos antes)</label>
        <select
          id="lembrete_minutos"
          name="lembrete_minutos"
          className={styles.select}
          value={form.lembrete_minutos ?? 60}
          onChange={handleChange}
        >
          <option value="5">5 minutos antes</option>
          <option value="15">15 minutos antes</option>
          <option value="30">30 minutos antes</option>
          <option value="60">1 hora antes</option>
          <option value="1440">1 dia antes</option>
          <option value="2880">2 dias antes</option>
        </select>
      </div>

      <div className={styles.buttonGroup}>
        <button 
          type="button" 
          onClick={onCancel} 
          className={styles.cancelButton}
          disabled={submitting}
        >
          Cancelar
        </button>
        <button 
          type="submit" 
          disabled={submitting} 
          className={`${styles.saveButton} ${submitting ? styles.loading : ''}`}
        >
          {submitting ? (
            <>
              <span className={styles.spinner} aria-hidden="true" />
              <span>Salvando...</span>
            </>
          ) : 'Salvar'}
        </button>
      </div>
    </form>
  );
}

================
File: src/components/modals/AddIdosoModal.module.css
================
.form {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.error {
  color: #b91c1c;
  background: #fee2e2;
  padding: 8px 10px;
  border-radius: 10px;
  font-size: 14px;
  border: 1px solid #fecaca;
}

.label {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.labelText {
  font-weight: 700;
  font-size: 14px;
  color: #0f172a;
}

.input {
  padding: 12px 14px;
  border-radius: 10px;
  border: 1px solid #e2e8f0;
  background: #ffffff;
  color: #0f172a;
  outline: none;
  transition: all 0.2s ease;
}

.input::placeholder {
  color: #94a3b8;
}

.input:focus {
  border-color: #0400b9;
  box-shadow: 0 0 0 3px rgba(4, 0, 185, 0.15);
}

.actions {
  display: flex;
  justify-content: flex-end;
  gap: 10px;
  margin-top: 6px;
}

.btn {
  padding: 10px 14px;
  border-radius: 10px;
  font-weight: 700;
  font-size: 14px;
  border: 1px solid transparent;
  cursor: pointer;
  transition: all 0.2s ease;
}

.btn:disabled {
  opacity: 0.7;
  cursor: not-allowed;
}

.cancel {
  background: #f8fafc;
  color: #0f172a;
  border-color: #e2e8f0;
}

.cancel:hover:not(:disabled) {
  background: #f1f5f9;
}

.primary {
  background: #0400b9;
  color: #ffffff;
}

.primary:hover:not(:disabled) {
  background: #2d2dff;
}

================
File: src/components/modals/AddIdosoModal.tsx
================
"use client";

import { useState, FormEvent } from "react";
import { Modal } from "@/components/Modal";
import { useAuthRequest } from "@/hooks/useAuthRequest";
import { toast } from "@/components/Toast";
import styles from "./AddIdosoModal.module.css";

interface AddIdosoModalProps {
  isOpen: boolean;
  onClose: () => void;
  onSuccess?: () => void;
}

export default function AddIdosoModal({ isOpen, onClose, onSuccess }: AddIdosoModalProps) {
  const { makeRequest } = useAuthRequest();
  const [nome, setNome] = useState("");
  const [email, setEmail] = useState("");
  const [senha, setSenha] = useState("");
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  const validate = () => {
    if (!nome.trim()) return "Informe o nome completo do idoso.";
    if (!email.trim()) return "Informe o e-mail do idoso.";
    const emailOk = /.+@.+\..+/.test(email);
    if (!emailOk) return "Informe um e-mail válido.";
    if (!senha || senha.length < 6) return "A senha deve ter no mínimo 6 caracteres.";
    return null;
  };

  const handleSubmit = async (e: FormEvent) => {
    e.preventDefault();
    const v = validate();
    if (v) {
      setError(v);
      return;
    }
    setError(null);
    setIsLoading(true);
    try {
      await makeRequest("/api/criar-idoso", {
        method: "POST",
        body: JSON.stringify({
          nome_idoso: nome.trim(),
          email_idoso: email.trim(),
          senha_idoso: senha,
        }),
      });
      toast.success("Idoso adicionado e vinculado com sucesso!");
      onClose();
      setNome("");
      setEmail("");
      setSenha("");
      onSuccess?.();
    } catch (err: any) {
      setError(err?.message || "Não foi possível criar e vincular o idoso.");
      toast.error(err?.message || "Não foi possível criar e vincular o idoso.");
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <Modal isOpen={isOpen} onClose={onClose} title="Adicionar e Conectar Perfil de Idoso">
      <form onSubmit={handleSubmit} className={styles.form} autoComplete="off">
        {error && (
          <div className={styles.error}>{error}</div>
        )}
        <label className={styles.label}>
          <span className={styles.labelText}>Nome Completo do Idoso</span>
          <input
            type="text"
            value={nome}
            onChange={(e) => setNome(e.target.value)}
            placeholder="Ex.: Maria da Silva"
            required
            className={styles.input}
          />
        </label>
        <label className={styles.label}>
          <span className={styles.labelText}>E-mail do Idoso</span>
          <input
            type="email"
            value={email}
            onChange={(e) => setEmail(e.target.value)}
            placeholder="idoso@exemplo.com"
            required
            autoComplete="off"
            autoCapitalize="off"
            spellCheck={false}
            name="idoso_email"
            className={styles.input}
          />
        </label>
        <label className={styles.label}>
          <span className={styles.labelText}>Senha Inicial</span>
          <input
            type="password"
            value={senha}
            onChange={(e) => setSenha(e.target.value)}
            minLength={6}
            placeholder="Mínimo 6 caracteres"
            required
            autoComplete="new-password"
            name="idoso_new_password"
            className={styles.input}
          />
        </label>
        <div className={styles.actions}>
          <button
            type="button"
            onClick={onClose}
            disabled={isLoading}
            className={`${styles.btn} ${styles.cancel}`}
          >
            Cancelar
          </button>
          <button
            type="submit"
            disabled={isLoading}
            className={`${styles.btn} ${styles.primary}`}
          >
            {isLoading ? "Adicionando..." : "Adicionar e Conectar"}
          </button>
        </div>
      </form>
    </Modal>
  );
}

================
File: src/components/perfil/GerenciarIdososVinculados.tsx
================
"use client";

import { useEffect, useState, forwardRef, useImperativeHandle } from 'react';
import Image from 'next/image';
import { useAuthRequest } from '@/hooks/useAuthRequest';
import { toast } from '@/components/Toast';

interface IdosoItem {
  id_idoso: string;
  nome: string | null;
  foto_usuario: string | null;
}

export type GerenciarIdososVinculadosRef = {
  refresh: () => void;
};

function GerenciarIdososVinculadosImpl(_props: {}, ref: React.Ref<GerenciarIdososVinculadosRef>) {
  const { makeRequest } = useAuthRequest();
  const [idosos, setIdosos] = useState<IdosoItem[]>([]);
  const [loading, setLoading] = useState(false);

  const fetchIdosos = async () => {
    setLoading(true);
    try {
      const data = await makeRequest<any[]>("/api/vinculos/idosos");
      const normalized: IdosoItem[] = (Array.isArray(data) ? data : []).map((x: any) => ({
        id_idoso: x.id_idoso || x.idoso_id || x.id,
        nome: x.nome ?? x.nome_idoso ?? x.nome_completo ?? null,
        foto_usuario: x.foto_usuario ?? x.foto ?? null,
      }));
      setIdosos(normalized);
    } catch (err) {
      // falha silenciosa por enquanto
    } finally {
      setLoading(false);
    }
  };

  useImperativeHandle(ref, () => ({ refresh: fetchIdosos }), []);

  useEffect(() => {
    fetchIdosos();
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, []);

  const handleDesvincular = async (id_idoso: string) => {
    const input = prompt('Para confirmar a desvinculação, digite: desvincular');
    if (input === null) return; // cancelado
    if ((input || '').trim().toLowerCase() !== 'desvincular') {
      toast.error('Confirmação incorreta. Digite exatamente: desvincular');
      return;
    }
    try {
      await makeRequest(`/api/vinculos/${id_idoso}`, { method: 'DELETE' });
      setIdosos(prev => prev.filter(i => i.id_idoso !== id_idoso));
      toast.success('Idoso desvinculado com sucesso.');
    } catch (err) {
      toast.error('Não foi possível desvincular. Tente novamente.');
    }
  };

  return (
    <section style={{ marginTop: 24 }}>
      <h2 style={{ fontSize: 18, fontWeight: 700, marginBottom: 12, color: '#111827' }}>Idosos Vinculados</h2>
      {loading ? (
        <div>Carregando...</div>
      ) : idosos.length === 0 ? (
        <div>Nenhum idoso vinculado ainda.</div>
      ) : (
        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(260px, 1fr))', gap: 12 }}>
          {idosos.map((i) => (
            <div key={i.id_idoso} style={{ border: '1px solid #e5e7eb', borderRadius: 12, padding: 12, display: 'flex', gap: 12, alignItems: 'center', minWidth: 0 }}>
              <Image src={i.foto_usuario || '/foto_padrao.png'} alt={i.nome || 'Idoso'} width={44} height={44} style={{ borderRadius: '9999px', objectFit: 'cover', flexShrink: 0 }} />
              <div style={{ flex: 1, minWidth: 0 }}>
                <div style={{ fontWeight: 700, color: '#111827', overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap' }}>{i.nome || 'Sem nome'}</div>
                <div style={{ fontSize: 12, color: '#6b7280', overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap' }}>{i.id_idoso}</div>
              </div>
              <button onClick={() => handleDesvincular(i.id_idoso)} style={{ background: '#ef4444', color: 'white', padding: '8px 12px', borderRadius: 10, fontWeight: 700, flexShrink: 0 }}>
                Desvincular
              </button>
            </div>
          ))}
        </div>
      )}
    </section>
  );
}

const GerenciarIdososVinculados = forwardRef(GerenciarIdososVinculadosImpl);
export default GerenciarIdososVinculados;

================
File: src/components/ProtectedRoute.tsx
================
'use client';

import { useAuth } from '@/contexts/AuthContext';
import { useRouter } from 'next/navigation';
import { useEffect } from 'react';

interface ProtectedRouteProps {
  children: React.ReactNode;
}

export default function ProtectedRoute({ children }: ProtectedRouteProps) {
  const { user, loading } = useAuth();
  const router = useRouter();

  useEffect(() => {
    if (!loading && !user) {
      router.push('/auth');
    }
  }, [user, loading, router]);

  if (loading) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <div className="text-center">
          <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"></div>
          <p className="mt-4 text-gray-600">Carregando...</p>
        </div>
      </div>
    );
  }

  if (!user) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <p>Redirecionando para autenticação...</p>
      </div>
    );
  }

  return <>{children}</>;
}

================
File: src/components/RotinasCard.module.css
================
.card {
  background-color: white;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
  border-radius: 0.5rem;
  padding: 1.5rem;
  border: 1px solid #e5e7eb;
  transition: box-shadow 0.3s ease;
  margin-top: 10px;
}

.card:hover {
  box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
}

.card_header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 0.5rem;
}

.card_title {
  font-size: 1.25rem;
  font-weight: bold;
  color: #1f2937;
  margin-bottom: 0.75rem;
}

.card_actions {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.actionButton {
  padding: 0.35rem 0.6rem;
  font-size: 0.875rem;
  border-radius: 0.375rem;
  border: 1px solid transparent;
  cursor: pointer;
  transition: background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease;
}

.editButton {
  background-color: #f3f4f6;
  color: #111827;
}
.editButton:hover {
  background-color: #e5e7eb;
}

.deleteButton {
  background-color: #fee2e2;
  color: #991b1b;
}
.deleteButton:hover {
  background-color: #fecaca;
}

.card_info {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
  color: #4b5563;
}

.card_info p {
  margin: 0;
}

.card_info strong {
  font-weight: 600;
}

.card_footer {
  margin-top: 1rem;
  padding-top: 1rem;
  border-top: 1px solid #e5e7eb;
}

.card_footer p {
  margin: 0;
  font-size: 0.875rem;
  color: #9ca3af;
}

================
File: src/components/RotinasCard.tsx
================
import React from 'react';
// Importa o objeto 'styles' do seu arquivo de módulo CSS
import styles from './RotinasCard.module.css';

// Define o formato esperado para os dados de uma rotina
type Rotina = {
  id: string;
  titulo: string;
  descricao?: string;
  frequencia?: string | Frequencia;
  created_at: string;
};

// --- Tipos de Frequência (mantidos como no original) ---
type FrequenciaDiaria = {
  tipo: 'diario';
  horarios: string[];
};

type FrequenciaIntervalo = {
  tipo: 'intervalo';
  intervalo_horas: number;
  inicio: string;
};

type FrequenciaDiasAlternados = {
  tipo: 'dias_alternados';
  intervalo_dias: number;
  horario: string;
};

type FrequenciaSemanal = {
  tipo: 'semanal';
  dias_da_semana: number[];
  horario: string;
};

type Frequencia = FrequenciaDiaria | FrequenciaIntervalo | FrequenciaDiasAlternados | FrequenciaSemanal;

// --- Função formatarFrequencia (mantida como no original) ---
function formatarFrequencia(freq?: string | Frequencia): string | null {
  if (!freq) return null;
  if (typeof freq === 'string') return freq;
  switch (freq.tipo) {
    case 'diario':
      return `Diário - ${freq.horarios.join(', ')}`;
    case 'intervalo':
      return `A cada ${freq.intervalo_horas}h (início: ${freq.inicio})`;
    case 'dias_alternados':
      return `A cada ${freq.intervalo_dias} dias (${freq.horario})`;
    case 'semanal': {
      const diasSemana = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb'];
      const dias = freq.dias_da_semana.map(dia => diasSemana[dia - 1]).join(', ');
      return `Toda ${dias} (${freq.horario})`;
    }
    default:
      return 'Frequência personalizada';
  }
} 

// --- ATUALIZADO: Define as props que o componente vai receber ---
interface RotinaCardProps {
  rotina: Rotina;
  onEdit?: (rotina: Rotina) => void;
  onDelete?: (id: string) => void;
  onMarkAsDone?: () => void;
  hasPendingToday?: boolean;
  isMarking?: boolean;
  isDeleting?: boolean;
}

const RotinaCard: React.FC<RotinaCardProps> = ({ rotina, onEdit, onDelete, onMarkAsDone, hasPendingToday, isMarking, isDeleting }) => {
  const frequenciaTexto = formatarFrequencia(rotina.frequencia);
  return (
    <div className={styles.card}>
      {/* --- ATUALIZADO: Adicionado cabeçalho para título e ações --- */}
      <div className={styles.card_header}>
        <h3 className={styles.card_title}>{rotina.titulo}</h3>
        <div className={styles.card_actions}>
          {hasPendingToday && onMarkAsDone && (
            <button
              type="button"
              className={`${styles.actionButton} ${styles.editButton}`}
              onClick={onMarkAsDone}
              disabled={isMarking}
              aria-label="Marcar como concluído hoje"
            >
              {isMarking ? 'Concluindo...' : 'Concluir hoje'}
            </button>
          )}
          {onEdit && (
            <button
              type="button"
              className={`${styles.actionButton} ${styles.editButton}`}
              onClick={() => onEdit(rotina)}
              aria-label="Editar rotina"
            >
              Editar
            </button>
          )}
          {onDelete && (
            <button
              type="button"
              className={`${styles.actionButton} ${styles.deleteButton}`}
              onClick={() => onDelete(rotina.id)}
              disabled={isDeleting}
              aria-label="Excluir rotina"
            >
              {isDeleting ? 'Excluindo...' : 'Excluir'}
            </button>
          )}
        </div>
      </div>
      {/* --- Fim da atualização --- */}

      <div className={styles.card_info}>
        {rotina.descricao && (
          <p>
            <strong>Descrição:</strong> {rotina.descricao}
          </p>
        )}
        {frequenciaTexto && (
          <p>
            <strong>Frequência:</strong> {frequenciaTexto}
          </p>
        )}
      </div>
      <div className={styles.card_footer}>
        <p>
          Adicionado em: {new Date(rotina.created_at).toLocaleDateString('pt-BR')}
        </p>
      </div>
    </div>
  );
};

export default RotinaCard;

================
File: src/components/Toast.tsx
================
"use client";

import { useEffect, useState, useRef, useCallback } from 'react';

export type ToastType = 'success' | 'error' | 'info' | 'confirm';

type ToastPosition = {
  top?: number | string;
  left?: number | string;
  right?: number | string;
  bottom?: number | string;
};

type ToastItem = {
  id: number;
  type: ToastType;
  message: string;
  position?: ToastPosition;
  resolve?: (value: boolean) => void;
};

let emit: ((t: ToastItem) => void) | null = null;
let counter = 1;

export const toast = {
  success(message: string, position?: ToastPosition) {
    emit?.({ id: counter++, type: 'success', message, position });
  },
  error(message: string, position?: ToastPosition) {
    emit?.({ id: counter++, type: 'error', message, position });
  },
  info(message: string, position?: ToastPosition) {
    emit?.({ id: counter++, type: 'info', message, position });
  },
  confirm(message: string, position?: ToastPosition) {
    return new Promise<boolean>((resolve) => {
      emit?.({ 
        id: counter++, 
        type: 'confirm', 
        message, 
        position,
        resolve 
      });
    });
  },
};

export function ToastContainer() {
  const [items, setItems] = useState<ToastItem[]>([]);
  const toastRefs = useRef<Record<number, HTMLDivElement | null>>({});

  useEffect(() => {
    emit = (t: ToastItem) => {
      setItems((prev) => [...prev, t]);
      if (t.type !== 'confirm') {
        setTimeout(() => {
          setItems((prev) => prev.filter((i) => i.id !== t.id));
        }, 3500);
      }
    };
    return () => { emit = null; };
  }, []);

  const getPositionStyle = useCallback((item: ToastItem): React.CSSProperties => {
    if (item.type === 'confirm') {
      // Diálogo de confirmação sempre no topo central
      return {
        top: '20px',
        left: '50%',
        transform: 'translateX(-50%)',
      };
    }
    // Outros toasts no canto superior direito
    if (!item.position) {
      return { top: '16px', right: '16px' };
    }
    return item.position;
  }, []);

  const handleConfirm = useCallback((item: ToastItem, confirm: boolean) => {
    setItems((prev) => prev.filter((x) => x.id !== item.id));
    item.resolve?.(confirm);
  }, []);

  return (
    <>
      {items.map((item) => (
        <div
          key={item.id}
          ref={(el) => {
            if (el) {
              toastRefs.current[item.id] = el;
            } else {
              delete toastRefs.current[item.id];
            }
          }}
          className="toast-message"
          style={{
            position: 'fixed',
            ...getPositionStyle(item),
            padding: item.type === 'confirm' ? '20px 24px' : '12px 16px',
            borderRadius: '12px',
            color: 'white',
            minWidth: item.type === 'confirm' ? '320px' : '260px',
            maxWidth: item.type === 'confirm' ? '400px' : '360px',
            boxShadow: '0 8px 32px rgba(0,0,0,0.2)',
            background: item.type === 'success' ? '#16a34a' : 
                       item.type === 'error' ? '#dc2626' : 
                       item.type === 'confirm' ? '#1f2937' : '#1f2937',
            zIndex: 9999,
            transition: 'opacity 0.3s, transform 0.3s',
            animation: 'slideIn 0.3s ease-out',
            textAlign: item.type === 'confirm' ? 'center' : 'left',
            fontSize: item.type === 'confirm' ? '16px' : '14px',
          }}
        >
          <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
            <div style={{ wordBreak: 'break-word' }}>{item.message}</div>
            {item.type === 'confirm' && (
              <div style={{ display: 'flex', gap: '12px', justifyContent: 'center', marginTop: '20px' }}>
                <button
                  onClick={() => handleConfirm(item, false)}
                  style={{
                    padding: '10px 20px',
                    borderRadius: '8px',
                    border: '1px solid #4b5563',
                    background: 'transparent',
                    color: 'white',
                    cursor: 'pointer',
                    fontWeight: 500,
                    transition: 'all 0.2s',
                    minWidth: '100px',
                  }}
                  onMouseOver={(e) => {
                    e.currentTarget.style.background = 'rgba(255, 255, 255, 0.1)';
                    e.currentTarget.style.borderColor = '#6b7280';
                  }}
                  onMouseOut={(e) => {
                    e.currentTarget.style.background = 'transparent';
                    e.currentTarget.style.borderColor = '#4b5563';
                  }}
                >
                  Cancelar
                </button>
                <button
                  onClick={() => handleConfirm(item, true)}
                  style={{
                    padding: '10px 20px',
                    borderRadius: '8px',
                    border: 'none',
                    background: '#dc2626',
                    color: 'white',
                    cursor: 'pointer',
                    fontWeight: 500,
                    transition: 'background 0.2s',
                    minWidth: '100px',
                  }}
                  onMouseOver={(e) => (e.currentTarget.style.background = '#b91c1c')}
                  onMouseOut={(e) => (e.currentTarget.style.background = '#dc2626')}
                >
                  Excluir
                </button>
              </div>
            )}
          </div>
        </div>
      ))}
      <style jsx global>{`
        @keyframes slideIn {
          from {
            opacity: 0;
            transform: translateY(-10px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }
        
        .toast-message {
          animation: slideIn 0.3s ease-out;
        }
      `}</style>
    </>
  );
}

================
File: src/components/ui/button.tsx
================
import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { cva, type VariantProps } from "class-variance-authority"
import { cn } from "@/lib/utils"

const buttonVariants = cva(
  "inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",
  {
    variants: {
      variant: {
        default: "bg-primary text-primary-foreground hover:bg-primary/90",
        destructive:
          "bg-destructive text-destructive-foreground hover:bg-destructive/90",
        outline:
          "border border-input bg-background hover:bg-accent hover:text-accent-foreground",
        secondary:
          "bg-secondary text-secondary-foreground hover:bg-secondary/80",
        ghost: "hover:bg-accent hover:text-accent-foreground",
        link: "text-primary underline-offset-4 hover:underline",
      },
      size: {
        default: "h-10 px-4 py-2",
        sm: "h-9 rounded-md px-3",
        lg: "h-11 rounded-md px-8",
        icon: "h-10 w-10",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

export interface ButtonProps
  extends React.ButtonHTMLAttributes<HTMLButtonElement>,
    VariantProps<typeof buttonVariants> {
  asChild?: boolean
}

const Button = React.forwardRef<HTMLButtonElement, ButtonProps>(
  ({ className, variant, size, asChild = false, ...props }, ref) => {
    const Comp = asChild ? Slot : "button"
    return (
      <Comp
        className={cn(buttonVariants({ variant, size, className }))}
        ref={ref}
        {...props}
      />
    )
  }
)
Button.displayName = "Button"

export { Button, buttonVariants }

================
File: src/components/Waves.tsx
================
"use client";

export function Waves() {
  return (
    <div className="global-waves" aria-hidden>
      <div className="global-wave" />
      <div className="global-wave" />
      <div className="global-wave" />
      <div className="global-wave" />
    </div>
  );
}

================
File: src/contexts/AuthContext.tsx
================
//contexts/AuthContext.tsx

'use client';

import { createContext, useContext, useEffect, useState, ReactNode, useMemo } from 'react';
import { createClient } from '@/lib/supabase/client'; 
import { User, Session, AuthResponse, AuthError } from '@supabase/supabase-js';
import { normalizeError } from '@/utils/errors';

interface AuthContextType {
  user: User | null;
  session: Session | null;
  loading: boolean;
  signIn: (email: string, password: string) => Promise<AuthResponse>;
  signUp: (email: string, password: string, fullName?: string, accountType?: 'individual' | 'familiar') => Promise<AuthResponse>;
  resetPassword: (email: string) => Promise<{ error: AuthError | null }>;
  signOut: () => Promise<void>;
}

  const AuthContext = createContext<AuthContextType | undefined>(undefined);

export function AuthProvider({ children }: { children: ReactNode }) {
  // 👇 2. Crie a instância do Supabase DENTRO do componente
  const supabase = useMemo( () => createClient(), [] ); 
  
  const [user, setUser] = useState<User | null>(null);
  const [session, setSession] = useState<Session | null>(null);
  const [loading, setLoading] = useState(true);
  
  // Função de reset password (necessita da instância do supabase)
  const resetPassword = async (email: string) => {
    const { error } = await supabase.auth.resetPasswordForEmail(email, {
        redirectTo: `${window.location.origin}/reset-password`,
    });
    return { error };
  };

  useEffect(() => {
    // Verifica a sessão atual ao carregar o componente
    const getInitialSession = async () => {
      try {
        // Cache da sessão para evitar múltiplas verificações
        const cachedSession = typeof window !== 'undefined' ? 
          sessionStorage.getItem('supabase_session') : null;
        
        if (cachedSession) {
          const parsedSession = JSON.parse(cachedSession);
          setSession(parsedSession);
          setUser(parsedSession?.user ?? null);
          setLoading(false);
          return;
        }

        const { data: { session }, error } = await supabase.auth.getSession();
        if (error) {
          console.error('Erro ao obter sessão:', error);
        }
        setSession(session);
        setUser(session?.user ?? null);
        
        // Cache da sessão
        if (typeof window !== 'undefined' && session) {
          sessionStorage.setItem('supabase_session', JSON.stringify(session));
        }
      } catch (error) {
        console.error('Erro inesperado ao obter sessão:', error);
      } finally {
        setLoading(false);
      }
    };

    getInitialSession();

    // Escuta mudanças no estado de autenticação
    const {
      data: { subscription },
    } = supabase.auth.onAuthStateChange(async (event, session) => {
      setSession(session);
      // Evita atualizar o estado do usuário quando apenas o token é renovado
      // (ex.: ao focar a aba). Mantém a referência se o id não mudou.
      setUser((prev) => {
        const nextUser = session?.user ?? null;
        if (prev?.id === nextUser?.id) return prev;
        return nextUser;
      });

      // Fallback: ao logar, tenta sincronizar metadados pendentes (ex.: phone) se não existirem ainda
      try {
        if (event === 'SIGNED_IN' && session?.user) {
          const currentMeta = session.user.user_metadata as Record<string, any> | undefined;
          const pendingRaw = typeof window !== 'undefined' ? localStorage.getItem('pendingUserMetadata') : null;
          if (pendingRaw) {
            const pending = JSON.parse(pendingRaw) as { full_name?: string; phone?: string } | null;
            const needsPhone = !currentMeta?.phone && !!pending?.phone;
            const needsName = !currentMeta?.full_name && !!pending?.full_name;
            if (needsPhone || needsName) {
              await supabase.auth.updateUser({
                data: {
                  full_name: needsName ? pending?.full_name : currentMeta?.full_name,
                  phone: needsPhone ? pending?.phone : currentMeta?.phone,
                },
              });
            }
            // Limpa pendências após tentativa
            if (typeof window !== 'undefined') {
              localStorage.removeItem('pendingUserMetadata');
            }
          }
        }
      } catch (syncErr) {
        // opcional: silenciar avisos não-críticos
      }

      setLoading(false);
    });

    return () => {
      subscription.unsubscribe();
    };
  }, [supabase]);

  const signIn = async (email: string, password: string) => {
    return await supabase.auth.signInWithPassword({
      email,
      password,
    });
  };

  const signUp = async (email: string, password: string, fullName?: string, accountType: 'individual' | 'familiar' = 'individual') => {
    try {
      // Verifica se as variáveis de ambiente estão configuradas
      const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;
      const supabaseKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;
      
      if (!supabaseUrl || !supabaseKey) {
        console.error('❌ Variáveis de ambiente do Supabase não configuradas!');
        console.error('URL:', supabaseUrl);
        console.error('Key:', supabaseKey ? 'Configurada' : 'Não configurada');
        throw new Error('Configuração do Supabase não encontrada. Verifique o arquivo .env.local');
      }
      
      console.log('✅ Configuração do Supabase encontrada');
      console.log('URL:', supabaseUrl);
      
      // Primeiro, registra o usuário na autenticação
      const authResponse = await supabase.auth.signUp({
        email,
        password,
        options: {
          data: {
            full_name: fullName,
            account_type: accountType,
          },
        },
      });
      
      console.log("Resposta de autenticação:", authResponse);
      
      // Tratamento: se usuário já existir, tentar realizar sign-in com a mesma credencial
      if (authResponse.error && typeof authResponse.error.message === 'string' && authResponse.error.message.toLowerCase().includes('already')) {
        const signInResp = await supabase.auth.signInWithPassword({ email, password });
        if (signInResp.data.user && !signInResp.error) {
          return signInResp;
        }
        return authResponse;
      }

      // Se o registro de autenticação for bem-sucedido, cria/atualiza o Perfis no banco de dados
      if (authResponse.data.user && !authResponse.error) {
        const userId = authResponse.data.user.id;
        
        // Dados do Perfis seguindo o schema: chave estrangeira em user_id
        const profileData = {
          user_id: userId,
          nome: fullName || 'Sem nome',
          tipo: accountType,
        } as const;
        
        console.log("Tentando inserir Perfis com nome:", fullName);
        
        // Upsert evita condição de corrida entre checar e inserir/atualizar
        const { error: upsertError } = await supabase
          .from('perfis')
          .upsert(profileData, { onConflict: 'user_id' });
        if (upsertError) {
          console.error('Erro ao upsert Perfis (não bloqueante):', upsertError);
        } else {
          console.log('Perfis upsert realizado com sucesso!');
        }
      } else if (authResponse.error) {
        console.error('Erro na autenticação:', authResponse.error);
      }
      
      return authResponse;
    } catch (error) {
      console.error('Erro inesperado no signUp:', error);
      throw normalizeError(error);
    }
  };

  const signOut = async () => {
    try {
      const { error } = await supabase.auth.signOut();
      if (error) {
        console.error('Erro ao fazer logout:', error);
        throw error;
      }
      // Limpa o estado local imediatamente
      setUser(null);
      setSession(null);
      // Limpa o cache de sessão para evitar reuso indevido ao reentrar
      if (typeof window !== 'undefined') {
        try {
          sessionStorage.removeItem('supabase_session');
        } catch {}
      }
    } catch (error) {
      console.error('Erro inesperado ao fazer logout:', error);
      throw normalizeError(error);
    }
  };

  const value = {
    user,
    session,
    loading,
    signIn,
    signUp,
    signOut,
    resetPassword,
  };

  return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>;
}

export function useAuth() {
  const context = useContext(AuthContext);
  if (context === undefined) {
    throw new Error('useAuth deve ser usado dentro de um AuthProvider');
  }
  return context;
}

================
File: src/contexts/IdosoContext.tsx
================
'use client';

import { createContext, useContext, useEffect, useMemo, useState, ReactNode, useCallback } from 'react';
import { createClient } from '@/lib/supabase/client';
import { useAuth } from '@/contexts/AuthContext';
import { useProfile } from '@/contexts/ProfileContext';

export type IdosoResumo = {
  id: string;
  nome: string;
};

type IdosoContextType = {
  listaIdososVinculados: IdosoResumo[];
  idosoSelecionadoId: string | null;
  setIdosoSelecionado: (id: string | null) => void;
  loading: boolean;
  refresh: () => Promise<void>;
};

const IdosoContext = createContext<IdosoContextType | undefined>(undefined);

export function IdosoProvider({ children }: { children: ReactNode }) {
  const { user } = useAuth();
  const { profile } = useProfile();
  const supabase = useMemo(() => createClient(), []);

  const [loading, setLoading] = useState(false);
  const [lista, setLista] = useState<IdosoResumo[]>([]);
  const [selecionado, setSelecionado] = useState<string | null>(null);

  const refresh = useCallback(async () => {
    if (!user) {
      setLista([]);
      setSelecionado(null);
      return;
    }
    // Apenas contas familiares listam idosos vinculados
    const isFamiliar = ((profile?.tipo || user.user_metadata?.account_type)?.toString().toLowerCase() === 'familiar');
    if (!isFamiliar) {
      setLista([]);
      setSelecionado(null);
      return;
    }
    setLoading(true);
    try {
      const { data: { session } } = await supabase.auth.getSession();
      const token = session?.access_token;
      const res = await fetch('/api/vinculos/idosos', {
        headers: token ? { Authorization: `Bearer ${token}` } : undefined,
        cache: 'no-store',
      });
      if (!res.ok) {
        setLista([]);
        setSelecionado(null);
        return;
      }
      const itens = await res.json();
      const mapped: IdosoResumo[] = (Array.isArray(itens) ? itens : []).map((x: any) => ({
        id: x.id || x.idoso_id || x.id_idoso,
        nome: x.nome || x.nome_idoso || x.nome_completo || 'Idoso',
      }));
      setLista(mapped);
      // Mantém seleção se ainda existir; caso contrário, usa persistido ou seleciona primeiro
      const persisted = typeof window !== 'undefined' ? (localStorage.getItem('idosoSelecionadoId') || null) : null;
      setSelecionado((prev) => {
        const candidate = (persisted && persisted !== '') ? persisted : prev;
        if (candidate && mapped.some((i) => i.id === candidate)) return candidate;
        return mapped.length ? mapped[0].id : null;
      });
    } finally {
      setLoading(false);
    }
  }, [supabase, user, profile?.tipo]);

  useEffect(() => {
    refresh();
  }, [refresh]);

  // Persiste a seleção entre sessões
  useEffect(() => {
    if (typeof window !== 'undefined') {
      if (selecionado) {
        localStorage.setItem('idosoSelecionadoId', selecionado);
      } else {
        localStorage.removeItem('idosoSelecionadoId');
      }
    }
  }, [selecionado]);

  const value: IdosoContextType = useMemo(() => ({
    listaIdososVinculados: lista,
    idosoSelecionadoId: escolhidoOrNull(selecionado),
    setIdosoSelecionado: setSelecionado,
    loading,
    refresh,
  }), [lista, selecionado, loading, refresh]);

  return (
    <IdosoContext.Provider value={value}>
      {children}
    </IdosoContext.Provider>
  );
}

function escolhidoOrNull(id: string | null) { return id ?? null; }

export function useIdoso() {
  const ctx = useContext(IdosoContext);
  if (!ctx) throw new Error('useIdoso deve ser usado dentro de IdosoProvider');
  return ctx;
}

================
File: src/contexts/LoadingContext.tsx
================
"use client";

import React, { createContext, useState, useContext, ReactNode, useEffect } from 'react';
import { FullScreenLoader } from '@/components/FullScreenLoader';

// Interface para definir o que o nosso contexto irá fornecer
interface LoadingContextType {
  setIsLoading: (isLoading: boolean) => void;
}

// Cria o contexto
const LoadingContext = createContext<LoadingContextType | undefined>(undefined);

// Componente Provedor que irá gerenciar o estado e exibir o loader
export function LoadingProvider({ children }: { children: ReactNode }) {
    const [isLoading, setIsLoading] = useState(false);
    // Exibe o loader apenas se o estado de loading persistir por mais de 250ms,
    // evitando "flash" rápido ao voltar a aba ou revalidações curtas.
    const [visible, setVisible] = useState(false);

    useEffect(() => {
        if (isLoading) {
            const t = setTimeout(() => setVisible(true), 250);
            return () => clearTimeout(t);
        }
        // Quando parar de carregar, some imediatamente
        setVisible(false);
    }, [isLoading]);

    return (
        <LoadingContext.Provider value={{ setIsLoading }}>
            {visible && <FullScreenLoader />}
            {children}
        </LoadingContext.Provider>
    );
}

// Hook customizado para facilitar o uso do contexto nas páginas
export function useLoading() {
    const context = useContext(LoadingContext);
    if (context === undefined) {
        throw new Error('useLoading precisa ser usado dentro de um LoadingProvider');
    }
    return context;
}

================
File: src/contexts/ProfileContext.tsx
================
'use client';

import { createContext, useContext, useEffect, useMemo, useState, ReactNode, useCallback } from 'react';
import { createClient } from '@/lib/supabase/client';
import { useAuth } from '@/contexts/AuthContext';

interface Profile {
  id: string;
  nome?: string | null;
  tipo?: string | null;
  foto_usuario?: string | null; // path in storage
}

interface ProfileContextValue {
  profile: Profile | null;
  photoUrl: string | null; // public URL
  loading: boolean;
  refresh: () => Promise<void>;
}

const ProfileContext = createContext<ProfileContextValue | undefined>(undefined);

export function ProfileProvider({ children }: { children: ReactNode }) {
  const { user } = useAuth();
  const supabase = useMemo(() => createClient(), []);

  const [profile, setProfile] = useState<Profile | null>(null);
  const [photoUrl, setPhotoUrl] = useState<string | null>(null);
  const [loading, setLoading] = useState(false);

  const computePublicUrl = useCallback((path: string | null | undefined) => {
    if (!path) return null;
    if (path.startsWith('http')) return path;
    const { data } = supabase.storage.from('avatars').getPublicUrl(path);
    return data?.publicUrl ?? null;
  }, [supabase]);

  const fetchOrCreateProfile = useCallback(async () => {
    if (!user) {
      setProfile(null);
      setPhotoUrl(null);
      return;
    }

    // Verifica cache primeiro
    const cacheKey = `profile_${user.id}`;
    const cachedProfile = typeof window !== 'undefined' ? 
      sessionStorage.getItem(cacheKey) : null;
    
    if (cachedProfile) {
      try {
        const parsedProfile = JSON.parse(cachedProfile);
        setProfile(parsedProfile);
        setPhotoUrl(computePublicUrl(parsedProfile?.foto_usuario ?? null));
        return;
      } catch (e) {
        // Se cache estiver corrompido, limpa e continua
        if (typeof window !== 'undefined') {
          sessionStorage.removeItem(cacheKey);
        }
      }
    }

    setLoading(true);
    try {
      // tenta buscar
      const { data, error } = await supabase
        .from('perfis')
        .select('id, user_id, nome, tipo, foto_usuario')
        .eq('user_id', user.id)
        .single();

      if (error) {
        // PGRST116 => not found
        if ((error as any).code === 'PGRST116') {
          // não criar automaticamente; deixar perfil nulo
          setProfile(null);
          setPhotoUrl(null);
        } else {
          throw error;
        }
      } else {
        setProfile(data as Profile);
        setPhotoUrl(computePublicUrl((data as any)?.foto_usuario ?? null));
        
        // Cache do perfil
        if (typeof window !== 'undefined') {
          sessionStorage.setItem(cacheKey, JSON.stringify(data));
        }
      }
    } catch (e) {
      console.error('ProfileProvider: erro ao obter perfil', e);
      setProfile(null);
      setPhotoUrl(null);
    } finally {
      setLoading(false);
    }
  }, [user, supabase, computePublicUrl]);

  useEffect(() => {
    fetchOrCreateProfile();
  }, [fetchOrCreateProfile]);

  // Listener para mudanças no localStorage
  useEffect(() => {
    const handleStorageChange = () => {
      if (user?.id) {
        fetchOrCreateProfile();
      }
    };

    window.addEventListener('storage', handleStorageChange);
    return () => window.removeEventListener('storage', handleStorageChange);
  }, [user?.id, fetchOrCreateProfile]);

  // Ouve eventos internos para atualização imediata da foto do perfil
  useEffect(() => {
    const handleProfilePhotoUpdated = (e: any) => {
      const newUrl: string | undefined = e?.detail?.photoUrl;
      if (!newUrl) {
        fetchOrCreateProfile();
        return;
      }
      const cacheBusted = `${newUrl}${newUrl.includes('?') ? '&' : '?'}v=${Date.now()}`;
      setPhotoUrl(cacheBusted);

      // Atualiza cache do perfil se existir
      if (user?.id && typeof window !== 'undefined') {
        const cacheKey = `profile_${user.id}`;
        try {
          const cached = sessionStorage.getItem(cacheKey);
          if (cached) {
            const parsed = JSON.parse(cached);
            parsed.foto_usuario = newUrl;
            sessionStorage.setItem(cacheKey, JSON.stringify(parsed));
          }
        } catch {}
      }
    };

    window.addEventListener('profilePhotoUpdated', handleProfilePhotoUpdated as any);
    return () => window.removeEventListener('profilePhotoUpdated', handleProfilePhotoUpdated as any);
  }, [user?.id, fetchOrCreateProfile]);

  const value: ProfileContextValue = useMemo(() => ({
    profile,
    photoUrl,
    loading,
    refresh: fetchOrCreateProfile,
  }), [profile, photoUrl, loading, fetchOrCreateProfile]);

  return (
    <ProfileContext.Provider value={value}>
      {children}
    </ProfileContext.Provider>
  );
}

export function useProfile() {
  const ctx = useContext(ProfileContext);
  if (!ctx) throw new Error('useProfile deve ser usado dentro de ProfileProvider');
  return ctx;
}

================
File: src/hooks/index.ts
================
// Custom hooks for Caremind application
export { useApiRequest } from './useApiRequest';
export { useAuthRequest } from './useAuthRequest';
export { useCrudOperations } from './useCrudOperations';
export { useModalState } from './useModalState';
export { useOptimisticUpdates } from './useOptimisticUpdates';
export { useOptimizedNavigation } from './useOptimizedNavigation';
export { usePersistentState } from './usePersistentState';
export { usePWA } from './use-pwa';

================
File: src/hooks/use-pwa.ts
================
"use client";

import { useState, useEffect } from "react";

interface BeforeInstallPromptEvent extends Event {
  readonly platforms: string[];
  readonly userChoice: Promise<{
    outcome: "accepted" | "dismissed";
    platform: string;
  }>;
  prompt(): Promise<void>;
}

export function usePWA() {
  const [isInstalled, setIsInstalled] = useState(false);
  const [isInstallable, setIsInstallable] = useState(false);
  const [deferredPrompt, setDeferredPrompt] = useState<BeforeInstallPromptEvent | null>(null);

  useEffect(() => {
    // Verificar se o app está rodando como PWA
    const checkIfInstalled = () => {
      // Verificar se está em modo standalone (PWA instalado)
      const isStandalone = window.matchMedia("(display-mode: standalone)").matches;
      // Verificar se está rodando no iOS como PWA
      const isIOSPWA = (window.navigator as Navigator & { standalone?: boolean }).standalone === true;
      
      setIsInstalled(isStandalone || isIOSPWA);
    };

    // Detectar evento de instalação
    const handleBeforeInstallPrompt = (e: Event) => {
      e.preventDefault();
      setDeferredPrompt(e as BeforeInstallPromptEvent);
      setIsInstallable(true);
    };

    // Detectar se foi instalado
    const handleAppInstalled = () => {
      setIsInstalled(true);
      setIsInstallable(false);
      setDeferredPrompt(null);
    };

    checkIfInstalled();

    window.addEventListener("beforeinstallprompt", handleBeforeInstallPrompt);
    window.addEventListener("appinstalled", handleAppInstalled);

    return () => {
      window.removeEventListener("beforeinstallprompt", handleBeforeInstallPrompt);
      window.removeEventListener("appinstalled", handleAppInstalled);
    };
  }, []);

  const installApp = async () => {
    if (!deferredPrompt) return false;

    deferredPrompt.prompt();
    const { outcome } = await deferredPrompt.userChoice;
    
    if (outcome === "accepted") {
      setIsInstalled(true);
      setIsInstallable(false);
      setDeferredPrompt(null);
      return true;
    }
    
    return false;
  };

  return {
    isInstalled,
    isInstallable,
    installApp,
  };
}

================
File: src/hooks/useApiRequest.ts
================
'use client';

import { useState, useCallback, useRef } from 'react';
import { normalizeError } from '@/utils/errors';

interface ApiRequestState<T> {
  data: T | null;
  loading: boolean;
  error: string | null;
}

interface UseApiRequestOptions {
  onSuccess?: (data: any) => void;
  onError?: (error: string) => void;
}

export function useApiRequest<T = any>(options: UseApiRequestOptions = {}) {
  const [state, setState] = useState<ApiRequestState<T>>({
    data: null,
    loading: false,
    error: null,
  });

  // Use useRef para evitar problemas com dependências
  const optionsRef = useRef(options);
  optionsRef.current = options;

  const execute = useCallback(async (requestFn: () => Promise<T>) => {
    setState(prev => ({ ...prev, loading: true, error: null }));

    try {
      const data = await requestFn();
      setState({ data, loading: false, error: null });
      optionsRef.current.onSuccess?.(data);
      return data;
    } catch (error) {
      const normalized = normalizeError(error);
      const errorMessage = normalized.message;
      setState(prev => ({ ...prev, loading: false, error: errorMessage }));
      optionsRef.current.onError?.(errorMessage);
      throw normalized;
    }
  }, []); // Dependências vazias, usa optionsRef

  const reset = useCallback(() => {
    setState({
      data: null,
      loading: false,
      error: null,
    });
  }, []);

  return {
    ...state,
    execute,
    reset,
  };
}

================
File: src/hooks/useAuthRequest.ts
================
'use client';

import { useCallback } from 'react';
import { createClient } from '@/lib/supabase/client';

interface AuthenticatedRequestOptions extends RequestInit {
  requiresAuth?: boolean;
}

export function useAuthRequest() {
  const supabase = createClient();

  const makeRequest = useCallback(async <T = any>(
    url: string,
    options: AuthenticatedRequestOptions = {}
  ): Promise<T> => {
    const { requiresAuth = true, ...fetchOptions } = options;

    // Corrigido: headers com tipagem correta
    const headers: Record<string, string> = {
      'Content-Type': 'application/json',
      ...(fetchOptions.headers as Record<string, string> || {}),
    };

    if (requiresAuth) {
      const { data: { session } } = await supabase.auth.getSession();
      if (!session) {
        throw new Error('Usuário não autenticado. Faça login para continuar.');
      }
      headers['Authorization'] = `Bearer ${session.access_token}`;
    }

    const response = await fetch(url, {
      ...fetchOptions,
      headers,
    });

    if (!response.ok) {
      const errorData = await response.json().catch(() => ({}));
      throw new Error(errorData.erro || errorData.message || `Erro HTTP ${response.status}`);
    }

    // Handle 204 No Content responses
    if (response.status === 204) {
      return null as T;
    }

    return await response.json();
  }, [supabase]);

  return {
    makeRequest,
  };
}

================
File: src/hooks/useCrudOperations.ts
================
'use client';

import { useState, useCallback, useEffect, useMemo } from 'react';
import { toast } from '@/components/Toast';
import { useAuthRequest } from './useAuthRequest';
import { useModalState } from './useModalState';
import { useOptimisticUpdates } from './useOptimisticUpdates';
import { normalizeError } from '@/utils/errors';

interface CrudOperationsConfig<T extends { id: string | number }> {
  endpoint: string;
  onSuccess?: {
    create?: (item: T) => void;
    update?: (item: T) => void;
    delete?: (itemId: string) => void;
    read?: (items: T[]) => void;
  };
  onError?: {
    create?: (error: string) => void;
    update?: (error: string) => void;
    delete?: (error: string) => void;
    read?: (error: string) => void;
  };
}

export function useCrudOperations<T extends { id: string | number }>(
  config: CrudOperationsConfig<T>
) {
  const [items, setItems] = useState<T[]>([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  const { makeRequest } = useAuthRequest();
  const addModal = useModalState<T>();
  const editModal = useModalState<T>();
  const { executeOptimisticUpdate } = useOptimisticUpdates<T>();

  // Ensure item-level operations hit the resource route without query params
  const baseEndpoint = useMemo(() => config.endpoint.split('?')[0], [config.endpoint]);

  // Fetch items
  const fetchItems = useCallback(async () => {
    setLoading(true);
    setError(null);

    try {
      const data = await makeRequest<T[]>(config.endpoint);
      setItems(data || []);
      config.onSuccess?.read?.(data || []);
    } catch (err) {
      const errorMessage = err instanceof Error ? err.message : 'Erro ao carregar dados';
      setError(errorMessage);
      // 🎯 ATENÇÃO AQUI: Mudança de tipo de erro (create => read/fetch)
      config.onError?.read?.(errorMessage);
    } finally {
      setLoading(false);
    }
  }, [makeRequest, config.endpoint, config.onError?.read, config.onSuccess?.read]);

  // Create item
  const createItem = useCallback(async (data: Omit<T, 'id'>) => {
    try {
      const newItem = await makeRequest<T>(config.endpoint, {
        method: 'POST',
        body: JSON.stringify(data),
      });

      setItems(prev => [newItem, ...prev]);
      addModal.close();
      config.onSuccess?.create?.(newItem);
    } catch (err) {
      const normalized = normalizeError(err, 'Erro ao criar item');
      config.onError?.create?.(normalized.message);
      throw normalized;
    }
  }, [makeRequest, config.endpoint, config.onSuccess?.create, config.onError?.create, addModal]);

  // Update item
  const updateItem = useCallback(async (itemId: string, data: Partial<T>) => {
    try {
      const optimisticUpdate = (item: T) => ({ ...item, ...data } as T);

      await executeOptimisticUpdate(
        items,
        updater => setItems(updater),
        itemId,
        optimisticUpdate,
        async () => {
          return makeRequest<T>(`${baseEndpoint}/${itemId}`, {
            method: 'PATCH',
            body: JSON.stringify(data),
          });
        },
        {
          onSuccess: (updatedItem) => {
            setItems(prev => prev.map(item => (item.id === itemId ? (updatedItem as T) : item)));
            editModal.close();
            config.onSuccess?.update?.(updatedItem as T);
          },
          onError: (error) => {
            config.onError?.update?.(error.message);
          },
        }
      );
    } catch (err) {
      const normalized = normalizeError(err, 'Erro ao atualizar item');
      config.onError?.update?.(normalized.message);
      throw normalized;
    }
  }, [items, makeRequest, config.endpoint, executeOptimisticUpdate, editModal, config.onSuccess?.update, config.onError?.update]);

  // Delete item
  const deleteItem = useCallback(async (itemId: string) => {
    const ok = await toast.confirm('Tem certeza que deseja excluir este item?');
    if (!ok) return;

    try {
      // Guardar estado anterior para possível rollback
      const previousItems = [...items];
      
      // Atualização otimista: remover o item imediatamente
      setItems(prev => prev.filter(item => item.id !== itemId));

      try {
        // Fazer a requisição DELETE
        await makeRequest(`${baseEndpoint}/${itemId}`, {
          method: 'DELETE',
        });

        // Se chegou aqui, deu certo
        config.onSuccess?.delete?.(itemId);
        toast.success('Item excluído com sucesso');
        return true;
      } catch (error) {
        // Rollback em caso de erro
        setItems(previousItems);
        throw error;
      }
    } catch (err) {
      const normalized = normalizeError(err, 'Erro ao excluir item');
      config.onError?.delete?.(normalized.message);
      throw normalized;
    }
  }, [items, makeRequest, baseEndpoint, config.onSuccess, config.onError]);

  // Edit item (open modal)
  const editItem = useCallback((item: T) => {
    editModal.open(item);
  }, [editModal]);

  // Load items on mount
  useEffect(() => {
    fetchItems();
  }, [fetchItems]);

  return {
    // State
    items,
    loading,
    error,

    // Modals
    addModal,
    editModal,

    // Operations
    createItem,
    updateItem,
    deleteItem,
    editItem,
    fetchItems,

    // Utilities
    setItems,
  };
}

================
File: src/hooks/useModalState.ts
================
'use client';

import { useState, useCallback } from 'react';

// Linha 5: Erro corrigido substituindo 'any' por 'unknown'
export function useModalState<T = unknown>(initialItem: T | null = null) {
  const [isOpen, setIsOpen] = useState(false);
  const [item, setItem] = useState<T | null>(initialItem);

  // Sem warnings de dependência de useCallback, pois 'itemToEdit' é um parâmetro
  const open = useCallback((itemToEdit?: T) => {
    setItem(itemToEdit ?? null);
    setIsOpen(true);
  }, []); // Dependências vazias estão corretas aqui

  // Sem warnings
  const close = useCallback(() => {
    setIsOpen(false);
    setItem(null);
  }, []); // Dependências vazias estão corretas aqui

  // Sem warnings
  const toggle = useCallback(() => {
    setIsOpen(prev => !prev);
  }, []); // Dependências vazias estão corretas aqui

  return {
    isOpen,
    item,
    open,
    close,
    toggle,
  };
}

================
File: src/hooks/useOptimisticUpdates.ts
================
'use client';

import { useCallback } from 'react';

interface OptimisticUpdateOptions<T, R = T> {
  onSuccess?: (updatedItem: R) => void;
  onError?: (error: Error, originalItem: T) => void;
}

export function useOptimisticUpdates<T extends { id: string | number }>() {
  const executeOptimisticUpdate = useCallback(async <R = T>(
    currentItems: T[],
    setItems: (updater: (items: T[]) => T[]) => void,
    itemId: string,
    optimisticUpdate: (item: T) => T,
    apiCall: () => Promise<R>,
    options: OptimisticUpdateOptions<T, R> = {}
  ): Promise<R | null> => {
    // Snapshot para rollback
    const originalItems = [...currentItems];

    // Aplica atualização otimista imediatamente
    setItems(() =>
      currentItems.map(item => (item.id === itemId ? optimisticUpdate(item) : item))
    );

    try {
      const result = await apiCall();
      options.onSuccess?.(result);
      return result;
    } catch (error) {
      const err = error instanceof Error ? error : new Error('Erro inesperado');
      // Rollback em caso de erro
      setItems(() => originalItems);
      const original = originalItems.find(item => item.id === itemId)!;
      options.onError?.(err, original);
      throw err;
    }
  }, []);

  return {
    executeOptimisticUpdate,
  };
}

================
File: src/hooks/useOptimizedNavigation.ts
================
'use client';

import { useRouter } from 'next/navigation';
import { useCallback, useRef } from 'react';

export function useOptimizedNavigation() {
  const router = useRouter();
  const navigationTimeoutRef = useRef<NodeJS.Timeout | null>(null);

  const navigateTo = useCallback((href: string, options?: { replace?: boolean }) => {
    // Cancela navegação anterior se ainda estiver pendente
    if (navigationTimeoutRef.current) {
      clearTimeout(navigationTimeoutRef.current);
    }

    // Usa timeout mínimo para evitar navegações muito rápidas
    navigationTimeoutRef.current = setTimeout(() => {
      if (options?.replace) {
        router.replace(href);
      } else {
        router.push(href);
      }
    }, 50); // 50ms de delay mínimo para suavizar a navegação
  }, [router]);

  const prefetchRoute = useCallback((href: string) => {
    // Prefetch da rota para navegação mais rápida
    router.prefetch(href);
  }, [router]);

  return {
    navigateTo,
    prefetchRoute,
  };
}

================
File: src/hooks/usePersistentState.ts
================
'use client';

import { useEffect, useRef, useState } from 'react';

export function usePersistentState<T>(key: string, initialValue: T) {
  const isFirst = useRef(true);
  const [state, setState] = useState<T>(() => {
    if (typeof window === 'undefined') return initialValue;
    try {
      const raw = window.localStorage.getItem(key);
      return raw != null ? (JSON.parse(raw) as T) : initialValue;
    } catch {
      return initialValue;
    }
  });

  useEffect(() => {
    if (typeof window === 'undefined') return;
    // evita sobrescrever no mount se já existe valor em storage
    if (isFirst.current) {
      isFirst.current = false;
      return;
    }
    try {
      window.localStorage.setItem(key, JSON.stringify(state));
    } catch {
      // ignore quota errors
    }
  }, [key, state]);

  return [state, setState] as const;
}

================
File: src/lib/medicamentoUtils.ts
================
// Função para verificar se um medicamento deve ser desmarcado com base na sua frequência


// Define o tipo de frequência
interface Frequencia {
    tipo: 'diario' | 'intervalo' | 'dias_alternados' | 'semanal';
    intervalo_horas?: number; // Usado em 'intervalo'
    intervalo_dias?: number; // Usado em 'dias_alternados'
    dias_da_semana?: number[]; // Usado em 'semanal' (0=domingo, 6=sábado)
    horario?: string; // Usado em 'semanal' (ex: "10:30")
}

// Define o tipo principal do Medicamento
interface Medicamento {
    id: string; // Exemplo
    nome: string; // Exemplo
    ultimaAtualizacao?: string | null; // Data da última atualização, opcional
    data_agendada?: string | null; // Próxima data agendada, opcional
    frequencia?: Frequencia | null; // Objeto de frequência, opcional
}

// Função para verificar se um medicamento deve ser desmarcado com base na sua frequência
// Linha 2: Erro corrigido substituindo 'any' por 'Medicamento'
export function shouldResetMedicamento(medicamento: Medicamento): boolean {
    if (!medicamento.ultimaAtualizacao) return false;
    
    // ... o restante da função é o mesmo
    const agora = new Date();
    const ultimaAtualizacao = new Date(medicamento.ultimaAtualizacao);
    const diferencaHoras = (agora.getTime() - ultimaAtualizacao.getTime()) / (1000 * 60 * 60);
    
    if (medicamento.frequencia) {
        switch (medicamento.frequencia.tipo) {
            case 'diario':
                // Verifica se já é um novo dia
                return ultimaAtualizacao.getDate() !== agora.getDate() ||
                        ultimaAtualizacao.getMonth() !== agora.getMonth() ||
                        ultimaAtualizacao.getFullYear() !== agora.getFullYear();
                
            case 'intervalo':
                // Verifica se já passou o intervalo de horas
                return diferencaHoras >= (medicamento.frequencia.intervalo_horas || Infinity); // Adicionado || Infinity para segurança
                
            case 'dias_alternados':
                // Verifica se já passou o número de dias alternados
                const diasPassados = diferencaHoras / 24;
                return diasPassados >= (medicamento.frequencia.intervalo_dias || Infinity); // Adicionado || Infinity para segurança
                
            default:
                return false;
        }
    }
    
    return false;
}

// Função para formatar a próxima dose
// Linha 33: Erro corrigido substituindo 'any' por 'Medicamento'
export function formatarProximaDose(medicamento: Medicamento): string {
    if (!medicamento.data_agendada) return 'Data não definida';
    
    // ... o restante da função é o mesmo
    const data = new Date(medicamento.data_agendada);
    
    if (isNaN(data.getTime())) return 'Data inválida';
    
    // Formata a data no padrão brasileiro
    return data.toLocaleString('pt-BR', {
        day: '2-digit',
        month: '2-digit',
        year: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
    });
}

// Função para calcular a próxima dose
// Linha 52: Erro corrigido substituindo 'any' por 'Medicamento'
export function calcularProximaDose(medicamento: Medicamento): Date | null {
    if (!medicamento.data_agendada) return null;
    
    // ... o restante da função é o mesmo
    const dataAtual = new Date(medicamento.data_agendada);
    if (isNaN(dataAtual.getTime())) return null;
    
    if (medicamento.frequencia) {
        const proximaData = new Date(dataAtual);
        
        switch (medicamento.frequencia.tipo) {
            case 'diario':
                // Próximo dia no mesmo horário
                proximaData.setDate(proximaData.getDate() + 1);
                break;
                
            case 'intervalo':
                // Adiciona o intervalo de horas
                proximaData.setHours(proximaData.getHours() + (medicamento.frequencia.intervalo_horas || 0)); // Adicionado || 0
                break;
                
            case 'dias_alternados':
                // Adiciona o número de dias alternados
                proximaData.setDate(proximaData.getDate() + (medicamento.frequencia.intervalo_dias || 0)); // Adicionado || 0
                break;
                
            case 'semanal':
                // ... lógica da semana mantida ...
                const hoje = proximaData.getDay(); // 0 = Domingo, 1 = Segunda, etc.
                const proximoDia = medicamento.frequencia.dias_da_semana
                    ? medicamento.frequencia.dias_da_semana
                        .sort((a: number, b: number) => a - b)
                        .find((dia: number) => dia > hoje) || 
                        (Math.min(...medicamento.frequencia.dias_da_semana) + 7)
                    : hoje + 7; // Caso dias_da_semana não exista
                
                const diasParaAdicionar = (proximoDia - hoje + 7) % 7 || 7;
                proximaData.setDate(proximaData.getDate() + diasParaAdicionar);
                
                // Define o horário
                if (medicamento.frequencia.horario) {
                    const [horas, minutos] = medicamento.frequencia.horario.split(':');
                    proximaData.setHours(parseInt(horas, 10), parseInt(minutos, 10), 0, 0);
                }
                break;
        }
        
        return proximaData;
    }
    
    return dataAtual;
}

================
File: src/lib/services/passwordService.ts
================
// src/lib/services/passwordService.ts

import { SupabaseClient } from '@supabase/supabase-js';

// Definição da interface (garantindo a exportação)
export interface ChangePasswordData {
    currentPassword: string;
    newPassword: string;
}

// Definição da classe (garantindo a exportação)
export class PasswordService {
    private supabase: SupabaseClient;

    constructor(supabaseClient: SupabaseClient) {
        this.supabase = supabaseClient;
    }

    /**
     * Tenta reautenticar o usuário com a senha atual antes de trocar para a nova senha.
     * Isso é necessário para proteger a conta de ataques de Sessão Fixa.
     * @param data { currentPassword: string, newPassword: string }
     * @returns { error: Error | null }
     */
    async changePassword(data: ChangePasswordData): Promise<{ error: Error | null }> {
        const { currentPassword, newPassword } = data;

        // 1. Obter o e-mail do usuário logado
        const { data: userData, error: userError } = await this.supabase.auth.getUser();

        if (userError || !userData.user?.email) {
            return { error: new Error("Usuário não autenticado ou e-mail indisponível.") };
        }

        const userEmail = userData.user.email;

        // 2. Reautenticar (tentar login) com a senha atual
        const { error: reauthError } = await this.supabase.auth.signInWithPassword({
            email: userEmail,
            password: currentPassword,
        });

        if (reauthError) {
            // Se a reautenticação falhar, a senha atual está errada.
            // Erro comum do Supabase: "Invalid login credentials"
            return { error: new Error("A senha atual informada está incorreta.") };
        }

        // 3. Se a reautenticação for bem-sucedida, atualize a senha.
        const { error: updateError } = await this.supabase.auth.updateUser({
            password: newPassword,
        });

        if (updateError) {
            return { error: updateError };
        }

        // Se tudo ocorrer bem
        return { error: null };
    }
}

================
File: src/lib/services/ProfileService.ts
================
export interface ProfileUpdateData {
    fullName: string;
    phone?: string;
    dob?: string;
}

export interface ProfileUpdateResponse {
    message?: string;
    error?: string;
}

export class ProfileService {
    private static baseUrl = '/api';

    /**
     * Atualiza os dados do perfil do usuário através da API
     */
    static async updateProfile(data: ProfileUpdateData): Promise<ProfileUpdateResponse> {
        try {
            const response = await fetch(`${this.baseUrl}/profile`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data),
            });

            const result = await response.json();

            if (!response.ok) {
                return { error: result.error || 'Erro desconhecido ao atualizar o perfil.' };
            }

            return { message: result.message };

        } catch (error) {
            console.error('Erro na requisição de atualização de perfil:', error);
            return { error: 'Falha de conexão. Não foi possível salvar as alterações.' };
        }
    }
}

================
File: src/lib/supabase/client.ts
================
// Arquivo: src/lib/supabase/client.ts
'use client'; 

import { createBrowserClient } from '@supabase/ssr';

export function createClient() {
  return createBrowserClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
  );
}

================
File: src/lib/supabase/server.ts
================
import { createServerClient, type CookieOptions } from '@supabase/ssr';
import { cookies } from 'next/headers';

export async function createClient(accessToken?: string) {
  const cookieStore = await cookies();

  return createServerClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    {
      cookies: {
        getAll() {
          return cookieStore.getAll();
        },
        setAll(cookiesToSet) {
          try {
            cookiesToSet.forEach(({ name, value, options }) =>
              cookieStore.set(name, value, options)
            );
          } catch (error) {
            // Ação 'set' pode falhar em Server Components, mas é seguro ignorar.
          }
        },
      },
      // Quando fornecido, propaga o token via header Authorization para autorizar as queries
      global: accessToken
        ? {
            headers: {
              Authorization: `Bearer ${accessToken}`,
            },
          }
        : undefined,
    }
  );
}

================
File: src/lib/utils.ts
================
import { clsx, type ClassValue } from "clsx"
import { twMerge } from "tailwind-merge"

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs))
}

================
File: src/middleware.ts
================
// middleware.ts (na raiz do projeto ou em src/)

import { createServerClient } from '@supabase/ssr'
import { NextResponse, type NextRequest } from 'next/server'

export async function middleware(request: NextRequest) {
  let response = NextResponse.next({
    request: {
      headers: request.headers,
    },
  })

  const allowedOrigin = 'https://caremind.online'

  if (request.method === 'OPTIONS') {
    const preflight = new NextResponse(null, { status: 204 })
    preflight.headers.set('Access-Control-Allow-Origin', allowedOrigin)
    preflight.headers.set('Vary', 'Origin')
    preflight.headers.set('Access-Control-Allow-Methods', 'GET, POST, PUT, PATCH, DELETE, OPTIONS')
    preflight.headers.set('Access-Control-Allow-Headers', 'Content-Type, Authorization, X-Requested-With')
    preflight.headers.set('Access-Control-Max-Age', '86400')
    return preflight
  }

  const supabase = createServerClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    {
      cookies: {
        get(name: string) {
          return request.cookies.get(name)?.value
        },
        set(name: string, value: string, options) {
          request.cookies.set({
            name,
            value,
            ...options,
          })
          response = NextResponse.next({
            request: {
              headers: request.headers,
            },
          })
          response.cookies.set({
            name,
            value,
            ...options,
          })
        },
        remove(name: string, options) {
          request.cookies.set({
            name,
            value: '',
            ...options,
          })
          response = NextResponse.next({
            request: {
              headers: request.headers,
            },
          })
          response.cookies.set({
            name,
            value: '',
            ...options,
          })
        },
      },
    }
  )

  // Atualiza a sessão do usuário. Essencial para Server Components e API Routes.
  await supabase.auth.getSession()

  const csp = [
    "default-src 'self'",
    "base-uri 'self'",
    "form-action 'self'",
    "frame-ancestors 'self'",
    "object-src 'none'",
    "script-src 'self' 'unsafe-inline' 'unsafe-eval'",
    "style-src 'self' 'unsafe-inline'",
    "img-src 'self' data: https:",
    "font-src 'self' data:",
    "connect-src 'self' https://*.supabase.co wss://*.supabase.co",
    'upgrade-insecure-requests',
  ].join('; ')

  response.headers.set('Content-Security-Policy', csp)
  response.headers.set('X-Frame-Options', 'SAMEORIGIN')
  response.headers.set('X-Content-Type-Options', 'nosniff')
  response.headers.set('Referrer-Policy', 'strict-origin-when-cross-origin')
  response.headers.set('Permissions-Policy', 'camera=(), microphone=(), geolocation=()')
  response.headers.set('Strict-Transport-Security', 'max-age=31536000; includeSubDomains; preload')

  const origin = request.headers.get('origin') || ''
  if (origin === allowedOrigin) {
    response.headers.set('Access-Control-Allow-Origin', allowedOrigin)
    response.headers.set('Vary', 'Origin')
  } else {
    response.headers.delete('Access-Control-Allow-Origin')
  }

  const path = request.nextUrl.pathname
  const isStaticAsset =
    path.startsWith('/_next/') ||
    path === '/favicon.ico' ||
    /\.(png|jpg|jpeg|gif|svg|webp|ico|css|js|map)$/.test(path)
  if (!isStaticAsset) {
    response.headers.set('Cache-Control', 'no-store')
  }

  return response
}

export const config = {
  matcher: [
    '/api/change-password/:path*',
    '/((?!_next/static|_next/image|favicon.ico|.*\\.png|.*\\.jpg|.*\\.jpeg|.*\\.gif|.*\\.svg|.*\\.webp).*)',
  ],
}

================
File: src/utils/errorHandler.ts
================
interface ErrorInfo {
  componentStack?: string;
}

export const logError = (error: Error, errorInfo?: ErrorInfo) => {
  console.error('Error:', error);
  if (errorInfo?.componentStack) {
    console.error('Error component stack:', errorInfo.componentStack);
  }
  
  // Here you can add error reporting service integration
  // For example, with Sentry:
  // if (process.env.NODE_ENV === 'production') {
  //   Sentry.captureException(error, { extra: { errorInfo } });
  // }
};

export const handlePromiseError = (promise: Promise<any>) => {
  return promise.catch(error => {
    logError(error);
    throw error; // Re-throw to allow further error handling if needed
  });
};

export const withErrorHandling = <T extends any[], R>(
  fn: (...args: T) => Promise<R>
) => {
  return async (...args: T): Promise<R | void> => {
    try {
      return await fn(...args);
    } catch (error) {
      logError(error as Error);
      // You might want to show a user-friendly message here
      throw error; // Re-throw to allow further error handling if needed
    }
  };
};

================
File: src/utils/errors.ts
================
export function normalizeError(input: unknown, fallbackMessage = 'Erro inesperado'): Error {
	if (input instanceof Error) return input;
	if (typeof input === 'string') return new Error(input);
	try {
		// Tenta serializar para capturar objetos como Event
		const maybe = JSON.stringify(input);
		return new Error(maybe && maybe !== '{}' ? maybe : fallbackMessage);
	} catch {
		return new Error(fallbackMessage);
	}
}

================
File: tsconfig.json
================
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "forceConsistentCasingInFileNames": true,
    "types": ["node", "react", "react-dom"],
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts"],
  "exclude": ["node_modules"]
}
